Index: dist/assets/index-XeKldO1I.js
===================================================================
diff --git a/dist/assets/index-XeKldO1I.js b/dist/assets/index-XeKldO1I.js
deleted file mode 100644
--- a/dist/assets/index-XeKldO1I.js	(revision 8f975f13449215f9523e04b8741069004d457444)
+++ /dev/null	(revision 8f975f13449215f9523e04b8741069004d457444)
@@ -1,2142 +0,0 @@
-var RC=Object.defineProperty;var LC=(l,f,v)=>f in l?RC(l,f,{enumerable:!0,configurable:!0,writable:!0,value:v}):l[f]=v;var vs=(l,f,v)=>(LC(l,typeof f!="symbol"?f+"":f,v),v);(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const A of document.querySelectorAll('link[rel="modulepreload"]'))b(A);new MutationObserver(A=>{for(const R of A)if(R.type==="childList")for(const z of R.addedNodes)z.tagName==="LINK"&&z.rel==="modulepreload"&&b(z)}).observe(document,{childList:!0,subtree:!0});function v(A){const R={};return A.integrity&&(R.integrity=A.integrity),A.referrerPolicy&&(R.referrerPolicy=A.referrerPolicy),A.crossOrigin==="use-credentials"?R.credentials="include":A.crossOrigin==="anonymous"?R.credentials="omit":R.credentials="same-origin",R}function b(A){if(A.ep)return;A.ep=!0;const R=v(A);fetch(A.href,R)}})();/**
-* @vue/shared v3.4.38
-* (c) 2018-present Yuxi (Evan) You and Vue contributors
-* @license MIT
-**//*! #__NO_SIDE_EFFECTS__ */function _0(l,f){const v=new Set(l.split(","));return f?b=>v.has(b.toLowerCase()):b=>v.has(b)}const ln={},nh=[],Xs=()=>{},DC=()=>!1,p_=l=>l.charCodeAt(0)===111&&l.charCodeAt(1)===110&&(l.charCodeAt(2)>122||l.charCodeAt(2)<97),g0=l=>l.startsWith("onUpdate:"),Nn=Object.assign,y0=(l,f)=>{const v=l.indexOf(f);v>-1&&l.splice(v,1)},OC=Object.prototype.hasOwnProperty,Er=(l,f)=>OC.call(l,f),Fi=Array.isArray,sh=l=>m_(l)==="[object Map]",IT=l=>m_(l)==="[object Set]",ir=l=>typeof l=="function",_n=l=>typeof l=="string",Pl=l=>typeof l=="symbol",en=l=>l!==null&&typeof l=="object",CT=l=>(en(l)||ir(l))&&ir(l.then)&&ir(l.catch),PT=Object.prototype.toString,m_=l=>PT.call(l),zC=l=>m_(l).slice(8,-1),RT=l=>m_(l)==="[object Object]",v0=l=>_n(l)&&l!=="NaN"&&l[0]!=="-"&&""+parseInt(l,10)===l,Mf=_0(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),__=l=>{const f=Object.create(null);return v=>f[v]||(f[v]=l(v))},kC=/-(\w)/g,vo=__(l=>l.replace(kC,(f,v)=>v?v.toUpperCase():"")),BC=/\B([A-Z])/g,Wc=__(l=>l.replace(BC,"-$1").toLowerCase()),g_=__(l=>l.charAt(0).toUpperCase()+l.slice(1)),Xm=__(l=>l?`on${g_(l)}`:""),Sl=(l,f)=>!Object.is(l,f),Km=(l,...f)=>{for(let v=0;v<l.length;v++)l[v](...f)},LT=(l,f,v,b=!1)=>{Object.defineProperty(l,f,{configurable:!0,enumerable:!1,writable:b,value:v})},Ky=l=>{const f=parseFloat(l);return isNaN(f)?l:f},FC=l=>{const f=_n(l)?Number(l):NaN;return isNaN(f)?l:f};let nw;const DT=()=>nw||(nw=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function y_(l){if(Fi(l)){const f={};for(let v=0;v<l.length;v++){const b=l[v],A=_n(b)?jC(b):y_(b);if(A)for(const R in A)f[R]=A[R]}return f}else if(_n(l)||en(l))return l}const NC=/;(?![^(]*\))/g,VC=/:([^]+)/,UC=/\/\*[^]*?\*\//g;function jC(l){const f={};return l.replace(UC,"").split(NC).forEach(v=>{if(v){const b=v.split(VC);b.length>1&&(f[b[0].trim()]=b[1].trim())}}),f}function Xo(l){let f="";if(_n(l))f=l;else if(Fi(l))for(let v=0;v<l.length;v++){const b=Xo(l[v]);b&&(f+=b+" ")}else if(en(l))for(const v in l)l[v]&&(f+=v+" ");return f.trim()}function mo(l){if(!l)return null;let{class:f,style:v}=l;return f&&!_n(f)&&(l.class=Xo(f)),v&&(l.style=y_(v)),l}const GC="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",$C=_0(GC);function OT(l){return!!l||l===""}const zT=l=>!!(l&&l.__v_isRef===!0),Nr=l=>_n(l)?l:l==null?"":Fi(l)||en(l)&&(l.toString===PT||!ir(l.toString))?zT(l)?Nr(l.value):JSON.stringify(l,kT,2):String(l),kT=(l,f)=>zT(f)?kT(l,f.value):sh(f)?{[`Map(${f.size})`]:[...f.entries()].reduce((v,[b,A],R)=>(v[Iy(b,R)+" =>"]=A,v),{})}:IT(f)?{[`Set(${f.size})`]:[...f.values()].map(v=>Iy(v))}:Pl(f)?Iy(f):en(f)&&!Fi(f)&&!RT(f)?String(f):f,Iy=(l,f="")=>{var v;return Pl(l)?`Symbol(${(v=l.description)!=null?v:f})`:l};/**
-* @vue/reactivity v3.4.38
-* (c) 2018-present Yuxi (Evan) You and Vue contributors
-* @license MIT
-**/let Fs;class BT{constructor(f=!1){this.detached=f,this._active=!0,this.effects=[],this.cleanups=[],this.parent=Fs,!f&&Fs&&(this.index=(Fs.scopes||(Fs.scopes=[])).push(this)-1)}get active(){return this._active}run(f){if(this._active){const v=Fs;try{return Fs=this,f()}finally{Fs=v}}}on(){Fs=this}off(){Fs=this.parent}stop(f){if(this._active){let v,b;for(v=0,b=this.effects.length;v<b;v++)this.effects[v].stop();for(v=0,b=this.cleanups.length;v<b;v++)this.cleanups[v]();if(this.scopes)for(v=0,b=this.scopes.length;v<b;v++)this.scopes[v].stop(!0);if(!this.detached&&this.parent&&!f){const A=this.parent.scopes.pop();A&&A!==this&&(this.parent.scopes[this.index]=A,A.index=this.index)}this.parent=void 0,this._active=!1}}}function FT(l){return new BT(l)}function qC(l,f=Fs){f&&f.active&&f.effects.push(l)}function NT(){return Fs}function ZC(l){Fs&&Fs.cleanups.push(l)}let Vc;class x0{constructor(f,v,b,A){this.fn=f,this.trigger=v,this.scheduler=b,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,qC(this,A)}get dirty(){if(this._dirtyLevel===2||this._dirtyLevel===3){this._dirtyLevel=1,Rl();for(let f=0;f<this._depsLength;f++){const v=this.deps[f];if(v.computed&&(HC(v.computed),this._dirtyLevel>=4))break}this._dirtyLevel===1&&(this._dirtyLevel=0),Ll()}return this._dirtyLevel>=4}set dirty(f){this._dirtyLevel=f?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let f=bl,v=Vc;try{return bl=!0,Vc=this,this._runnings++,sw(this),this.fn()}finally{ow(this),this._runnings--,Vc=v,bl=f}}stop(){this.active&&(sw(this),ow(this),this.onStop&&this.onStop(),this.active=!1)}}function HC(l){return l.value}function sw(l){l._trackId++,l._depsLength=0}function ow(l){if(l.deps.length>l._depsLength){for(let f=l._depsLength;f<l.deps.length;f++)VT(l.deps[f],l);l.deps.length=l._depsLength}}function VT(l,f){const v=l.get(f);v!==void 0&&f._trackId!==v&&(l.delete(f),l.size===0&&l.cleanup())}let bl=!0,Yy=0;const UT=[];function Rl(){UT.push(bl),bl=!1}function Ll(){const l=UT.pop();bl=l===void 0?!0:l}function b0(){Yy++}function w0(){for(Yy--;!Yy&&Jy.length;)Jy.shift()()}function jT(l,f,v){if(f.get(l)!==l._trackId){f.set(l,l._trackId);const b=l.deps[l._depsLength];b!==f?(b&&VT(b,l),l.deps[l._depsLength++]=f):l._depsLength++}}const Jy=[];function GT(l,f,v){b0();for(const b of l.keys()){let A;b._dirtyLevel<f&&(A??(A=l.get(b)===b._trackId))&&(b._shouldSchedule||(b._shouldSchedule=b._dirtyLevel===0),b._dirtyLevel=f),b._shouldSchedule&&(A??(A=l.get(b)===b._trackId))&&(b.trigger(),(!b._runnings||b.allowRecurse)&&b._dirtyLevel!==2&&(b._shouldSchedule=!1,b.scheduler&&Jy.push(b.scheduler)))}w0()}const $T=(l,f)=>{const v=new Map;return v.cleanup=l,v.computed=f,v},i_=new WeakMap,Uc=Symbol(""),Qy=Symbol("");function ws(l,f,v){if(bl&&Vc){let b=i_.get(l);b||i_.set(l,b=new Map);let A=b.get(v);A||b.set(v,A=$T(()=>b.delete(v))),jT(Vc,A)}}function Ta(l,f,v,b,A,R){const z=i_.get(l);if(!z)return;let G=[];if(f==="clear")G=[...z.values()];else if(v==="length"&&Fi(l)){const o=Number(b);z.forEach((Y,ie)=>{(ie==="length"||!Pl(ie)&&ie>=o)&&G.push(Y)})}else switch(v!==void 0&&G.push(z.get(v)),f){case"add":Fi(l)?v0(v)&&G.push(z.get("length")):(G.push(z.get(Uc)),sh(l)&&G.push(z.get(Qy)));break;case"delete":Fi(l)||(G.push(z.get(Uc)),sh(l)&&G.push(z.get(Qy)));break;case"set":sh(l)&&G.push(z.get(Uc));break}b0();for(const o of G)o&&GT(o,4);w0()}function WC(l,f){const v=i_.get(l);return v&&v.get(f)}const XC=_0("__proto__,__v_isRef,__isVue"),qT=new Set(Object.getOwnPropertyNames(Symbol).filter(l=>l!=="arguments"&&l!=="caller").map(l=>Symbol[l]).filter(Pl)),aw=KC();function KC(){const l={};return["includes","indexOf","lastIndexOf"].forEach(f=>{l[f]=function(...v){const b=Sr(this);for(let R=0,z=this.length;R<z;R++)ws(b,"get",R+"");const A=b[f](...v);return A===-1||A===!1?b[f](...v.map(Sr)):A}}),["push","pop","shift","unshift","splice"].forEach(f=>{l[f]=function(...v){Rl(),b0();const b=Sr(this)[f].apply(this,v);return w0(),Ll(),b}}),l}function YC(l){Pl(l)||(l=String(l));const f=Sr(this);return ws(f,"has",l),f.hasOwnProperty(l)}class ZT{constructor(f=!1,v=!1){this._isReadonly=f,this._isShallow=v}get(f,v,b){const A=this._isReadonly,R=this._isShallow;if(v==="__v_isReactive")return!A;if(v==="__v_isReadonly")return A;if(v==="__v_isShallow")return R;if(v==="__v_raw")return b===(A?R?uP:KT:R?XT:WT).get(f)||Object.getPrototypeOf(f)===Object.getPrototypeOf(b)?f:void 0;const z=Fi(f);if(!A){if(z&&Er(aw,v))return Reflect.get(aw,v,b);if(v==="hasOwnProperty")return YC}const G=Reflect.get(f,v,b);return(Pl(v)?qT.has(v):XC(v))||(A||ws(f,"get",v),R)?G:Ln(G)?z&&v0(v)?G:G.value:en(G)?A?JT(G):jf(G):G}}class HT extends ZT{constructor(f=!1){super(!1,f)}set(f,v,b,A){let R=f[v];if(!this._isShallow){const o=Zc(R);if(!uh(b)&&!Zc(b)&&(R=Sr(R),b=Sr(b)),!Fi(f)&&Ln(R)&&!Ln(b))return o?!1:(R.value=b,!0)}const z=Fi(f)&&v0(v)?Number(v)<f.length:Er(f,v),G=Reflect.set(f,v,b,A);return f===Sr(A)&&(z?Sl(b,R)&&Ta(f,"set",v,b):Ta(f,"add",v,b)),G}deleteProperty(f,v){const b=Er(f,v);f[v];const A=Reflect.deleteProperty(f,v);return A&&b&&Ta(f,"delete",v,void 0),A}has(f,v){const b=Reflect.has(f,v);return(!Pl(v)||!qT.has(v))&&ws(f,"has",v),b}ownKeys(f){return ws(f,"iterate",Fi(f)?"length":Uc),Reflect.ownKeys(f)}}class JC extends ZT{constructor(f=!1){super(!0,f)}set(f,v){return!0}deleteProperty(f,v){return!0}}const QC=new HT,eP=new JC,tP=new HT(!0);const T0=l=>l,v_=l=>Reflect.getPrototypeOf(l);function Vm(l,f,v=!1,b=!1){l=l.__v_raw;const A=Sr(l),R=Sr(f);v||(Sl(f,R)&&ws(A,"get",f),ws(A,"get",R));const{has:z}=v_(A),G=b?T0:v?A0:Of;if(z.call(A,f))return G(l.get(f));if(z.call(A,R))return G(l.get(R));l!==A&&l.get(f)}function Um(l,f=!1){const v=this.__v_raw,b=Sr(v),A=Sr(l);return f||(Sl(l,A)&&ws(b,"has",l),ws(b,"has",A)),l===A?v.has(l):v.has(l)||v.has(A)}function jm(l,f=!1){return l=l.__v_raw,!f&&ws(Sr(l),"iterate",Uc),Reflect.get(l,"size",l)}function lw(l,f=!1){!f&&!uh(l)&&!Zc(l)&&(l=Sr(l));const v=Sr(this);return v_(v).has.call(v,l)||(v.add(l),Ta(v,"add",l,l)),this}function cw(l,f,v=!1){!v&&!uh(f)&&!Zc(f)&&(f=Sr(f));const b=Sr(this),{has:A,get:R}=v_(b);let z=A.call(b,l);z||(l=Sr(l),z=A.call(b,l));const G=R.call(b,l);return b.set(l,f),z?Sl(f,G)&&Ta(b,"set",l,f):Ta(b,"add",l,f),this}function uw(l){const f=Sr(this),{has:v,get:b}=v_(f);let A=v.call(f,l);A||(l=Sr(l),A=v.call(f,l)),b&&b.call(f,l);const R=f.delete(l);return A&&Ta(f,"delete",l,void 0),R}function hw(){const l=Sr(this),f=l.size!==0,v=l.clear();return f&&Ta(l,"clear",void 0,void 0),v}function Gm(l,f){return function(b,A){const R=this,z=R.__v_raw,G=Sr(z),o=f?T0:l?A0:Of;return!l&&ws(G,"iterate",Uc),z.forEach((Y,ie)=>b.call(A,o(Y),o(ie),R))}}function $m(l,f,v){return function(...b){const A=this.__v_raw,R=Sr(A),z=sh(R),G=l==="entries"||l===Symbol.iterator&&z,o=l==="keys"&&z,Y=A[l](...b),ie=v?T0:f?A0:Of;return!f&&ws(R,"iterate",o?Qy:Uc),{next(){const{value:K,done:de}=Y.next();return de?{value:K,done:de}:{value:G?[ie(K[0]),ie(K[1])]:ie(K),done:de}},[Symbol.iterator](){return this}}}}function ul(l){return function(...f){return l==="delete"?!1:l==="clear"?void 0:this}}function iP(){const l={get(R){return Vm(this,R)},get size(){return jm(this)},has:Um,add:lw,set:cw,delete:uw,clear:hw,forEach:Gm(!1,!1)},f={get(R){return Vm(this,R,!1,!0)},get size(){return jm(this)},has:Um,add(R){return lw.call(this,R,!0)},set(R,z){return cw.call(this,R,z,!0)},delete:uw,clear:hw,forEach:Gm(!1,!0)},v={get(R){return Vm(this,R,!0)},get size(){return jm(this,!0)},has(R){return Um.call(this,R,!0)},add:ul("add"),set:ul("set"),delete:ul("delete"),clear:ul("clear"),forEach:Gm(!0,!1)},b={get(R){return Vm(this,R,!0,!0)},get size(){return jm(this,!0)},has(R){return Um.call(this,R,!0)},add:ul("add"),set:ul("set"),delete:ul("delete"),clear:ul("clear"),forEach:Gm(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(R=>{l[R]=$m(R,!1,!1),v[R]=$m(R,!0,!1),f[R]=$m(R,!1,!0),b[R]=$m(R,!0,!0)}),[l,v,f,b]}const[rP,nP,sP,oP]=iP();function E0(l,f){const v=f?l?oP:sP:l?nP:rP;return(b,A,R)=>A==="__v_isReactive"?!l:A==="__v_isReadonly"?l:A==="__v_raw"?b:Reflect.get(Er(v,A)&&A in b?v:b,A,R)}const aP={get:E0(!1,!1)},lP={get:E0(!1,!0)},cP={get:E0(!0,!1)};const WT=new WeakMap,XT=new WeakMap,KT=new WeakMap,uP=new WeakMap;function hP(l){switch(l){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function dP(l){return l.__v_skip||!Object.isExtensible(l)?0:hP(zC(l))}function jf(l){return Zc(l)?l:S0(l,!1,QC,aP,WT)}function YT(l){return S0(l,!1,tP,lP,XT)}function JT(l){return S0(l,!0,eP,cP,KT)}function S0(l,f,v,b,A){if(!en(l)||l.__v_raw&&!(f&&l.__v_isReactive))return l;const R=A.get(l);if(R)return R;const z=dP(l);if(z===0)return l;const G=new Proxy(l,z===2?b:v);return A.set(l,G),G}function jc(l){return Zc(l)?jc(l.__v_raw):!!(l&&l.__v_isReactive)}function Zc(l){return!!(l&&l.__v_isReadonly)}function uh(l){return!!(l&&l.__v_isShallow)}function QT(l){return l?!!l.__v_raw:!1}function Sr(l){const f=l&&l.__v_raw;return f?Sr(f):l}function M0(l){return Object.isExtensible(l)&&LT(l,"__v_skip",!0),l}const Of=l=>en(l)?jf(l):l,A0=l=>en(l)?JT(l):l;class eE{constructor(f,v,b,A){this.getter=f,this._setter=v,this.dep=void 0,this.__v_isRef=!0,this.__v_isReadonly=!1,this.effect=new x0(()=>f(this._value),()=>Ym(this,this.effect._dirtyLevel===2?2:3)),this.effect.computed=this,this.effect.active=this._cacheable=!A,this.__v_isReadonly=b}get value(){const f=Sr(this);return(!f._cacheable||f.effect.dirty)&&Sl(f._value,f._value=f.effect.run())&&Ym(f,4),tE(f),f.effect._dirtyLevel>=2&&Ym(f,2),f._value}set value(f){this._setter(f)}get _dirty(){return this.effect.dirty}set _dirty(f){this.effect.dirty=f}}function fP(l,f,v=!1){let b,A;const R=ir(l);return R?(b=l,A=Xs):(b=l.get,A=l.set),new eE(b,A,R||!A,v)}function tE(l){var f;bl&&Vc&&(l=Sr(l),jT(Vc,(f=l.dep)!=null?f:l.dep=$T(()=>l.dep=void 0,l instanceof eE?l:void 0)))}function Ym(l,f=4,v,b){l=Sr(l);const A=l.dep;A&&GT(A,f)}function Ln(l){return!!(l&&l.__v_isRef===!0)}function Bi(l){return iE(l,!1)}function pP(l){return iE(l,!0)}function iE(l,f){return Ln(l)?l:new mP(l,f)}class mP{constructor(f,v){this.__v_isShallow=v,this.dep=void 0,this.__v_isRef=!0,this._rawValue=v?f:Sr(f),this._value=v?f:Of(f)}get value(){return tE(this),this._value}set value(f){const v=this.__v_isShallow||uh(f)||Zc(f);f=v?f:Sr(f),Sl(f,this._rawValue)&&(this._rawValue,this._rawValue=f,this._value=v?f:Of(f),Ym(this,4))}}function wr(l){return Ln(l)?l.value:l}const _P={get:(l,f,v)=>wr(Reflect.get(l,f,v)),set:(l,f,v,b)=>{const A=l[f];return Ln(A)&&!Ln(v)?(A.value=v,!0):Reflect.set(l,f,v,b)}};function rE(l){return jc(l)?l:new Proxy(l,_P)}function gP(l){const f=Fi(l)?new Array(l.length):{};for(const v in l)f[v]=vP(l,v);return f}class yP{constructor(f,v,b){this._object=f,this._key=v,this._defaultValue=b,this.__v_isRef=!0}get value(){const f=this._object[this._key];return f===void 0?this._defaultValue:f}set value(f){this._object[this._key]=f}get dep(){return WC(Sr(this._object),this._key)}}function vP(l,f,v){const b=l[f];return Ln(b)?b:new yP(l,f,v)}/**
-* @vue/runtime-core v3.4.38
-* (c) 2018-present Yuxi (Evan) You and Vue contributors
-* @license MIT
-**/function wl(l,f,v,b){try{return b?l(...b):l()}catch(A){x_(A,f,v)}}function Ks(l,f,v,b){if(ir(l)){const A=wl(l,f,v,b);return A&&CT(A)&&A.catch(R=>{x_(R,f,v)}),A}if(Fi(l)){const A=[];for(let R=0;R<l.length;R++)A.push(Ks(l[R],f,v,b));return A}}function x_(l,f,v,b=!0){const A=f?f.vnode:null;if(f){let R=f.parent;const z=f.proxy,G=`https://vuejs.org/error-reference/#runtime-${v}`;for(;R;){const Y=R.ec;if(Y){for(let ie=0;ie<Y.length;ie++)if(Y[ie](l,z,G)===!1)return}R=R.parent}const o=f.appContext.config.errorHandler;if(o){Rl(),wl(o,null,10,[l,z,G]),Ll();return}}xP(l,v,A,b)}function xP(l,f,v,b=!0){console.error(l)}let zf=!1,e0=!1;const ts=[];let Wo=0;const oh=[];let _l=null,Fc=0;const nE=Promise.resolve();let I0=null;function C0(l){const f=I0||nE;return l?f.then(this?l.bind(this):l):f}function bP(l){let f=Wo+1,v=ts.length;for(;f<v;){const b=f+v>>>1,A=ts[b],R=kf(A);R<l||R===l&&A.pre?f=b+1:v=b}return f}function P0(l){(!ts.length||!ts.includes(l,zf&&l.allowRecurse?Wo+1:Wo))&&(l.id==null?ts.push(l):ts.splice(bP(l.id),0,l),sE())}function sE(){!zf&&!e0&&(e0=!0,I0=nE.then(aE))}function wP(l){const f=ts.indexOf(l);f>Wo&&ts.splice(f,1)}function TP(l){Fi(l)?oh.push(...l):(!_l||!_l.includes(l,l.allowRecurse?Fc+1:Fc))&&oh.push(l),sE()}function dw(l,f,v=zf?Wo+1:0){for(;v<ts.length;v++){const b=ts[v];if(b&&b.pre){if(l&&b.id!==l.uid)continue;ts.splice(v,1),v--,b()}}}function oE(l){if(oh.length){const f=[...new Set(oh)].sort((v,b)=>kf(v)-kf(b));if(oh.length=0,_l){_l.push(...f);return}for(_l=f,Fc=0;Fc<_l.length;Fc++){const v=_l[Fc];v.active!==!1&&v()}_l=null,Fc=0}}const kf=l=>l.id==null?1/0:l.id,EP=(l,f)=>{const v=kf(l)-kf(f);if(v===0){if(l.pre&&!f.pre)return-1;if(f.pre&&!l.pre)return 1}return v};function aE(l){e0=!1,zf=!0,ts.sort(EP);try{for(Wo=0;Wo<ts.length;Wo++){const f=ts[Wo];f&&f.active!==!1&&wl(f,f.i,f.i?15:14)}}finally{Wo=0,ts.length=0,oE(),zf=!1,I0=null,(ts.length||oh.length)&&aE()}}let Rn=null,b_=null;function r_(l){const f=Rn;return Rn=l,b_=l&&l.type.__scopeId||null,f}function SP(l){b_=l}function MP(){b_=null}function go(l,f=Rn,v){if(!f||l._n)return l;const b=(...A)=>{b._d&&ww(-1);const R=r_(f);let z;try{z=l(...A)}finally{r_(R),b._d&&ww(1)}return z};return b._n=!0,b._c=!0,b._d=!0,b}function Tl(l,f){if(Rn===null)return l;const v=A_(Rn),b=l.dirs||(l.dirs=[]);for(let A=0;A<f.length;A++){let[R,z,G,o=ln]=f[A];R&&(ir(R)&&(R={mounted:R,updated:R}),R.deep&&xl(z),b.push({dir:R,instance:v,value:z,oldValue:void 0,arg:G,modifiers:o}))}return l}function Rc(l,f,v,b){const A=l.dirs,R=f&&f.dirs;for(let z=0;z<A.length;z++){const G=A[z];R&&(G.oldValue=R[z].value);let o=G.dir[b];o&&(Rl(),Ks(o,v,8,[l.el,G,l,f]),Ll())}}const gl=Symbol("_leaveCb"),qm=Symbol("_enterCb");function AP(){const l={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return bo(()=>{l.isMounted=!0}),pE(()=>{l.isUnmounting=!0}),l}const Hs=[Function,Array],lE={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Hs,onEnter:Hs,onAfterEnter:Hs,onEnterCancelled:Hs,onBeforeLeave:Hs,onLeave:Hs,onAfterLeave:Hs,onLeaveCancelled:Hs,onBeforeAppear:Hs,onAppear:Hs,onAfterAppear:Hs,onAppearCancelled:Hs},cE=l=>{const f=l.subTree;return f.component?cE(f.component):f},IP={name:"BaseTransition",props:lE,setup(l,{slots:f}){const v=SR(),b=AP();return()=>{const A=f.default&&hE(f.default(),!0);if(!A||!A.length)return;let R=A[0];if(A.length>1){for(const de of A)if(de.type!==bs){R=de;break}}const z=Sr(l),{mode:G}=z;if(b.isLeaving)return Cy(R);const o=fw(R);if(!o)return Cy(R);let Y=t0(o,z,b,v,de=>Y=de);n_(o,Y);const ie=v.subTree,K=ie&&fw(ie);if(K&&K.type!==bs&&!Nc(o,K)&&cE(v).type!==bs){const de=t0(K,z,b,v);if(n_(K,de),G==="out-in"&&o.type!==bs)return b.isLeaving=!0,de.afterLeave=()=>{b.isLeaving=!1,v.update.active!==!1&&(v.effect.dirty=!0,v.update())},Cy(R);G==="in-out"&&o.type!==bs&&(de.delayLeave=(ce,Ee,Ue)=>{const $e=uE(b,K);$e[String(K.key)]=K,ce[gl]=()=>{Ee(),ce[gl]=void 0,delete Y.delayedLeave},Y.delayedLeave=Ue})}return R}}},CP=IP;function uE(l,f){const{leavingVNodes:v}=l;let b=v.get(f.type);return b||(b=Object.create(null),v.set(f.type,b)),b}function t0(l,f,v,b,A){const{appear:R,mode:z,persisted:G=!1,onBeforeEnter:o,onEnter:Y,onAfterEnter:ie,onEnterCancelled:K,onBeforeLeave:de,onLeave:ce,onAfterLeave:Ee,onLeaveCancelled:Ue,onBeforeAppear:$e,onAppear:et,onAfterAppear:ht,onAppearCancelled:Xe}=f,$t=String(l.key),kt=uE(v,l),At=(Ie,Ti)=>{Ie&&Ks(Ie,b,9,Ti)},_i=(Ie,Ti)=>{const Wi=Ti[1];At(Ie,Ti),Fi(Ie)?Ie.every(dt=>dt.length<=1)&&Wi():Ie.length<=1&&Wi()},ai={mode:z,persisted:G,beforeEnter(Ie){let Ti=o;if(!v.isMounted)if(R)Ti=$e||o;else return;Ie[gl]&&Ie[gl](!0);const Wi=kt[$t];Wi&&Nc(l,Wi)&&Wi.el[gl]&&Wi.el[gl](),At(Ti,[Ie])},enter(Ie){let Ti=Y,Wi=ie,dt=K;if(!v.isMounted)if(R)Ti=et||Y,Wi=ht||ie,dt=Xe||K;else return;let Ei=!1;const Dr=Ie[qm]=tt=>{Ei||(Ei=!0,tt?At(dt,[Ie]):At(Wi,[Ie]),ai.delayedLeave&&ai.delayedLeave(),Ie[qm]=void 0)};Ti?_i(Ti,[Ie,Dr]):Dr()},leave(Ie,Ti){const Wi=String(l.key);if(Ie[qm]&&Ie[qm](!0),v.isUnmounting)return Ti();At(de,[Ie]);let dt=!1;const Ei=Ie[gl]=Dr=>{dt||(dt=!0,Ti(),Dr?At(Ue,[Ie]):At(Ee,[Ie]),Ie[gl]=void 0,kt[Wi]===l&&delete kt[Wi])};kt[Wi]=l,ce?_i(ce,[Ie,Ei]):Ei()},clone(Ie){const Ti=t0(Ie,f,v,b,A);return A&&A(Ti),Ti}};return ai}function Cy(l){if(w_(l))return l=Ml(l),l.children=null,l}function fw(l){if(!w_(l))return l;const{shapeFlag:f,children:v}=l;if(v){if(f&16)return v[0];if(f&32&&ir(v.default))return v.default()}}function n_(l,f){l.shapeFlag&6&&l.component?n_(l.component.subTree,f):l.shapeFlag&128?(l.ssContent.transition=f.clone(l.ssContent),l.ssFallback.transition=f.clone(l.ssFallback)):l.transition=f}function hE(l,f=!1,v){let b=[],A=0;for(let R=0;R<l.length;R++){let z=l[R];const G=v==null?z.key:String(v)+String(z.key!=null?z.key:R);z.type===Gr?(z.patchFlag&128&&A++,b=b.concat(hE(z.children,f,G))):(f||z.type!==bs)&&b.push(G!=null?Ml(z,{key:G}):z)}if(A>1)for(let R=0;R<b.length;R++)b[R].patchFlag=-2;return b}/*! #__NO_SIDE_EFFECTS__ */function is(l,f){return ir(l)?Nn({name:l.name},f,{setup:l}):l}const Af=l=>!!l.type.__asyncLoader,w_=l=>l.type.__isKeepAlive;function PP(l,f){dE(l,"a",f)}function RP(l,f){dE(l,"da",f)}function dE(l,f,v=Fn){const b=l.__wdc||(l.__wdc=()=>{let A=v;for(;A;){if(A.isDeactivated)return;A=A.parent}return l()});if(T_(f,b,v),v){let A=v.parent;for(;A&&A.parent;)w_(A.parent.vnode)&&LP(b,f,v,A),A=A.parent}}function LP(l,f,v,b){const A=T_(f,l,b,!0);Gf(()=>{y0(b[f],A)},v)}function T_(l,f,v=Fn,b=!1){if(v){const A=v[l]||(v[l]=[]),R=f.__weh||(f.__weh=(...z)=>{Rl();const G=$f(v),o=Ks(f,v,l,z);return G(),Ll(),o});return b?A.unshift(R):A.push(R),R}}const Ea=l=>(f,v=Fn)=>{(!M_||l==="sp")&&T_(l,(...b)=>f(...b),v)},fE=Ea("bm"),bo=Ea("m"),DP=Ea("bu"),OP=Ea("u"),pE=Ea("bum"),Gf=Ea("um"),zP=Ea("sp"),kP=Ea("rtg"),BP=Ea("rtc");function FP(l,f=Fn){T_("ec",l,f)}const R0="components",NP="directives";function L0(l,f){return D0(R0,l,!0,f)||l}const mE=Symbol.for("v-ndc");function Py(l){return _n(l)?D0(R0,l,!1)||l:l||mE}function VP(l){return D0(NP,l)}function D0(l,f,v=!0,b=!1){const A=Rn||Fn;if(A){const R=A.type;if(l===R0){const G=PR(R,!1);if(G&&(G===f||G===vo(f)||G===g_(vo(f))))return R}const z=pw(A[l]||R[l],f)||pw(A.appContext[l],f);return!z&&b?R:z}}function pw(l,f){return l&&(l[f]||l[vo(f)]||l[g_(vo(f))])}function Ko(l,f,v,b){let A;const R=v&&v[b];if(Fi(l)||_n(l)){A=new Array(l.length);for(let z=0,G=l.length;z<G;z++)A[z]=f(l[z],z,void 0,R&&R[z])}else if(typeof l=="number"){A=new Array(l);for(let z=0;z<l;z++)A[z]=f(z+1,z,void 0,R&&R[z])}else if(en(l))if(l[Symbol.iterator])A=Array.from(l,(z,G)=>f(z,G,void 0,R&&R[G]));else{const z=Object.keys(l);A=new Array(z.length);for(let G=0,o=z.length;G<o;G++){const Y=z[G];A[G]=f(l[Y],Y,G,R&&R[G])}}else A=[];return v&&(v[b]=A),A}function Bs(l,f,v={},b,A){if(Rn.isCE||Rn.parent&&Af(Rn.parent)&&Rn.parent.isCE)return f!=="default"&&(v.name=f),Cr("slot",v,b&&b());let R=l[f];R&&R._c&&(R._d=!1),ri();const z=R&&_E(R(v)),G=$c(Gr,{key:(v.key||z&&z.key||`_${f}`)+(!z&&b?"_fb":"")},z||(b?b():[]),z&&l._===1?64:-2);return!A&&G.scopeId&&(G.slotScopeIds=[G.scopeId+"-s"]),R&&R._c&&(R._d=!0),G}function _E(l){return l.some(f=>o_(f)?!(f.type===bs||f.type===Gr&&!_E(f.children)):!0)?l:null}function UP(l,f){const v={};for(const b in l)v[f&&/[A-Z]/.test(b)?`on:${b}`:Xm(b)]=l[b];return v}const i0=l=>l?zE(l)?A_(l):i0(l.parent):null,If=Nn(Object.create(null),{$:l=>l,$el:l=>l.vnode.el,$data:l=>l.data,$props:l=>l.props,$attrs:l=>l.attrs,$slots:l=>l.slots,$refs:l=>l.refs,$parent:l=>i0(l.parent),$root:l=>i0(l.root),$emit:l=>l.emit,$options:l=>O0(l),$forceUpdate:l=>l.f||(l.f=()=>{l.effect.dirty=!0,P0(l.update)}),$nextTick:l=>l.n||(l.n=C0.bind(l.proxy)),$watch:l=>hR.bind(l)}),Ry=(l,f)=>l!==ln&&!l.__isScriptSetup&&Er(l,f),jP={get({_:l},f){if(f==="__v_skip")return!0;const{ctx:v,setupState:b,data:A,props:R,accessCache:z,type:G,appContext:o}=l;let Y;if(f[0]!=="$"){const ce=z[f];if(ce!==void 0)switch(ce){case 1:return b[f];case 2:return A[f];case 4:return v[f];case 3:return R[f]}else{if(Ry(b,f))return z[f]=1,b[f];if(A!==ln&&Er(A,f))return z[f]=2,A[f];if((Y=l.propsOptions[0])&&Er(Y,f))return z[f]=3,R[f];if(v!==ln&&Er(v,f))return z[f]=4,v[f];r0&&(z[f]=0)}}const ie=If[f];let K,de;if(ie)return f==="$attrs"&&ws(l.attrs,"get",""),ie(l);if((K=G.__cssModules)&&(K=K[f]))return K;if(v!==ln&&Er(v,f))return z[f]=4,v[f];if(de=o.config.globalProperties,Er(de,f))return de[f]},set({_:l},f,v){const{data:b,setupState:A,ctx:R}=l;return Ry(A,f)?(A[f]=v,!0):b!==ln&&Er(b,f)?(b[f]=v,!0):Er(l.props,f)||f[0]==="$"&&f.slice(1)in l?!1:(R[f]=v,!0)},has({_:{data:l,setupState:f,accessCache:v,ctx:b,appContext:A,propsOptions:R}},z){let G;return!!v[z]||l!==ln&&Er(l,z)||Ry(f,z)||(G=R[0])&&Er(G,z)||Er(b,z)||Er(If,z)||Er(A.config.globalProperties,z)},defineProperty(l,f,v){return v.get!=null?l._.accessCache[f]=0:Er(v,"value")&&this.set(l,f,v.value,null),Reflect.defineProperty(l,f,v)}};function mw(l){return Fi(l)?l.reduce((f,v)=>(f[v]=null,f),{}):l}let r0=!0;function GP(l){const f=O0(l),v=l.proxy,b=l.ctx;r0=!1,f.beforeCreate&&_w(f.beforeCreate,l,"bc");const{data:A,computed:R,methods:z,watch:G,provide:o,inject:Y,created:ie,beforeMount:K,mounted:de,beforeUpdate:ce,updated:Ee,activated:Ue,deactivated:$e,beforeDestroy:et,beforeUnmount:ht,destroyed:Xe,unmounted:$t,render:kt,renderTracked:At,renderTriggered:_i,errorCaptured:ai,serverPrefetch:Ie,expose:Ti,inheritAttrs:Wi,components:dt,directives:Ei,filters:Dr}=f;if(Y&&$P(Y,b,null),z)for(const Zi in z){const Nt=z[Zi];ir(Nt)&&(b[Zi]=Nt.bind(v))}if(A){const Zi=A.call(v,v);en(Zi)&&(l.data=jf(Zi))}if(r0=!0,R)for(const Zi in R){const Nt=R[Zi],Dn=ir(Nt)?Nt.bind(v,v):ir(Nt.get)?Nt.get.bind(v,v):Xs,Cn=!ir(Nt)&&ir(Nt.set)?Nt.set.bind(v):Xs,tn=Ws({get:Dn,set:Cn});Object.defineProperty(b,Zi,{enumerable:!0,configurable:!0,get:()=>tn.value,set:gr=>tn.value=gr})}if(G)for(const Zi in G)gE(G[Zi],b,v,Zi);if(o){const Zi=ir(o)?o.call(v):o;Reflect.ownKeys(Zi).forEach(Nt=>{Jm(Nt,Zi[Nt])})}ie&&_w(ie,l,"c");function Ri(Zi,Nt){Fi(Nt)?Nt.forEach(Dn=>Zi(Dn.bind(v))):Nt&&Zi(Nt.bind(v))}if(Ri(fE,K),Ri(bo,de),Ri(DP,ce),Ri(OP,Ee),Ri(PP,Ue),Ri(RP,$e),Ri(FP,ai),Ri(BP,At),Ri(kP,_i),Ri(pE,ht),Ri(Gf,$t),Ri(zP,Ie),Fi(Ti))if(Ti.length){const Zi=l.exposed||(l.exposed={});Ti.forEach(Nt=>{Object.defineProperty(Zi,Nt,{get:()=>v[Nt],set:Dn=>v[Nt]=Dn})})}else l.exposed||(l.exposed={});kt&&l.render===Xs&&(l.render=kt),Wi!=null&&(l.inheritAttrs=Wi),dt&&(l.components=dt),Ei&&(l.directives=Ei)}function $P(l,f,v=Xs){Fi(l)&&(l=n0(l));for(const b in l){const A=l[b];let R;en(A)?"default"in A?R=yo(A.from||b,A.default,!0):R=yo(A.from||b):R=yo(A),Ln(R)?Object.defineProperty(f,b,{enumerable:!0,configurable:!0,get:()=>R.value,set:z=>R.value=z}):f[b]=R}}function _w(l,f,v){Ks(Fi(l)?l.map(b=>b.bind(f.proxy)):l.bind(f.proxy),f,v)}function gE(l,f,v,b){const A=b.includes(".")?RE(v,b):()=>v[b];if(_n(l)){const R=f[l];ir(R)&&El(A,R)}else if(ir(l))El(A,l.bind(v));else if(en(l))if(Fi(l))l.forEach(R=>gE(R,f,v,b));else{const R=ir(l.handler)?l.handler.bind(v):f[l.handler];ir(R)&&El(A,R,l)}}function O0(l){const f=l.type,{mixins:v,extends:b}=f,{mixins:A,optionsCache:R,config:{optionMergeStrategies:z}}=l.appContext,G=R.get(f);let o;return G?o=G:!A.length&&!v&&!b?o=f:(o={},A.length&&A.forEach(Y=>s_(o,Y,z,!0)),s_(o,f,z)),en(f)&&R.set(f,o),o}function s_(l,f,v,b=!1){const{mixins:A,extends:R}=f;R&&s_(l,R,v,!0),A&&A.forEach(z=>s_(l,z,v,!0));for(const z in f)if(!(b&&z==="expose")){const G=qP[z]||v&&v[z];l[z]=G?G(l[z],f[z]):f[z]}return l}const qP={data:gw,props:yw,emits:yw,methods:Sf,computed:Sf,beforeCreate:us,created:us,beforeMount:us,mounted:us,beforeUpdate:us,updated:us,beforeDestroy:us,beforeUnmount:us,destroyed:us,unmounted:us,activated:us,deactivated:us,errorCaptured:us,serverPrefetch:us,components:Sf,directives:Sf,watch:HP,provide:gw,inject:ZP};function gw(l,f){return f?l?function(){return Nn(ir(l)?l.call(this,this):l,ir(f)?f.call(this,this):f)}:f:l}function ZP(l,f){return Sf(n0(l),n0(f))}function n0(l){if(Fi(l)){const f={};for(let v=0;v<l.length;v++)f[l[v]]=l[v];return f}return l}function us(l,f){return l?[...new Set([].concat(l,f))]:f}function Sf(l,f){return l?Nn(Object.create(null),l,f):f}function yw(l,f){return l?Fi(l)&&Fi(f)?[...new Set([...l,...f])]:Nn(Object.create(null),mw(l),mw(f??{})):f}function HP(l,f){if(!l)return f;if(!f)return l;const v=Nn(Object.create(null),l);for(const b in f)v[b]=us(l[b],f[b]);return v}function yE(){return{app:null,config:{isNativeTag:DC,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let WP=0;function XP(l,f){return function(b,A=null){ir(b)||(b=Nn({},b)),A!=null&&!en(A)&&(A=null);const R=yE(),z=new WeakSet;let G=!1;const o=R.app={_uid:WP++,_component:b,_props:A,_container:null,_context:R,_instance:null,version:LR,get config(){return R.config},set config(Y){},use(Y,...ie){return z.has(Y)||(Y&&ir(Y.install)?(z.add(Y),Y.install(o,...ie)):ir(Y)&&(z.add(Y),Y(o,...ie))),o},mixin(Y){return R.mixins.includes(Y)||R.mixins.push(Y),o},component(Y,ie){return ie?(R.components[Y]=ie,o):R.components[Y]},directive(Y,ie){return ie?(R.directives[Y]=ie,o):R.directives[Y]},mount(Y,ie,K){if(!G){const de=Cr(b,A);return de.appContext=R,K===!0?K="svg":K===!1&&(K=void 0),ie&&f?f(de,Y):l(de,Y,K),G=!0,o._container=Y,Y.__vue_app__=o,A_(de.component)}},unmount(){G&&(l(null,o._container),delete o._container.__vue_app__)},provide(Y,ie){return R.provides[Y]=ie,o},runWithContext(Y){const ie=Gc;Gc=o;try{return Y()}finally{Gc=ie}}};return o}}let Gc=null;function Jm(l,f){if(Fn){let v=Fn.provides;const b=Fn.parent&&Fn.parent.provides;b===v&&(v=Fn.provides=Object.create(b)),v[l]=f}}function yo(l,f,v=!1){const b=Fn||Rn;if(b||Gc){const A=Gc?Gc._context.provides:b?b.parent==null?b.vnode.appContext&&b.vnode.appContext.provides:b.parent.provides:void 0;if(A&&l in A)return A[l];if(arguments.length>1)return v&&ir(f)?f.call(b&&b.proxy):f}}function KP(){return!!(Fn||Rn||Gc)}const vE={},xE=()=>Object.create(vE),bE=l=>Object.getPrototypeOf(l)===vE;function YP(l,f,v,b=!1){const A={},R=xE();l.propsDefaults=Object.create(null),wE(l,f,A,R);for(const z in l.propsOptions[0])z in A||(A[z]=void 0);v?l.props=b?A:YT(A):l.type.props?l.props=A:l.props=R,l.attrs=R}function JP(l,f,v,b){const{props:A,attrs:R,vnode:{patchFlag:z}}=l,G=Sr(A),[o]=l.propsOptions;let Y=!1;if((b||z>0)&&!(z&16)){if(z&8){const ie=l.vnode.dynamicProps;for(let K=0;K<ie.length;K++){let de=ie[K];if(E_(l.emitsOptions,de))continue;const ce=f[de];if(o)if(Er(R,de))ce!==R[de]&&(R[de]=ce,Y=!0);else{const Ee=vo(de);A[Ee]=s0(o,G,Ee,ce,l,!1)}else ce!==R[de]&&(R[de]=ce,Y=!0)}}}else{wE(l,f,A,R)&&(Y=!0);let ie;for(const K in G)(!f||!Er(f,K)&&((ie=Wc(K))===K||!Er(f,ie)))&&(o?v&&(v[K]!==void 0||v[ie]!==void 0)&&(A[K]=s0(o,G,K,void 0,l,!0)):delete A[K]);if(R!==G)for(const K in R)(!f||!Er(f,K))&&(delete R[K],Y=!0)}Y&&Ta(l.attrs,"set","")}function wE(l,f,v,b){const[A,R]=l.propsOptions;let z=!1,G;if(f)for(let o in f){if(Mf(o))continue;const Y=f[o];let ie;A&&Er(A,ie=vo(o))?!R||!R.includes(ie)?v[ie]=Y:(G||(G={}))[ie]=Y:E_(l.emitsOptions,o)||(!(o in b)||Y!==b[o])&&(b[o]=Y,z=!0)}if(R){const o=Sr(v),Y=G||ln;for(let ie=0;ie<R.length;ie++){const K=R[ie];v[K]=s0(A,o,K,Y[K],l,!Er(Y,K))}}return z}function s0(l,f,v,b,A,R){const z=l[v];if(z!=null){const G=Er(z,"default");if(G&&b===void 0){const o=z.default;if(z.type!==Function&&!z.skipFactory&&ir(o)){const{propsDefaults:Y}=A;if(v in Y)b=Y[v];else{const ie=$f(A);b=Y[v]=o.call(null,f),ie()}}else b=o}z[0]&&(R&&!G?b=!1:z[1]&&(b===""||b===Wc(v))&&(b=!0))}return b}const QP=new WeakMap;function TE(l,f,v=!1){const b=v?QP:f.propsCache,A=b.get(l);if(A)return A;const R=l.props,z={},G=[];let o=!1;if(!ir(l)){const ie=K=>{o=!0;const[de,ce]=TE(K,f,!0);Nn(z,de),ce&&G.push(...ce)};!v&&f.mixins.length&&f.mixins.forEach(ie),l.extends&&ie(l.extends),l.mixins&&l.mixins.forEach(ie)}if(!R&&!o)return en(l)&&b.set(l,nh),nh;if(Fi(R))for(let ie=0;ie<R.length;ie++){const K=vo(R[ie]);vw(K)&&(z[K]=ln)}else if(R)for(const ie in R){const K=vo(ie);if(vw(K)){const de=R[ie],ce=z[K]=Fi(de)||ir(de)?{type:de}:Nn({},de),Ee=ce.type;let Ue=!1,$e=!0;if(Fi(Ee))for(let et=0;et<Ee.length;++et){const ht=Ee[et],Xe=ir(ht)&&ht.name;if(Xe==="Boolean"){Ue=!0;break}else Xe==="String"&&($e=!1)}else Ue=ir(Ee)&&Ee.name==="Boolean";ce[0]=Ue,ce[1]=$e,(Ue||Er(ce,"default"))&&G.push(K)}}const Y=[z,G];return en(l)&&b.set(l,Y),Y}function vw(l){return l[0]!=="$"&&!Mf(l)}const EE=l=>l[0]==="_"||l==="$stable",z0=l=>Fi(l)?l.map(Ho):[Ho(l)],eR=(l,f,v)=>{if(f._n)return f;const b=go((...A)=>z0(f(...A)),v);return b._c=!1,b},SE=(l,f,v)=>{const b=l._ctx;for(const A in l){if(EE(A))continue;const R=l[A];if(ir(R))f[A]=eR(A,R,b);else if(R!=null){const z=z0(R);f[A]=()=>z}}},ME=(l,f)=>{const v=z0(f);l.slots.default=()=>v},AE=(l,f,v)=>{for(const b in f)(v||b!=="_")&&(l[b]=f[b])},tR=(l,f,v)=>{const b=l.slots=xE();if(l.vnode.shapeFlag&32){const A=f._;A?(AE(b,f,v),v&&LT(b,"_",A,!0)):SE(f,b)}else f&&ME(l,f)},iR=(l,f,v)=>{const{vnode:b,slots:A}=l;let R=!0,z=ln;if(b.shapeFlag&32){const G=f._;G?v&&G===1?R=!1:AE(A,f,v):(R=!f.$stable,SE(f,A)),z=f}else f&&(ME(l,f),z={default:1});if(R)for(const G in A)!EE(G)&&z[G]==null&&delete A[G]};function o0(l,f,v,b,A=!1){if(Fi(l)){l.forEach((de,ce)=>o0(de,f&&(Fi(f)?f[ce]:f),v,b,A));return}if(Af(b)&&!A)return;const R=b.shapeFlag&4?A_(b.component):b.el,z=A?null:R,{i:G,r:o}=l,Y=f&&f.r,ie=G.refs===ln?G.refs={}:G.refs,K=G.setupState;if(Y!=null&&Y!==o&&(_n(Y)?(ie[Y]=null,Er(K,Y)&&(K[Y]=null)):Ln(Y)&&(Y.value=null)),ir(o))wl(o,G,12,[z,ie]);else{const de=_n(o),ce=Ln(o);if(de||ce){const Ee=()=>{if(l.f){const Ue=de?Er(K,o)?K[o]:ie[o]:o.value;A?Fi(Ue)&&y0(Ue,R):Fi(Ue)?Ue.includes(R)||Ue.push(R):de?(ie[o]=[R],Er(K,o)&&(K[o]=ie[o])):(o.value=[R],l.k&&(ie[l.k]=o.value))}else de?(ie[o]=z,Er(K,o)&&(K[o]=z)):ce&&(o.value=z,l.k&&(ie[l.k]=z))};z?(Ee.id=-1,xs(Ee,v)):Ee()}}}const rR=Symbol("_vte"),nR=l=>l.__isTeleport,xs=vR;function sR(l){return oR(l)}function oR(l,f){const v=DT();v.__VUE__=!0;const{insert:b,remove:A,patchProp:R,createElement:z,createText:G,createComment:o,setText:Y,setElementText:ie,parentNode:K,nextSibling:de,setScopeId:ce=Xs,insertStaticContent:Ee}=l,Ue=(pe,_e,Fe,yt=null,rt=null,bt=null,qt=void 0,wt=null,Vt=!!_e.dynamicChildren)=>{if(pe===_e)return;pe&&!Nc(pe,_e)&&(yt=lt(pe),gr(pe,rt,bt,!0),pe=null),_e.patchFlag===-2&&(Vt=!1,_e.dynamicChildren=null);const{type:Tt,ref:Ht,shapeFlag:oi}=_e;switch(Tt){case S_:$e(pe,_e,Fe,yt);break;case bs:et(pe,_e,Fe,yt);break;case Oy:pe==null&&ht(_e,Fe,yt,qt);break;case Gr:dt(pe,_e,Fe,yt,rt,bt,qt,wt,Vt);break;default:oi&1?kt(pe,_e,Fe,yt,rt,bt,qt,wt,Vt):oi&6?Ei(pe,_e,Fe,yt,rt,bt,qt,wt,Vt):(oi&64||oi&128)&&Tt.process(pe,_e,Fe,yt,rt,bt,qt,wt,Vt,Kt)}Ht!=null&&rt&&o0(Ht,pe&&pe.ref,bt,_e||pe,!_e)},$e=(pe,_e,Fe,yt)=>{if(pe==null)b(_e.el=G(_e.children),Fe,yt);else{const rt=_e.el=pe.el;_e.children!==pe.children&&Y(rt,_e.children)}},et=(pe,_e,Fe,yt)=>{pe==null?b(_e.el=o(_e.children||""),Fe,yt):_e.el=pe.el},ht=(pe,_e,Fe,yt)=>{[pe.el,pe.anchor]=Ee(pe.children,_e,Fe,yt,pe.el,pe.anchor)},Xe=({el:pe,anchor:_e},Fe,yt)=>{let rt;for(;pe&&pe!==_e;)rt=de(pe),b(pe,Fe,yt),pe=rt;b(_e,Fe,yt)},$t=({el:pe,anchor:_e})=>{let Fe;for(;pe&&pe!==_e;)Fe=de(pe),A(pe),pe=Fe;A(_e)},kt=(pe,_e,Fe,yt,rt,bt,qt,wt,Vt)=>{_e.type==="svg"?qt="svg":_e.type==="math"&&(qt="mathml"),pe==null?At(_e,Fe,yt,rt,bt,qt,wt,Vt):Ie(pe,_e,rt,bt,qt,wt,Vt)},At=(pe,_e,Fe,yt,rt,bt,qt,wt)=>{let Vt,Tt;const{props:Ht,shapeFlag:oi,transition:ni,dirs:Se}=pe;if(Vt=pe.el=z(pe.type,bt,Ht&&Ht.is,Ht),oi&8?ie(Vt,pe.children):oi&16&&ai(pe.children,Vt,null,yt,rt,Ly(pe,bt),qt,wt),Se&&Rc(pe,null,yt,"created"),_i(Vt,pe,pe.scopeId,qt,yt),Ht){for(const ne in Ht)ne!=="value"&&!Mf(ne)&&R(Vt,ne,null,Ht[ne],bt,yt);"value"in Ht&&R(Vt,"value",null,Ht.value,bt),(Tt=Ht.onVnodeBeforeMount)&&Zo(Tt,yt,pe)}Se&&Rc(pe,null,yt,"beforeMount");const Z=aR(rt,ni);Z&&ni.beforeEnter(Vt),b(Vt,_e,Fe),((Tt=Ht&&Ht.onVnodeMounted)||Z||Se)&&xs(()=>{Tt&&Zo(Tt,yt,pe),Z&&ni.enter(Vt),Se&&Rc(pe,null,yt,"mounted")},rt)},_i=(pe,_e,Fe,yt,rt)=>{if(Fe&&ce(pe,Fe),yt)for(let bt=0;bt<yt.length;bt++)ce(pe,yt[bt]);if(rt){let bt=rt.subTree;if(_e===bt){const qt=rt.vnode;_i(pe,qt,qt.scopeId,qt.slotScopeIds,rt.parent)}}},ai=(pe,_e,Fe,yt,rt,bt,qt,wt,Vt=0)=>{for(let Tt=Vt;Tt<pe.length;Tt++){const Ht=pe[Tt]=wt?yl(pe[Tt]):Ho(pe[Tt]);Ue(null,Ht,_e,Fe,yt,rt,bt,qt,wt)}},Ie=(pe,_e,Fe,yt,rt,bt,qt)=>{const wt=_e.el=pe.el;let{patchFlag:Vt,dynamicChildren:Tt,dirs:Ht}=_e;Vt|=pe.patchFlag&16;const oi=pe.props||ln,ni=_e.props||ln;let Se;if(Fe&&Lc(Fe,!1),(Se=ni.onVnodeBeforeUpdate)&&Zo(Se,Fe,_e,pe),Ht&&Rc(_e,pe,Fe,"beforeUpdate"),Fe&&Lc(Fe,!0),(oi.innerHTML&&ni.innerHTML==null||oi.textContent&&ni.textContent==null)&&ie(wt,""),Tt?Ti(pe.dynamicChildren,Tt,wt,Fe,yt,Ly(_e,rt),bt):qt||Nt(pe,_e,wt,null,Fe,yt,Ly(_e,rt),bt,!1),Vt>0){if(Vt&16)Wi(wt,oi,ni,Fe,rt);else if(Vt&2&&oi.class!==ni.class&&R(wt,"class",null,ni.class,rt),Vt&4&&R(wt,"style",oi.style,ni.style,rt),Vt&8){const Z=_e.dynamicProps;for(let ne=0;ne<Z.length;ne++){const le=Z[ne],Re=oi[le],Ne=ni[le];(Ne!==Re||le==="value")&&R(wt,le,Re,Ne,rt,Fe)}}Vt&1&&pe.children!==_e.children&&ie(wt,_e.children)}else!qt&&Tt==null&&Wi(wt,oi,ni,Fe,rt);((Se=ni.onVnodeUpdated)||Ht)&&xs(()=>{Se&&Zo(Se,Fe,_e,pe),Ht&&Rc(_e,pe,Fe,"updated")},yt)},Ti=(pe,_e,Fe,yt,rt,bt,qt)=>{for(let wt=0;wt<_e.length;wt++){const Vt=pe[wt],Tt=_e[wt],Ht=Vt.el&&(Vt.type===Gr||!Nc(Vt,Tt)||Vt.shapeFlag&70)?K(Vt.el):Fe;Ue(Vt,Tt,Ht,null,yt,rt,bt,qt,!0)}},Wi=(pe,_e,Fe,yt,rt)=>{if(_e!==Fe){if(_e!==ln)for(const bt in _e)!Mf(bt)&&!(bt in Fe)&&R(pe,bt,_e[bt],null,rt,yt);for(const bt in Fe){if(Mf(bt))continue;const qt=Fe[bt],wt=_e[bt];qt!==wt&&bt!=="value"&&R(pe,bt,wt,qt,rt,yt)}"value"in Fe&&R(pe,"value",_e.value,Fe.value,rt)}},dt=(pe,_e,Fe,yt,rt,bt,qt,wt,Vt)=>{const Tt=_e.el=pe?pe.el:G(""),Ht=_e.anchor=pe?pe.anchor:G("");let{patchFlag:oi,dynamicChildren:ni,slotScopeIds:Se}=_e;Se&&(wt=wt?wt.concat(Se):Se),pe==null?(b(Tt,Fe,yt),b(Ht,Fe,yt),ai(_e.children||[],Fe,Ht,rt,bt,qt,wt,Vt)):oi>0&&oi&64&&ni&&pe.dynamicChildren?(Ti(pe.dynamicChildren,ni,Fe,rt,bt,qt,wt),(_e.key!=null||rt&&_e===rt.subTree)&&IE(pe,_e,!0)):Nt(pe,_e,Fe,Ht,rt,bt,qt,wt,Vt)},Ei=(pe,_e,Fe,yt,rt,bt,qt,wt,Vt)=>{_e.slotScopeIds=wt,pe==null?_e.shapeFlag&512?rt.ctx.activate(_e,Fe,yt,qt,Vt):Dr(_e,Fe,yt,rt,bt,qt,Vt):tt(pe,_e,Vt)},Dr=(pe,_e,Fe,yt,rt,bt,qt)=>{const wt=pe.component=ER(pe,yt,rt);if(w_(pe)&&(wt.ctx.renderer=Kt),MR(wt,!1,qt),wt.asyncDep){if(rt&&rt.registerDep(wt,Ri,qt),!pe.el){const Vt=wt.subTree=Cr(bs);et(null,Vt,_e,Fe)}}else Ri(wt,pe,_e,Fe,rt,bt,qt)},tt=(pe,_e,Fe)=>{const yt=_e.component=pe.component;if(_R(pe,_e,Fe))if(yt.asyncDep&&!yt.asyncResolved){Zi(yt,_e,Fe);return}else yt.next=_e,wP(yt.update),yt.effect.dirty=!0,yt.update();else _e.el=pe.el,yt.vnode=_e},Ri=(pe,_e,Fe,yt,rt,bt,qt)=>{const wt=()=>{if(pe.isMounted){let{next:Ht,bu:oi,u:ni,parent:Se,vnode:Z}=pe;{const Qe=CE(pe);if(Qe){Ht&&(Ht.el=Z.el,Zi(pe,Ht,qt)),Qe.asyncDep.then(()=>{pe.isUnmounted||wt()});return}}let ne=Ht,le;Lc(pe,!1),Ht?(Ht.el=Z.el,Zi(pe,Ht,qt)):Ht=Z,oi&&Km(oi),(le=Ht.props&&Ht.props.onVnodeBeforeUpdate)&&Zo(le,Se,Ht,Z),Lc(pe,!0);const Re=Dy(pe),Ne=pe.subTree;pe.subTree=Re,Ue(Ne,Re,K(Ne.el),lt(Ne),pe,rt,bt),Ht.el=Re.el,ne===null&&gR(pe,Re.el),ni&&xs(ni,rt),(le=Ht.props&&Ht.props.onVnodeUpdated)&&xs(()=>Zo(le,Se,Ht,Z),rt)}else{let Ht;const{el:oi,props:ni}=_e,{bm:Se,m:Z,parent:ne}=pe,le=Af(_e);if(Lc(pe,!1),Se&&Km(Se),!le&&(Ht=ni&&ni.onVnodeBeforeMount)&&Zo(Ht,ne,_e),Lc(pe,!0),oi&&sr){const Re=()=>{pe.subTree=Dy(pe),sr(oi,pe.subTree,pe,rt,null)};le?_e.type.__asyncLoader().then(()=>!pe.isUnmounted&&Re()):Re()}else{const Re=pe.subTree=Dy(pe);Ue(null,Re,Fe,yt,pe,rt,bt),_e.el=Re.el}if(Z&&xs(Z,rt),!le&&(Ht=ni&&ni.onVnodeMounted)){const Re=_e;xs(()=>Zo(Ht,ne,Re),rt)}(_e.shapeFlag&256||ne&&Af(ne.vnode)&&ne.vnode.shapeFlag&256)&&pe.a&&xs(pe.a,rt),pe.isMounted=!0,_e=Fe=yt=null}},Vt=pe.effect=new x0(wt,Xs,()=>P0(Tt),pe.scope),Tt=pe.update=()=>{Vt.dirty&&Vt.run()};Tt.i=pe,Tt.id=pe.uid,Lc(pe,!0),Tt()},Zi=(pe,_e,Fe)=>{_e.component=pe;const yt=pe.vnode.props;pe.vnode=_e,pe.next=null,JP(pe,_e.props,yt,Fe),iR(pe,_e.children,Fe),Rl(),dw(pe),Ll()},Nt=(pe,_e,Fe,yt,rt,bt,qt,wt,Vt=!1)=>{const Tt=pe&&pe.children,Ht=pe?pe.shapeFlag:0,oi=_e.children,{patchFlag:ni,shapeFlag:Se}=_e;if(ni>0){if(ni&128){Cn(Tt,oi,Fe,yt,rt,bt,qt,wt,Vt);return}else if(ni&256){Dn(Tt,oi,Fe,yt,rt,bt,qt,wt,Vt);return}}Se&8?(Ht&16&&wn(Tt,rt,bt),oi!==Tt&&ie(Fe,oi)):Ht&16?Se&16?Cn(Tt,oi,Fe,yt,rt,bt,qt,wt,Vt):wn(Tt,rt,bt,!0):(Ht&8&&ie(Fe,""),Se&16&&ai(oi,Fe,yt,rt,bt,qt,wt,Vt))},Dn=(pe,_e,Fe,yt,rt,bt,qt,wt,Vt)=>{pe=pe||nh,_e=_e||nh;const Tt=pe.length,Ht=_e.length,oi=Math.min(Tt,Ht);let ni;for(ni=0;ni<oi;ni++){const Se=_e[ni]=Vt?yl(_e[ni]):Ho(_e[ni]);Ue(pe[ni],Se,Fe,null,rt,bt,qt,wt,Vt)}Tt>Ht?wn(pe,rt,bt,!0,!1,oi):ai(_e,Fe,yt,rt,bt,qt,wt,Vt,oi)},Cn=(pe,_e,Fe,yt,rt,bt,qt,wt,Vt)=>{let Tt=0;const Ht=_e.length;let oi=pe.length-1,ni=Ht-1;for(;Tt<=oi&&Tt<=ni;){const Se=pe[Tt],Z=_e[Tt]=Vt?yl(_e[Tt]):Ho(_e[Tt]);if(Nc(Se,Z))Ue(Se,Z,Fe,null,rt,bt,qt,wt,Vt);else break;Tt++}for(;Tt<=oi&&Tt<=ni;){const Se=pe[oi],Z=_e[ni]=Vt?yl(_e[ni]):Ho(_e[ni]);if(Nc(Se,Z))Ue(Se,Z,Fe,null,rt,bt,qt,wt,Vt);else break;oi--,ni--}if(Tt>oi){if(Tt<=ni){const Se=ni+1,Z=Se<Ht?_e[Se].el:yt;for(;Tt<=ni;)Ue(null,_e[Tt]=Vt?yl(_e[Tt]):Ho(_e[Tt]),Fe,Z,rt,bt,qt,wt,Vt),Tt++}}else if(Tt>ni)for(;Tt<=oi;)gr(pe[Tt],rt,bt,!0),Tt++;else{const Se=Tt,Z=Tt,ne=new Map;for(Tt=Z;Tt<=ni;Tt++){const mt=_e[Tt]=Vt?yl(_e[Tt]):Ho(_e[Tt]);mt.key!=null&&ne.set(mt.key,Tt)}let le,Re=0;const Ne=ni-Z+1;let Qe=!1,Pt=0;const Be=new Array(Ne);for(Tt=0;Tt<Ne;Tt++)Be[Tt]=0;for(Tt=Se;Tt<=oi;Tt++){const mt=pe[Tt];if(Re>=Ne){gr(mt,rt,bt,!0);continue}let It;if(mt.key!=null)It=ne.get(mt.key);else for(le=Z;le<=ni;le++)if(Be[le-Z]===0&&Nc(mt,_e[le])){It=le;break}It===void 0?gr(mt,rt,bt,!0):(Be[It-Z]=Tt+1,It>=Pt?Pt=It:Qe=!0,Ue(mt,_e[It],Fe,null,rt,bt,qt,wt,Vt),Re++)}const Dt=Qe?lR(Be):nh;for(le=Dt.length-1,Tt=Ne-1;Tt>=0;Tt--){const mt=Z+Tt,It=_e[mt],vi=mt+1<Ht?_e[mt+1].el:yt;Be[Tt]===0?Ue(null,It,Fe,vi,rt,bt,qt,wt,Vt):Qe&&(le<0||Tt!==Dt[le]?tn(It,Fe,vi,2):le--)}}},tn=(pe,_e,Fe,yt,rt=null)=>{const{el:bt,type:qt,transition:wt,children:Vt,shapeFlag:Tt}=pe;if(Tt&6){tn(pe.component.subTree,_e,Fe,yt);return}if(Tt&128){pe.suspense.move(_e,Fe,yt);return}if(Tt&64){qt.move(pe,_e,Fe,Kt);return}if(qt===Gr){b(bt,_e,Fe);for(let oi=0;oi<Vt.length;oi++)tn(Vt[oi],_e,Fe,yt);b(pe.anchor,_e,Fe);return}if(qt===Oy){Xe(pe,_e,Fe);return}if(yt!==2&&Tt&1&&wt)if(yt===0)wt.beforeEnter(bt),b(bt,_e,Fe),xs(()=>wt.enter(bt),rt);else{const{leave:oi,delayLeave:ni,afterLeave:Se}=wt,Z=()=>b(bt,_e,Fe),ne=()=>{oi(bt,()=>{Z(),Se&&Se()})};ni?ni(bt,Z,ne):ne()}else b(bt,_e,Fe)},gr=(pe,_e,Fe,yt=!1,rt=!1)=>{const{type:bt,props:qt,ref:wt,children:Vt,dynamicChildren:Tt,shapeFlag:Ht,patchFlag:oi,dirs:ni,cacheIndex:Se}=pe;if(oi===-2&&(rt=!1),wt!=null&&o0(wt,null,Fe,pe,!0),Se!=null&&(_e.renderCache[Se]=void 0),Ht&256){_e.ctx.deactivate(pe);return}const Z=Ht&1&&ni,ne=!Af(pe);let le;if(ne&&(le=qt&&qt.onVnodeBeforeUnmount)&&Zo(le,_e,pe),Ht&6)Us(pe.component,Fe,yt);else{if(Ht&128){pe.suspense.unmount(Fe,yt);return}Z&&Rc(pe,null,_e,"beforeUnmount"),Ht&64?pe.type.remove(pe,_e,Fe,Kt,yt):Tt&&!Tt.hasOnce&&(bt!==Gr||oi>0&&oi&64)?wn(Tt,_e,Fe,!1,!0):(bt===Gr&&oi&384||!rt&&Ht&16)&&wn(Vt,_e,Fe),yt&&qn(pe)}(ne&&(le=qt&&qt.onVnodeUnmounted)||Z)&&xs(()=>{le&&Zo(le,_e,pe),Z&&Rc(pe,null,_e,"unmounted")},Fe)},qn=pe=>{const{type:_e,el:Fe,anchor:yt,transition:rt}=pe;if(_e===Gr){ns(Fe,yt);return}if(_e===Oy){$t(pe);return}const bt=()=>{A(Fe),rt&&!rt.persisted&&rt.afterLeave&&rt.afterLeave()};if(pe.shapeFlag&1&&rt&&!rt.persisted){const{leave:qt,delayLeave:wt}=rt,Vt=()=>qt(Fe,bt);wt?wt(pe.el,bt,Vt):Vt()}else bt()},ns=(pe,_e)=>{let Fe;for(;pe!==_e;)Fe=de(pe),A(pe),pe=Fe;A(_e)},Us=(pe,_e,Fe)=>{const{bum:yt,scope:rt,update:bt,subTree:qt,um:wt,m:Vt,a:Tt}=pe;xw(Vt),xw(Tt),yt&&Km(yt),rt.stop(),bt&&(bt.active=!1,gr(qt,pe,_e,Fe)),wt&&xs(wt,_e),xs(()=>{pe.isUnmounted=!0},_e),_e&&_e.pendingBranch&&!_e.isUnmounted&&pe.asyncDep&&!pe.asyncResolved&&pe.suspenseId===_e.pendingId&&(_e.deps--,_e.deps===0&&_e.resolve())},wn=(pe,_e,Fe,yt=!1,rt=!1,bt=0)=>{for(let qt=bt;qt<pe.length;qt++)gr(pe[qt],_e,Fe,yt,rt)},lt=pe=>{if(pe.shapeFlag&6)return lt(pe.component.subTree);if(pe.shapeFlag&128)return pe.suspense.next();const _e=de(pe.anchor||pe.el),Fe=_e&&_e[rR];return Fe?de(Fe):_e};let Qt=!1;const Gt=(pe,_e,Fe)=>{pe==null?_e._vnode&&gr(_e._vnode,null,null,!0):Ue(_e._vnode||null,pe,_e,null,null,null,Fe),_e._vnode=pe,Qt||(Qt=!0,dw(),oE(),Qt=!1)},Kt={p:Ue,um:gr,m:tn,r:qn,mt:Dr,mc:ai,pc:Nt,pbc:Ti,n:lt,o:l};let Xi,sr;return f&&([Xi,sr]=f(Kt)),{render:Gt,hydrate:Xi,createApp:XP(Gt,Xi)}}function Ly({type:l,props:f},v){return v==="svg"&&l==="foreignObject"||v==="mathml"&&l==="annotation-xml"&&f&&f.encoding&&f.encoding.includes("html")?void 0:v}function Lc({effect:l,update:f},v){l.allowRecurse=f.allowRecurse=v}function aR(l,f){return(!l||l&&!l.pendingBranch)&&f&&!f.persisted}function IE(l,f,v=!1){const b=l.children,A=f.children;if(Fi(b)&&Fi(A))for(let R=0;R<b.length;R++){const z=b[R];let G=A[R];G.shapeFlag&1&&!G.dynamicChildren&&((G.patchFlag<=0||G.patchFlag===32)&&(G=A[R]=yl(A[R]),G.el=z.el),!v&&G.patchFlag!==-2&&IE(z,G)),G.type===S_&&(G.el=z.el)}}function lR(l){const f=l.slice(),v=[0];let b,A,R,z,G;const o=l.length;for(b=0;b<o;b++){const Y=l[b];if(Y!==0){if(A=v[v.length-1],l[A]<Y){f[b]=A,v.push(b);continue}for(R=0,z=v.length-1;R<z;)G=R+z>>1,l[v[G]]<Y?R=G+1:z=G;Y<l[v[R]]&&(R>0&&(f[b]=v[R-1]),v[R]=b)}}for(R=v.length,z=v[R-1];R-- >0;)v[R]=z,z=f[z];return v}function CE(l){const f=l.subTree.component;if(f)return f.asyncDep&&!f.asyncResolved?f:CE(f)}function xw(l){if(l)for(let f=0;f<l.length;f++)l[f].active=!1}const cR=Symbol.for("v-scx"),uR=()=>yo(cR);function PE(l,f){return k0(l,null,f)}const Zm={};function El(l,f,v){return k0(l,f,v)}function k0(l,f,{immediate:v,deep:b,flush:A,once:R,onTrack:z,onTrigger:G}=ln){if(f&&R){const At=f;f=(..._i)=>{At(..._i),kt()}}const o=Fn,Y=At=>b===!0?At:xl(At,b===!1?1:void 0);let ie,K=!1,de=!1;if(Ln(l)?(ie=()=>l.value,K=uh(l)):jc(l)?(ie=()=>Y(l),K=!0):Fi(l)?(de=!0,K=l.some(At=>jc(At)||uh(At)),ie=()=>l.map(At=>{if(Ln(At))return At.value;if(jc(At))return Y(At);if(ir(At))return wl(At,o,2)})):ir(l)?f?ie=()=>wl(l,o,2):ie=()=>(ce&&ce(),Ks(l,o,3,[Ee])):ie=Xs,f&&b){const At=ie;ie=()=>xl(At())}let ce,Ee=At=>{ce=Xe.onStop=()=>{wl(At,o,4),ce=Xe.onStop=void 0}},Ue;if(M_)if(Ee=Xs,f?v&&Ks(f,o,3,[ie(),de?[]:void 0,Ee]):ie(),A==="sync"){const At=uR();Ue=At.__watcherHandles||(At.__watcherHandles=[])}else return Xs;let $e=de?new Array(l.length).fill(Zm):Zm;const et=()=>{if(!(!Xe.active||!Xe.dirty))if(f){const At=Xe.run();(b||K||(de?At.some((_i,ai)=>Sl(_i,$e[ai])):Sl(At,$e)))&&(ce&&ce(),Ks(f,o,3,[At,$e===Zm?void 0:de&&$e[0]===Zm?[]:$e,Ee]),$e=At)}else Xe.run()};et.allowRecurse=!!f;let ht;A==="sync"?ht=et:A==="post"?ht=()=>xs(et,o&&o.suspense):(et.pre=!0,o&&(et.id=o.uid),ht=()=>P0(et));const Xe=new x0(ie,Xs,ht),$t=NT(),kt=()=>{Xe.stop(),$t&&y0($t.effects,Xe)};return f?v?et():$e=Xe.run():A==="post"?xs(Xe.run.bind(Xe),o&&o.suspense):Xe.run(),Ue&&Ue.push(kt),kt}function hR(l,f,v){const b=this.proxy,A=_n(l)?l.includes(".")?RE(b,l):()=>b[l]:l.bind(b,b);let R;ir(f)?R=f:(R=f.handler,v=f);const z=$f(this),G=k0(A,R.bind(b),v);return z(),G}function RE(l,f){const v=f.split(".");return()=>{let b=l;for(let A=0;A<v.length&&b;A++)b=b[v[A]];return b}}function xl(l,f=1/0,v){if(f<=0||!en(l)||l.__v_skip||(v=v||new Set,v.has(l)))return l;if(v.add(l),f--,Ln(l))xl(l.value,f,v);else if(Fi(l))for(let b=0;b<l.length;b++)xl(l[b],f,v);else if(IT(l)||sh(l))l.forEach(b=>{xl(b,f,v)});else if(RT(l)){for(const b in l)xl(l[b],f,v);for(const b of Object.getOwnPropertySymbols(l))Object.prototype.propertyIsEnumerable.call(l,b)&&xl(l[b],f,v)}return l}const dR=(l,f)=>f==="modelValue"||f==="model-value"?l.modelModifiers:l[`${f}Modifiers`]||l[`${vo(f)}Modifiers`]||l[`${Wc(f)}Modifiers`];function fR(l,f,...v){if(l.isUnmounted)return;const b=l.vnode.props||ln;let A=v;const R=f.startsWith("update:"),z=R&&dR(b,f.slice(7));z&&(z.trim&&(A=v.map(ie=>_n(ie)?ie.trim():ie)),z.number&&(A=v.map(Ky)));let G,o=b[G=Xm(f)]||b[G=Xm(vo(f))];!o&&R&&(o=b[G=Xm(Wc(f))]),o&&Ks(o,l,6,A);const Y=b[G+"Once"];if(Y){if(!l.emitted)l.emitted={};else if(l.emitted[G])return;l.emitted[G]=!0,Ks(Y,l,6,A)}}function LE(l,f,v=!1){const b=f.emitsCache,A=b.get(l);if(A!==void 0)return A;const R=l.emits;let z={},G=!1;if(!ir(l)){const o=Y=>{const ie=LE(Y,f,!0);ie&&(G=!0,Nn(z,ie))};!v&&f.mixins.length&&f.mixins.forEach(o),l.extends&&o(l.extends),l.mixins&&l.mixins.forEach(o)}return!R&&!G?(en(l)&&b.set(l,null),null):(Fi(R)?R.forEach(o=>z[o]=null):Nn(z,R),en(l)&&b.set(l,z),z)}function E_(l,f){return!l||!p_(f)?!1:(f=f.slice(2).replace(/Once$/,""),Er(l,f[0].toLowerCase()+f.slice(1))||Er(l,Wc(f))||Er(l,f))}function Dy(l){const{type:f,vnode:v,proxy:b,withProxy:A,propsOptions:[R],slots:z,attrs:G,emit:o,render:Y,renderCache:ie,props:K,data:de,setupState:ce,ctx:Ee,inheritAttrs:Ue}=l,$e=r_(l);let et,ht;try{if(v.shapeFlag&4){const $t=A||b,kt=$t;et=Ho(Y.call(kt,$t,ie,K,ce,de,Ee)),ht=G}else{const $t=f;et=Ho($t.length>1?$t(K,{attrs:G,slots:z,emit:o}):$t(K,null)),ht=f.props?G:pR(G)}}catch($t){Cf.length=0,x_($t,l,1),et=Cr(bs)}let Xe=et;if(ht&&Ue!==!1){const $t=Object.keys(ht),{shapeFlag:kt}=Xe;$t.length&&kt&7&&(R&&$t.some(g0)&&(ht=mR(ht,R)),Xe=Ml(Xe,ht,!1,!0))}return v.dirs&&(Xe=Ml(Xe,null,!1,!0),Xe.dirs=Xe.dirs?Xe.dirs.concat(v.dirs):v.dirs),v.transition&&(Xe.transition=v.transition),et=Xe,r_($e),et}const pR=l=>{let f;for(const v in l)(v==="class"||v==="style"||p_(v))&&((f||(f={}))[v]=l[v]);return f},mR=(l,f)=>{const v={};for(const b in l)(!g0(b)||!(b.slice(9)in f))&&(v[b]=l[b]);return v};function _R(l,f,v){const{props:b,children:A,component:R}=l,{props:z,children:G,patchFlag:o}=f,Y=R.emitsOptions;if(f.dirs||f.transition)return!0;if(v&&o>=0){if(o&1024)return!0;if(o&16)return b?bw(b,z,Y):!!z;if(o&8){const ie=f.dynamicProps;for(let K=0;K<ie.length;K++){const de=ie[K];if(z[de]!==b[de]&&!E_(Y,de))return!0}}}else return(A||G)&&(!G||!G.$stable)?!0:b===z?!1:b?z?bw(b,z,Y):!0:!!z;return!1}function bw(l,f,v){const b=Object.keys(f);if(b.length!==Object.keys(l).length)return!0;for(let A=0;A<b.length;A++){const R=b[A];if(f[R]!==l[R]&&!E_(v,R))return!0}return!1}function gR({vnode:l,parent:f},v){for(;f;){const b=f.subTree;if(b.suspense&&b.suspense.activeBranch===l&&(b.el=l.el),b===l)(l=f.vnode).el=v,f=f.parent;else break}}const yR=l=>l.__isSuspense;function vR(l,f){f&&f.pendingBranch?Fi(l)?f.effects.push(...l):f.effects.push(l):TP(l)}const Gr=Symbol.for("v-fgt"),S_=Symbol.for("v-txt"),bs=Symbol.for("v-cmt"),Oy=Symbol.for("v-stc"),Cf=[];let Ns=null;function ri(l=!1){Cf.push(Ns=l?null:[])}function xR(){Cf.pop(),Ns=Cf[Cf.length-1]||null}let Bf=1;function ww(l){Bf+=l,l<0&&Ns&&(Ns.hasOnce=!0)}function DE(l){return l.dynamicChildren=Bf>0?Ns||nh:null,xR(),Bf>0&&Ns&&Ns.push(l),l}function hi(l,f,v,b,A,R){return DE(He(l,f,v,b,A,R,!0))}function $c(l,f,v,b,A){return DE(Cr(l,f,v,b,A,!0))}function o_(l){return l?l.__v_isVNode===!0:!1}function Nc(l,f){return l.type===f.type&&l.key===f.key}const OE=({key:l})=>l??null,Qm=({ref:l,ref_key:f,ref_for:v})=>(typeof l=="number"&&(l=""+l),l!=null?_n(l)||Ln(l)||ir(l)?{i:Rn,r:l,k:f,f:!!v}:l:null);function He(l,f=null,v=null,b=0,A=null,R=l===Gr?0:1,z=!1,G=!1){const o={__v_isVNode:!0,__v_skip:!0,type:l,props:f,key:f&&OE(f),ref:f&&Qm(f),scopeId:b_,slotScopeIds:null,children:v,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:R,patchFlag:b,dynamicProps:A,dynamicChildren:null,appContext:null,ctx:Rn};return G?(B0(o,v),R&128&&l.normalize(o)):v&&(o.shapeFlag|=_n(v)?8:16),Bf>0&&!z&&Ns&&(o.patchFlag>0||R&6)&&o.patchFlag!==32&&Ns.push(o),o}const Cr=bR;function bR(l,f=null,v=null,b=0,A=null,R=!1){if((!l||l===mE)&&(l=bs),o_(l)){const G=Ml(l,f,!0);return v&&B0(G,v),Bf>0&&!R&&Ns&&(G.shapeFlag&6?Ns[Ns.indexOf(l)]=G:Ns.push(G)),G.patchFlag=-2,G}if(RR(l)&&(l=l.__vccOpts),f){f=_o(f);let{class:G,style:o}=f;G&&!_n(G)&&(f.class=Xo(G)),en(o)&&(QT(o)&&!Fi(o)&&(o=Nn({},o)),f.style=y_(o))}const z=_n(l)?1:yR(l)?128:nR(l)?64:en(l)?4:ir(l)?2:0;return He(l,f,v,b,A,z,R,!0)}function _o(l){return l?QT(l)||bE(l)?Nn({},l):l:null}function Ml(l,f,v=!1,b=!1){const{props:A,ref:R,patchFlag:z,children:G,transition:o}=l,Y=f?a0(A||{},f):A,ie={__v_isVNode:!0,__v_skip:!0,type:l.type,props:Y,key:Y&&OE(Y),ref:f&&f.ref?v&&R?Fi(R)?R.concat(Qm(f)):[R,Qm(f)]:Qm(f):R,scopeId:l.scopeId,slotScopeIds:l.slotScopeIds,children:G,target:l.target,targetStart:l.targetStart,targetAnchor:l.targetAnchor,staticCount:l.staticCount,shapeFlag:l.shapeFlag,patchFlag:f&&l.type!==Gr?z===-1?16:z|16:z,dynamicProps:l.dynamicProps,dynamicChildren:l.dynamicChildren,appContext:l.appContext,dirs:l.dirs,transition:o,component:l.component,suspense:l.suspense,ssContent:l.ssContent&&Ml(l.ssContent),ssFallback:l.ssFallback&&Ml(l.ssFallback),el:l.el,anchor:l.anchor,ctx:l.ctx,ce:l.ce};return o&&b&&n_(ie,o.clone(ie)),ie}function Hc(l=" ",f=0){return Cr(S_,null,l,f)}function Xr(l="",f=!1){return f?(ri(),$c(bs,null,l)):Cr(bs,null,l)}function Ho(l){return l==null||typeof l=="boolean"?Cr(bs):Fi(l)?Cr(Gr,null,l.slice()):typeof l=="object"?yl(l):Cr(S_,null,String(l))}function yl(l){return l.el===null&&l.patchFlag!==-1||l.memo?l:Ml(l)}function B0(l,f){let v=0;const{shapeFlag:b}=l;if(f==null)f=null;else if(Fi(f))v=16;else if(typeof f=="object")if(b&65){const A=f.default;A&&(A._c&&(A._d=!1),B0(l,A()),A._c&&(A._d=!0));return}else{v=32;const A=f._;!A&&!bE(f)?f._ctx=Rn:A===3&&Rn&&(Rn.slots._===1?f._=1:(f._=2,l.patchFlag|=1024))}else ir(f)?(f={default:f,_ctx:Rn},v=32):(f=String(f),b&64?(v=16,f=[Hc(f)]):v=8);l.children=f,l.shapeFlag|=v}function a0(...l){const f={};for(let v=0;v<l.length;v++){const b=l[v];for(const A in b)if(A==="class")f.class!==b.class&&(f.class=Xo([f.class,b.class]));else if(A==="style")f.style=y_([f.style,b.style]);else if(p_(A)){const R=f[A],z=b[A];z&&R!==z&&!(Fi(R)&&R.includes(z))&&(f[A]=R?[].concat(R,z):z)}else A!==""&&(f[A]=b[A])}return f}function Zo(l,f,v,b=null){Ks(l,f,7,[v,b])}const wR=yE();let TR=0;function ER(l,f,v){const b=l.type,A=(f?f.appContext:l.appContext)||wR,R={uid:TR++,vnode:l,type:b,parent:f,appContext:A,root:null,next:null,subTree:null,effect:null,update:null,scope:new BT(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:f?f.provides:Object.create(A.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:TE(b,A),emitsOptions:LE(b,A),emit:null,emitted:null,propsDefaults:ln,inheritAttrs:b.inheritAttrs,ctx:ln,data:ln,props:ln,attrs:ln,slots:ln,refs:ln,setupState:ln,setupContext:null,suspense:v,suspenseId:v?v.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return R.ctx={_:R},R.root=f?f.root:R,R.emit=fR.bind(null,R),l.ce&&l.ce(R),R}let Fn=null;const SR=()=>Fn||Rn;let a_,l0;{const l=DT(),f=(v,b)=>{let A;return(A=l[v])||(A=l[v]=[]),A.push(b),R=>{A.length>1?A.forEach(z=>z(R)):A[0](R)}};a_=f("__VUE_INSTANCE_SETTERS__",v=>Fn=v),l0=f("__VUE_SSR_SETTERS__",v=>M_=v)}const $f=l=>{const f=Fn;return a_(l),l.scope.on(),()=>{l.scope.off(),a_(f)}},Tw=()=>{Fn&&Fn.scope.off(),a_(null)};function zE(l){return l.vnode.shapeFlag&4}let M_=!1;function MR(l,f=!1,v=!1){f&&l0(f);const{props:b,children:A}=l.vnode,R=zE(l);YP(l,b,R,f),tR(l,A,v);const z=R?AR(l,f):void 0;return f&&l0(!1),z}function AR(l,f){const v=l.type;l.accessCache=Object.create(null),l.proxy=new Proxy(l.ctx,jP);const{setup:b}=v;if(b){const A=l.setupContext=b.length>1?CR(l):null,R=$f(l);Rl();const z=wl(b,l,0,[l.props,A]);if(Ll(),R(),CT(z)){if(z.then(Tw,Tw),f)return z.then(G=>{Ew(l,G,f)}).catch(G=>{x_(G,l,0)});l.asyncDep=z}else Ew(l,z,f)}else kE(l,f)}function Ew(l,f,v){ir(f)?l.type.__ssrInlineRender?l.ssrRender=f:l.render=f:en(f)&&(l.setupState=rE(f)),kE(l,v)}let Sw;function kE(l,f,v){const b=l.type;if(!l.render){if(!f&&Sw&&!b.render){const A=b.template||O0(l).template;if(A){const{isCustomElement:R,compilerOptions:z}=l.appContext.config,{delimiters:G,compilerOptions:o}=b,Y=Nn(Nn({isCustomElement:R,delimiters:G},z),o);b.render=Sw(A,Y)}}l.render=b.render||Xs}{const A=$f(l);Rl();try{GP(l)}finally{Ll(),A()}}}const IR={get(l,f){return ws(l,"get",""),l[f]}};function CR(l){const f=v=>{l.exposed=v||{}};return{attrs:new Proxy(l.attrs,IR),slots:l.slots,emit:l.emit,expose:f}}function A_(l){return l.exposed?l.exposeProxy||(l.exposeProxy=new Proxy(rE(M0(l.exposed)),{get(f,v){if(v in f)return f[v];if(v in If)return If[v](l)},has(f,v){return v in f||v in If}})):l.proxy}function PR(l,f=!0){return ir(l)?l.displayName||l.name:l.name||f&&l.__name}function RR(l){return ir(l)&&"__vccOpts"in l}const Ws=(l,f)=>fP(l,f,M_);function F0(l,f,v){const b=arguments.length;return b===2?en(f)&&!Fi(f)?o_(f)?Cr(l,null,[f]):Cr(l,f):Cr(l,null,f):(b>3?v=Array.prototype.slice.call(arguments,2):b===3&&o_(v)&&(v=[v]),Cr(l,f,v))}const LR="3.4.38";/**
-* @vue/runtime-dom v3.4.38
-* (c) 2018-present Yuxi (Evan) You and Vue contributors
-* @license MIT
-**/const DR="http://www.w3.org/2000/svg",OR="http://www.w3.org/1998/Math/MathML",wa=typeof document<"u"?document:null,Mw=wa&&wa.createElement("template"),zR={insert:(l,f,v)=>{f.insertBefore(l,v||null)},remove:l=>{const f=l.parentNode;f&&f.removeChild(l)},createElement:(l,f,v,b)=>{const A=f==="svg"?wa.createElementNS(DR,l):f==="mathml"?wa.createElementNS(OR,l):v?wa.createElement(l,{is:v}):wa.createElement(l);return l==="select"&&b&&b.multiple!=null&&A.setAttribute("multiple",b.multiple),A},createText:l=>wa.createTextNode(l),createComment:l=>wa.createComment(l),setText:(l,f)=>{l.nodeValue=f},setElementText:(l,f)=>{l.textContent=f},parentNode:l=>l.parentNode,nextSibling:l=>l.nextSibling,querySelector:l=>wa.querySelector(l),setScopeId(l,f){l.setAttribute(f,"")},insertStaticContent(l,f,v,b,A,R){const z=v?v.previousSibling:f.lastChild;if(A&&(A===R||A.nextSibling))for(;f.insertBefore(A.cloneNode(!0),v),!(A===R||!(A=A.nextSibling)););else{Mw.innerHTML=b==="svg"?`<svg>${l}</svg>`:b==="mathml"?`<math>${l}</math>`:l;const G=Mw.content;if(b==="svg"||b==="mathml"){const o=G.firstChild;for(;o.firstChild;)G.appendChild(o.firstChild);G.removeChild(o)}f.insertBefore(G,v)}return[z?z.nextSibling:f.firstChild,v?v.previousSibling:f.lastChild]}},hl="transition",bf="animation",Ff=Symbol("_vtc"),qc=(l,{slots:f})=>F0(CP,kR(l),f);qc.displayName="Transition";const BE={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};qc.props=Nn({},lE,BE);const Dc=(l,f=[])=>{Fi(l)?l.forEach(v=>v(...f)):l&&l(...f)},Aw=l=>l?Fi(l)?l.some(f=>f.length>1):l.length>1:!1;function kR(l){const f={};for(const dt in l)dt in BE||(f[dt]=l[dt]);if(l.css===!1)return f;const{name:v="v",type:b,duration:A,enterFromClass:R=`${v}-enter-from`,enterActiveClass:z=`${v}-enter-active`,enterToClass:G=`${v}-enter-to`,appearFromClass:o=R,appearActiveClass:Y=z,appearToClass:ie=G,leaveFromClass:K=`${v}-leave-from`,leaveActiveClass:de=`${v}-leave-active`,leaveToClass:ce=`${v}-leave-to`}=l,Ee=BR(A),Ue=Ee&&Ee[0],$e=Ee&&Ee[1],{onBeforeEnter:et,onEnter:ht,onEnterCancelled:Xe,onLeave:$t,onLeaveCancelled:kt,onBeforeAppear:At=et,onAppear:_i=ht,onAppearCancelled:ai=Xe}=f,Ie=(dt,Ei,Dr)=>{Oc(dt,Ei?ie:G),Oc(dt,Ei?Y:z),Dr&&Dr()},Ti=(dt,Ei)=>{dt._isLeaving=!1,Oc(dt,K),Oc(dt,ce),Oc(dt,de),Ei&&Ei()},Wi=dt=>(Ei,Dr)=>{const tt=dt?_i:ht,Ri=()=>Ie(Ei,dt,Dr);Dc(tt,[Ei,Ri]),Iw(()=>{Oc(Ei,dt?o:R),dl(Ei,dt?ie:G),Aw(tt)||Cw(Ei,b,Ue,Ri)})};return Nn(f,{onBeforeEnter(dt){Dc(et,[dt]),dl(dt,R),dl(dt,z)},onBeforeAppear(dt){Dc(At,[dt]),dl(dt,o),dl(dt,Y)},onEnter:Wi(!1),onAppear:Wi(!0),onLeave(dt,Ei){dt._isLeaving=!0;const Dr=()=>Ti(dt,Ei);dl(dt,K),dl(dt,de),VR(),Iw(()=>{dt._isLeaving&&(Oc(dt,K),dl(dt,ce),Aw($t)||Cw(dt,b,$e,Dr))}),Dc($t,[dt,Dr])},onEnterCancelled(dt){Ie(dt,!1),Dc(Xe,[dt])},onAppearCancelled(dt){Ie(dt,!0),Dc(ai,[dt])},onLeaveCancelled(dt){Ti(dt),Dc(kt,[dt])}})}function BR(l){if(l==null)return null;if(en(l))return[zy(l.enter),zy(l.leave)];{const f=zy(l);return[f,f]}}function zy(l){return FC(l)}function dl(l,f){f.split(/\s+/).forEach(v=>v&&l.classList.add(v)),(l[Ff]||(l[Ff]=new Set)).add(f)}function Oc(l,f){f.split(/\s+/).forEach(b=>b&&l.classList.remove(b));const v=l[Ff];v&&(v.delete(f),v.size||(l[Ff]=void 0))}function Iw(l){requestAnimationFrame(()=>{requestAnimationFrame(l)})}let FR=0;function Cw(l,f,v,b){const A=l._endId=++FR,R=()=>{A===l._endId&&b()};if(v)return setTimeout(R,v);const{type:z,timeout:G,propCount:o}=NR(l,f);if(!z)return b();const Y=z+"end";let ie=0;const K=()=>{l.removeEventListener(Y,de),R()},de=ce=>{ce.target===l&&++ie>=o&&K()};setTimeout(()=>{ie<o&&K()},G+1),l.addEventListener(Y,de)}function NR(l,f){const v=window.getComputedStyle(l),b=Ee=>(v[Ee]||"").split(", "),A=b(`${hl}Delay`),R=b(`${hl}Duration`),z=Pw(A,R),G=b(`${bf}Delay`),o=b(`${bf}Duration`),Y=Pw(G,o);let ie=null,K=0,de=0;f===hl?z>0&&(ie=hl,K=z,de=R.length):f===bf?Y>0&&(ie=bf,K=Y,de=o.length):(K=Math.max(z,Y),ie=K>0?z>Y?hl:bf:null,de=ie?ie===hl?R.length:o.length:0);const ce=ie===hl&&/\b(transform|all)(,|$)/.test(b(`${hl}Property`).toString());return{type:ie,timeout:K,propCount:de,hasTransform:ce}}function Pw(l,f){for(;l.length<f.length;)l=l.concat(l);return Math.max(...f.map((v,b)=>Rw(v)+Rw(l[b])))}function Rw(l){return l==="auto"?0:Number(l.slice(0,-1).replace(",","."))*1e3}function VR(){return document.body.offsetHeight}function UR(l,f,v){const b=l[Ff];b&&(f=(f?[f,...b]:[...b]).join(" ")),f==null?l.removeAttribute("class"):v?l.setAttribute("class",f):l.className=f}const l_=Symbol("_vod"),FE=Symbol("_vsh"),Nf={beforeMount(l,{value:f},{transition:v}){l[l_]=l.style.display==="none"?"":l.style.display,v&&f?v.beforeEnter(l):wf(l,f)},mounted(l,{value:f},{transition:v}){v&&f&&v.enter(l)},updated(l,{value:f,oldValue:v},{transition:b}){!f!=!v&&(b?f?(b.beforeEnter(l),wf(l,!0),b.enter(l)):b.leave(l,()=>{wf(l,!1)}):wf(l,f))},beforeUnmount(l,{value:f}){wf(l,f)}};function wf(l,f){l.style.display=f?l[l_]:"none",l[FE]=!f}const jR=Symbol(""),GR=/(^|;)\s*display\s*:/;function $R(l,f,v){const b=l.style,A=_n(v);let R=!1;if(v&&!A){if(f)if(_n(f))for(const z of f.split(";")){const G=z.slice(0,z.indexOf(":")).trim();v[G]==null&&e_(b,G,"")}else for(const z in f)v[z]==null&&e_(b,z,"");for(const z in v)z==="display"&&(R=!0),e_(b,z,v[z])}else if(A){if(f!==v){const z=b[jR];z&&(v+=";"+z),b.cssText=v,R=GR.test(v)}}else f&&l.removeAttribute("style");l_ in l&&(l[l_]=R?b.display:"",l[FE]&&(b.display="none"))}const Lw=/\s*!important$/;function e_(l,f,v){if(Fi(v))v.forEach(b=>e_(l,f,b));else if(v==null&&(v=""),f.startsWith("--"))l.setProperty(f,v);else{const b=qR(l,f);Lw.test(v)?l.setProperty(Wc(b),v.replace(Lw,""),"important"):l[b]=v}}const Dw=["Webkit","Moz","ms"],ky={};function qR(l,f){const v=ky[f];if(v)return v;let b=vo(f);if(b!=="filter"&&b in l)return ky[f]=b;b=g_(b);for(let A=0;A<Dw.length;A++){const R=Dw[A]+b;if(R in l)return ky[f]=R}return f}const Ow="http://www.w3.org/1999/xlink";function zw(l,f,v,b,A,R=$C(f)){b&&f.startsWith("xlink:")?v==null?l.removeAttributeNS(Ow,f.slice(6,f.length)):l.setAttributeNS(Ow,f,v):v==null||R&&!OT(v)?l.removeAttribute(f):l.setAttribute(f,R?"":Pl(v)?String(v):v)}function ZR(l,f,v,b){if(f==="innerHTML"||f==="textContent"){if(v==null)return;l[f]=v;return}const A=l.tagName;if(f==="value"&&A!=="PROGRESS"&&!A.includes("-")){const z=A==="OPTION"?l.getAttribute("value")||"":l.value,G=v==null?"":String(v);(z!==G||!("_value"in l))&&(l.value=G),v==null&&l.removeAttribute(f),l._value=v;return}let R=!1;if(v===""||v==null){const z=typeof l[f];z==="boolean"?v=OT(v):v==null&&z==="string"?(v="",R=!0):z==="number"&&(v=0,R=!0)}try{l[f]=v}catch{}R&&l.removeAttribute(f)}function ih(l,f,v,b){l.addEventListener(f,v,b)}function HR(l,f,v,b){l.removeEventListener(f,v,b)}const kw=Symbol("_vei");function WR(l,f,v,b,A=null){const R=l[kw]||(l[kw]={}),z=R[f];if(b&&z)z.value=b;else{const[G,o]=XR(f);if(b){const Y=R[f]=JR(b,A);ih(l,G,Y,o)}else z&&(HR(l,G,z,o),R[f]=void 0)}}const Bw=/(?:Once|Passive|Capture)$/;function XR(l){let f;if(Bw.test(l)){f={};let b;for(;b=l.match(Bw);)l=l.slice(0,l.length-b[0].length),f[b[0].toLowerCase()]=!0}return[l[2]===":"?l.slice(3):Wc(l.slice(2)),f]}let By=0;const KR=Promise.resolve(),YR=()=>By||(KR.then(()=>By=0),By=Date.now());function JR(l,f){const v=b=>{if(!b._vts)b._vts=Date.now();else if(b._vts<=v.attached)return;Ks(QR(b,v.value),f,5,[b])};return v.value=l,v.attached=YR(),v}function QR(l,f){if(Fi(f)){const v=l.stopImmediatePropagation;return l.stopImmediatePropagation=()=>{v.call(l),l._stopped=!0},f.map(b=>A=>!A._stopped&&b&&b(A))}else return f}const Fw=l=>l.charCodeAt(0)===111&&l.charCodeAt(1)===110&&l.charCodeAt(2)>96&&l.charCodeAt(2)<123,eL=(l,f,v,b,A,R)=>{const z=A==="svg";f==="class"?UR(l,b,z):f==="style"?$R(l,v,b):p_(f)?g0(f)||WR(l,f,v,b,R):(f[0]==="."?(f=f.slice(1),!0):f[0]==="^"?(f=f.slice(1),!1):tL(l,f,b,z))?(ZR(l,f,b),!l.tagName.includes("-")&&(f==="value"||f==="checked"||f==="selected")&&zw(l,f,b,z,R,f!=="value")):(f==="true-value"?l._trueValue=b:f==="false-value"&&(l._falseValue=b),zw(l,f,b,z))};function tL(l,f,v,b){if(b)return!!(f==="innerHTML"||f==="textContent"||f in l&&Fw(f)&&ir(v));if(f==="spellcheck"||f==="draggable"||f==="translate"||f==="form"||f==="list"&&l.tagName==="INPUT"||f==="type"&&l.tagName==="TEXTAREA")return!1;if(f==="width"||f==="height"){const A=l.tagName;if(A==="IMG"||A==="VIDEO"||A==="CANVAS"||A==="SOURCE")return!1}return Fw(f)&&_n(v)?!1:f in l}const Nw=l=>{const f=l.props["onUpdate:modelValue"]||!1;return Fi(f)?v=>Km(f,v):f};function iL(l){l.target.composing=!0}function Vw(l){const f=l.target;f.composing&&(f.composing=!1,f.dispatchEvent(new Event("input")))}const Fy=Symbol("_assign"),Uw={created(l,{modifiers:{lazy:f,trim:v,number:b}},A){l[Fy]=Nw(A);const R=b||A.props&&A.props.type==="number";ih(l,f?"change":"input",z=>{if(z.target.composing)return;let G=l.value;v&&(G=G.trim()),R&&(G=Ky(G)),l[Fy](G)}),v&&ih(l,"change",()=>{l.value=l.value.trim()}),f||(ih(l,"compositionstart",iL),ih(l,"compositionend",Vw),ih(l,"change",Vw))},mounted(l,{value:f}){l.value=f??""},beforeUpdate(l,{value:f,oldValue:v,modifiers:{lazy:b,trim:A,number:R}},z){if(l[Fy]=Nw(z),l.composing)return;const G=(R||l.type==="number")&&!/^0\d/.test(l.value)?Ky(l.value):l.value,o=f??"";G!==o&&(document.activeElement===l&&l.type!=="range"&&(b&&f===v||A&&l.value.trim()===o)||(l.value=o))}},rL=["ctrl","shift","alt","meta"],nL={stop:l=>l.stopPropagation(),prevent:l=>l.preventDefault(),self:l=>l.target!==l.currentTarget,ctrl:l=>!l.ctrlKey,shift:l=>!l.shiftKey,alt:l=>!l.altKey,meta:l=>!l.metaKey,left:l=>"button"in l&&l.button!==0,middle:l=>"button"in l&&l.button!==1,right:l=>"button"in l&&l.button!==2,exact:(l,f)=>rL.some(v=>l[`${v}Key`]&&!f.includes(v))},c0=(l,f)=>{const v=l._withMods||(l._withMods={}),b=f.join(".");return v[b]||(v[b]=(A,...R)=>{for(let z=0;z<f.length;z++){const G=nL[f[z]];if(G&&G(A,f))return}return l(A,...R)})},sL=Nn({patchProp:eL},zR);let jw;function oL(){return jw||(jw=sR(sL))}const aL=(...l)=>{const f=oL().createApp(...l),{mount:v}=f;return f.mount=b=>{const A=cL(b);if(!A)return;const R=f._component;!ir(R)&&!R.render&&!R.template&&(R.template=A.innerHTML),A.innerHTML="";const z=v(A,!1,lL(A));return A instanceof Element&&(A.removeAttribute("v-cloak"),A.setAttribute("data-v-app","")),z},f};function lL(l){if(l instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&l instanceof MathMLElement)return"mathml"}function cL(l){return _n(l)?document.querySelector(l):l}var uL=!1;/*!
- * pinia v2.1.7
- * (c) 2023 Eduardo San Martin Morote
- * @license MIT
- */let NE;const I_=l=>NE=l,VE=Symbol();function u0(l){return l&&typeof l=="object"&&Object.prototype.toString.call(l)==="[object Object]"&&typeof l.toJSON!="function"}var Pf;(function(l){l.direct="direct",l.patchObject="patch object",l.patchFunction="patch function"})(Pf||(Pf={}));function hL(){const l=FT(!0),f=l.run(()=>Bi({}));let v=[],b=[];const A=M0({install(R){I_(A),A._a=R,R.provide(VE,A),R.config.globalProperties.$pinia=A,b.forEach(z=>v.push(z)),b=[]},use(R){return!this._a&&!uL?b.push(R):v.push(R),this},_p:v,_a:null,_e:l,_s:new Map,state:f});return A}const UE=()=>{};function Gw(l,f,v,b=UE){l.push(f);const A=()=>{const R=l.indexOf(f);R>-1&&(l.splice(R,1),b())};return!v&&NT()&&ZC(A),A}function Qu(l,...f){l.slice().forEach(v=>{v(...f)})}const dL=l=>l();function h0(l,f){l instanceof Map&&f instanceof Map&&f.forEach((v,b)=>l.set(b,v)),l instanceof Set&&f instanceof Set&&f.forEach(l.add,l);for(const v in f){if(!f.hasOwnProperty(v))continue;const b=f[v],A=l[v];u0(A)&&u0(b)&&l.hasOwnProperty(v)&&!Ln(b)&&!jc(b)?l[v]=h0(A,b):l[v]=b}return l}const fL=Symbol();function pL(l){return!u0(l)||!l.hasOwnProperty(fL)}const{assign:ml}=Object;function mL(l){return!!(Ln(l)&&l.effect)}function _L(l,f,v,b){const{state:A,actions:R,getters:z}=f,G=v.state.value[l];let o;function Y(){G||(v.state.value[l]=A?A():{});const ie=gP(v.state.value[l]);return ml(ie,R,Object.keys(z||{}).reduce((K,de)=>(K[de]=M0(Ws(()=>{I_(v);const ce=v._s.get(l);return z[de].call(ce,ce)})),K),{}))}return o=jE(l,Y,f,v,b,!0),o}function jE(l,f,v={},b,A,R){let z;const G=ml({actions:{}},v),o={deep:!0};let Y,ie,K=[],de=[],ce;const Ee=b.state.value[l];!R&&!Ee&&(b.state.value[l]={}),Bi({});let Ue;function $e(ai){let Ie;Y=ie=!1,typeof ai=="function"?(ai(b.state.value[l]),Ie={type:Pf.patchFunction,storeId:l,events:ce}):(h0(b.state.value[l],ai),Ie={type:Pf.patchObject,payload:ai,storeId:l,events:ce});const Ti=Ue=Symbol();C0().then(()=>{Ue===Ti&&(Y=!0)}),ie=!0,Qu(K,Ie,b.state.value[l])}const et=R?function(){const{state:Ie}=v,Ti=Ie?Ie():{};this.$patch(Wi=>{ml(Wi,Ti)})}:UE;function ht(){z.stop(),K=[],de=[],b._s.delete(l)}function Xe(ai,Ie){return function(){I_(b);const Ti=Array.from(arguments),Wi=[],dt=[];function Ei(Ri){Wi.push(Ri)}function Dr(Ri){dt.push(Ri)}Qu(de,{args:Ti,name:ai,store:kt,after:Ei,onError:Dr});let tt;try{tt=Ie.apply(this&&this.$id===l?this:kt,Ti)}catch(Ri){throw Qu(dt,Ri),Ri}return tt instanceof Promise?tt.then(Ri=>(Qu(Wi,Ri),Ri)).catch(Ri=>(Qu(dt,Ri),Promise.reject(Ri))):(Qu(Wi,tt),tt)}}const $t={_p:b,$id:l,$onAction:Gw.bind(null,de),$patch:$e,$reset:et,$subscribe(ai,Ie={}){const Ti=Gw(K,ai,Ie.detached,()=>Wi()),Wi=z.run(()=>El(()=>b.state.value[l],dt=>{(Ie.flush==="sync"?ie:Y)&&ai({storeId:l,type:Pf.direct,events:ce},dt)},ml({},o,Ie)));return Ti},$dispose:ht},kt=jf($t);b._s.set(l,kt);const _i=(b._a&&b._a.runWithContext||dL)(()=>b._e.run(()=>(z=FT()).run(f)));for(const ai in _i){const Ie=_i[ai];if(Ln(Ie)&&!mL(Ie)||jc(Ie))R||(Ee&&pL(Ie)&&(Ln(Ie)?Ie.value=Ee[ai]:h0(Ie,Ee[ai])),b.state.value[l][ai]=Ie);else if(typeof Ie=="function"){const Ti=Xe(ai,Ie);_i[ai]=Ti,G.actions[ai]=Ie}}return ml(kt,_i),ml(Sr(kt),_i),Object.defineProperty(kt,"$state",{get:()=>b.state.value[l],set:ai=>{$e(Ie=>{ml(Ie,ai)})}}),b._p.forEach(ai=>{ml(kt,z.run(()=>ai({store:kt,app:b._a,pinia:b,options:G})))}),Ee&&R&&v.hydrate&&v.hydrate(kt.$state,Ee),Y=!0,ie=!0,kt}function N0(l,f,v){let b,A;const R=typeof f=="function";typeof l=="string"?(b=l,A=R?v:f):(A=l,b=l.id);function z(G,o){const Y=KP();return G=G||(Y?yo(VE,null):null),G&&I_(G),G=NE,G._s.has(b)||(R?jE(b,f,A,G):_L(b,A,G)),G._s.get(b)}return z.$id=b,z}function gL(l){return typeof l=="object"&&l!==null}function $w(l,f){return l=gL(l)?l:Object.create(null),new Proxy(l,{get(v,b,A){return b==="key"?Reflect.get(v,b,A):Reflect.get(v,b,A)||Reflect.get(f,b,A)}})}function yL(l,f){return f.reduce((v,b)=>v==null?void 0:v[b],l)}function vL(l,f,v){return f.slice(0,-1).reduce((b,A)=>/^(__proto__)$/.test(A)?{}:b[A]=b[A]||{},l)[f[f.length-1]]=v,l}function xL(l,f){return f.reduce((v,b)=>{const A=b.split(".");return vL(v,A,yL(l,A))},{})}function bL(l,f){return v=>{var b;try{const{storage:A=localStorage,beforeRestore:R=void 0,afterRestore:z=void 0,serializer:G={serialize:JSON.stringify,deserialize:JSON.parse},key:o=f.$id,paths:Y=null,debug:ie=!1}=v;return{storage:A,beforeRestore:R,afterRestore:z,serializer:G,key:((b=l.key)!=null?b:K=>K)(typeof o=="string"?o:o(f.$id)),paths:Y,debug:ie}}catch(A){return v.debug&&console.error("[pinia-plugin-persistedstate]",A),null}}}function qw(l,{storage:f,serializer:v,key:b,debug:A}){try{const R=f==null?void 0:f.getItem(b);R&&l.$patch(v==null?void 0:v.deserialize(R))}catch(R){A&&console.error("[pinia-plugin-persistedstate]",R)}}function Zw(l,{storage:f,serializer:v,key:b,paths:A,debug:R}){try{const z=Array.isArray(A)?xL(l,A):l;f.setItem(b,v.serialize(z))}catch(z){R&&console.error("[pinia-plugin-persistedstate]",z)}}function wL(l={}){return f=>{const{auto:v=!1}=l,{options:{persist:b=v},store:A,pinia:R}=f;if(!b)return;if(!(A.$id in R.state.value)){const G=R._s.get(A.$id.replace("__hot:",""));G&&Promise.resolve().then(()=>G.$persist());return}const z=(Array.isArray(b)?b.map(G=>$w(G,l)):[$w(b,l)]).map(bL(l,A)).filter(Boolean);A.$persist=()=>{z.forEach(G=>{Zw(A.$state,G)})},A.$hydrate=({runHooks:G=!0}={})=>{z.forEach(o=>{const{beforeRestore:Y,afterRestore:ie}=o;G&&(Y==null||Y(f)),qw(A,o),G&&(ie==null||ie(f))})},z.forEach(G=>{const{beforeRestore:o,afterRestore:Y}=G;o==null||o(f),qw(A,G),Y==null||Y(f),A.$subscribe((ie,K)=>{Zw(K,G)},{detached:!0})})}}var TL=wL();const qf=(l,f)=>{const v=l.__vccOpts||l;for(const[b,A]of f)v[b]=A;return v},EL={};function SL(l,f){const v=L0("router-view");return ri(),hi("main",null,[Cr(v)])}const ML=qf(EL,[["render",SL]]);/*!
-  * vue-router v4.4.3
-  * (c) 2024 Eduardo San Martin Morote
-  * @license MIT
-  */const rh=typeof document<"u";function AL(l){return l.__esModule||l[Symbol.toStringTag]==="Module"}const jr=Object.assign;function Ny(l,f){const v={};for(const b in f){const A=f[b];v[b]=xo(A)?A.map(l):l(A)}return v}const Rf=()=>{},xo=Array.isArray,GE=/#/g,IL=/&/g,CL=/\//g,PL=/=/g,RL=/\?/g,$E=/\+/g,LL=/%5B/g,DL=/%5D/g,qE=/%5E/g,OL=/%60/g,ZE=/%7B/g,zL=/%7C/g,HE=/%7D/g,kL=/%20/g;function V0(l){return encodeURI(""+l).replace(zL,"|").replace(LL,"[").replace(DL,"]")}function BL(l){return V0(l).replace(ZE,"{").replace(HE,"}").replace(qE,"^")}function d0(l){return V0(l).replace($E,"%2B").replace(kL,"+").replace(GE,"%23").replace(IL,"%26").replace(OL,"`").replace(ZE,"{").replace(HE,"}").replace(qE,"^")}function FL(l){return d0(l).replace(PL,"%3D")}function NL(l){return V0(l).replace(GE,"%23").replace(RL,"%3F")}function VL(l){return l==null?"":NL(l).replace(CL,"%2F")}function Vf(l){try{return decodeURIComponent(""+l)}catch{}return""+l}const UL=/\/$/,jL=l=>l.replace(UL,"");function Vy(l,f,v="/"){let b,A={},R="",z="";const G=f.indexOf("#");let o=f.indexOf("?");return G<o&&G>=0&&(o=-1),o>-1&&(b=f.slice(0,o),R=f.slice(o+1,G>-1?G:f.length),A=l(R)),G>-1&&(b=b||f.slice(0,G),z=f.slice(G,f.length)),b=ZL(b??f,v),{fullPath:b+(R&&"?")+R+z,path:b,query:A,hash:Vf(z)}}function GL(l,f){const v=f.query?l(f.query):"";return f.path+(v&&"?")+v+(f.hash||"")}function Hw(l,f){return!f||!l.toLowerCase().startsWith(f.toLowerCase())?l:l.slice(f.length)||"/"}function $L(l,f,v){const b=f.matched.length-1,A=v.matched.length-1;return b>-1&&b===A&&hh(f.matched[b],v.matched[A])&&WE(f.params,v.params)&&l(f.query)===l(v.query)&&f.hash===v.hash}function hh(l,f){return(l.aliasOf||l)===(f.aliasOf||f)}function WE(l,f){if(Object.keys(l).length!==Object.keys(f).length)return!1;for(const v in l)if(!qL(l[v],f[v]))return!1;return!0}function qL(l,f){return xo(l)?Ww(l,f):xo(f)?Ww(f,l):l===f}function Ww(l,f){return xo(f)?l.length===f.length&&l.every((v,b)=>v===f[b]):l.length===1&&l[0]===f}function ZL(l,f){if(l.startsWith("/"))return l;if(!l)return f;const v=f.split("/"),b=l.split("/"),A=b[b.length-1];(A===".."||A===".")&&b.push("");let R=v.length-1,z,G;for(z=0;z<b.length;z++)if(G=b[z],G!==".")if(G==="..")R>1&&R--;else break;return v.slice(0,R).join("/")+"/"+b.slice(z).join("/")}const fl={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Uf;(function(l){l.pop="pop",l.push="push"})(Uf||(Uf={}));var Lf;(function(l){l.back="back",l.forward="forward",l.unknown=""})(Lf||(Lf={}));function HL(l){if(!l)if(rh){const f=document.querySelector("base");l=f&&f.getAttribute("href")||"/",l=l.replace(/^\w+:\/\/[^\/]+/,"")}else l="/";return l[0]!=="/"&&l[0]!=="#"&&(l="/"+l),jL(l)}const WL=/^[^#]+#/;function XL(l,f){return l.replace(WL,"#")+f}function KL(l,f){const v=document.documentElement.getBoundingClientRect(),b=l.getBoundingClientRect();return{behavior:f.behavior,left:b.left-v.left-(f.left||0),top:b.top-v.top-(f.top||0)}}const C_=()=>({left:window.scrollX,top:window.scrollY});function YL(l){let f;if("el"in l){const v=l.el,b=typeof v=="string"&&v.startsWith("#"),A=typeof v=="string"?b?document.getElementById(v.slice(1)):document.querySelector(v):v;if(!A)return;f=KL(A,l)}else f=l;"scrollBehavior"in document.documentElement.style?window.scrollTo(f):window.scrollTo(f.left!=null?f.left:window.scrollX,f.top!=null?f.top:window.scrollY)}function Xw(l,f){return(history.state?history.state.position-f:-1)+l}const f0=new Map;function JL(l,f){f0.set(l,f)}function QL(l){const f=f0.get(l);return f0.delete(l),f}let eD=()=>location.protocol+"//"+location.host;function XE(l,f){const{pathname:v,search:b,hash:A}=f,R=l.indexOf("#");if(R>-1){let G=A.includes(l.slice(R))?l.slice(R).length:1,o=A.slice(G);return o[0]!=="/"&&(o="/"+o),Hw(o,"")}return Hw(v,l)+b+A}function tD(l,f,v,b){let A=[],R=[],z=null;const G=({state:de})=>{const ce=XE(l,location),Ee=v.value,Ue=f.value;let $e=0;if(de){if(v.value=ce,f.value=de,z&&z===Ee){z=null;return}$e=Ue?de.position-Ue.position:0}else b(ce);A.forEach(et=>{et(v.value,Ee,{delta:$e,type:Uf.pop,direction:$e?$e>0?Lf.forward:Lf.back:Lf.unknown})})};function o(){z=v.value}function Y(de){A.push(de);const ce=()=>{const Ee=A.indexOf(de);Ee>-1&&A.splice(Ee,1)};return R.push(ce),ce}function ie(){const{history:de}=window;de.state&&de.replaceState(jr({},de.state,{scroll:C_()}),"")}function K(){for(const de of R)de();R=[],window.removeEventListener("popstate",G),window.removeEventListener("beforeunload",ie)}return window.addEventListener("popstate",G),window.addEventListener("beforeunload",ie,{passive:!0}),{pauseListeners:o,listen:Y,destroy:K}}function Kw(l,f,v,b=!1,A=!1){return{back:l,current:f,forward:v,replaced:b,position:window.history.length,scroll:A?C_():null}}function iD(l){const{history:f,location:v}=window,b={value:XE(l,v)},A={value:f.state};A.value||R(b.value,{back:null,current:b.value,forward:null,position:f.length-1,replaced:!0,scroll:null},!0);function R(o,Y,ie){const K=l.indexOf("#"),de=K>-1?(v.host&&document.querySelector("base")?l:l.slice(K))+o:eD()+l+o;try{f[ie?"replaceState":"pushState"](Y,"",de),A.value=Y}catch(ce){console.error(ce),v[ie?"replace":"assign"](de)}}function z(o,Y){const ie=jr({},f.state,Kw(A.value.back,o,A.value.forward,!0),Y,{position:A.value.position});R(o,ie,!0),b.value=o}function G(o,Y){const ie=jr({},A.value,f.state,{forward:o,scroll:C_()});R(ie.current,ie,!0);const K=jr({},Kw(b.value,o,null),{position:ie.position+1},Y);R(o,K,!1),b.value=o}return{location:b,state:A,push:G,replace:z}}function rD(l){l=HL(l);const f=iD(l),v=tD(l,f.state,f.location,f.replace);function b(R,z=!0){z||v.pauseListeners(),history.go(R)}const A=jr({location:"",base:l,go:b,createHref:XL.bind(null,l)},f,v);return Object.defineProperty(A,"location",{enumerable:!0,get:()=>f.location.value}),Object.defineProperty(A,"state",{enumerable:!0,get:()=>f.state.value}),A}function nD(l){return typeof l=="string"||l&&typeof l=="object"}function KE(l){return typeof l=="string"||typeof l=="symbol"}const YE=Symbol("");var Yw;(function(l){l[l.aborted=4]="aborted",l[l.cancelled=8]="cancelled",l[l.duplicated=16]="duplicated"})(Yw||(Yw={}));function dh(l,f){return jr(new Error,{type:l,[YE]:!0},f)}function ba(l,f){return l instanceof Error&&YE in l&&(f==null||!!(l.type&f))}const Jw="[^/]+?",sD={sensitive:!1,strict:!1,start:!0,end:!0},oD=/[.+*?^${}()[\]/\\]/g;function aD(l,f){const v=jr({},sD,f),b=[];let A=v.start?"^":"";const R=[];for(const Y of l){const ie=Y.length?[]:[90];v.strict&&!Y.length&&(A+="/");for(let K=0;K<Y.length;K++){const de=Y[K];let ce=40+(v.sensitive?.25:0);if(de.type===0)K||(A+="/"),A+=de.value.replace(oD,"\\$&"),ce+=40;else if(de.type===1){const{value:Ee,repeatable:Ue,optional:$e,regexp:et}=de;R.push({name:Ee,repeatable:Ue,optional:$e});const ht=et||Jw;if(ht!==Jw){ce+=10;try{new RegExp(`(${ht})`)}catch($t){throw new Error(`Invalid custom RegExp for param "${Ee}" (${ht}): `+$t.message)}}let Xe=Ue?`((?:${ht})(?:/(?:${ht}))*)`:`(${ht})`;K||(Xe=$e&&Y.length<2?`(?:/${Xe})`:"/"+Xe),$e&&(Xe+="?"),A+=Xe,ce+=20,$e&&(ce+=-8),Ue&&(ce+=-20),ht===".*"&&(ce+=-50)}ie.push(ce)}b.push(ie)}if(v.strict&&v.end){const Y=b.length-1;b[Y][b[Y].length-1]+=.7000000000000001}v.strict||(A+="/?"),v.end?A+="$":v.strict&&(A+="(?:/|$)");const z=new RegExp(A,v.sensitive?"":"i");function G(Y){const ie=Y.match(z),K={};if(!ie)return null;for(let de=1;de<ie.length;de++){const ce=ie[de]||"",Ee=R[de-1];K[Ee.name]=ce&&Ee.repeatable?ce.split("/"):ce}return K}function o(Y){let ie="",K=!1;for(const de of l){(!K||!ie.endsWith("/"))&&(ie+="/"),K=!1;for(const ce of de)if(ce.type===0)ie+=ce.value;else if(ce.type===1){const{value:Ee,repeatable:Ue,optional:$e}=ce,et=Ee in Y?Y[Ee]:"";if(xo(et)&&!Ue)throw new Error(`Provided param "${Ee}" is an array but it is not repeatable (* or + modifiers)`);const ht=xo(et)?et.join("/"):et;if(!ht)if($e)de.length<2&&(ie.endsWith("/")?ie=ie.slice(0,-1):K=!0);else throw new Error(`Missing required param "${Ee}"`);ie+=ht}}return ie||"/"}return{re:z,score:b,keys:R,parse:G,stringify:o}}function lD(l,f){let v=0;for(;v<l.length&&v<f.length;){const b=f[v]-l[v];if(b)return b;v++}return l.length<f.length?l.length===1&&l[0]===80?-1:1:l.length>f.length?f.length===1&&f[0]===80?1:-1:0}function JE(l,f){let v=0;const b=l.score,A=f.score;for(;v<b.length&&v<A.length;){const R=lD(b[v],A[v]);if(R)return R;v++}if(Math.abs(A.length-b.length)===1){if(Qw(b))return 1;if(Qw(A))return-1}return A.length-b.length}function Qw(l){const f=l[l.length-1];return l.length>0&&f[f.length-1]<0}const cD={type:0,value:""},uD=/[a-zA-Z0-9_]/;function hD(l){if(!l)return[[]];if(l==="/")return[[cD]];if(!l.startsWith("/"))throw new Error(`Invalid path "${l}"`);function f(ce){throw new Error(`ERR (${v})/"${Y}": ${ce}`)}let v=0,b=v;const A=[];let R;function z(){R&&A.push(R),R=[]}let G=0,o,Y="",ie="";function K(){Y&&(v===0?R.push({type:0,value:Y}):v===1||v===2||v===3?(R.length>1&&(o==="*"||o==="+")&&f(`A repeatable param (${Y}) must be alone in its segment. eg: '/:ids+.`),R.push({type:1,value:Y,regexp:ie,repeatable:o==="*"||o==="+",optional:o==="*"||o==="?"})):f("Invalid state to consume buffer"),Y="")}function de(){Y+=o}for(;G<l.length;){if(o=l[G++],o==="\\"&&v!==2){b=v,v=4;continue}switch(v){case 0:o==="/"?(Y&&K(),z()):o===":"?(K(),v=1):de();break;case 4:de(),v=b;break;case 1:o==="("?v=2:uD.test(o)?de():(K(),v=0,o!=="*"&&o!=="?"&&o!=="+"&&G--);break;case 2:o===")"?ie[ie.length-1]=="\\"?ie=ie.slice(0,-1)+o:v=3:ie+=o;break;case 3:K(),v=0,o!=="*"&&o!=="?"&&o!=="+"&&G--,ie="";break;default:f("Unknown state");break}}return v===2&&f(`Unfinished custom RegExp for param "${Y}"`),K(),z(),A}function dD(l,f,v){const b=aD(hD(l.path),v),A=jr(b,{record:l,parent:f,children:[],alias:[]});return f&&!A.record.aliasOf==!f.record.aliasOf&&f.children.push(A),A}function fD(l,f){const v=[],b=new Map;f=iT({strict:!1,end:!0,sensitive:!1},f);function A(K){return b.get(K)}function R(K,de,ce){const Ee=!ce,Ue=pD(K);Ue.aliasOf=ce&&ce.record;const $e=iT(f,K),et=[Ue];if("alias"in K){const $t=typeof K.alias=="string"?[K.alias]:K.alias;for(const kt of $t)et.push(jr({},Ue,{components:ce?ce.record.components:Ue.components,path:kt,aliasOf:ce?ce.record:Ue}))}let ht,Xe;for(const $t of et){const{path:kt}=$t;if(de&&kt[0]!=="/"){const At=de.record.path,_i=At[At.length-1]==="/"?"":"/";$t.path=de.record.path+(kt&&_i+kt)}if(ht=dD($t,de,$e),ce?ce.alias.push(ht):(Xe=Xe||ht,Xe!==ht&&Xe.alias.push(ht),Ee&&K.name&&!tT(ht)&&z(K.name)),QE(ht)&&o(ht),Ue.children){const At=Ue.children;for(let _i=0;_i<At.length;_i++)R(At[_i],ht,ce&&ce.children[_i])}ce=ce||ht}return Xe?()=>{z(Xe)}:Rf}function z(K){if(KE(K)){const de=b.get(K);de&&(b.delete(K),v.splice(v.indexOf(de),1),de.children.forEach(z),de.alias.forEach(z))}else{const de=v.indexOf(K);de>-1&&(v.splice(de,1),K.record.name&&b.delete(K.record.name),K.children.forEach(z),K.alias.forEach(z))}}function G(){return v}function o(K){const de=gD(K,v);v.splice(de,0,K),K.record.name&&!tT(K)&&b.set(K.record.name,K)}function Y(K,de){let ce,Ee={},Ue,$e;if("name"in K&&K.name){if(ce=b.get(K.name),!ce)throw dh(1,{location:K});$e=ce.record.name,Ee=jr(eT(de.params,ce.keys.filter(Xe=>!Xe.optional).concat(ce.parent?ce.parent.keys.filter(Xe=>Xe.optional):[]).map(Xe=>Xe.name)),K.params&&eT(K.params,ce.keys.map(Xe=>Xe.name))),Ue=ce.stringify(Ee)}else if(K.path!=null)Ue=K.path,ce=v.find(Xe=>Xe.re.test(Ue)),ce&&(Ee=ce.parse(Ue),$e=ce.record.name);else{if(ce=de.name?b.get(de.name):v.find(Xe=>Xe.re.test(de.path)),!ce)throw dh(1,{location:K,currentLocation:de});$e=ce.record.name,Ee=jr({},de.params,K.params),Ue=ce.stringify(Ee)}const et=[];let ht=ce;for(;ht;)et.unshift(ht.record),ht=ht.parent;return{name:$e,path:Ue,params:Ee,matched:et,meta:_D(et)}}l.forEach(K=>R(K));function ie(){v.length=0,b.clear()}return{addRoute:R,resolve:Y,removeRoute:z,clearRoutes:ie,getRoutes:G,getRecordMatcher:A}}function eT(l,f){const v={};for(const b of f)b in l&&(v[b]=l[b]);return v}function pD(l){return{path:l.path,redirect:l.redirect,name:l.name,meta:l.meta||{},aliasOf:void 0,beforeEnter:l.beforeEnter,props:mD(l),children:l.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in l?l.components||null:l.component&&{default:l.component}}}function mD(l){const f={},v=l.props||!1;if("component"in l)f.default=v;else for(const b in l.components)f[b]=typeof v=="object"?v[b]:v;return f}function tT(l){for(;l;){if(l.record.aliasOf)return!0;l=l.parent}return!1}function _D(l){return l.reduce((f,v)=>jr(f,v.meta),{})}function iT(l,f){const v={};for(const b in l)v[b]=b in f?f[b]:l[b];return v}function gD(l,f){let v=0,b=f.length;for(;v!==b;){const R=v+b>>1;JE(l,f[R])<0?b=R:v=R+1}const A=yD(l);return A&&(b=f.lastIndexOf(A,b-1)),b}function yD(l){let f=l;for(;f=f.parent;)if(QE(f)&&JE(l,f)===0)return f}function QE({record:l}){return!!(l.name||l.components&&Object.keys(l.components).length||l.redirect)}function vD(l){const f={};if(l===""||l==="?")return f;const b=(l[0]==="?"?l.slice(1):l).split("&");for(let A=0;A<b.length;++A){const R=b[A].replace($E," "),z=R.indexOf("="),G=Vf(z<0?R:R.slice(0,z)),o=z<0?null:Vf(R.slice(z+1));if(G in f){let Y=f[G];xo(Y)||(Y=f[G]=[Y]),Y.push(o)}else f[G]=o}return f}function rT(l){let f="";for(let v in l){const b=l[v];if(v=FL(v),b==null){b!==void 0&&(f+=(f.length?"&":"")+v);continue}(xo(b)?b.map(R=>R&&d0(R)):[b&&d0(b)]).forEach(R=>{R!==void 0&&(f+=(f.length?"&":"")+v,R!=null&&(f+="="+R))})}return f}function xD(l){const f={};for(const v in l){const b=l[v];b!==void 0&&(f[v]=xo(b)?b.map(A=>A==null?null:""+A):b==null?b:""+b)}return f}const bD=Symbol(""),nT=Symbol(""),P_=Symbol(""),eS=Symbol(""),p0=Symbol("");function Tf(){let l=[];function f(b){return l.push(b),()=>{const A=l.indexOf(b);A>-1&&l.splice(A,1)}}function v(){l=[]}return{add:f,list:()=>l.slice(),reset:v}}function vl(l,f,v,b,A,R=z=>z()){const z=b&&(b.enterCallbacks[A]=b.enterCallbacks[A]||[]);return()=>new Promise((G,o)=>{const Y=de=>{de===!1?o(dh(4,{from:v,to:f})):de instanceof Error?o(de):nD(de)?o(dh(2,{from:f,to:de})):(z&&b.enterCallbacks[A]===z&&typeof de=="function"&&z.push(de),G())},ie=R(()=>l.call(b&&b.instances[A],f,v,Y));let K=Promise.resolve(ie);l.length<3&&(K=K.then(Y)),K.catch(de=>o(de))})}function Uy(l,f,v,b,A=R=>R()){const R=[];for(const z of l)for(const G in z.components){let o=z.components[G];if(!(f!=="beforeRouteEnter"&&!z.instances[G]))if(wD(o)){const ie=(o.__vccOpts||o)[f];ie&&R.push(vl(ie,v,b,z,G,A))}else{let Y=o();R.push(()=>Y.then(ie=>{if(!ie)return Promise.reject(new Error(`Couldn't resolve component "${G}" at "${z.path}"`));const K=AL(ie)?ie.default:ie;z.components[G]=K;const ce=(K.__vccOpts||K)[f];return ce&&vl(ce,v,b,z,G,A)()}))}}return R}function wD(l){return typeof l=="object"||"displayName"in l||"props"in l||"__vccOpts"in l}function sT(l){const f=yo(P_),v=yo(eS),b=Ws(()=>{const o=wr(l.to);return f.resolve(o)}),A=Ws(()=>{const{matched:o}=b.value,{length:Y}=o,ie=o[Y-1],K=v.matched;if(!ie||!K.length)return-1;const de=K.findIndex(hh.bind(null,ie));if(de>-1)return de;const ce=oT(o[Y-2]);return Y>1&&oT(ie)===ce&&K[K.length-1].path!==ce?K.findIndex(hh.bind(null,o[Y-2])):de}),R=Ws(()=>A.value>-1&&MD(v.params,b.value.params)),z=Ws(()=>A.value>-1&&A.value===v.matched.length-1&&WE(v.params,b.value.params));function G(o={}){return SD(o)?f[wr(l.replace)?"replace":"push"](wr(l.to)).catch(Rf):Promise.resolve()}return{route:b,href:Ws(()=>b.value.href),isActive:R,isExactActive:z,navigate:G}}const TD=is({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:sT,setup(l,{slots:f}){const v=jf(sT(l)),{options:b}=yo(P_),A=Ws(()=>({[aT(l.activeClass,b.linkActiveClass,"router-link-active")]:v.isActive,[aT(l.exactActiveClass,b.linkExactActiveClass,"router-link-exact-active")]:v.isExactActive}));return()=>{const R=f.default&&f.default(v);return l.custom?R:F0("a",{"aria-current":v.isExactActive?l.ariaCurrentValue:null,href:v.href,onClick:v.navigate,class:A.value},R)}}}),ED=TD;function SD(l){if(!(l.metaKey||l.altKey||l.ctrlKey||l.shiftKey)&&!l.defaultPrevented&&!(l.button!==void 0&&l.button!==0)){if(l.currentTarget&&l.currentTarget.getAttribute){const f=l.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(f))return}return l.preventDefault&&l.preventDefault(),!0}}function MD(l,f){for(const v in f){const b=f[v],A=l[v];if(typeof b=="string"){if(b!==A)return!1}else if(!xo(A)||A.length!==b.length||b.some((R,z)=>R!==A[z]))return!1}return!0}function oT(l){return l?l.aliasOf?l.aliasOf.path:l.path:""}const aT=(l,f,v)=>l??f??v,AD=is({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(l,{attrs:f,slots:v}){const b=yo(p0),A=Ws(()=>l.route||b.value),R=yo(nT,0),z=Ws(()=>{let Y=wr(R);const{matched:ie}=A.value;let K;for(;(K=ie[Y])&&!K.components;)Y++;return Y}),G=Ws(()=>A.value.matched[z.value]);Jm(nT,Ws(()=>z.value+1)),Jm(bD,G),Jm(p0,A);const o=Bi();return El(()=>[o.value,G.value,l.name],([Y,ie,K],[de,ce,Ee])=>{ie&&(ie.instances[K]=Y,ce&&ce!==ie&&Y&&Y===de&&(ie.leaveGuards.size||(ie.leaveGuards=ce.leaveGuards),ie.updateGuards.size||(ie.updateGuards=ce.updateGuards))),Y&&ie&&(!ce||!hh(ie,ce)||!de)&&(ie.enterCallbacks[K]||[]).forEach(Ue=>Ue(Y))},{flush:"post"}),()=>{const Y=A.value,ie=l.name,K=G.value,de=K&&K.components[ie];if(!de)return lT(v.default,{Component:de,route:Y});const ce=K.props[ie],Ee=ce?ce===!0?Y.params:typeof ce=="function"?ce(Y):ce:null,$e=F0(de,jr({},Ee,f,{onVnodeUnmounted:et=>{et.component.isUnmounted&&(K.instances[ie]=null)},ref:o}));return lT(v.default,{Component:$e,route:Y})||$e}}});function lT(l,f){if(!l)return null;const v=l(f);return v.length===1?v[0]:v}const ID=AD;function CD(l){const f=fD(l.routes,l),v=l.parseQuery||vD,b=l.stringifyQuery||rT,A=l.history,R=Tf(),z=Tf(),G=Tf(),o=pP(fl);let Y=fl;rh&&l.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const ie=Ny.bind(null,lt=>""+lt),K=Ny.bind(null,VL),de=Ny.bind(null,Vf);function ce(lt,Qt){let Gt,Kt;return KE(lt)?(Gt=f.getRecordMatcher(lt),Kt=Qt):Kt=lt,f.addRoute(Kt,Gt)}function Ee(lt){const Qt=f.getRecordMatcher(lt);Qt&&f.removeRoute(Qt)}function Ue(){return f.getRoutes().map(lt=>lt.record)}function $e(lt){return!!f.getRecordMatcher(lt)}function et(lt,Qt){if(Qt=jr({},Qt||o.value),typeof lt=="string"){const _e=Vy(v,lt,Qt.path),Fe=f.resolve({path:_e.path},Qt),yt=A.createHref(_e.fullPath);return jr(_e,Fe,{params:de(Fe.params),hash:Vf(_e.hash),redirectedFrom:void 0,href:yt})}let Gt;if(lt.path!=null)Gt=jr({},lt,{path:Vy(v,lt.path,Qt.path).path});else{const _e=jr({},lt.params);for(const Fe in _e)_e[Fe]==null&&delete _e[Fe];Gt=jr({},lt,{params:K(_e)}),Qt.params=K(Qt.params)}const Kt=f.resolve(Gt,Qt),Xi=lt.hash||"";Kt.params=ie(de(Kt.params));const sr=GL(b,jr({},lt,{hash:BL(Xi),path:Kt.path})),pe=A.createHref(sr);return jr({fullPath:sr,hash:Xi,query:b===rT?xD(lt.query):lt.query||{}},Kt,{redirectedFrom:void 0,href:pe})}function ht(lt){return typeof lt=="string"?Vy(v,lt,o.value.path):jr({},lt)}function Xe(lt,Qt){if(Y!==lt)return dh(8,{from:Qt,to:lt})}function $t(lt){return _i(lt)}function kt(lt){return $t(jr(ht(lt),{replace:!0}))}function At(lt){const Qt=lt.matched[lt.matched.length-1];if(Qt&&Qt.redirect){const{redirect:Gt}=Qt;let Kt=typeof Gt=="function"?Gt(lt):Gt;return typeof Kt=="string"&&(Kt=Kt.includes("?")||Kt.includes("#")?Kt=ht(Kt):{path:Kt},Kt.params={}),jr({query:lt.query,hash:lt.hash,params:Kt.path!=null?{}:lt.params},Kt)}}function _i(lt,Qt){const Gt=Y=et(lt),Kt=o.value,Xi=lt.state,sr=lt.force,pe=lt.replace===!0,_e=At(Gt);if(_e)return _i(jr(ht(_e),{state:typeof _e=="object"?jr({},Xi,_e.state):Xi,force:sr,replace:pe}),Qt||Gt);const Fe=Gt;Fe.redirectedFrom=Qt;let yt;return!sr&&$L(b,Kt,Gt)&&(yt=dh(16,{to:Fe,from:Kt}),tn(Kt,Kt,!0,!1)),(yt?Promise.resolve(yt):Ti(Fe,Kt)).catch(rt=>ba(rt)?ba(rt,2)?rt:Cn(rt):Nt(rt,Fe,Kt)).then(rt=>{if(rt){if(ba(rt,2))return _i(jr({replace:pe},ht(rt.to),{state:typeof rt.to=="object"?jr({},Xi,rt.to.state):Xi,force:sr}),Qt||Fe)}else rt=dt(Fe,Kt,!0,pe,Xi);return Wi(Fe,Kt,rt),rt})}function ai(lt,Qt){const Gt=Xe(lt,Qt);return Gt?Promise.reject(Gt):Promise.resolve()}function Ie(lt){const Qt=ns.values().next().value;return Qt&&typeof Qt.runWithContext=="function"?Qt.runWithContext(lt):lt()}function Ti(lt,Qt){let Gt;const[Kt,Xi,sr]=PD(lt,Qt);Gt=Uy(Kt.reverse(),"beforeRouteLeave",lt,Qt);for(const _e of Kt)_e.leaveGuards.forEach(Fe=>{Gt.push(vl(Fe,lt,Qt))});const pe=ai.bind(null,lt,Qt);return Gt.push(pe),wn(Gt).then(()=>{Gt=[];for(const _e of R.list())Gt.push(vl(_e,lt,Qt));return Gt.push(pe),wn(Gt)}).then(()=>{Gt=Uy(Xi,"beforeRouteUpdate",lt,Qt);for(const _e of Xi)_e.updateGuards.forEach(Fe=>{Gt.push(vl(Fe,lt,Qt))});return Gt.push(pe),wn(Gt)}).then(()=>{Gt=[];for(const _e of sr)if(_e.beforeEnter)if(xo(_e.beforeEnter))for(const Fe of _e.beforeEnter)Gt.push(vl(Fe,lt,Qt));else Gt.push(vl(_e.beforeEnter,lt,Qt));return Gt.push(pe),wn(Gt)}).then(()=>(lt.matched.forEach(_e=>_e.enterCallbacks={}),Gt=Uy(sr,"beforeRouteEnter",lt,Qt,Ie),Gt.push(pe),wn(Gt))).then(()=>{Gt=[];for(const _e of z.list())Gt.push(vl(_e,lt,Qt));return Gt.push(pe),wn(Gt)}).catch(_e=>ba(_e,8)?_e:Promise.reject(_e))}function Wi(lt,Qt,Gt){G.list().forEach(Kt=>Ie(()=>Kt(lt,Qt,Gt)))}function dt(lt,Qt,Gt,Kt,Xi){const sr=Xe(lt,Qt);if(sr)return sr;const pe=Qt===fl,_e=rh?history.state:{};Gt&&(Kt||pe?A.replace(lt.fullPath,jr({scroll:pe&&_e&&_e.scroll},Xi)):A.push(lt.fullPath,Xi)),o.value=lt,tn(lt,Qt,Gt,pe),Cn()}let Ei;function Dr(){Ei||(Ei=A.listen((lt,Qt,Gt)=>{if(!Us.listening)return;const Kt=et(lt),Xi=At(Kt);if(Xi){_i(jr(Xi,{replace:!0}),Kt).catch(Rf);return}Y=Kt;const sr=o.value;rh&&JL(Xw(sr.fullPath,Gt.delta),C_()),Ti(Kt,sr).catch(pe=>ba(pe,12)?pe:ba(pe,2)?(_i(pe.to,Kt).then(_e=>{ba(_e,20)&&!Gt.delta&&Gt.type===Uf.pop&&A.go(-1,!1)}).catch(Rf),Promise.reject()):(Gt.delta&&A.go(-Gt.delta,!1),Nt(pe,Kt,sr))).then(pe=>{pe=pe||dt(Kt,sr,!1),pe&&(Gt.delta&&!ba(pe,8)?A.go(-Gt.delta,!1):Gt.type===Uf.pop&&ba(pe,20)&&A.go(-1,!1)),Wi(Kt,sr,pe)}).catch(Rf)}))}let tt=Tf(),Ri=Tf(),Zi;function Nt(lt,Qt,Gt){Cn(lt);const Kt=Ri.list();return Kt.length?Kt.forEach(Xi=>Xi(lt,Qt,Gt)):console.error(lt),Promise.reject(lt)}function Dn(){return Zi&&o.value!==fl?Promise.resolve():new Promise((lt,Qt)=>{tt.add([lt,Qt])})}function Cn(lt){return Zi||(Zi=!lt,Dr(),tt.list().forEach(([Qt,Gt])=>lt?Gt(lt):Qt()),tt.reset()),lt}function tn(lt,Qt,Gt,Kt){const{scrollBehavior:Xi}=l;if(!rh||!Xi)return Promise.resolve();const sr=!Gt&&QL(Xw(lt.fullPath,0))||(Kt||!Gt)&&history.state&&history.state.scroll||null;return C0().then(()=>Xi(lt,Qt,sr)).then(pe=>pe&&YL(pe)).catch(pe=>Nt(pe,lt,Qt))}const gr=lt=>A.go(lt);let qn;const ns=new Set,Us={currentRoute:o,listening:!0,addRoute:ce,removeRoute:Ee,clearRoutes:f.clearRoutes,hasRoute:$e,getRoutes:Ue,resolve:et,options:l,push:$t,replace:kt,go:gr,back:()=>gr(-1),forward:()=>gr(1),beforeEach:R.add,beforeResolve:z.add,afterEach:G.add,onError:Ri.add,isReady:Dn,install(lt){const Qt=this;lt.component("RouterLink",ED),lt.component("RouterView",ID),lt.config.globalProperties.$router=Qt,Object.defineProperty(lt.config.globalProperties,"$route",{enumerable:!0,get:()=>wr(o)}),rh&&!qn&&o.value===fl&&(qn=!0,$t(A.location).catch(Xi=>{}));const Gt={};for(const Xi in fl)Object.defineProperty(Gt,Xi,{get:()=>o.value[Xi],enumerable:!0});lt.provide(P_,Qt),lt.provide(eS,YT(Gt)),lt.provide(p0,o);const Kt=lt.unmount;ns.add(lt),lt.unmount=function(){ns.delete(lt),ns.size<1&&(Y=fl,Ei&&Ei(),Ei=null,o.value=fl,qn=!1,Zi=!1),Kt()}}};function wn(lt){return lt.reduce((Qt,Gt)=>Qt.then(()=>Ie(Gt)),Promise.resolve())}return Us}function PD(l,f){const v=[],b=[],A=[],R=Math.max(f.matched.length,l.matched.length);for(let z=0;z<R;z++){const G=f.matched[z];G&&(l.matched.find(Y=>hh(Y,G))?b.push(G):v.push(G));const o=l.matched[z];o&&(f.matched.find(Y=>hh(Y,o))||A.push(o))}return[v,b,A]}function Zf(){return yo(P_)}const RD="/assets/logo-CbnM1z8W.png",LD={class:"max-w-sm bg-white border border-gray-500 rounded-lg shadow mr-4"},DD={key:0,class:"rounded-t-lg",src:"https://i.pinimg.com/736x/78/b2/fb/78b2fbc764bfab4a210ae9ae9117b941.jpg",alt:""},OD={class:"p-5"},zD={href:"#"},kD={class:"mb-2 text-2xl font-bold tracking-tight text-gray-900"},BD={class:"mb-3 font-normal text-gray-700"},FD=is({__name:"Card",props:{id:{},name:{},description:{},image:{},hasImage:{type:Boolean},distance:{}},setup(l){const f=l;return(v,b)=>{const A=L0("router-link");return ri(),hi("div",LD,[Cr(A,{to:`/marina/${f.id}`},{default:go(()=>[f.hasImage?(ri(),hi("img",DD)):Xr("",!0),He("div",OD,[He("a",zD,[He("h5",kD,Nr(f.name),1)]),He("p",BD,Nr(f.description),1),He("p",null,Nr(f.distance)+" miles",1)])]),_:1},8,["to"])])}}}),ND=qf(FD,[["__scopeId","data-v-3ce56771"]]),VD="http://46.101.86.104:5000";class UD{constructor(f={}){vs(this,"configuration");this.configuration=f}set config(f){this.configuration=f}get basePath(){return this.configuration.basePath!=null?this.configuration.basePath:VD}get fetchApi(){return this.configuration.fetchApi}get middleware(){return this.configuration.middleware||[]}get queryParamsStringify(){return this.configuration.queryParamsStringify||tS}get username(){return this.configuration.username}get password(){return this.configuration.password}get apiKey(){const f=this.configuration.apiKey;if(f)return typeof f=="function"?f:()=>f}get accessToken(){const f=this.configuration.accessToken;if(f)return typeof f=="function"?f:async()=>f}get headers(){return this.configuration.headers}get credentials(){return this.configuration.credentials}}const jD=new UD,f_=class f_{constructor(f=jD){vs(this,"configuration");vs(this,"middleware");vs(this,"fetchApi",async(f,v)=>{let b={url:f,init:v};for(const R of this.middleware)R.pre&&(b=await R.pre({fetch:this.fetchApi,...b})||b);let A;try{A=await(this.configuration.fetchApi||fetch)(b.url,b.init)}catch(R){for(const z of this.middleware)z.onError&&(A=await z.onError({fetch:this.fetchApi,url:b.url,init:b.init,error:R,response:A?A.clone():void 0})||A);if(A===void 0)throw R instanceof Error?new ZD(R,"The request failed and the interceptors did not return an alternative response"):R}for(const R of this.middleware)R.post&&(A=await R.post({fetch:this.fetchApi,url:b.url,init:b.init,response:A.clone()})||A);return A});this.configuration=f,this.middleware=f.middleware}withMiddleware(...f){const v=this.clone();return v.middleware=v.middleware.concat(...f),v}withPreMiddleware(...f){const v=f.map(b=>({pre:b}));return this.withMiddleware(...v)}withPostMiddleware(...f){const v=f.map(b=>({post:b}));return this.withMiddleware(...v)}isJsonMime(f){return f?f_.jsonRegex.test(f):!1}async request(f,v){const{url:b,init:A}=await this.createFetchParams(f,v),R=await this.fetchApi(b,A);if(R&&R.status>=200&&R.status<300)return R;throw new qD(R,"Response returned an error code")}async createFetchParams(f,v){let b=this.configuration.basePath+f.path;f.query!==void 0&&Object.keys(f.query).length!==0&&(b+="?"+this.configuration.queryParamsStringify(f.query));const A=Object.assign({},this.configuration.headers,f.headers);Object.keys(A).forEach(ie=>A[ie]===void 0?delete A[ie]:{});const R=typeof v=="function"?v:async()=>v,z={method:f.method,headers:A,body:f.body,credentials:this.configuration.credentials},G={...z,...await R({init:z,context:f})};let o;$D(G.body)||G.body instanceof URLSearchParams||GD(G.body)?o=G.body:this.isJsonMime(A["Content-Type"])?o=JSON.stringify(G.body):o=G.body;const Y={...G,body:o};return{url:b,init:Y}}clone(){const f=this.constructor,v=new f(this.configuration);return v.middleware=this.middleware.slice(),v}};vs(f_,"jsonRegex",new RegExp("^(:?application/json|[^;/ 	]+/[^;/ 	]+[+]json)[ 	]*(:?;.*)?$","i"));let fh=f_;function GD(l){return typeof Blob<"u"&&l instanceof Blob}function $D(l){return typeof FormData<"u"&&l instanceof FormData}class qD extends Error{constructor(v,b){super(b);vs(this,"response");vs(this,"name","ResponseError");this.response=v}}class ZD extends Error{constructor(v,b){super(b);vs(this,"cause");vs(this,"name","FetchError");this.cause=v}}class zc extends Error{constructor(v,b){super(b);vs(this,"field");vs(this,"name","RequiredError");this.field=v}}function tS(l,f=""){return Object.keys(l).map(v=>iS(v,l[v],f)).filter(v=>v.length>0).join("&")}function iS(l,f,v=""){const b=v+(v.length?`[${l}]`:l);if(f instanceof Array){const A=f.map(R=>encodeURIComponent(String(R))).join(`&${encodeURIComponent(b)}=`);return`${encodeURIComponent(b)}=${A}`}if(f instanceof Set){const A=Array.from(f);return iS(l,A,v)}return f instanceof Date?`${encodeURIComponent(b)}=${encodeURIComponent(f.toISOString())}`:f instanceof Object?tS(f,b):`${encodeURIComponent(b)}=${encodeURIComponent(String(f))}`}class mn{constructor(f,v=b=>b){vs(this,"raw");vs(this,"transformer");this.raw=f,this.transformer=v}async value(){return this.transformer(await this.raw.json())}}function HD(l){return WD(l)}function WD(l,f){return l==null?l:{title:l.title==null?void 0:l.title,mooringPinId:l.mooringPinId==null?void 0:l.mooringPinId,icon:l.icon==null?void 0:l.icon,layer:l.layer==null?void 0:l.layer,rotate:l.rotate==null?void 0:l.rotate}}function XD(l){return KD(l)}function KD(l,f){return l==null?l:{type:l.type==null?void 0:l.type,coordinates:l.coordinates==null?void 0:l.coordinates}}function YD(l){return JD(l)}function JD(l,f){return l==null?l:{type:l.type==null?void 0:l.type,geometry:l.geometry==null?void 0:XD(l.geometry),id:l.id==null?void 0:l.id,properties:l.properties==null?void 0:HD(l.properties)}}function eh(l){return QD(l)}function QD(l,f){return l==null?l:{type:l.type==null?void 0:l.type,features:l.features==null?void 0:l.features.map(YD)}}function e3(l){return t3(l)}function t3(l,f){return l==null?l:{key:l.key==null?void 0:l.key,value:l.value==null?void 0:l.value}}function i3(l){return r3(l)}function r3(l,f){return l==null?l:{name:l.name==null?void 0:l.name,coordinates:l.coordinates==null?void 0:l.coordinates}}function rS(l){return n3(l)}function n3(l,f){return l==null?l:{key:l.key==null?void 0:l.key,value:l.value==null?void 0:l.value,iconKey:l.iconKey==null?void 0:l.iconKey}}function Df(l){return s3(l)}function s3(l,f){return l==null?l:{id:l.id==null?void 0:l.id,geoJsonId:l.geoJsonId==null?void 0:l.geoJsonId,serviceKey:l.serviceKey==null?void 0:l.serviceKey,coordinates:l.coordinates==null?void 0:l.coordinates,marinaId:l.marinaId==null?void 0:l.marinaId,mooringId:l.mooringId==null?void 0:l.mooringId,distanceFromSearch:l.distanceFromSearch==null?void 0:l.distanceFromSearch,distanceFromUser:l.distanceFromUser==null?void 0:l.distanceFromUser,serviceType:l.serviceType==null?void 0:rS(l.serviceType)}}function nS(l){return o3(l)}function o3(l,f){return l==null?l:{key:l.key==null?void 0:l.key,value:l.value==null?void 0:l.value,iconKey:l.iconKey==null?void 0:l.iconKey}}function Ef(l){return a3(l)}function a3(l,f){return l==null?l:{id:l.id==null?void 0:l.id,geoJsonId:l.geoJsonId==null?void 0:l.geoJsonId,name:l.name==null?void 0:l.name,type:l.type==null?void 0:l.type,coordinates:l.coordinates==null?void 0:l.coordinates,canalplanLink:l.canalplanLink==null?void 0:l.canalplanLink,website:l.website==null?void 0:l.website,address:l.address==null?void 0:l.address,canalName:l.canalName==null?void 0:l.canalName,phoneNumber:l.phoneNumber==null?void 0:l.phoneNumber,distanceFromSearch:l.distanceFromSearch==null?void 0:l.distanceFromSearch,distanceFromUser:l.distanceFromUser==null?void 0:l.distanceFromUser,marinaType:l.marinaType==null?void 0:nS(l.marinaType),services:l.services==null?void 0:l.services.map(Df)}}function sS(l){return l3(l)}function l3(l,f){return l==null?l:{key:l.key==null?void 0:l.key,value:l.value==null?void 0:l.value,iconKey:l.iconKey==null?void 0:l.iconKey}}function jy(l){return c3(l)}function c3(l,f){return l==null?l:{id:l.id==null?void 0:l.id,geoJsonId:l.geoJsonId==null?void 0:l.geoJsonId,name:l.name==null?void 0:l.name,type:l.type==null?void 0:l.type,coordinates:l.coordinates==null?void 0:l.coordinates,canalplanLink:l.canalplanLink==null?void 0:l.canalplanLink,website:l.website==null?void 0:l.website,address:l.address==null?void 0:l.address,canalName:l.canalName==null?void 0:l.canalName,phoneNumber:l.phoneNumber==null?void 0:l.phoneNumber,distanceFromSearch:l.distanceFromSearch==null?void 0:l.distanceFromSearch,distanceFromUser:l.distanceFromUser==null?void 0:l.distanceFromUser,mooringType:l.mooringType==null?void 0:sS(l.mooringType),services:l.services==null?void 0:l.services.map(Df)}}class Hf extends fh{async dataGeoJsonIdGetRaw(f,v){if(f.geoJsonId==null)throw new zc("geoJsonId",'Required parameter "geoJsonId" was null or undefined when calling dataGeoJsonIdGet().');const b={},A={},R=await this.request({path:"/Data/{geoJsonId}".replace("{geoJsonId}",encodeURIComponent(String(f.geoJsonId))),method:"GET",headers:A,query:b},v);return new mn(R,z=>Ef(z))}async dataGeoJsonIdGet(f,v){return await(await this.dataGeoJsonIdGetRaw(f,v)).value()}async dataMarinaIdGetRaw(f,v){if(f.id==null)throw new zc("id",'Required parameter "id" was null or undefined when calling dataMarinaIdGet().');const b={},A={},R=await this.request({path:"/Data/marina/{id}".replace("{id}",encodeURIComponent(String(f.id))),method:"GET",headers:A,query:b},v);return new mn(R,z=>Ef(z))}async dataMarinaIdGet(f,v){return await(await this.dataMarinaIdGetRaw(f,v)).value()}async dataMarinasClosestGetRaw(f,v){const b={};f.userCoordinates!=null&&(b.userCoordinates=f.userCoordinates),f.numberOfMarinas!=null&&(b.numberOfMarinas=f.numberOfMarinas);const A={},R=await this.request({path:"/Data/marinas/closest",method:"GET",headers:A,query:b},v);return new mn(R,z=>z.map(Ef))}async dataMarinasClosestGet(f={},v){return await(await this.dataMarinasClosestGetRaw(f,v)).value()}async dataMarinasSearchGetRaw(f,v){const b={};f.name!=null&&(b.name=f.name),f.searchCoordinates!=null&&(b.searchCoordinates=f.searchCoordinates),f.userCoordinates!=null&&(b.userCoordinates=f.userCoordinates),f.searchDistance!=null&&(b.searchDistance=f.searchDistance),f.limit!=null&&(b.limit=f.limit),f.offset!=null&&(b.offset=f.offset),f.serviceTypes!=null&&(b.serviceTypes=f.serviceTypes),f.matchAllServices!=null&&(b.matchAllServices=f.matchAllServices);const A={},R=await this.request({path:"/Data/marinas/search",method:"GET",headers:A,query:b},v);return new mn(R,z=>z.map(Ef))}async dataMarinasSearchGet(f={},v){return await(await this.dataMarinasSearchGetRaw(f,v)).value()}async dataMarinasTypeTypeGetRaw(f,v){if(f.type==null)throw new zc("type",'Required parameter "type" was null or undefined when calling dataMarinasTypeTypeGet().');const b={};f.searchCoordinates!=null&&(b.searchCoordinates=f.searchCoordinates),f.userCoordinates!=null&&(b.userCoordinates=f.userCoordinates),f.searchDistance!=null&&(b.searchDistance=f.searchDistance),f.limit!=null&&(b.limit=f.limit),f.offset!=null&&(b.offset=f.offset);const A={},R=await this.request({path:"/Data/marinas/type/{type}".replace("{type}",encodeURIComponent(String(f.type))),method:"GET",headers:A,query:b},v);return new mn(R,z=>z.map(Ef))}async dataMarinasTypeTypeGet(f,v){return await(await this.dataMarinasTypeTypeGetRaw(f,v)).value()}async dataMooringsIdGetRaw(f,v){if(f.id==null)throw new zc("id",'Required parameter "id" was null or undefined when calling dataMooringsIdGet().');const b={},A={},R=await this.request({path:"/Data/moorings/{id}".replace("{id}",encodeURIComponent(String(f.id))),method:"GET",headers:A,query:b},v);return new mn(R,z=>jy(z))}async dataMooringsIdGet(f,v){return await(await this.dataMooringsIdGetRaw(f,v)).value()}async dataMooringsSearchGetRaw(f,v){const b={};f.name!=null&&(b.name=f.name),f.searchCoordinates!=null&&(b.searchCoordinates=f.searchCoordinates),f.userCoordinates!=null&&(b.userCoordinates=f.userCoordinates),f.searchDistance!=null&&(b.searchDistance=f.searchDistance),f.limit!=null&&(b.limit=f.limit),f.offset!=null&&(b.offset=f.offset),f.serviceTypes!=null&&(b.serviceTypes=f.serviceTypes),f.matchAllServices!=null&&(b.matchAllServices=f.matchAllServices);const A={},R=await this.request({path:"/Data/moorings/search",method:"GET",headers:A,query:b},v);return new mn(R,z=>z.map(jy))}async dataMooringsSearchGet(f={},v){return await(await this.dataMooringsSearchGetRaw(f,v)).value()}async dataMooringsTypeTypeGetRaw(f,v){if(f.type==null)throw new zc("type",'Required parameter "type" was null or undefined when calling dataMooringsTypeTypeGet().');const b={};f.searchCoordinates!=null&&(b.searchCoordinates=f.searchCoordinates),f.userCoordinates!=null&&(b.userCoordinates=f.userCoordinates),f.searchDistance!=null&&(b.searchDistance=f.searchDistance),f.limit!=null&&(b.limit=f.limit),f.offset!=null&&(b.offset=f.offset);const A={},R=await this.request({path:"/Data/moorings/type/{type}".replace("{type}",encodeURIComponent(String(f.type))),method:"GET",headers:A,query:b},v);return new mn(R,z=>z.map(jy))}async dataMooringsTypeTypeGet(f,v){return await(await this.dataMooringsTypeTypeGetRaw(f,v)).value()}async dataServicesIdGetRaw(f,v){if(f.id==null)throw new zc("id",'Required parameter "id" was null or undefined when calling dataServicesIdGet().');const b={},A={},R=await this.request({path:"/Data/services/{id}".replace("{id}",encodeURIComponent(String(f.id))),method:"GET",headers:A,query:b},v);return new mn(R,z=>Df(z))}async dataServicesIdGet(f,v){return await(await this.dataServicesIdGetRaw(f,v)).value()}async dataServicesSearchGetRaw(f,v){const b={};f.name!=null&&(b.name=f.name),f.searchCoordinates!=null&&(b.searchCoordinates=f.searchCoordinates),f.userCoordinates!=null&&(b.userCoordinates=f.userCoordinates),f.searchDistance!=null&&(b.searchDistance=f.searchDistance),f.limit!=null&&(b.limit=f.limit),f.offset!=null&&(b.offset=f.offset),f.serviceTypes!=null&&(b.serviceTypes=f.serviceTypes);const A={},R=await this.request({path:"/Data/services/search",method:"GET",headers:A,query:b},v);return new mn(R,z=>z.map(Df))}async dataServicesSearchGet(f={},v){return await(await this.dataServicesSearchGetRaw(f,v)).value()}async dataServicesTypeTypeGetRaw(f,v){if(f.type==null)throw new zc("type",'Required parameter "type" was null or undefined when calling dataServicesTypeTypeGet().');const b={};f.searchCoordinates!=null&&(b.searchCoordinates=f.searchCoordinates),f.userCoordinates!=null&&(b.userCoordinates=f.userCoordinates),f.searchDistance!=null&&(b.searchDistance=f.searchDistance),f.limit!=null&&(b.limit=f.limit),f.offset!=null&&(b.offset=f.offset);const A={},R=await this.request({path:"/Data/services/type/{type}".replace("{type}",encodeURIComponent(String(f.type))),method:"GET",headers:A,query:b},v);return new mn(R,z=>z.map(Df))}async dataServicesTypeTypeGet(f,v){return await(await this.dataServicesTypeTypeGetRaw(f,v)).value()}}class oS extends fh{async geoJsonAllGetRaw(f,v){const b={};f.searchCoordinates!=null&&(b.searchCoordinates=f.searchCoordinates),f.searchDistance!=null&&(b.searchDistance=f.searchDistance);const A={},R=await this.request({path:"/GeoJson/all",method:"GET",headers:A,query:b},v);return new mn(R,z=>eh(z))}async geoJsonAllGet(f={},v){return await(await this.geoJsonAllGetRaw(f,v)).value()}async geoJsonGeoJsonByIdGetRaw(f,v){const b={};f.id!=null&&(b.id=f.id);const A={},R=await this.request({path:"/GeoJson/geoJsonById",method:"GET",headers:A,query:b},v);return new mn(R,z=>eh(z))}async geoJsonGeoJsonByIdGet(f={},v){return await(await this.geoJsonGeoJsonByIdGetRaw(f,v)).value()}async geoJsonGeoJsonByIdsGetRaw(f,v){const b={};f.ids!=null&&(b.ids=f.ids);const A={},R=await this.request({path:"/GeoJson/geoJsonByIds",method:"GET",headers:A,query:b},v);return new mn(R,z=>eh(z))}async geoJsonGeoJsonByIdsGet(f={},v){return await(await this.geoJsonGeoJsonByIdsGetRaw(f,v)).value()}async geoJsonMarinasGetRaw(f,v){const b={};f.searchCoordinates!=null&&(b.searchCoordinates=f.searchCoordinates),f.searchDistance!=null&&(b.searchDistance=f.searchDistance);const A={},R=await this.request({path:"/GeoJson/marinas",method:"GET",headers:A,query:b},v);return new mn(R,z=>eh(z))}async geoJsonMarinasGet(f={},v){return await(await this.geoJsonMarinasGetRaw(f,v)).value()}async geoJsonMooringsGetRaw(f,v){const b={};f.searchCoordinates!=null&&(b.searchCoordinates=f.searchCoordinates),f.searchDistance!=null&&(b.searchDistance=f.searchDistance);const A={},R=await this.request({path:"/GeoJson/moorings",method:"GET",headers:A,query:b},v);return new mn(R,z=>eh(z))}async geoJsonMooringsGet(f={},v){return await(await this.geoJsonMooringsGetRaw(f,v)).value()}async geoJsonServicesGetRaw(f,v){const b={};f.searchCoordinates!=null&&(b.searchCoordinates=f.searchCoordinates),f.searchDistance!=null&&(b.searchDistance=f.searchDistance);const A={},R=await this.request({path:"/GeoJson/services",method:"GET",headers:A,query:b},v);return new mn(R,z=>eh(z))}async geoJsonServicesGet(f={},v){return await(await this.geoJsonServicesGetRaw(f,v)).value()}}class u3 extends fh{async locationSearchGetRaw(f,v){const b={};f.query!=null&&(b.query=f.query);const A={},R=await this.request({path:"/location/search",method:"GET",headers:A,query:b},v);return new mn(R,z=>z.map(i3))}async locationSearchGet(f={},v){return await(await this.locationSearchGetRaw(f,v)).value()}}class aS extends fh{async typesIconsGetRaw(f){const v={},b={},A=await this.request({path:"/Types/icons",method:"GET",headers:b,query:v},f);return new mn(A,R=>R.map(e3))}async typesIconsGet(f){return await(await this.typesIconsGetRaw(f)).value()}async typesMarinaTypesGetRaw(f){const v={},b={},A=await this.request({path:"/Types/marina-types",method:"GET",headers:b,query:v},f);return new mn(A,R=>nS(R))}async typesMarinaTypesGet(f){return await(await this.typesMarinaTypesGetRaw(f)).value()}async typesMooringTypesGetRaw(f){const v={},b={},A=await this.request({path:"/Types/mooring-types",method:"GET",headers:b,query:v},f);return new mn(A,R=>R.map(sS))}async typesMooringTypesGet(f){return await(await this.typesMooringTypesGetRaw(f)).value()}async typesServiceTypesGetRaw(f){const v={},b={},A=await this.request({path:"/Types/service-types",method:"GET",headers:b,query:v},f);return new mn(A,R=>R.map(rS))}async typesServiceTypesGet(f){return await(await this.typesServiceTypesGetRaw(f)).value()}}const Xc=N0("searchStore",()=>{const l=new aS,f=Bi([{icon:"",title:"Marinas",active:!0}]),v=Bi(void 0),b=Bi(void 0),A=Bi(4),R=Bi(void 0),z=Bi(void 0),G=Bi(),o=Bi(),Y=Bi(void 0),ie=Bi();ie.value=[{name:"Alphabetically",active:!0,enabled:!0,id:1},{name:"Number Of Services",active:!1,enabled:!0,id:2},{name:"Distance",active:!0,enabled:!1,id:3}];const K=Bi();async function de(){try{const ht=await l.typesServiceTypesGet();G.value=ht,console.log(G.value)}catch(ht){console.error("Error fetching data:",ht)}}async function ce(){var ht;await de(),K.value=(ht=G.value)==null?void 0:ht.map(Xe=>({serviceType:Xe,active:!1})).sort((Xe,$t)=>Xe==null?void 0:Xe.serviceType.value.localeCompare($t==null?void 0:$t.serviceType.value))}function Ee(ht){var $t;const Xe=($t=K.value)==null?void 0:$t.find(kt=>kt.serviceType.key===ht);Xe&&(Xe.active=!0)}function Ue(){ie.value=[{name:"Alphabetically",active:!0,enabled:!0,id:1},{name:"Number Of Services",active:!1,enabled:!0,id:2},{name:"Distance",active:!1,enabled:!0,id:3}]}function $e(ht){var $t,kt;const Xe=($t=ie.value)==null?void 0:$t.find(At=>At.id===ht);Xe!==void 0&&((kt=ie.value)==null||kt.forEach(At=>At.active=!1),Xe.active=!0,et(Xe))}function et(ht){if(o.value!==void 0)switch(ht.name){case"Distance":o.value.sort((Xe,$t)=>(Xe.distanceFromUser||0)-($t.distanceFromUser||0));break;case"Alphabetically":o.value.sort((Xe,$t)=>Xe==null?void 0:Xe.name.localeCompare($t==null?void 0:$t.name));break;case"Number Of Services":o.value.sort((Xe,$t)=>{var kt,At;return(((kt=$t.services)==null?void 0:kt.length)||0)-(((At=Xe.services)==null?void 0:At.length)||0)});break}}return{searchItems:f,serviceTypes:G,marinaSearchValue:R,serviceSearchValue:z,searchLocationValue:v,searchLocationCoordinatesValue:b,searchRadiusValue:A,marinaSearchResults:o,sortOptions:ie,setSortOption:$e,resetSortOptions:Ue,userLocation:Y,resetServiceFilterOptions:ce,serviceFilterOptions:K,setServiceFilterOptionActive:Ee}});var Vs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function U0(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}function h3(l){if(l.__esModule)return l;var f=l.default;if(typeof f=="function"){var v=function b(){return this instanceof b?Reflect.construct(f,arguments,this.constructor):f.apply(this,arguments)};v.prototype=f.prototype}else v={};return Object.defineProperty(v,"__esModule",{value:!0}),Object.keys(l).forEach(function(b){var A=Object.getOwnPropertyDescriptor(l,b);Object.defineProperty(v,b,A.get?A:{enumerable:!0,get:function(){return l[b]}})}),v}var Dl=f3,d3=Object.prototype.hasOwnProperty;function f3(){for(var l={},f=0;f<arguments.length;f++){var v=arguments[f];for(var b in v)d3.call(v,b)&&(l[b]=v[b])}return l}var p3=Object.prototype.toString,m3=function(l){var f;return p3.call(l)==="[object Object]"&&(f=Object.getPrototypeOf(l),f===null||f===Object.getPrototypeOf({}))},_3=m3,g3=Dl,lS="value",Gy=`
-  `,Kr={};Kr.assert=function(l,f){return f=f||{},function(v){var b=Al(l,v);if(b){var A=j0(b,f);throw f.apiName&&(A=f.apiName+": "+A),new Error(A)}}};Kr.shape=function(f){var v=b3(f);return function(A){var R=Al(Kr.plainObject,A);if(R)return R;for(var z,G,o=[],Y=0;Y<v.length;Y++)z=v[Y].key,G=v[Y].value,R=Al(G,A[z]),R&&o.push([z].concat(R));return o.length<2?o[0]:function(ie){o=o.map(function(ce){var Ee=ce[0],Ue=j0(ce,ie).split(`
-`).join(Gy);return"- "+Ee+": "+Ue});var K=ie.path.join("."),de=K===lS?"":" of "+K;return"The following properties"+de+" have invalid values:"+Gy+o.join(Gy)}}};Kr.strictShape=function(f){var v=Kr.shape(f);return function(A){var R=v(A);if(R)return R;var z=Object.keys(A).reduce(function(G,o){return f[o]===void 0&&G.push(o),G},[]);if(z.length!==0)return function(){return"The following keys are invalid: "+z.join(", ")}}};Kr.arrayOf=function(f){return cS(f)};Kr.tuple=function(){var f=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return cS(f)};function cS(l){var f=Array.isArray(l),v=function(b){return f?l[b]:l};return function(A){var R=Al(Kr.plainArray,A);if(R)return R;if(f&&A.length!==l.length)return"an array with "+l.length+" items";for(var z=0;z<A.length;z++)if(R=Al(v(z),A[z]),R)return[z].concat(R)}}Kr.required=function(f){function v(b){return b==null?function(A){return uS(A,hS(A.path)?"cannot be undefined/null.":"is required.")}:f.apply(this,arguments)}return v.__required=!0,v};Kr.oneOfType=function(){var f=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(b){var A=f.map(function(R){return Al(R,b)}).filter(Boolean);if(A.length===f.length)return A.every(function(R){return R.length===1&&typeof R[0]=="string"})?y3(A.map(function(R){return R[0]})):A.reduce(function(R,z){return z.length>R.length?z:R})}};Kr.equal=function(f){return function(b){if(b!==f)return JSON.stringify(f)}};Kr.oneOf=function(){var f=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),v=f.map(function(b){return Kr.equal(b)});return Kr.oneOfType.apply(this,v)};Kr.range=function(f){var v=f[0],b=f[1];return function(R){var z=Al(Kr.number,R);if(z||R<v||R>b)return"number between "+v+" & "+b+" (inclusive)"}};Kr.any=function(){};Kr.boolean=function(f){if(typeof f!="boolean")return"boolean"};Kr.number=function(f){if(typeof f!="number")return"number"};Kr.plainArray=function(f){if(!Array.isArray(f))return"array"};Kr.plainObject=function(f){if(!_3(f))return"object"};Kr.string=function(f){if(typeof f!="string")return"string"};Kr.func=function(f){if(typeof f!="function")return"function"};function Al(l,f){if(!(f==null&&!l.hasOwnProperty("__required"))){var v=l(f);if(v)return Array.isArray(v)?v:[v]}}function j0(l,f){var v=l.length,b=l[v-1],A=l.slice(0,v-1);return A.length===0&&(A=[lS]),f=g3(f,{path:A}),typeof b=="function"?b(f):uS(f,v3(b))}function y3(l){return l.length<2?l[0]:l.length===2?l.join(" or "):l.slice(0,-1).join(", ")+", or "+l.slice(-1)}function v3(l){return"must be "+x3(l)+"."}function x3(l){return/^an? /.test(l)?l:/^[aeiou]/i.test(l)?"an "+l:/^[a-z]/i.test(l)?"a "+l:l}function uS(l,f){var v=hS(l.path),b=l.path.join(".")+" "+f,A=v?"Item at position ":"";return A+b}function hS(l){return typeof l[l.length-1]=="number"||typeof l[0]=="number"}function b3(l){return Object.keys(l||{}).map(function(f){return{key:f,value:l[f]}})}Kr.validate=Al;Kr.processMessage=j0;var dS=Kr,w3=Dl,ah=dS;function T3(l){if(typeof window<"u")return l instanceof Vs.Blob||l instanceof Vs.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof l=="string"||l.pipe!==void 0))return"Filename or Readable stream"}function E3(l,f){return ah.assert(ah.strictShape(l),f)}function S3(l){var f="date";if(typeof l=="boolean")return f;try{var v=new Date(l);if(v.getTime&&isNaN(v.getTime()))return f}catch{return f}}function M3(l){return ah.tuple(ah.number,ah.number)(l)}var A3=w3(ah,{file:T3,date:S3,coordinates:M3,assertShape:E3});function I3(l,f){var v=function(b,A){return f.indexOf(b)!==-1&&A!==void 0};return typeof f=="function"&&(v=f),Object.keys(l).filter(function(b){return v(b,l[b])}).reduce(function(b,A){return b[A]=l[A],b},{})}var C3=I3,c_={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */c_.exports;(function(l,f){(function(v){var b=f,A=l&&l.exports==b&&l,R=typeof Vs=="object"&&Vs;(R.global===R||R.window===R)&&(v=R);var z=function(Ee){this.message=Ee};z.prototype=new Error,z.prototype.name="InvalidCharacterError";var G=function(Ee){throw new z(Ee)},o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Y=/[\t\n\f\r ]/g,ie=function(Ee){Ee=String(Ee).replace(Y,"");var Ue=Ee.length;Ue%4==0&&(Ee=Ee.replace(/==?$/,""),Ue=Ee.length),(Ue%4==1||/[^+a-zA-Z0-9/]/.test(Ee))&&G("Invalid character: the string to be decoded is not correctly encoded.");for(var $e=0,et,ht,Xe="",$t=-1;++$t<Ue;)ht=o.indexOf(Ee.charAt($t)),et=$e%4?et*64+ht:ht,$e++%4&&(Xe+=String.fromCharCode(255&et>>(-2*$e&6)));return Xe},K=function(Ee){Ee=String(Ee),/[^\0-\xFF]/.test(Ee)&&G("The string to be encoded contains characters outside of the Latin1 range.");for(var Ue=Ee.length%3,$e="",et=-1,ht,Xe,$t,kt,At=Ee.length-Ue;++et<At;)ht=Ee.charCodeAt(et)<<16,Xe=Ee.charCodeAt(++et)<<8,$t=Ee.charCodeAt(++et),kt=ht+Xe+$t,$e+=o.charAt(kt>>18&63)+o.charAt(kt>>12&63)+o.charAt(kt>>6&63)+o.charAt(kt&63);return Ue==2?(ht=Ee.charCodeAt(et)<<8,Xe=Ee.charCodeAt(++et),kt=ht+Xe,$e+=o.charAt(kt>>10)+o.charAt(kt>>4&63)+o.charAt(kt<<2&63)+"="):Ue==1&&(kt=Ee.charCodeAt(et),$e+=o.charAt(kt>>2)+o.charAt(kt<<4&63)+"=="),$e},de={encode:K,decode:ie,version:"0.1.0"};if(b&&!b.nodeType)if(A)A.exports=de;else for(var ce in de)de.hasOwnProperty(ce)&&(b[ce]=de[ce]);else v.base64=de})(Vs)})(c_,c_.exports);var P3=c_.exports,R3=P3,$y={};function L3(l){if($y[l])return $y[l];var f=l.split("."),v=f[0],b=f[1];if(!b)throw new Error("Invalid token");var A=D3(b),R={usage:v,user:A.u};return kc(A,"a")&&(R.authorization=A.a),kc(A,"exp")&&(R.expires=A.exp*1e3),kc(A,"iat")&&(R.created=A.iat*1e3),kc(A,"scopes")&&(R.scopes=A.scopes),kc(A,"client")&&(R.client=A.client),kc(A,"ll")&&(R.lastLogin=A.ll),kc(A,"iu")&&(R.impersonator=A.iu),$y[l]=R,R}function D3(l){try{return JSON.parse(R3.decode(l))}catch{throw new Error("Invalid token")}}function kc(l,f){return Object.prototype.hasOwnProperty.call(l,f)}var R_=L3,fS={exports:{}};(function(l){var f=Object.prototype.hasOwnProperty,v="~";function b(){}Object.create&&(b.prototype=Object.create(null),new b().__proto__||(v=!1));function A(o,Y,ie){this.fn=o,this.context=Y,this.once=ie||!1}function R(o,Y,ie,K,de){if(typeof ie!="function")throw new TypeError("The listener must be a function");var ce=new A(ie,K||o,de),Ee=v?v+Y:Y;return o._events[Ee]?o._events[Ee].fn?o._events[Ee]=[o._events[Ee],ce]:o._events[Ee].push(ce):(o._events[Ee]=ce,o._eventsCount++),o}function z(o,Y){--o._eventsCount===0?o._events=new b:delete o._events[Y]}function G(){this._events=new b,this._eventsCount=0}G.prototype.eventNames=function(){var Y=[],ie,K;if(this._eventsCount===0)return Y;for(K in ie=this._events)f.call(ie,K)&&Y.push(v?K.slice(1):K);return Object.getOwnPropertySymbols?Y.concat(Object.getOwnPropertySymbols(ie)):Y},G.prototype.listeners=function(Y){var ie=v?v+Y:Y,K=this._events[ie];if(!K)return[];if(K.fn)return[K.fn];for(var de=0,ce=K.length,Ee=new Array(ce);de<ce;de++)Ee[de]=K[de].fn;return Ee},G.prototype.listenerCount=function(Y){var ie=v?v+Y:Y,K=this._events[ie];return K?K.fn?1:K.length:0},G.prototype.emit=function(Y,ie,K,de,ce,Ee){var Ue=v?v+Y:Y;if(!this._events[Ue])return!1;var $e=this._events[Ue],et=arguments.length,ht,Xe;if($e.fn){switch($e.once&&this.removeListener(Y,$e.fn,void 0,!0),et){case 1:return $e.fn.call($e.context),!0;case 2:return $e.fn.call($e.context,ie),!0;case 3:return $e.fn.call($e.context,ie,K),!0;case 4:return $e.fn.call($e.context,ie,K,de),!0;case 5:return $e.fn.call($e.context,ie,K,de,ce),!0;case 6:return $e.fn.call($e.context,ie,K,de,ce,Ee),!0}for(Xe=1,ht=new Array(et-1);Xe<et;Xe++)ht[Xe-1]=arguments[Xe];$e.fn.apply($e.context,ht)}else{var $t=$e.length,kt;for(Xe=0;Xe<$t;Xe++)switch($e[Xe].once&&this.removeListener(Y,$e[Xe].fn,void 0,!0),et){case 1:$e[Xe].fn.call($e[Xe].context);break;case 2:$e[Xe].fn.call($e[Xe].context,ie);break;case 3:$e[Xe].fn.call($e[Xe].context,ie,K);break;case 4:$e[Xe].fn.call($e[Xe].context,ie,K,de);break;default:if(!ht)for(kt=1,ht=new Array(et-1);kt<et;kt++)ht[kt-1]=arguments[kt];$e[Xe].fn.apply($e[Xe].context,ht)}}return!0},G.prototype.on=function(Y,ie,K){return R(this,Y,ie,K,!1)},G.prototype.once=function(Y,ie,K){return R(this,Y,ie,K,!0)},G.prototype.removeListener=function(Y,ie,K,de){var ce=v?v+Y:Y;if(!this._events[ce])return this;if(!ie)return z(this,ce),this;var Ee=this._events[ce];if(Ee.fn)Ee.fn===ie&&(!de||Ee.once)&&(!K||Ee.context===K)&&z(this,ce);else{for(var Ue=0,$e=[],et=Ee.length;Ue<et;Ue++)(Ee[Ue].fn!==ie||de&&!Ee[Ue].once||K&&Ee[Ue].context!==K)&&$e.push(Ee[Ue]);$e.length?this._events[ce]=$e.length===1?$e[0]:$e:z(this,ce)}return this},G.prototype.removeAllListeners=function(Y){var ie;return Y?(ie=v?v+Y:Y,this._events[ie]&&z(this,ie)):(this._events=new b,this._eventsCount=0),this},G.prototype.off=G.prototype.removeListener,G.prototype.addListener=G.prototype.on,G.prefixed=v,G.EventEmitter=G,l.exports=G})(fS);var pS=fS.exports;function O3(l){return l.map(encodeURIComponent).join(",")}function mS(l){return Array.isArray(l)?O3(l):encodeURIComponent(String(l))}function _S(l,f,v){if(v===!1||v===null)return l;var b=/\?/.test(l)?"&":"?",A=encodeURIComponent(f);return v!==void 0&&v!==""&&v!==!0&&(A+="="+mS(v)),""+l+b+A}function z3(l,f){if(!f)return l;var v=l;return Object.keys(f).forEach(function(b){var A=f[b];A!==void 0&&(Array.isArray(A)&&(A=A.filter(function(R){return R!=null}).join(",")),v=_S(v,b,A))}),v}function k3(l,f){if(!f||l.slice(0,4)==="http")return l;var v=l[0]==="/"?"":"/";return""+f.replace(/\/$/,"")+v+l}function B3(l,f){return f?l.replace(/\/:([a-zA-Z0-9]+)/g,function(v,b){var A=f[b];if(A===void 0)throw new Error("Unspecified route parameter "+b);var R=mS(A);return"/"+R}):l}var F3={appendQueryObject:z3,appendQueryParam:_S,prependOrigin:k3,interpolateRouteParams:B3},L_={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},N3=R_,G0=Dl,V3=pS,Hm=F3,cT=L_,U3=1;function Il(l,f){if(!l)throw new Error("MapiRequest requires a client");if(!f||!f.path||!f.method)throw new Error("MapiRequest requires an options object with path and method properties");var v={};f.body&&(v["content-type"]="application/json");var b=G0(v,f.headers),A=Object.keys(b).reduce(function(R,z){return R[z.toLowerCase()]=b[z],R},{});this.id=U3++,this._options=f,this.emitter=new V3,this.client=l,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=f.path,this.method=f.method,this.origin=f.origin||l.origin,this.query=f.query||{},this.params=f.params||{},this.body=f.body||null,this.file=f.file||null,this.encoding=f.encoding||"utf8",this.sendFileAs=f.sendFileAs||null,this.headers=A}Il.prototype.url=function(f){var v=Hm.prependOrigin(this.path,this.origin);v=Hm.appendQueryObject(v,this.query);var b=this.params,A=f??this.client.accessToken;if(A){v=Hm.appendQueryParam(v,"access_token",A);var R=N3(A).user;b=G0({ownerId:R},b)}return v=Hm.interpolateRouteParams(v,b),v};Il.prototype.send=function(){var f=this;if(f.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return f.sent=!0,f.client.sendRequest(f).then(function(v){return f.response=v,f.emitter.emit(cT.EVENT_RESPONSE,v),v},function(v){throw f.error=v,f.emitter.emit(cT.EVENT_ERROR,v),v})};Il.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Il.prototype.eachPage=function(f){var v=this;function b(z){function G(){delete v._nextPageRequest;var o=z.nextPage();o&&(v._nextPageRequest=o,R(o))}f(null,z,G)}function A(z){f(z,null,function(){})}function R(z){z.send().then(b,A)}R(this)};Il.prototype.clone=function(){return this._extend()};Il.prototype._extend=function(f){var v=G0(this._options,f);return new Il(this.client,v)};var j3=Il,G3=R_,$3=j3,q3=L_;function gS(l){if(!l||!l.accessToken)throw new Error("Cannot create a client without an access token");G3(l.accessToken),this.accessToken=l.accessToken,this.origin=l.origin||q3.API_ORIGIN}gS.prototype.createRequest=function(f){return new $3(this,f)};var yS=gS;function Z3(l){var f=l.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return f?{key:f[1],value:f[2]}:null}function H3(l){var f=l.match(/<?([^>]*)>(.*)/);if(!f)return null;var v=f[1],b=f[2].split(";"),A=null,R=b.reduce(function(z,G){var o=Z3(G);return o?o.key==="rel"?(A||(A=o.value),z):(z[o.key]=o.value,z):z},{});return A?{url:v,rel:A,params:R}:null}function W3(l){return l?l.split(/,\s*</).reduce(function(f,v){var b=H3(v);if(!b)return f;var A=b.rel.split(/\s+/);return A.forEach(function(R){f[R]||(f[R]={url:b.url,params:b.params})}),f},{}):{}}var X3=W3,K3=X3;function $0(l,f){this.request=l,this.headers=f.headers,this.rawBody=f.body,this.statusCode=f.statusCode;try{this.body=JSON.parse(f.body||"{}")}catch{this.body=f.body}this.links=K3(this.headers.link)}$0.prototype.hasNextPage=function(){return!!this.links.next};$0.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var Y3=$0,uT=L_;function J3(l){var f=l.type||uT.ERROR_HTTP,v;if(l.body)try{v=JSON.parse(l.body)}catch{v=l.body}else v=null;var b=l.message||null;b||(typeof v=="string"?b=v:v&&typeof v.message=="string"?b=v.message:f===uT.ERROR_REQUEST_ABORTED&&(b="Request aborted")),this.message=b,this.type=f,this.statusCode=l.statusCode||null,this.request=l.request,this.body=v}var Q3=J3;function eO(l){var f=l.indexOf(":"),v=l.substring(0,f).trim().toLowerCase(),b=l.substring(f+1).trim();return{name:v,value:b}}function tO(l){var f={};return l&&l.trim().split(/[\r|\n]+/).forEach(function(v){var b=eO(v);f[b.name]=b.value}),f}var iO=tO,rO=Y3,hT=Q3,qy=L_,nO=iO,u_={};function sO(l){var f=u_[l.id];f&&(f.abort(),delete u_[l.id])}function oO(l,f){return new rO(l,{body:f.response,headers:nO(f.getAllResponseHeaders()),statusCode:f.status})}function dT(l){var f=l.total,v=l.loaded,b=100*v/f;return{total:f,transferred:v,percent:b}}function vS(l,f){return new Promise(function(v,b){f.onprogress=function(z){l.emitter.emit(qy.EVENT_PROGRESS_DOWNLOAD,dT(z))};var A=l.file;A&&(f.upload.onprogress=function(z){l.emitter.emit(qy.EVENT_PROGRESS_UPLOAD,dT(z))}),f.onerror=function(z){b(z)},f.onabort=function(){var z=new hT({request:l,type:qy.ERROR_REQUEST_ABORTED});b(z)},f.onload=function(){if(delete u_[l.id],f.status<200||f.status>=400){var z=new hT({request:l,body:f.response,statusCode:f.status});b(z);return}v(f)};var R=l.body;typeof R=="string"?f.send(R):R?f.send(JSON.stringify(R)):A?f.send(A):f.send(),u_[l.id]=f}).then(function(v){return oO(l,v)})}function xS(l,f){var v=l.url(f),b=new window.XMLHttpRequest;return b.open(l.method,v),Object.keys(l.headers).forEach(function(A){b.setRequestHeader(A,l.headers[A])}),b}function aO(l){return Promise.resolve().then(function(){var f=xS(l,l.client.accessToken);return vS(l,f)})}var lO={browserAbort:sO,sendRequestXhr:vS,browserSend:aO,createRequestXhr:xS},bS=lO,wS=yS;function ph(l){wS.call(this,l)}ph.prototype=Object.create(wS.prototype);ph.prototype.constructor=ph;ph.prototype.sendRequest=bS.browserSend;ph.prototype.abortRequest=bS.browserAbort;function cO(l){return new ph(l)}var uO=cO,hO=yS,dO=uO;function fO(l){return function(f){var v;hO.prototype.isPrototypeOf(f)?v=f:v=dO(f);var b=Object.create(l);return b.client=v,b}}var pO=fO,lr=A3,mh=C3,mO=pO,Yo={};Yo.listDatasets=function(l){return lr.assertShape({sortby:lr.oneOf("created","modified")})(l),this.client.createRequest({method:"GET",path:"/datasets/v1/:ownerId",query:l?mh(l,["sortby"]):{}})};Yo.createDataset=function(l){return lr.assertShape({name:lr.string,description:lr.string})(l),this.client.createRequest({method:"POST",path:"/datasets/v1/:ownerId",body:l})};Yo.getMetadata=function(l){return lr.assertShape({datasetId:lr.required(lr.string),description:lr.string})(l),this.client.createRequest({method:"GET",path:"/datasets/v1/:ownerId/:datasetId",params:l})};Yo.updateMetadata=function(l){return lr.assertShape({datasetId:lr.required(lr.string),name:lr.string,description:lr.string})(l),this.client.createRequest({method:"PATCH",path:"/datasets/v1/:ownerId/:datasetId",params:mh(l,["datasetId"]),body:mh(l,["name","description"])})};Yo.deleteDataset=function(l){return lr.assertShape({datasetId:lr.required(lr.string)})(l),this.client.createRequest({method:"DELETE",path:"/datasets/v1/:ownerId/:datasetId",params:l})};Yo.listFeatures=function(l){return lr.assertShape({datasetId:lr.required(lr.string),limit:lr.number,start:lr.string})(l),this.client.createRequest({method:"GET",path:"/datasets/v1/:ownerId/:datasetId/features",params:mh(l,["datasetId"]),query:mh(l,["limit","start"])})};Yo.putFeature=function(l){if(lr.assertShape({datasetId:lr.required(lr.string),featureId:lr.required(lr.string),feature:lr.required(lr.plainObject)})(l),l.feature.id!==void 0&&l.feature.id!==l.featureId)throw new Error("featureId must match the id property of the feature");return this.client.createRequest({method:"PUT",path:"/datasets/v1/:ownerId/:datasetId/features/:featureId",params:mh(l,["datasetId","featureId"]),body:l.feature})};Yo.getFeature=function(l){return lr.assertShape({datasetId:lr.required(lr.string),featureId:lr.required(lr.string)})(l),this.client.createRequest({method:"GET",path:"/datasets/v1/:ownerId/:datasetId/features/:featureId",params:l})};Yo.deleteFeature=function(l){return lr.assertShape({datasetId:lr.required(lr.string),featureId:lr.required(lr.string)})(l),this.client.createRequest({method:"DELETE",path:"/datasets/v1/:ownerId/:datasetId/features/:featureId",params:l})};var _O=mO(Yo);const gO=U0(_O),Ol=N0("mapStore",()=>{const l=Bi(!1),f=Bi(!0),v=Bi(!0),b=Bi([]),A=Bi(void 0),R=Bi(void 0),z=Bi(void 0),G=Bi(0);function o(){gO({accessToken:"pk.eyJ1IjoibXItdGhvbWFzLXJvZ2VycyIsImEiOiJjbHV4MmJhZ2kwbW5lMmpxcmR4dmYyd3JpIn0.T4Knhl9eC-Nh-JNm2YQ3vw"}).listDatasets().send().then(Ue=>{const $e=Ue.body;console.log($e)}).catch(Ue=>{console.error("Error fetching datasets:",Ue)})}function Y(ce){b.value.push(ce),console.log(b.value)}function ie(ce){const Ee=b.value.find($e=>$e.cp_id===ce);if(Ee===void 0)return;const Ue=b.value.indexOf(Ee);b.value.splice(Ue,1)}function K(ce){A.value=ce,G.value++}function de(ce){R.value=ce}return{mapLoaded:l,allMarinas:z,showMoorings:f,showMarinas:v,savedLocations:b,zoomToLocation:A,currentLocation:R,triggerLocationChange:G,setCurrentLocation:de,addLocation:Y,removeLocation:ie,setZoomLocation:K,getDataSets:o}},{persist:!0}),yO={class:"search-container shadow-xl"},vO={class:"container-header"},xO={key:0,class:"search-error bg-red-600"},bO={style:{width:"100%"}},wO={for:"",style:{"text-align":"left",display:"block",width:"90%",margin:"0px auto","margin-top":"20px"}},q0=is({__name:"SearchForm",emits:["searched"],setup(l,{emit:f}){const v=new aS,b=new Hf,A=new u3,R=Zf(),z=Xc(),G=Bi(""),o=Bi(!1),Y=f;function ie(ce){const Ee=ce.split(",");return Ee.length>=2?Ee.slice(0,2).join(","):ce}async function K(){if(z.searchLocationValue===void 0||z.searchLocationValue===null||z.searchLocationValue===""||z.searchRadiusValue===void 0||z.searchRadiusValue===null){G.value="Please complete the search form",o.value=!0;return}z.searchRadiusValue>30&&(z.searchRadiusValue=30);const ce={query:z.searchLocationValue};let Ee;try{const $e=await A.locationSearchGet(ce);Ee=$e[0].coordinates,z.searchLocationValue=ie($e[0].name),z.searchLocationCoordinatesValue=$e[0].coordinates}catch($e){console.error("Location error: ",$e),console.warn($e.response.statusText),G.value="Can't find that location",o.value=!0;return}Ee===void 0&&console.warn("something wrong with location searhc");const Ue={name:void 0,searchCoordinates:Ee,searchDistance:z.searchRadiusValue,userCoordinates:z.userLocation??void 0,serviceTypes:void 0,limit:void 0,offset:0};console.warn(Ue);try{const $e=await b.dataMarinasSearchGet(Ue);z.marinaSearchResults=$e,console.log(z.marinaSearchResults)}catch($e){if($e.response&&$e.response.status===404){R.push("/results"),z.marinaSearchResults=[];return}console.error("Search error: ",$e),console.warn($e.response.statusText),G.value="Error with search",o.value=!0;return}R.push("/results"),o.value=!1,z.resetSortOptions(),z.resetServiceFilterOptions(),Y("searched")}const de=Bi();return bo(async()=>{try{const ce=await v.typesServiceTypesGet();de.value=ce,z.serviceTypes=ce,console.log(de.value)}catch(ce){console.error("Error fetching data:",ce)}}),(ce,Ee)=>(ri(),hi("div",yO,[He("div",vO,[o.value?(ri(),hi("div",xO,Nr(G.value),1)):Xr("",!0)]),He("form",null,[Tl(He("input",{type:"text",placeholder:"Location","onUpdate:modelValue":Ee[0]||(Ee[0]=Ue=>wr(z).searchLocationValue=Ue),style:{"text-align":"left"}},null,512),[[Uw,wr(z).searchLocationValue]]),He("div",bO,[He("label",wO,"Search Radius: "+Nr(wr(z).searchRadiusValue)+" Miles",1),Tl(He("input",{type:"range",placeholder:"Radius (miles)","onUpdate:modelValue":Ee[1]||(Ee[1]=Ue=>wr(z).searchRadiusValue=Ue),max:"30",min:"1",value:"1",style:{display:"block",width:"90%",margin:"0px auto","margin-bottom":"12px","margin-top":"12px"}},null,512),[[Uw,wr(z).searchRadiusValue]])])]),He("div",{class:"container-footer"},[He("button",{class:"bg-blue-700",onClick:K},"Search")])]))}}),TO={class:"bg-blue-700",style:{padding:"0px","padding-top":"10px"}},EO=He("img",{style:{margin:"0px auto"},src:RD,width:"50%",alt:""},null,-1),SO={class:"search-types"},MO=["onClick"],AO={id:"search"},IO={style:{padding:"20px","padding-bottom":"0px"}},CO={class:"mb-2"},PO={id:"close-by"},RO={class:"close-items"},LO=He("footer",null,null,-1),DO=is({__name:"experimentalLayout",setup(l){const f=new Hf;Ol();const v=Xc(),b=Bi();Bi(!0),Zf(),Bi(""),Bi(!1);function A(Y){v.searchItems.find(ie=>ie.active).active=!1,v.searchItems.find(ie=>ie.title===Y).active=!0,b.value=v.searchItems.find(ie=>ie.active).title}const R=Bi(null),z=Bi(null),G=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(Y=>{R.value={latitude:Y.coords.latitude,longitude:Y.coords.longitude},console.log("Location:",R.value),v.userLocation=`${R.value.longitude}, ${R.value.latitude}`},Y=>{switch(Y.code){case Y.PERMISSION_DENIED:z.value="User denied the request for Geolocation.";break;case Y.POSITION_UNAVAILABLE:z.value="Location information is unavailable.";break;case Y.TIMEOUT:z.value="The request to get user location timed out.";break;default:z.value="An unknown error occurred.";break}console.log("Error:",z.value)}):(z.value="Geolocation is not supported by this browser.",console.log("Error:",z.value))},o=Bi(void 0);return PE(async()=>{if(v.userLocation!=null){console.log("get close",v.userLocation);const Y={searchCoordinates:v.userLocation,userCoordinates:v.userLocation,searchDistance:8,limit:20};o.value=await f.dataMarinasSearchGet(Y)??void 0,o.value=o.value.sort((ie,K)=>(ie==null?void 0:ie.distanceFromUser)-(K==null?void 0:K.distanceFromUser)),console.warn(o.value)}}),bo(async()=>{b.value=v.searchItems.find(Y=>Y.active).title,G(),console.log("Initial Location:",R.value),console.log("Initial Error:",z.value)}),(Y,ie)=>(ri(),hi(Gr,null,[He("nav",TO,[EO,He("div",SO,[wr(v).searchItems.length>1?(ri(!0),hi(Gr,{key:0},Ko(wr(v).searchItems,K=>(ri(),hi(Gr,null,[He("div",{class:Xo(["search-type",{active:K.active}]),onClick:de=>A(K.title)},Nr(K.title),11,MO),Hc("location ")],64))),256)):Xr("",!0)])]),He("section",AO,[Cr(q0)]),R.value&&o.value!=null?(ri(),hi(Gr,{key:0},[He("div",IO,[He("h2",CO,Nr(b.value)+" closest to you",1)]),He("section",PO,[He("div",RO,[o.value!=null?(ri(!0),hi(Gr,{key:0},Ko(o.value,K=>(ri(),$c(ND,{id:K.id,name:K.name,description:"",image:"","has-image":!1,distance:K.distanceFromUser.toFixed(2),onClick:ie[0]||(ie[0]=de=>wr(v).searchLocationValue=void 0)},null,8,["id","name","distance"]))),256)):Xr("",!0)])])],64)):Xr("",!0),LO],64))}}),OO="/assets/AquaTrailsLogo-BC82zGx8.png",D_=N0("navStore",()=>({toggleNav:Bi(!1)})),zO={class:"bg-slate-100 w-full z-20 h-69 top-0 start-0 border-b border-gray-200 dark:border-gray-600 shadow",style:{"flex-shrink":"0"}},kO={class:"flex p-4 justify-between"},BO=He("a",{href:"/",class:"flex space-x-3"},[He("img",{src:OO,class:"h-8",alt:"Flowbite Logo"})],-1),FO={class:"flex space-x-6"},NO=He("span",{class:"sr-only"},"Open main menu",-1),VO=He("svg",{class:"w-5 h-5","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 14"},[He("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M1 1h15M1 7h15M1 13h15"})],-1),UO=[NO,VO],jO=is({__name:"NavBar",setup(l){const f=D_();return(v,b)=>(ri(),hi("nav",zO,[He("div",kO,[BO,He("div",FO,[He("button",{class:"md:hidden",onClick:b[0]||(b[0]=A=>wr(f).toggleNav=!wr(f).toggleNav)},UO)])])]))}});var TS={exports:{}};(function(l,f){var v={};(function(b,A){l.exports=A()})(Vs,function(){var b,A,R;function z(o,Y){if(!b)b=Y;else if(!A)A=Y;else{var ie="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+b+")(sharedChunk); ("+A+")(sharedChunk); self.onerror = null;",K={};b(K),R=Y(K),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(R.workerUrl=window.URL.createObjectURL(new Blob([ie],{type:"text/javascript"})))}}z(["exports"],function(o){var Y="3.3.0";let ie;const K={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(ie==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ie=v.API_URL_REGEX!=null?new RegExp(v.API_URL_REGEX):t}catch{ie=t}}return ie},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!K.API_URL)return null;try{const t=new URL(K.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"};function de(t){return K.API_URL_REGEX.test(t)}function ce(t){return t.indexOf("mapbox:")===0}function Ee(t){return K.API_CDN_URL_REGEX.test(t)}function Ue(t){return K.API_SPRITE_REGEX.test(t)}function $e(t){return K.API_STYLE_REGEX.test(t)&&!Ue(t)}const et={create:"create",load:"load",fullLoad:"fullLoad"};function ht(t){const e=t.name.split("?")[0];return Ee(e)&&e.includes("mapbox-gl.js")?"javascript":Ee(e)&&e.includes("mapbox-gl.css")?"css":function(i){return K.API_FONTS_REGEX.test(i)}(e)?"fontRange":Ue(e)?"sprite":$e(e)?"style":function(i){return K.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}function Xe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var $t=kt;function kt(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=n}kt.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,n=0;n<8;n++){var a=this.sampleCurveX(i)-t;if(Math.abs(a)<e)return i;var c=this.sampleCurveDerivativeX(i);if(Math.abs(c)<1e-6)break;i-=a/c}var d=0,m=1;for(i=t,n=0;n<20&&(a=this.sampleCurveX(i),!(Math.abs(a-t)<e));n++)t>a?d=i:m=i,i=.5*(m-d)+d;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var At=Xe($t),_i=ai;function ai(t,e){this.x=t,this.y=e}ai.prototype={clone:function(){return new ai(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=n,this},_rotateAround:function(t,e){var i=Math.cos(t),n=Math.sin(t),a=e.y+n*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-n*(this.y-e.y),this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ai.convert=function(t){return t instanceof ai?t:Array.isArray(t)?new ai(t[0],t[1]):t};var Ie=Xe(_i);const Ti=Math.PI/180,Wi=180/Math.PI;function dt(t){return t*Ti}function Ei(t){return t*Wi}const Dr=[[0,0],[1,0],[1,1],[0,1]];function tt(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function Ri(t,e,i,n){const a=new At(t,e,i,n);return function(c){return a.solve(c)}}const Zi=Ri(.25,.1,.25,1);function Nt(t,e,i){return Math.min(i,Math.max(e,t))}function Dn(t,e,i){return(i=Nt((i-t)/(e-t),0,1))*i*(3-2*i)}function Cn(t,e,i){const n=i-e,a=((t-e)%n+n)%n+e;return a===e?i:a}function tn(t,e,i){if(!t.length)return i(null,[]);let n=t.length;const a=new Array(t.length);let c=null;t.forEach((d,m)=>{e(d,(g,y)=>{g&&(c=g),a[m]=y,--n==0&&i(c,a)})})}function gr(t,...e){for(const i of e)for(const n in i)t[n]=i[n];return t}let qn=1;function ns(){return qn++}function Us(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function wn(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function lt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Qt(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Gt(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Kt(t,e,i){const n={};for(const a in t)n[a]=e.call(i||this,t[a],a,t);return n}function Xi(t,e,i){const n={};for(const a in t)e.call(i||this,t[a],a,t)&&(n[a]=t[a]);return n}function sr(t){return Array.isArray(t)?t.map(sr):typeof t=="object"&&t?Kt(t,sr):t}const pe={};function _e(t){pe[t]||(typeof console<"u"&&console.warn(t),pe[t]=!0)}function Fe(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function yt(t){let e=0;for(let i,n,a=0,c=t.length,d=c-1;a<c;d=a++)i=t[a],n=t[d],e+=(n.x-i.x)*(i.y+n.y);return e}function rt([t,e,i]){const n=dt(e+90),a=dt(i);return{x:t*Math.cos(n)*Math.sin(a),y:t*Math.sin(n)*Math.sin(a),z:t*Math.cos(a),azimuthal:e,polar:i}}function bt(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function qt(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,n,a,c)=>{const d=a||c;return e[n]=!d||d.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let wt,Vt,Tt,Ht,oi,ni,Se=null;function Z(t){try{const e=self[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function ne(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function le(t,e,i,n){for(;e<i;){const a=e+i>>1;t[a]<n?e=a+1:i=a}return e}function Re(t,e,i,n){for(;e<i;){const a=e+i>>1;t[a]<=n?e=a+1:i=a}return e}function Ne(){return wt==null&&(wt=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),wt}const Qe={now:()=>Ht!==void 0?Ht:performance.now(),setNow(t){Ht=t},restoreNow(){Ht=void 0},frame(t){const e=requestAnimationFrame(t);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:n}=t;oi||(oi=document.createElement("canvas"));const a=oi.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(i>oi.width||n>oi.height)&&(oi.width=i,oi.height=n),a.clearRect(-e,-e,i+2*e,n+2*e),a.drawImage(t,0,0,i,n),a.getImageData(-e,-e,i+2*e,n+2*e)},resolveURL:t=>(Vt||(Vt=document.createElement("a")),Vt.href=t,Vt.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Tt==null&&(Tt=window.matchMedia("(prefers-reduced-motion: reduce)")),Tt.matches)},hasCanvasFingerprintNoise(){if(ni!==void 0)return ni;if(!Ne())return ni=!1,!1;const t=new OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0});let i=0;for(let a=0;a<t.width;++a)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(a,0,1,1);const n=e.getImageData(0,0,t.width,t.height);i=0;for(let a=0;a<n.data.length;++a)if(a%4!=3&&i++!==n.data[a])return ni=!0,!0;return ni=!1,!1}},Pt="mapbox-tiles";let Be=500,Dt=50,mt,It;function vi(){try{return caches}catch{}}function cr(){const t=vi();t&&!mt&&(mt=t.open(Pt))}function Mr(t){const e=t.indexOf("?");if(e<0)return t;const i=["language","worldview"],n=new URLSearchParams,a=new URLSearchParams(t.slice(e));for(const c of i){const d=a.get(c);d&&n.set(c,d)}return`${t.slice(0,e)}?${n.toString()}`}function ur(t,e){const i=t.indexOf("?");if(i<0)return`${t}?${new URLSearchParams(e).toString()}`;const n=new URLSearchParams(t.slice(i));for(const a in e)n.set(a,e[a]);return`${t.slice(0,i)}?${n.toString()}`}let rr=1/0;const Ji={supported:!1,testSupport:function(t){!hn&&yr&&(Tr?On(t):or=t)}};let or,yr,hn=!1,Tr=!1;const Vn=typeof self<"u"?self:{};function On(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,yr),t.isContextLost())return;Ji.supported=!0}catch{}t.deleteTexture(e),hn=!0}Vn.document&&(yr=Vn.document.createElement("img"),yr.onload=function(){or&&On(or),or=null,Tr=!0},yr.onerror=function(){hn=!0,or=null},yr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Zn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Zn);class rn extends Error{constructor(e,i,n){i===401&&de(n)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Yr=bt()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ke=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(Yr())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(n,a){const c=new AbortController,d=new Request(n.url,{method:n.method||"GET",body:n.body,credentials:n.credentials,headers:n.headers,referrer:Yr(),referrerPolicy:n.referrerPolicy,signal:c.signal});let m=!1,g=!1;const y=(w=d.url).indexOf("sku=")>0&&de(w);var w;n.type==="json"&&d.headers.set("Accept","application/json");const E=(P,D,O)=>{if(g)return;if(P&&P.message!=="SecurityError"&&_e(P.toString()),D&&O)return M(D);const F=Date.now();fetch(d).then(V=>{if(V.ok){const W=y?V.clone():null;return M(V,W,F)}return a(new rn(V.statusText,V.status,n.url))}).catch(V=>{V.name!=="AbortError"&&a(new Error(`${V.message} ${n.url}`))})},M=(P,D,O)=>{(n.type==="arrayBuffer"?P.arrayBuffer():n.type==="json"?P.json():P.text()).then(F=>{g||(D&&O&&function(V,W,Q){if(cr(),!mt)return;const J=qt(W.headers.get("Cache-Control")||"");if(J["no-store"])return;const oe={status:W.status,statusText:W.statusText,headers:new Headers};W.headers.forEach((ge,xe)=>oe.headers.set(xe,ge)),J["max-age"]&&oe.headers.set("Expires",new Date(Q+1e3*J["max-age"]).toUTCString());const se=oe.headers.get("Expires");if(!se||new Date(se).getTime()-Q<42e4)return;let he=Mr(V.url);if(W.status===206){const ge=V.headers.get("Range");if(!ge)return;oe.status=200,he=ur(he,{range:ge})}(function(ge,xe){if(It===void 0)try{new Response(new ReadableStream),It=!0}catch{It=!1}It?xe(ge.body):ge.blob().then(xe)})(W,ge=>{const xe=new Response(ge,oe);cr(),mt&&mt.then(Ae=>Ae.put(he,xe)).catch(Ae=>_e(Ae.message))})}(d,D,O),m=!0,a(null,F,P.headers.get("Cache-Control"),P.headers.get("Expires")))}).catch(F=>{g||a(new Error(F.message))})};return y?function(P,D){if(cr(),!mt)return D(null);mt.then(O=>{let F=Mr(P.url);const V=P.headers.get("Range");V&&(F=ur(F,{range:V})),O.match(F).then(W=>{const Q=function(J){if(!J)return!1;const oe=new Date(J.headers.get("Expires")||0),se=qt(J.headers.get("Cache-Control")||"");return oe>Date.now()&&!se["no-cache"]}(W);O.delete(F),Q&&O.put(F,W.clone()),D(null,W,Q)}).catch(D)}).catch(D)}(d,E):E(null,null),{cancel:()=>{g=!0,m||c.abort()}}}(t,e);if(bt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(n,a){const c=new XMLHttpRequest;c.open(n.method||"GET",n.url,!0),n.type==="arrayBuffer"&&(c.responseType="arraybuffer");for(const d in n.headers)c.setRequestHeader(d,n.headers[d]);return n.type==="json"&&(c.responseType="text",c.setRequestHeader("Accept","application/json")),c.withCredentials=n.credentials==="include",c.onerror=()=>{a(new Error(c.statusText))},c.onload=()=>{if((c.status>=200&&c.status<300||c.status===0)&&c.response!==null){let d=c.response;if(n.type==="json")try{d=JSON.parse(c.response)}catch(m){return a(m)}a(null,d,c.getResponseHeader("Cache-Control"),c.getResponseHeader("Expires"))}else a(new rn(c.statusText,c.status,n.url))},c.send(n.body),{cancel:()=>c.abort()}}(t,e)},Ve=function(t,e){return ke(gr(t,{type:"arrayBuffer"}),e)};function it(t){const e=document.createElement("a");return e.href=t,e.protocol===location.protocol&&e.host===location.host}const ft="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ot,gt;ot=[],gt=0;const vt=function(t,e){if(Ji.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),gt>=K.MAX_PARALLEL_IMAGE_REQUESTS){const c={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ot.push(c),c}gt++;let i=!1;const n=()=>{if(!i)for(i=!0,gt--;ot.length&&gt<K.MAX_PARALLEL_IMAGE_REQUESTS;){const c=ot.shift(),{requestParameters:d,callback:m,cancelled:g}=c;g||(c.cancel=vt(d,m).cancel)}},a=Ve(t,(c,d,m,g)=>{n(),c?e(c):d&&(self.createImageBitmap?function(y,w){const E=new Blob([new Uint8Array(y)],{type:"image/png"});createImageBitmap(E).then(M=>{w(null,M)}).catch(M=>{w(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(d,(y,w)=>e(y,w,m,g)):function(y,w){const E=new Image;E.onload=()=>{w(null,E),URL.revokeObjectURL(E.src),E.onload=null,requestAnimationFrame(()=>{E.src=ft})},E.onerror=()=>w(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(y)],{type:"image/png"});E.src=y.byteLength?URL.createObjectURL(M):ft}(d,(y,w)=>e(y,w,m,g)))});return{cancel:()=>{a.cancel(),n()}}},ct="01",Et="NO_ACCESS_TOKEN",pt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ii(t){const e=t.match(pt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Li(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const jt="mapbox.eventData";function hr(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Pr{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=hr(K.ACCESS_TOKEN);let n="";return n=i&&i.u?btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(a,c)=>String.fromCharCode(+("0x"+c)))):K.ACCESS_TOKEN||"",e?`${jt}.${e}:${n}`:`${jt}:${n}`}fetchEventData(){const e=Z("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{const a=localStorage.getItem(i);a&&(this.eventData=JSON.parse(a));const c=localStorage.getItem(n);c&&(this.anonId=c)}catch{_e("Unable to read from LocalStorage")}}saveEventData(){const e=Z("localStorage"),i=this.getStorageKey(),n=this.getStorageKey("uuid"),a=this.anonId;if(e&&a)try{localStorage.setItem(n,a),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{_e("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,n,a){if(!K.EVENTS_URL)return;const c=ii(K.EVENTS_URL);c.params.push(`access_token=${a||K.ACCESS_TOKEN||""}`);const d={event:this.type,created:new Date(e).toISOString()},m=i?gr(d,i):d,g={url:Li(c),headers:{"Content-Type":"text/plain"},body:JSON.stringify([m])};this.pendingRequest=function(y,w){return ke(gr(y,{method:"POST"}),w)}(g,y=>{this.pendingRequest=null,n(y),this.saveEventData(),this.processRequests(a)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const mr=new class extends Pr{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){K.EVENTS_URL&&K.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>ce(i)||de(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=hr(K.ACCESS_TOKEN),i=e?e.u:K.ACCESS_TOKEN;let n=i!==this.eventData.tokenU;lt(this.anonId)||(this.anonId=Us(),n=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const c=new Date(this.eventData.lastSuccess),d=new Date(a),m=(a-this.eventData.lastSuccess)/864e5;n=n||m>=1||m<-1||c.getDate()!==d.getDate()}else n=!0;n?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Y,skuId:ct,"enabled.telemetry":!1,userId:this.anonId},c=>{c||(this.eventData.lastSuccess=a,this.eventData.tokenU=i)},t):this.processRequests()}},nn=mr.postTurnstileEvent.bind(mr),Tn=new class extends Pr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,n){this.skuToken=e,this.errorCb=n,K.EVENTS_URL&&(i||K.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Et)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),lt(this.anonId)||(this.anonId=Us()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Y,skuId:ct,skuToken:this.skuToken,userId:this.anonId},n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t))}remove(){this.errorCb=null}},Ki=Tn.postMapLoadEvent.bind(Tn),ss=new class extends Pr{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){K.EVENTS_URL&&(t||K.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),n=function(a){const c=performance.getEntriesByType("resource"),d=performance.getEntriesByType("mark"),m=function(P){const D={};if(P){for(const O in P)if(O!=="other")for(const F of P[O]){const V=`${O}ResolveRangeMin`,W=`${O}ResolveRangeMax`,Q=`${O}RequestCount`,J=`${O}RequestCachedCount`;D[V]=Math.min(D[V]||1/0,F.startTime),D[W]=Math.max(D[W]||-1/0,F.responseEnd);const oe=se=>{D[se]===void 0&&(D[se]=0),++D[se]};F.transferSize!==void 0&&F.transferSize===0&&oe(J),oe(Q)}}return D}(function(P,D){const O={};if(P)for(const F of P){const V=D(F);O[V]===void 0&&(O[V]=[]),O[V].push(F)}return O}(c,ht)),g=window.devicePixelRatio,y=navigator.connection||navigator.mozConnection||navigator.webkitConnection,w=y?y.effectiveType:void 0,E={counters:[],metadata:[],attributes:[]},M=(P,D,O)=>{O!=null&&P.push({name:D,value:O.toString()})};for(const P in m)M(E.counters,P,m[P]);if(a.interactionRange[0]!==1/0&&a.interactionRange[1]!==-1/0&&(M(E.counters,"interactionRangeMin",a.interactionRange[0]),M(E.counters,"interactionRangeMax",a.interactionRange[1])),d)for(const P of Object.keys(et)){const D=et[P],O=d.find(F=>F.name===D);O&&M(E.counters,D,O.startTime)}return M(E.counters,"visibilityHidden",a.visibilityHidden),M(E.attributes,"style",function(P){if(P)for(const D of P){const O=D.name.split("?")[0];if($e(O)){const F=O.split("/").slice(-2);if(F.length===2)return`mapbox://styles/${F[0]}/${F[1]}`}}}(c)),M(E.attributes,"terrainEnabled",a.terrainEnabled?"true":"false"),M(E.attributes,"fogEnabled",a.fogEnabled?"true":"false"),M(E.attributes,"projection",a.projection),M(E.attributes,"zoom",a.zoom),M(E.metadata,"devicePixelRatio",g),M(E.metadata,"connectionEffectiveType",w),M(E.metadata,"navigatorUserAgent",navigator.userAgent),M(E.metadata,"screenWidth",window.screen.width),M(E.metadata,"screenHeight",window.screen.height),M(E.metadata,"windowWidth",window.innerWidth),M(E.metadata,"windowHeight",window.innerHeight),M(E.metadata,"mapWidth",a.width/g),M(E.metadata,"mapHeight",a.height/g),M(E.metadata,"webglRenderer",a.renderer),M(E.metadata,"webglVendor",a.vendor),M(E.metadata,"sdkVersion",Y),M(E.metadata,"sdkIdentifier","mapbox-gl-js"),E}(i);for(const a of n.metadata);for(const a of n.counters);for(const a of n.attributes);this.postEvent(e,n,()=>{},t)}},Es=ss.postPerformanceEvent.bind(ss),En=new class extends Pr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,n){if(!K.API_URL||!K.SESSION_PATH)return;const a=ii(K.API_URL+K.SESSION_PATH);a.params.push(`sku=${e||""}`),a.params.push(`access_token=${n||K.ACCESS_TOKEN||""}`);const c={url:Li(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(d,m){return ke(gr(d,{method:"GET"}),m)}(c,d=>{this.pendingRequest=null,i(d),this.saveEventData(),this.processRequests(n)})}getSessionAPI(t,e,i,n){this.skuToken=e,this.errorCb=n,K.SESSION_PATH&&K.API_URL&&(i||K.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(Et)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,n=>{n?this.errorCb(n):e&&(this.success[e]=!0)},t)}remove(){this.errorCb=null}},zl=En.getSessionAPI.bind(En),wo=new Set;function Sa(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function yh(t,e,i){if(i&&i[t]){const n=i[t].indexOf(e);n!==-1&&i[t].splice(n,1)}}class Jo{constructor(e,i={}){gr(this,i),this.type=e}}class vh extends Jo{constructor(e,i={}){super("error",gr({error:e},i))}}class Ma{on(e,i){return this._listeners=this._listeners||{},Sa(e,i,this._listeners),this}off(e,i){return yh(e,i,this._listeners),yh(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Sa(e,i,this._oneTimeListeners),this):new Promise(n=>this.once(e,n))}fire(e,i){typeof e=="string"&&(e=new Jo(e,i||{}));const n=e.type;if(this.listens(n)){e.target=this;const a=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const m of a)m.call(this,e);const c=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const m of c)yh(n,m,this._oneTimeListeners),m.call(this,e);const d=this._eventedParent;d&&(gr(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),d.fire(e))}else e instanceof vh&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}o.y=void 0;var Wf={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Kc(t){return(t=Math.round(t))<0?0:t>255?255:t}function xh(t){return Kc(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Yc(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function bh(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{o.y={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in Wf)return Wf[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=i.indexOf("("),a=i.indexOf(")");if(n!==-1&&a+1===i.length){var c=i.substr(0,n),d=i.substr(n+1,a-(n+1)).split(","),m=1;switch(c){case"rgba":if(d.length!==4)return null;m=Yc(d.pop());case"rgb":return d.length!==3?null:[xh(d[0]),xh(d[1]),xh(d[2]),m];case"hsla":if(d.length!==4)return null;m=Yc(d.pop());case"hsl":if(d.length!==3)return null;var g=(parseFloat(d[0])%360+360)%360/360,y=Yc(d[1]),w=Yc(d[2]),E=w<=.5?w*(y+1):w+y-w*y,M=2*w-E;return[Kc(255*bh(M,E,g+1/3)),Kc(255*bh(M,E,g)),Kc(255*bh(M,E,g-1/3)),m];default:return null}}return null}}catch{}class Hn{constructor(e,i,n,a=1){this.r=e,this.g=i,this.b=n,this.a=a}static parse(e){if(!e)return;if(e instanceof Hn)return e;if(typeof e!="string")return;const i=o.y(e);return i?new Hn(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,n,a]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(n)},${a})`}toArray(){const{r:e,g:i,b:n,a}=this;return a===0?[0,0,0,0]:[255*e/a,255*i/a,255*n/a,a]}toArray01(){const{r:e,g:i,b:n,a}=this;return a===0?[0,0,0,0]:[e/a,i/a,n/a,a]}toArray01Scaled(e){const{r:i,g:n,b:a,a:c}=this;return c===0?[0,0,0]:[i/c*e,n/c*e,a/c*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:n,a}=this;return[e,i,n,a]}toArray01Linear(){const{r:e,g:i,b:n,a}=this;return a===0?[0,0,0,0]:[Math.pow(e/a,2.2),Math.pow(i/a,2.2),Math.pow(n/a,2.2),a]}}Hn.black=new Hn(0,0,0,1),Hn.white=new Hn(1,1,1,1),Hn.transparent=new Hn(0,0,0,0),Hn.red=new Hn(1,0,0,1),Hn.blue=new Hn(0,0,1,1);var Jr=Hn;function Di(t,e,i){return t*(1-i)+e*i}function Xf(t,e,i){return t.map((n,a)=>Di(n,e[a],i))}var Jc=Object.freeze({__proto__:null,array:Xf,color:function(t,e,i){return new Jr(Di(t.r,e.r,i),Di(t.g,e.g,i),Di(t.b,e.b,i),Di(t.a,e.a,i))},number:Di});function wh(t,...e){for(const i of e)for(const n in i)t[n]=i[n];return t}class B_ extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var js=B_;class Th{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[n,a]of i)this.bindings[n]=a}concat(e){return new Th(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var F_=Th;const Aa={kind:"null"},Mt={kind:"number"},Qi={kind:"string"},er={kind:"boolean"},hs={kind:"color"},Ia={kind:"object"},Vi={kind:"value"},Qc={kind:"collator"},Ca={kind:"formatted"},kl={kind:"resolvedImage"};function Wn(t,e){return{kind:"array",itemType:t,N:e}}function Wr(t){if(t.kind==="array"){const e=Wr(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const Yt=[Aa,Mt,Qi,er,hs,Ca,Ia,Wn(Vi),kl];function Qo(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Qo(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of Yt)if(!Qo(i,e))return null}}return`Expected ${Wr(t)} but found ${Wr(e)} instead.`}function li(t,e){return e.some(i=>i.kind===t.kind)}function To(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}class Si{constructor(e,i,n){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Pa{constructor(e,i,n,a,c){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=n,this.fontStack=a,this.textColor=c}}class Sn{constructor(e){this.sections=e}static fromString(e){return new Sn([new Pa(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof Sn?e:Sn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const n={};i.fontStack&&(n["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(n["font-scale"]=i.scale),i.textColor&&(n["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(n)}return e}}class Jt{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new Jt({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function Kf(t,e,i,n){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?n===void 0||typeof n=="number"&&n>=0&&n<=1?null:`Invalid rgba value [${[t,e,i,n].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof n=="number"?[t,e,i,n]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ea(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Jr||t instanceof Si||t instanceof Sn||t instanceof Jt)return!0;if(Array.isArray(t)){for(const e of t)if(!ea(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!ea(t[e]))return!1;return!0}return!1}function sn(t){if(t===null)return Aa;if(typeof t=="string")return Qi;if(typeof t=="boolean")return er;if(typeof t=="number")return Mt;if(t instanceof Jr)return hs;if(t instanceof Si)return Qc;if(t instanceof Sn)return Ca;if(t instanceof Jt)return kl;if(Array.isArray(t)){const e=t.length;let i;for(const n of t){const a=sn(n);if(i){if(i===a)continue;i=Vi;break}i=a}return Wn(i||Vi,e)}return Ia}function ds(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Jr||t instanceof Sn||t instanceof Jt?t.toString():JSON.stringify(t)}class Eo{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ea(e[1]))return i.error("invalid value");const n=e[1];let a=sn(n);const c=i.expectedType;return a.kind!=="array"||a.N!==0||!c||c.kind!=="array"||typeof c.N=="number"&&c.N!==0||(a=c),new Eo(a,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Jr?["rgba"].concat(this.value.toArray()):this.value instanceof Sn?this.value.serialize():this.value}}var Ys=Eo,on=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Eh={string:Qi,number:Mt,boolean:er,object:Ia};class Sh{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let n,a=1;const c=e[0];if(c==="array"){let m,g;if(e.length>2){const y=e[1];if(typeof y!="string"||!(y in Eh)||y==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);m=Eh[y],a++}else m=Vi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);g=e[2],a++}n=Wn(m,g)}else n=Eh[c];const d=[];for(;a<e.length;a++){const m=i.parse(e[a],a,Vi);if(!m)return null;d.push(m)}return new Sh(n,d)}evaluate(e){for(let i=0;i<this.args.length;i++){const n=this.args[i].evaluate(e);if(!Qo(this.type,sn(n)))return n;if(i===this.args.length-1)throw new on(`Expected value to be of type ${Wr(this.type)}, but found ${Wr(sn(n))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const n=e.itemType;if(n.kind==="string"||n.kind==="number"||n.kind==="boolean"){i.push(n.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&i.push(a)}}return i.concat(this.args.map(n=>n.serialize()))}}var Js=Sh;class Ra{constructor(e){this.type=Ca,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const n=e[1];if(!Array.isArray(n)&&typeof n=="object")return i.error("First argument must be an image or text section.");const a=[];let c=!1;for(let d=1;d<=e.length-1;++d){const m=e[d];if(c&&typeof m=="object"&&!Array.isArray(m)){c=!1;let g=null;if(m["font-scale"]&&(g=i.parse(m["font-scale"],1,Mt),!g))return null;let y=null;if(m["text-font"]&&(y=i.parse(m["text-font"],1,Wn(Qi)),!y))return null;let w=null;if(m["text-color"]&&(w=i.parse(m["text-color"],1,hs),!w))return null;const E=a[a.length-1];E.scale=g,E.font=y,E.textColor=w}else{const g=i.parse(e[d],1,Vi);if(!g)return null;const y=g.type.kind;if(y!=="string"&&y!=="value"&&y!=="null"&&y!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");c=!0,a.push({content:g,scale:null,font:null,textColor:null})}}return new Ra(a)}evaluate(e){return new Sn(this.sections.map(i=>{const n=i.content.evaluate(e);return sn(n)===kl?new Pa("",n,null,null,null):new Pa(ds(n),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const n={};i.scale&&(n["font-scale"]=i.scale.serialize()),i.font&&(n["text-font"]=i.font.serialize()),i.textColor&&(n["text-color"]=i.textColor.serialize()),e.push(n)}return e}}class ta{constructor(e,i){this.type=kl,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");const n=i.parse(e[1],1,Qi);if(!n)return i.error("No image name provided.");if(e.length===2)return new ta(n);const a=i.parse(e[2],1,Qi);return a?new ta(n,a):i.error("Secondary image variant is not a string.")}evaluate(e){const i=Jt.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function La(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}const Ss={"to-boolean":er,"to-color":hs,"to-number":Mt,"to-string":Qi};class eu{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const n=e[0],a=[];let c=Aa;if(n==="to-array"){if(!Array.isArray(e[1]))return null;const d=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);c=Wn(i.expectedType.itemType,d)}else{if(!(d>0&&ea(e[1][0])))return null;c=Wn(sn(e[1][0]),d)}for(let m=0;m<d;m++){const g=e[1][m];let y;if(La(g)==="array")y=i.parse(g,void 0,c.itemType);else{const w=La(g);if(w!==c.itemType.kind)return i.error(`Expected ${c.itemType.kind} but found ${w}.`);y=i.registry.literal.parse(["literal",g===void 0?null:g],i)}if(!y)return null;a.push(y)}}else{if((n==="to-boolean"||n==="to-string")&&e.length!==2)return i.error("Expected one argument.");c=Ss[n];for(let d=1;d<e.length;d++){const m=i.parse(e[d],d,Vi);if(!m)return null;a.push(m)}}return new eu(c,a)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,n;for(const a of this.args){if(i=a.evaluate(e),n=null,i instanceof Jr)return i;if(typeof i=="string"){const c=e.parseColor(i);if(c)return c}else if(Array.isArray(i)&&(n=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Kf(i[0],i[1],i[2],i[3]),!n))return new Jr(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new on(n||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const n of this.args){if(i=n.evaluate(e),i===null)return 0;const a=Number(i);if(!isNaN(a))return a}throw new on(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Sn.fromString(ds(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Jt.fromString(ds(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):ds(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ra([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new ta(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Qs=eu;const Bl=["Unknown","Point","LineString","Polygon"];var Yf=class{constructor(t,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Bl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(n*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Jr.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class ia{constructor(e,i,n,a,c){this.name=e,this.type=i,this._evaluate=n,this.args=a,this._overloadIndex=c}evaluate(e){if(!this._evaluate){const i=ia.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const n=e[0],a=ia.definitions[n];if(!a)return i.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const c=Array.isArray(a)?a[0]:a.type,d=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,m=[];let g=null,y=-1;for(const[w,E]of d){if(Array.isArray(w)&&w.length!==e.length-1)continue;m.push(w),y++,g=new np(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const M=[];let P=!1;for(let D=1;D<e.length;D++){const O=e[D],F=Array.isArray(w)?w[D-1]:w.type,V=g.parse(O,1+M.length,F);if(!V){P=!0;break}M.push(V)}if(!P)if(Array.isArray(w)&&w.length!==M.length)g.error(`Expected ${w.length} arguments, but found ${M.length} instead.`);else{for(let D=0;D<M.length;D++){const O=Array.isArray(w)?w[D]:w.type,F=M[D];g.concat(D+1).checkSubtype(O,F.type)}if(g.errors.length===0)return new ia(n,c,E,M,y)}}if(m.length===1)i.errors.push(...g.errors);else{const w=(m.length?m:d.map(([M])=>M)).map(Jf).join(" | "),E=[];for(let M=1;M<e.length;M++){const P=i.parse(e[M],1+E.length);if(!P)return null;E.push(Wr(P.type))}i.error(`Expected arguments of type ${w}, but found (${E.join(", ")}) instead.`)}return null}static register(e,i){ia.definitions=i;for(const n in i)e[n]=ia}}function Jf(t){return Array.isArray(t)?`(${t.map(Wr).join(", ")})`:`(${Wr(t.type)}...)`}var zi=ia;class Fl{constructor(e,i,n){this.type=Qc,this.locale=n,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const n=e[1];if(typeof n!="object"||Array.isArray(n))return i.error("Collator options argument must be an object.");const a=i.parse(n["case-sensitive"]!==void 0&&n["case-sensitive"],1,er);if(!a)return null;const c=i.parse(n["diacritic-sensitive"]!==void 0&&n["diacritic-sensitive"],1,er);if(!c)return null;let d=null;return n.locale&&(d=i.parse(n.locale,1,Qi),!d)?null:new Fl(a,c,d)}evaluate(e){return new Si(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var Mh={exports:{}};Mh.exports=function(){function t(n,a,c,d,m){for(;d>c;){if(d-c>600){var g=d-c+1,y=a-c+1,w=Math.log(g),E=.5*Math.exp(2*w/3),M=.5*Math.sqrt(w*E*(g-E)/g)*(y-g/2<0?-1:1);t(n,a,Math.max(c,Math.floor(a-y*E/g+M)),Math.min(d,Math.floor(a+(g-y)*E/g+M)),m)}var P=n[a],D=c,O=d;for(e(n,c,a),m(n[d],P)>0&&e(n,c,d);D<O;){for(e(n,D,O),D++,O--;m(n[D],P)<0;)D++;for(;m(n[O],P)>0;)O--}m(n[c],P)===0?e(n,c,O):e(n,++O,d),O<=a&&(c=O+1),a<=O&&(d=O-1)}}function e(n,a,c){var d=n[a];n[a]=n[c],n[c]=d}function i(n,a){return n<a?-1:n>a?1:0}return function(n,a,c,d,m){t(n,a,c||0,d||n.length-1,m||i)}}();var N_=Xe(Mh.exports);function V_(t){let e=0;for(let i,n,a=0,c=t.length,d=c-1;a<c;d=a++)i=t[a],n=t[d],e+=(n.x-i.x)*(i.y+n.y);return e}function So(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Mo(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function tu(t,e,i){const n=t[0]-e[0],a=t[1]-e[1],c=t[0]-i[0],d=t[1]-i[1];return n*d-c*a==0&&n*c<=0&&a*d<=0}function Da(t,e,i=!1){let n=!1;for(let m=0,g=e.length;m<g;m++){const y=e[m];for(let w=0,E=y.length,M=E-1;w<E;M=w++){const P=y[M],D=y[w];if(tu(t,P,D))return i;(c=P)[1]>(a=t)[1]!=(d=D)[1]>a[1]&&a[0]<(d[0]-c[0])*(a[1]-c[1])/(d[1]-c[1])+c[0]&&(n=!n)}}var a,c,d;return n}function Ah(t,e,i,n){const a=n[0]-i[0],c=n[1]-i[1],d=(t[0]-i[0])*c-a*(t[1]-i[1]),m=(e[0]-i[0])*c-a*(e[1]-i[1]);return d>0&&m<0||d<0&&m>0}function eo(t,e,i,n){return(a=[n[0]-i[0],n[1]-i[1]])[0]*(c=[e[0]-t[0],e[1]-t[1]])[1]-a[1]*c[0]!=0&&!(!Ah(t,e,i,n)||!Ah(i,n,t,e));var a,c}const Ao=8192;function Nl(t,e){const i=(180+t[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(i*a*Ao),Math.round(n*a*Ao)]}function Ih(t,e){for(let i=0;i<e.length;i++)if(Da(t,e[i]))return!0;return!1}function Ch(t,e,i){for(const n of i)for(let a=0,c=n.length,d=c-1;a<c;d=a++)if(eo(t,e,n[d],n[a]))return!0;return!1}function fs(t,e){for(let i=0;i<t.length;++i)if(!Da(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Ch(t[i],t[i+1],e))return!1;return!0}function Qf(t,e){for(let i=0;i<e.length;i++)if(fs(t,e[i]))return!0;return!1}function Ph(t,e,i){const n=[];for(let a=0;a<t.length;a++){const c=[];for(let d=0;d<t[a].length;d++){const m=Nl(t[a][d],i);So(e,m),c.push(m)}n.push(c)}return n}function Rh(t,e,i){const n=[];for(let a=0;a<t.length;a++){const c=Ph(t[a],e,i);n.push(c)}return n}function Lh(t,e,i,n){if(t[0]<i[0]||t[0]>i[2]){const a=.5*n;let c=t[0]-i[0]>a?-n:i[0]-t[0]>a?n:0;c===0&&(c=t[0]-i[2]>a?-n:i[2]-t[0]>a?n:0),t[0]+=c}So(e,t)}function Dh(t,e,i,n){const a=Math.pow(2,n.z)*Ao,c=[n.x*Ao,n.y*Ao],d=[];if(!t)return d;for(const m of t)for(const g of m){const y=[g.x+c[0],g.y+c[1]];Lh(y,e,i,a),d.push(y)}return d}function Oh(t,e,i,n){const a=Math.pow(2,n.z)*Ao,c=[n.x*Ao,n.y*Ao],d=[];if(!t)return d;for(const g of t){const y=[];for(const w of g){const E=[w.x+c[0],w.y+c[1]];So(e,E),y.push(E)}d.push(y)}if(e[2]-e[0]<=a/2){(m=e)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(const g of d)for(const y of g)Lh(y,e,i,a)}var m;return d}class Oa{constructor(e,i){this.type=er,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ea(e[1])){const n=e[1];if(n.type==="FeatureCollection")for(let a=0;a<n.features.length;++a){const c=n.features[a].geometry.type;if(c==="Polygon"||c==="MultiPolygon")return new Oa(n,n.features[a].geometry)}else if(n.type==="Feature"){const a=n.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new Oa(n,n.geometry)}else if(n.type==="Polygon"||n.type==="MultiPolygon")return new Oa(n,n)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,n){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(n.type==="Polygon"){const m=Ph(n.coordinates,c,d),g=Dh(i.geometry(),a,c,d);if(!Mo(a,c))return!1;for(const y of g)if(!Da(y,m))return!1}if(n.type==="MultiPolygon"){const m=Rh(n.coordinates,c,d),g=Dh(i.geometry(),a,c,d);if(!Mo(a,c))return!1;for(const y of g)if(!Ih(y,m))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,n){const a=[1/0,1/0,-1/0,-1/0],c=[1/0,1/0,-1/0,-1/0],d=i.canonicalID();if(!d)return!1;if(n.type==="Polygon"){const m=Ph(n.coordinates,c,d),g=Oh(i.geometry(),a,c,d);if(!Mo(a,c))return!1;for(const y of g)if(!fs(y,m))return!1}if(n.type==="MultiPolygon"){const m=Rh(n.coordinates,c,d),g=Oh(i.geometry(),a,c,d);if(!Mo(a,c))return!1;for(const y of g)if(!Qf(y,m))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var iu=Oa,Vl={exports:{}};Vl.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,i=e*(2-e),n=Math.PI/180,a=function(y,w){if(y===void 0)throw new Error("No latitude given.");if(w&&!t[w])throw new Error("Unknown unit "+w+". Use one of: "+Object.keys(t).join(", "));var E=6378.137*n*(w?t[w]:1),M=Math.cos(y*n),P=1/(1-i*(1-M*M)),D=Math.sqrt(P);this.kx=E*D*M,this.ky=E*D*P*(1-i)},c={units:{configurable:!0}};function d(y,w){return y[0]===w[0]&&y[1]===w[1]}function m(y,w,E){var M=g(w[0]-y[0]);return[y[0]+M*E,y[1]+(w[1]-y[1])*E]}function g(y){for(;y<-180;)y+=360;for(;y>180;)y-=360;return y}return a.fromTile=function(y,w,E){var M=Math.PI*(1-2*(y+.5)/Math.pow(2,w)),P=Math.atan(.5*(Math.exp(M)-Math.exp(-M)))/n;return new a(P,E)},c.units.get=function(){return t},a.prototype.distance=function(y,w){var E=g(y[0]-w[0])*this.kx,M=(y[1]-w[1])*this.ky;return Math.sqrt(E*E+M*M)},a.prototype.bearing=function(y,w){var E=g(w[0]-y[0])*this.kx;return Math.atan2(E,(w[1]-y[1])*this.ky)/n},a.prototype.destination=function(y,w,E){var M=E*n;return this.offset(y,Math.sin(M)*w,Math.cos(M)*w)},a.prototype.offset=function(y,w,E){return[y[0]+w/this.kx,y[1]+E/this.ky]},a.prototype.lineDistance=function(y){for(var w=0,E=0;E<y.length-1;E++)w+=this.distance(y[E],y[E+1]);return w},a.prototype.area=function(y){for(var w=0,E=0;E<y.length;E++)for(var M=y[E],P=0,D=M.length,O=D-1;P<D;O=P++)w+=g(M[P][0]-M[O][0])*(M[P][1]+M[O][1])*(E?-1:1);return Math.abs(w)/2*this.kx*this.ky},a.prototype.along=function(y,w){var E=0;if(w<=0)return y[0];for(var M=0;M<y.length-1;M++){var P=y[M],D=y[M+1],O=this.distance(P,D);if((E+=O)>w)return m(P,D,(w-(E-O))/O)}return y[y.length-1]},a.prototype.pointToSegmentDistance=function(y,w,E){var M=w[0],P=w[1],D=g(E[0]-M)*this.kx,O=(E[1]-P)*this.ky,F=0;return D===0&&O===0||((F=(g(y[0]-M)*this.kx*D+(y[1]-P)*this.ky*O)/(D*D+O*O))>1?(M=E[0],P=E[1]):F>0&&(M+=D/this.kx*F,P+=O/this.ky*F)),D=g(y[0]-M)*this.kx,O=(y[1]-P)*this.ky,Math.sqrt(D*D+O*O)},a.prototype.pointOnLine=function(y,w){for(var E,M,P,D,O=1/0,F=0;F<y.length-1;F++){var V=y[F][0],W=y[F][1],Q=g(y[F+1][0]-V)*this.kx,J=(y[F+1][1]-W)*this.ky,oe=0;Q===0&&J===0||((oe=(g(w[0]-V)*this.kx*Q+(w[1]-W)*this.ky*J)/(Q*Q+J*J))>1?(V=y[F+1][0],W=y[F+1][1]):oe>0&&(V+=Q/this.kx*oe,W+=J/this.ky*oe));var se=(Q=g(w[0]-V)*this.kx)*Q+(J=(w[1]-W)*this.ky)*J;se<O&&(O=se,E=V,M=W,P=F,D=oe)}return{point:[E,M],index:P,t:Math.max(0,Math.min(1,D))}},a.prototype.lineSlice=function(y,w,E){var M=this.pointOnLine(E,y),P=this.pointOnLine(E,w);if(M.index>P.index||M.index===P.index&&M.t>P.t){var D=M;M=P,P=D}var O=[M.point],F=M.index+1,V=P.index;!d(E[F],O[0])&&F<=V&&O.push(E[F]);for(var W=F+1;W<=V;W++)O.push(E[W]);return d(E[V],P.point)||O.push(P.point),O},a.prototype.lineSliceAlong=function(y,w,E){for(var M=0,P=[],D=0;D<E.length-1;D++){var O=E[D],F=E[D+1],V=this.distance(O,F);if((M+=V)>y&&P.length===0&&P.push(m(O,F,(y-(M-V))/V)),M>=w)return P.push(m(O,F,(w-(M-V))/V)),P;M>y&&P.push(F)}return P},a.prototype.bufferPoint=function(y,w){var E=w/this.ky,M=w/this.kx;return[y[0]-M,y[1]-E,y[0]+M,y[1]+E]},a.prototype.bufferBBox=function(y,w){var E=w/this.ky,M=w/this.kx;return[y[0]-M,y[1]-E,y[2]+M,y[3]+E]},a.prototype.insideBBox=function(y,w){return g(y[0]-w[0])>=0&&g(y[0]-w[2])<=0&&y[1]>=w[1]&&y[1]<=w[3]},Object.defineProperties(a,c),a}();var Io=Xe(Vl.exports),zh={exports:{}};zh.exports=function(){var t=function(i,n){if(i===void 0&&(i=[]),n===void 0&&(n=e),this.data=i,this.length=this.data.length,this.compare=n,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};function e(i,n){return i<n?-1:i>n?1:0}return t.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var i=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),i}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(i){for(var n=this.data,a=this.compare,c=n[i];i>0;){var d=i-1>>1,m=n[d];if(a(c,m)>=0)break;n[i]=m,i=d}n[i]=c},t.prototype._down=function(i){for(var n=this.data,a=this.compare,c=this.length>>1,d=n[i];i<c;){var m=1+(i<<1),g=n[m],y=m+1;if(y<this.length&&a(n[y],g)<0&&(m=y,g=n[y]),a(g,d)>=0)break;n[i]=g,i=m}n[i]=d},t}();var ps=Xe(zh.exports),xt=8192;function ru(t,e){return e.dist-t.dist}const kh=100,Ul=50;function Bh(t){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}function Co(t){return t[1]-t[0]+1}function Ms(t,e){const i=t[1]>=t[0]&&t[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Fh(t,e){if(t[0]>t[1])return[null,null];const i=Co(t);if(e){if(i===2)return[t,null];const n=Math.floor(i/2);return[[t[0],t[0]+n],[t[0]+n,t[1]]]}{if(i===1)return[t,null];const n=Math.floor(i/2)-1;return[[t[0],t[0]+n],[t[0]+n+1,t[1]]]}}function ra(t,e){const i=[1/0,1/0,-1/0,-1/0];if(!Ms(e,t.length))return i;for(let n=e[0];n<=e[1];++n)So(i,t[n]);return i}function nu(t){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<t.length;++i)for(let n=0;n<t[i].length;++n)So(e,t[i][n]);return e}function na(t,e,i){if(Bh(t)||Bh(e))return NaN;let n=0,a=0;return t[2]<e[0]&&(n=e[0]-t[2]),t[0]>e[2]&&(n=t[0]-e[2]),t[1]>e[3]&&(a=t[1]-e[3]),t[3]<e[1]&&(a=e[1]-t[3]),i.distance([0,0],[n,a])}function Nh(t){return 360*t-180}function U_(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function za(t,e){const i=Math.pow(2,e.z),n=(t.y/xt+e.y)/i;return[Nh((t.x/xt+e.x)/i),U_(n)]}function j_(t,e){const i=[];for(let n=0;n<t.length;++n)i.push(za(t[n],e));return i}function ep(t,e,i){const n=i.pointOnLine(e,t).point;return i.distance(t,n)}function tp(t,e,i,n,a){const c=i.slice(n[0],n[1]+1);let d=1/0;for(let m=e[0];m<=e[1];++m)if((d=Math.min(d,ep(t[m],c,a)))===0)return 0;return d}function Vh(t,e,i,n,a){const c=Math.min(a.pointToSegmentDistance(t,i,n),a.pointToSegmentDistance(e,i,n)),d=Math.min(a.pointToSegmentDistance(i,t,e),a.pointToSegmentDistance(n,t,e));return Math.min(c,d)}function G_(t,e,i,n,a){if(!Ms(e,t.length)||!Ms(n,i.length))return NaN;let c=1/0;for(let d=e[0];d<e[1];++d)for(let m=n[0];m<n[1];++m){if(eo(t[d],t[d+1],i[m],i[m+1]))return 0;c=Math.min(c,Vh(t[d],t[d+1],i[m],i[m+1],a))}return c}function $_(t,e,i,n,a){if(!Ms(e,t.length)||!Ms(n,i.length))return NaN;let c=1/0;for(let d=e[0];d<=e[1];++d)for(let m=n[0];m<=n[1];++m)if((c=Math.min(c,a.distance(t[d],i[m])))===0)return c;return c}function q_(t,e,i){if(Da(t,e,!0))return 0;let n=1/0;for(const a of e){const c=a.length;if(c<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[c-1]&&(n=Math.min(n,i.pointToSegmentDistance(t,a[c-1],a[0])))===0||(n=Math.min(n,ep(t,a,i)))===0)return n}return n}function ip(t,e,i,n){if(!Ms(e,t.length))return NaN;for(let c=e[0];c<=e[1];++c)if(Da(t[c],i,!0))return 0;let a=1/0;for(let c=e[0];c<e[1];++c)for(const d of i)for(let m=0,g=d.length,y=g-1;m<g;y=m++){if(eo(t[c],t[c+1],d[y],d[m]))return 0;a=Math.min(a,Vh(t[c],t[c+1],d[y],d[m],n))}return a}function jl(t,e){for(const i of t)for(let n=0;n<=i.length-1;++n)if(Da(i[n],e,!0))return!0;return!1}function Z_(t,e,i,n=1/0){const a=nu(t),c=nu(e);if(n!==1/0&&na(a,c,i)>=n)return n;if(Mo(a,c)){if(jl(t,e))return 0}else if(jl(e,t))return 0;let d=n;for(const m of t)for(let g=0,y=m.length,w=y-1;g<y;w=g++)for(const E of e)for(let M=0,P=E.length,D=P-1;M<P;D=M++){if(eo(m[w],m[g],E[D],E[M]))return 0;d=Math.min(d,Vh(m[w],m[g],E[D],E[M],i))}return d}function su(t,e,i,n,a,c,d){if(c===null||d===null)return;const m=na(ra(n,c),ra(a,d),i);m<e&&t.push({dist:m,range1:c,range2:d})}function Uh(t,e,i,n,a=1/0){let c=Math.min(n.distance(t[0],i[0][0]),a);if(c===0)return c;const d=new ps([{dist:0,range1:[0,t.length-1],range2:[0,0]}],ru),m=e?Ul:kh,g=nu(i);for(;d.length;){const y=d.pop();if(y.dist>=c)continue;const w=y.range1;if(Co(w)<=m){if(!Ms(w,t.length))return NaN;if(e){const E=ip(t,w,i,n);if((c=Math.min(c,E))===0)return c}else for(let E=w[0];E<=w[1];++E){const M=q_(t[E],i,n);if((c=Math.min(c,M))===0)return c}}else{const E=Fh(w,e);if(E[0]!==null){const M=na(ra(t,E[0]),g,n);M<c&&d.push({dist:M,range1:E[0],range2:[0,0]})}if(E[1]!==null){const M=na(ra(t,E[1]),g,n);M<c&&d.push({dist:M,range1:E[1],range2:[0,0]})}}}return c}function rp(t,e,i,n,a,c=1/0){let d=Math.min(c,a.distance(t[0],i[0]));if(d===0)return d;const m=new ps([{dist:0,range1:[0,t.length-1],range2:[0,i.length-1]}],ru),g=e?Ul:kh,y=n?Ul:kh;for(;m.length;){const w=m.pop();if(w.dist>=d)continue;const E=w.range1,M=w.range2;if(Co(E)<=g&&Co(M)<=y){if(!Ms(E,t.length)||!Ms(M,i.length))return NaN;if(e&&n?d=Math.min(d,G_(t,E,i,M,a)):e||n?e&&!n?d=Math.min(d,tp(i,M,t,E,a)):!e&&n&&(d=Math.min(d,tp(t,E,i,M,a))):d=Math.min(d,$_(t,E,i,M,a)),d===0)return d}else{const P=Fh(E,e),D=Fh(M,n);su(m,d,a,t,i,P[0],D[0]),su(m,d,a,t,i,P[0],D[1]),su(m,d,a,t,i,P[1],D[0]),su(m,d,a,t,i,P[1],D[1])}}return d}function jh(t,e,i,n,a=1/0){let c=a;const d=ra(t,[0,t.length-1]);for(const m of i)if(!(c!==1/0&&na(d,ra(m,[0,m.length-1]),n)>=c)&&(c=Math.min(c,rp(t,e,m,!0,n,c)),c===0))return c;return c}function ou(t,e,i,n,a=1/0){let c=a;const d=ra(t,[0,t.length-1]);for(const m of i){if(c!==1/0&&na(d,nu(m),n)>=c)continue;const g=Uh(t,e,m,n,c);if(isNaN(g))return g;if((c=Math.min(c,g))===0)return c}return c}function Gh(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class sa{constructor(e,i){this.type=Mt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ea(e[1])){const n=e[1];if(n.type==="FeatureCollection"){for(let a=0;a<n.features.length;++a)if(Gh(n.features[a].geometry.type))return new sa(n,n.features[a].geometry)}else if(n.type==="Feature"){if(Gh(n.geometry.type))return new sa(n,n.geometry)}else if(Gh(n.type))return new sa(n,n)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),n=e.canonicalID();if(i!=null&&n!=null){if(e.geometryType()==="Point")return function(a,c,d){const m=[];for(const y of a)for(const w of y)m.push(za(w,c));const g=new Io(m[0][1],"meters");return d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString"?rp(m,!1,d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",g):d.type==="MultiLineString"?jh(m,!1,d.coordinates,g):d.type==="Polygon"||d.type==="MultiPolygon"?ou(m,!1,d.type==="Polygon"?[d.coordinates]:d.coordinates,g):null}(i,n,this.geometries);if(e.geometryType()==="LineString")return function(a,c,d){const m=[];for(const y of a){const w=[];for(const E of y)w.push(za(E,c));m.push(w)}const g=new Io(m[0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return jh(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",m,g);if(d.type==="MultiLineString"){let y=1/0;for(let w=0;w<d.coordinates.length;w++){const E=jh(d.coordinates[w],!0,m,g,y);if(isNaN(E))return E;if((y=Math.min(y,E))===0)return y}return y}if(d.type==="Polygon"||d.type==="MultiPolygon"){let y=1/0;for(let w=0;w<m.length;w++){const E=ou(m[w],!0,d.type==="Polygon"?[d.coordinates]:d.coordinates,g,y);if(isNaN(E))return E;if((y=Math.min(y,E))===0)return y}return y}return null}(i,n,this.geometries);if(e.geometryType()==="Polygon")return function(a,c,d){const m=[];for(const y of function(w,E){const M=w.length;if(M<=1)return[w];const P=[];let D,O;for(let F=0;F<M;F++){const V=V_(w[F]);V!==0&&(w[F].area=Math.abs(V),O===void 0&&(O=V<0),O===V<0?(D&&P.push(D),D=[w[F]]):D.push(w[F]))}return D&&P.push(D),P}(a)){const w=[];for(let E=0;E<y.length;++E)w.push(j_(y[E],c));m.push(w)}const g=new Io(m[0][0][0][1],"meters");if(d.type==="Point"||d.type==="MultiPoint"||d.type==="LineString")return ou(d.type==="Point"?[d.coordinates]:d.coordinates,d.type==="LineString",m,g);if(d.type==="MultiLineString"){let y=1/0;for(let w=0;w<d.coordinates.length;w++){const E=ou(d.coordinates[w],!0,m,g,y);if(isNaN(E))return E;if((y=Math.min(y,E))===0)return y}return y}return d.type==="Polygon"||d.type==="MultiPolygon"?function(y,w,E){let M=1/0;for(const P of y)for(const D of w){const O=Z_(P,D,E,M);if(isNaN(O))return O;if((M=Math.min(M,O))===0)return M}return M}(d.type==="Polygon"?[d.coordinates]:d.coordinates,m,g):null}(i,n,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var au=sa;function Gl(t,e){switch(t){case"string":return ds(e);case"number":return+e;case"boolean":return!!e;case"color":return Jr.parse(e);case"formatted":return Sn.fromString(ds(e));case"resolvedImage":return Jt.fromString(ds(e))}return e}function $h(t,e,i,n){return n!==void 0&&(t=n*Math.round(t/n)),e!==void 0&&t<e&&(t=e),i!==void 0&&t>i&&(t=i),t}class $l{constructor(e,i,n){this.type=e,this.key=i,this.scope=n}static parse(e,i){let n=i.expectedType;if(n==null&&(n=Vi),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const a=i.parse(e[1],1);if(!(a instanceof Ys))return i.error("Key name of 'config' expression must be a string literal.");if(e.length>=3){const c=i.parse(e[2],2);return c instanceof Ys?new $l(n,ds(a.value),ds(c.value)):i.error("Scope of 'config' expression must be a string literal.")}return new $l(n,ds(a.value))}evaluate(e){const i=[this.key,this.scope,e.scope].filter(Boolean).join(""),n=e.getConfig(i);if(!n)return null;const{type:a,value:c,values:d,minValue:m,maxValue:g,stepValue:y}=n,w=n.default.evaluate(e);let E=w;if(c){const M=e.scope;e.scope=(M||"").split("").slice(1).join(""),E=c.evaluate(e),e.scope=M}return a&&(E=Gl(a,E)),E===void 0||m===void 0&&g===void 0&&y===void 0||(typeof E=="number"?E=$h(E,m,g,y):Array.isArray(E)&&(E=E.map(M=>typeof M=="number"?$h(M,m,g,y):M))),c!==void 0&&E!==void 0&&d&&!d.includes(E)&&(E=w,a&&(E=Gl(a,E))),(a&&a!==this.type||E!==void 0&&sn(E)!==this.type)&&(E=Gl(this.type.kind,E)),E}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.key),e}}var ka=$l;function Ba(t){if(t instanceof zi&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof iu||t instanceof au)return!1;let e=!0;return t.eachChild(i=>{e&&!Ba(i)&&(e=!1)}),e}function ql(t){if(t instanceof zi&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!ql(i)&&(e=!1)}),e}function Zl(t){if(t instanceof ka)return!1;let e=!0;return t.eachChild(i=>{e&&!Zl(i)&&(e=!1)}),e}function Mn(t,e){if(t instanceof zi&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(n=>{i&&!Mn(n,e)&&(i=!1)}),i}class Po{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const n=e[1];return i.scope.has(n)?new Po(n,i.scope.get(n)):i.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Un=Po;class qh{constructor(e,i=[],n,a=new F_,c=[],d,m){this.registry=e,this.path=i,this.key=i.map(g=>`[${g}]`).join(""),this.scope=a,this.errors=c,this.expectedType=n,this._scope=d,this.options=m}parse(e,i,n,a,c={}){return i||n?this.concat(i,n,a)._parse(e,c):this._parse(e,c)}_parse(e,i){function n(a,c,d){return d==="assert"?new Js(c,[a]):d==="coerce"?new Qs(c,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(a){let c=a.parse(e,this);if(!c)return null;if(this.expectedType){const d=this.expectedType,m=c.type;if(d.kind!=="string"&&d.kind!=="number"&&d.kind!=="boolean"&&d.kind!=="object"&&d.kind!=="array"||m.kind!=="value")if(d.kind!=="color"&&d.kind!=="formatted"&&d.kind!=="resolvedImage"||m.kind!=="value"&&m.kind!=="string"){if(this.checkSubtype(d,m))return null}else c=n(c,d,i.typeAnnotation||"coerce");else c=n(c,d,i.typeAnnotation||"assert")}if(!(c instanceof Ys)&&c.type.kind!=="resolvedImage"&&Zh(c)){const d=new Yf(this._scope,this.options);try{c=new Ys(c.type,c.evaluate(d))}catch(m){return this.error(m.message),null}}return c}return Qs.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,n){const a=typeof e=="number"?this.path.concat(e):this.path,c=n?this.scope.concat(n):this.scope;return new qh(this.registry,a,i||null,c,this.errors,this._scope,this.options)}error(e,...i){const n=`${this.key}${i.map(a=>`[${a}]`).join("")}`;this.errors.push(new js(n,e))}checkSubtype(e,i){const n=Qo(e,i);return n&&this.error(n),n}}var np=qh;function Zh(t){if(t instanceof Un)return Zh(t.boundExpression);if(t instanceof zi&&t.name==="error"||t instanceof Fl||t instanceof iu||t instanceof au||t instanceof ka)return!1;const e=t instanceof Qs||t instanceof Js;let i=!0;return t.eachChild(n=>{i=e?i&&Zh(n):i&&n instanceof Ys}),!!i&&Ba(t)&&Mn(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function oa(t,e){const i=t.length-1;let n,a,c=0,d=i,m=0;for(;c<=d;)if(m=Math.floor((c+d)/2),n=t[m],a=t[m+1],n<=e){if(m===i||e<a)return m;c=m+1}else{if(!(n>e))throw new on("Input is not a number.");d=m-1}return 0}class lu{constructor(e,i,n){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[a,c]of n)this.labels.push(a),this.outputs.push(c)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const n=i.parse(e[1],1,Mt);if(!n)return null;const a=[];let c=null;i.expectedType&&i.expectedType.kind!=="value"&&(c=i.expectedType);for(let d=1;d<e.length;d+=2){const m=d===1?-1/0:e[d],g=e[d+1],y=d,w=d+1;if(typeof m!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',y);if(a.length&&a[a.length-1][0]>=m)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',y);const E=i.parse(g,w,c);if(!E)return null;c=c||E.type,a.push([m,E])}return new lu(c,n,a)}evaluate(e){const i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return n[0].evaluate(e);const c=i.length;return a>=i[c-1]?n[c-1].evaluate(e):n[oa(i,a)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Hl=lu;const sp=.95047,Ro=1.08883,op=4/29,Fa=6/29,Hh=3*Fa*Fa,ap=Fa*Fa*Fa,H_=Math.PI/180,As=180/Math.PI;function cu(t){return t>ap?Math.pow(t,1/3):t/Hh+op}function uu(t){return t>Fa?t*t*t:Hh*(t-op)}function hu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function du(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Wh(t){const e=du(t.r),i=du(t.g),n=du(t.b),a=cu((.4124564*e+.3575761*i+.1804375*n)/sp),c=cu((.2126729*e+.7151522*i+.072175*n)/1);return{l:116*c-16,a:500*(a-c),b:200*(c-cu((.0193339*e+.119192*i+.9503041*n)/Ro)),alpha:t.a}}function Xh(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*uu(e),i=sp*uu(i),n=Ro*uu(n),new Jr(hu(3.2404542*i-1.5371385*e-.4985314*n),hu(-.969266*i+1.8760108*e+.041556*n),hu(.0556434*i-.2040259*e+1.0572252*n),t.alpha)}function lp(t,e,i){const n=e-t;return t+i*(n>180||n<-180?n-360*Math.round(n/360):n)}const Na={forward:Wh,reverse:Xh,interpolate:function(t,e,i){return{l:Di(t.l,e.l,i),a:Di(t.a,e.a,i),b:Di(t.b,e.b,i),alpha:Di(t.alpha,e.alpha,i)}}},Va={forward:function(t){const{l:e,a:i,b:n}=Wh(t),a=Math.atan2(n,i)*As;return{h:a<0?a+360:a,c:Math.sqrt(i*i+n*n),l:e,alpha:t.a}},reverse:function(t){const e=t.h*H_,i=t.c;return Xh({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:lp(t.h,e.h,i),c:Di(t.c,e.c,i),l:Di(t.l,e.l,i),alpha:Di(t.alpha,e.alpha,i)}}};var Kh=Object.freeze({__proto__:null,hcl:Va,lab:Na});class Wl{constructor(e,i,n,a,c){this.type=e,this.operator=i,this.interpolation=n,this.input=a,this.labels=[],this.outputs=[];for(const[d,m]of c)this.labels.push(d),this.outputs.push(m)}static interpolationFactor(e,i,n,a){let c=0;if(e.name==="exponential")c=Ua(i,e.base,n,a);else if(e.name==="linear")c=Ua(i,1,n,a);else if(e.name==="cubic-bezier"){const d=e.controlPoints;c=new At(d[0],d[1],d[2],d[3]).solve(Ua(i,1,n,a))}return c}static parse(e,i){let[n,a,c,...d]=e;if(!Array.isArray(a)||a.length===0)return i.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const y=a[1];if(typeof y!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:y}}else{if(a[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const y=a.slice(1);if(y.length!==4||y.some(w=>typeof w!="number"||w<0||w>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:y}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(c=i.parse(c,2,Mt),!c)return null;const m=[];let g=null;n==="interpolate-hcl"||n==="interpolate-lab"?g=hs:i.expectedType&&i.expectedType.kind!=="value"&&(g=i.expectedType);for(let y=0;y<d.length;y+=2){const w=d[y],E=d[y+1],M=y+3,P=y+4;if(typeof w!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(m.length&&m[m.length-1][0]>=w)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const D=i.parse(E,P,g);if(!D)return null;g=g||D.type,m.push([w,D])}return g.kind==="number"||g.kind==="color"||g.kind==="array"&&g.itemType.kind==="number"&&typeof g.N=="number"?new Wl(g,n,a,c,m):i.error(`Type ${Wr(g)} is not interpolatable.`)}evaluate(e){const i=this.labels,n=this.outputs;if(i.length===1)return n[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return n[0].evaluate(e);const c=i.length;if(a>=i[c-1])return n[c-1].evaluate(e);const d=oa(i,a),m=Wl.interpolationFactor(this.interpolation,a,i[d],i[d+1]),g=n[d].evaluate(e),y=n[d+1].evaluate(e);return this.operator==="interpolate"?Jc[this.type.kind.toLowerCase()](g,y,m):this.operator==="interpolate-hcl"?Va.reverse(Va.interpolate(Va.forward(g),Va.forward(y),m)):Na.reverse(Na.interpolate(Na.forward(g),Na.forward(y),m))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let n=0;n<this.labels.length;n++)i.push(this.labels[n],this.outputs[n].serialize());return i}}function Ua(t,e,i,n){const a=n-i,c=t-i;return a===0?0:e===1?c/a:(Math.pow(e,c)-1)/(Math.pow(e,a)-1)}var os=Wl;class ja{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let n=null;const a=i.expectedType;a&&a.kind!=="value"&&(n=a);const c=[];for(const m of e.slice(1)){const g=i.parse(m,1+c.length,n,void 0,{typeAnnotation:"omit"});if(!g)return null;n=n||g.type,c.push(g)}const d=a&&c.some(m=>Qo(a,m.type));return new ja(d?Vi:n,c)}evaluate(e){let i,n=null,a=0;for(const c of this.args){if(a++,n=c.evaluate(e),n&&n instanceof Jt&&!n.available&&(i||(i=n),n=null,a===this.args.length))return i;if(n!==null)break}return n}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Yh=ja;class fu{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const n=[];for(let c=1;c<e.length-1;c+=2){const d=e[c];if(typeof d!="string")return i.error(`Expected string, but found ${typeof d} instead.`,c);if(/[^a-zA-Z0-9_]/.test(d))return i.error("Variable names must contain only alphanumeric characters or '_'.",c);const m=i.parse(e[c+1],c+1);if(!m)return null;n.push([d,m])}const a=i.parse(e[e.length-1],e.length-1,i.expectedType,n);return a?new fu(n,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,n]of this.bindings)e.push(i,n.serialize());return e.push(this.result.serialize()),e}}var Jh=fu;class Lo{constructor(e,i,n){this.type=e,this.index=i,this.input=n}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,Mt),a=i.parse(e[2],2,Wn(i.expectedType||Vi));return n&&a?new Lo(a.type.itemType,n,a):null}evaluate(e){const i=this.index.evaluate(e),n=this.input.evaluate(e);if(i<0)throw new on(`Array index out of bounds: ${i} < 0.`);if(i>=n.length)throw new on(`Array index out of bounds: ${i} > ${n.length-1}.`);if(i!==Math.floor(i))throw new on(`Array index must be an integer, but found ${i} instead.`);return n[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ui=Lo;class Qh{constructor(e,i){this.type=er,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,Vi),a=i.parse(e[2],2,Vi);return n&&a?li(n.type,[er,Qi,Mt,Aa,Vi])?new Qh(n,a):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(n.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(n==null)return!1;if(!To(i,["boolean","string","number","null"]))throw new on(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(sn(i))} instead.`);if(!To(n,["string","array"]))throw new on(`Expected second argument to be of type array or string, but found ${Wr(sn(n))} instead.`);return n.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var W_=Qh;class pu{constructor(e,i,n){this.type=Mt,this.needle=e,this.haystack=i,this.fromIndex=n}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,Vi),a=i.parse(e[2],2,Vi);if(!n||!a)return null;if(!li(n.type,[er,Qi,Mt,Aa,Vi]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(n.type)} instead`);if(e.length===4){const c=i.parse(e[3],3,Mt);return c?new pu(n,a,c):null}return new pu(n,a)}evaluate(e){const i=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!To(i,["boolean","string","number","null"]))throw new on(`Expected first argument to be of type boolean, string, number or null, but found ${Wr(sn(i))} instead.`);if(!To(n,["string","array"]))throw new on(`Expected second argument to be of type array or string, but found ${Wr(sn(n))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return n.indexOf(i,a)}return n.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var cp=pu;class ed{constructor(e,i,n,a,c,d){this.inputType=e,this.type=i,this.input=n,this.cases=a,this.outputs=c,this.otherwise=d}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let n,a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const c={},d=[];for(let y=2;y<e.length-1;y+=2){let w=e[y];const E=e[y+1];Array.isArray(w)||(w=[w]);const M=i.concat(y);if(w.length===0)return M.error("Expected at least one branch label.");for(const D of w){if(typeof D!="number"&&typeof D!="string")return M.error("Branch labels must be numbers or strings.");if(typeof D=="number"&&Math.abs(D)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof D=="number"&&Math.floor(D)!==D)return M.error("Numeric branch labels must be integer values.");if(n){if(M.checkSubtype(n,sn(D)))return null}else n=sn(D);if(c[String(D)]!==void 0)return M.error("Branch labels must be unique.");c[String(D)]=d.length}const P=i.parse(E,y,a);if(!P)return null;a=a||P.type,d.push(P)}const m=i.parse(e[1],1,Vi);if(!m)return null;const g=i.parse(e[e.length-1],e.length-1,a);return g?m.type.kind!=="value"&&i.concat(1).checkSubtype(n,m.type)?null:new ed(n,a,m,c,d,g):null}evaluate(e){const i=this.input.evaluate(e);return(sn(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),n=[],a={};for(const d of i){const m=a[this.cases[d]];m===void 0?(a[this.cases[d]]=n.length,n.push([this.cases[d],[d]])):n[m][1].push(d)}const c=d=>this.inputType.kind==="number"?Number(d):d;for(const[d,m]of n)e.push(m.length===1?c(m[0]):m.map(c)),e.push(this.outputs[d].serialize());return e.push(this.otherwise.serialize()),e}}var up=ed;class mu{constructor(e,i,n){this.type=e,this.branches=i,this.otherwise=n}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let n;i.expectedType&&i.expectedType.kind!=="value"&&(n=i.expectedType);const a=[];for(let d=1;d<e.length-1;d+=2){const m=i.parse(e[d],d,er);if(!m)return null;const g=i.parse(e[d+1],d+1,n);if(!g)return null;a.push([m,g]),n=n||g.type}const c=i.parse(e[e.length-1],e.length-1,n);return c?new mu(n,a,c):null}evaluate(e){for(const[i,n]of this.branches)if(i.evaluate(e))return n.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,n]of this.branches)e(i),e(n);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var hp=mu;class Xl{constructor(e,i,n,a){this.type=e,this.input=i,this.beginIndex=n,this.endIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const n=i.parse(e[1],1,Vi),a=i.parse(e[2],2,Mt);if(!n||!a)return null;if(!li(n.type,[Wn(Vi),Qi,Vi]))return i.error(`Expected first argument to be of type array or string, but found ${Wr(n.type)} instead`);if(e.length===4){const c=i.parse(e[3],3,Mt);return c?new Xl(n.type,n,a,c):null}return new Xl(n.type,n,a)}evaluate(e){const i=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!To(i,["string","array"]))throw new on(`Expected first argument to be of type array or string, but found ${Wr(sn(i))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return i.slice(n,a)}return i.slice(n)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ga=Xl;function td(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function id(t,e,i,n){return n.compare(e,i)===0}function $a(t,e,i){const n=t!=="=="&&t!=="!=";return class ES{constructor(c,d,m){this.type=er,this.lhs=c,this.rhs=d,this.collator=m,this.hasUntypedArgument=c.type.kind==="value"||d.type.kind==="value"}static parse(c,d){if(c.length!==3&&c.length!==4)return d.error("Expected two or three arguments.");const m=c[0];let g=d.parse(c[1],1,Vi);if(!g)return null;if(!td(m,g.type))return d.concat(1).error(`"${m}" comparisons are not supported for type '${Wr(g.type)}'.`);let y=d.parse(c[2],2,Vi);if(!y)return null;if(!td(m,y.type))return d.concat(2).error(`"${m}" comparisons are not supported for type '${Wr(y.type)}'.`);if(g.type.kind!==y.type.kind&&g.type.kind!=="value"&&y.type.kind!=="value")return d.error(`Cannot compare types '${Wr(g.type)}' and '${Wr(y.type)}'.`);n&&(g.type.kind==="value"&&y.type.kind!=="value"?g=new Js(y.type,[g]):g.type.kind!=="value"&&y.type.kind==="value"&&(y=new Js(g.type,[y])));let w=null;if(c.length===4){if(g.type.kind!=="string"&&y.type.kind!=="string"&&g.type.kind!=="value"&&y.type.kind!=="value")return d.error("Cannot use collator to compare non-string types.");if(w=d.parse(c[3],3,Qc),!w)return null}return new ES(g,y,w)}evaluate(c){const d=this.lhs.evaluate(c),m=this.rhs.evaluate(c);if(n&&this.hasUntypedArgument){const g=sn(d),y=sn(m);if(g.kind!==y.kind||g.kind!=="string"&&g.kind!=="number")throw new on(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${g.kind}, ${y.kind}) instead.`)}if(this.collator&&!n&&this.hasUntypedArgument){const g=sn(d),y=sn(m);if(g.kind!=="string"||y.kind!=="string")return e(c,d,m)}return this.collator?i(c,d,m,this.collator.evaluate(c)):e(c,d,m)}eachChild(c){c(this.lhs),c(this.rhs),this.collator&&c(this.collator)}outputDefined(){return!0}serialize(){const c=[t];return this.eachChild(d=>{c.push(d.serialize())}),c}}}const rd=$a("==",function(t,e,i){return e===i},id),nd=$a("!=",function(t,e,i){return e!==i},function(t,e,i,n){return!id(0,e,i,n)}),X_=$a("<",function(t,e,i){return e<i},function(t,e,i,n){return n.compare(e,i)<0}),K_=$a(">",function(t,e,i){return e>i},function(t,e,i,n){return n.compare(e,i)>0}),dp=$a("<=",function(t,e,i){return e<=i},function(t,e,i,n){return n.compare(e,i)<=0}),Y_=$a(">=",function(t,e,i){return e>=i},function(t,e,i,n){return n.compare(e,i)>=0});class sd{constructor(e,i,n,a,c,d){this.type=Qi,this.number=e,this.locale=i,this.currency=n,this.unit=a,this.minFractionDigits=c,this.maxFractionDigits=d}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const n=i.parse(e[1],1,Mt);if(!n)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return i.error("NumberFormat options argument must be an object.");let c=null;if(a.locale&&(c=i.parse(a.locale,1,Qi),!c))return null;let d=null;if(a.currency&&(d=i.parse(a.currency,1,Qi),!d))return null;let m=null;if(a.unit&&(m=i.parse(a.unit,1,Qi),!m))return null;let g=null;if(a["min-fraction-digits"]&&(g=i.parse(a["min-fraction-digits"],1,Mt),!g))return null;let y=null;return a["max-fraction-digits"]&&(y=i.parse(a["max-fraction-digits"],1,Mt),!y)?null:new sd(n,c,d,m,g,y)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class od{constructor(e){this.type=Mt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const n=i.parse(e[1],1);return n?n.type.kind!=="array"&&n.type.kind!=="string"&&n.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Wr(n.type)} instead.`):new od(n):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new on(`Expected value to be of type string or array, but found ${Wr(sn(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function fp(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const ad={"==":rd,"!=":nd,">":K_,"<":X_,">=":Y_,"<=":dp,array:Js,at:Ui,boolean:Js,case:hp,coalesce:Yh,collator:Fl,format:Ra,image:ta,in:W_,"index-of":cp,interpolate:os,"interpolate-hcl":os,"interpolate-lab":os,length:od,let:Jh,literal:Ys,match:up,number:Js,"number-format":sd,object:Js,slice:Ga,step:Hl,string:Js,"to-boolean":Qs,"to-color":Qs,"to-number":Qs,"to-string":Qs,var:Un,within:iu,distance:au,config:ka};function ld(t,[e,i,n,a]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const c=a?a.evaluate(t):1,d=Kf(e,i,n,c);if(d)throw new on(d);return new Jr(e/255*c,i/255*c,n/255*c,c)}function pp(t,[e,i,n,a]){e=e.evaluate(t),i=i.evaluate(t),n=n.evaluate(t);const c=a?a.evaluate(t):1,d=function(y,w,E,M){return typeof y=="number"&&y>=0&&y<=360?typeof w=="number"&&w>=0&&w<=100&&typeof E=="number"&&E>=0&&E<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[y,w,E,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[y,w,E,M]:[y,w,E]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[y,w,E,M]:[y,w,E]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,n,c);if(d)throw new on(d);const m=`hsla(${e}, ${i}%, ${n}%, ${c})`,g=Jr.parse(m);if(!g)throw new on(`Failed to parse HSLA color: ${m}`);return g}function cd(t,e){return t in e}function ud(t,e){const i=e[t];return i===void 0?null:i}function aa(t){return{type:t}}zi.register(ad,{error:[{kind:"error"},[Qi],(t,[e])=>{throw new on(e.evaluate(t))}],typeof:[Qi,[Vi],(t,[e])=>Wr(sn(e.evaluate(t)))],"to-rgba":[Wn(Mt,4),[hs],(t,[e])=>e.evaluate(t).toArray()],rgb:[hs,[Mt,Mt,Mt],ld],rgba:[hs,[Mt,Mt,Mt,Mt],ld],hsl:[hs,[Mt,Mt,Mt],pp],hsla:[hs,[Mt,Mt,Mt,Mt],pp],has:{type:er,overloads:[[[Qi],(t,[e])=>cd(e.evaluate(t),t.properties())],[[Qi,Ia],(t,[e,i])=>cd(e.evaluate(t),i.evaluate(t))]]},get:{type:Vi,overloads:[[[Qi],(t,[e])=>ud(e.evaluate(t),t.properties())],[[Qi,Ia],(t,[e,i])=>ud(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Vi,[Qi],(t,[e])=>ud(e.evaluate(t),t.featureState||{})],properties:[Ia,[],t=>t.properties()],"geometry-type":[Qi,[],t=>t.geometryType()],id:[Vi,[],t=>t.id()],zoom:[Mt,[],t=>t.globals.zoom],pitch:[Mt,[],t=>t.globals.pitch||0],"distance-from-center":[Mt,[],t=>t.distanceFromCenter()],"measure-light":[Mt,[Qi],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[Mt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Mt,[],t=>t.globals.lineProgress||0],"raster-value":[Mt,[],t=>t.globals.rasterValue||0],"raster-particle-speed":[Mt,[],t=>t.globals.rasterParticleSpeed||0],"sky-radial-progress":[Mt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Vi,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[Mt,aa(Mt),(t,e)=>{let i=0;for(const n of e)i+=n.evaluate(t);return i}],"*":[Mt,aa(Mt),(t,e)=>{let i=1;for(const n of e)i*=n.evaluate(t);return i}],"-":{type:Mt,overloads:[[[Mt,Mt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[Mt],(t,[e])=>-e.evaluate(t)]]},"/":[Mt,[Mt,Mt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[Mt,[Mt,Mt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[Mt,[],()=>Math.LN2],pi:[Mt,[],()=>Math.PI],e:[Mt,[],()=>Math.E],"^":[Mt,[Mt,Mt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[Mt,[Mt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Mt,[Mt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Mt,[Mt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Mt,[Mt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Mt,[Mt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Mt,[Mt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Mt,[Mt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Mt,[Mt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Mt,[Mt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Mt,[Mt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Mt,aa(Mt),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[Mt,aa(Mt),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[Mt,[Mt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Mt,[Mt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[Mt,[Mt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Mt,[Mt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[er,[Qi,Vi],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[er,[Vi],(t,[e])=>t.id()===e.value],"filter-type-==":[er,[Qi],(t,[e])=>t.geometryType()===e.value],"filter-<":[er,[Qi,Vi],(t,[e,i])=>{const n=t.properties()[e.value],a=i.value;return typeof n==typeof a&&n<a}],"filter-id-<":[er,[Vi],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<n}],"filter->":[er,[Qi,Vi],(t,[e,i])=>{const n=t.properties()[e.value],a=i.value;return typeof n==typeof a&&n>a}],"filter-id->":[er,[Vi],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>n}],"filter-<=":[er,[Qi,Vi],(t,[e,i])=>{const n=t.properties()[e.value],a=i.value;return typeof n==typeof a&&n<=a}],"filter-id-<=":[er,[Vi],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i<=n}],"filter->=":[er,[Qi,Vi],(t,[e,i])=>{const n=t.properties()[e.value],a=i.value;return typeof n==typeof a&&n>=a}],"filter-id->=":[er,[Vi],(t,[e])=>{const i=t.id(),n=e.value;return typeof i==typeof n&&i>=n}],"filter-has":[er,[Vi],(t,[e])=>e.value in t.properties()],"filter-has-id":[er,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[er,[Wn(Qi)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[er,[Wn(Vi)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[er,[Qi,Wn(Vi)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[er,[Qi,Wn(Vi)],(t,[e,i])=>function(n,a,c,d){for(;c<=d;){const m=c+d>>1;if(a[m]===n)return!0;a[m]>n?d=m-1:c=m+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:er,overloads:[[[er,er],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[aa(er),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:er,overloads:[[[er,er],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[aa(er),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[er,[er],(t,[e])=>!e.evaluate(t)],"is-supported-script":[er,[Qi],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Qi,[Qi],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Qi,[Qi],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Qi,aa(Vi),(t,e)=>e.map(i=>ds(i.evaluate(t))).join("")],"resolved-locale":[Qi,[Qc],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[Mt,[Mt,Mt,Vi],(t,e)=>{const[i,n,a]=e.map(d=>d.evaluate(t));if(i>n||i===n)return i;let c;if(typeof a=="string")c=function(d){let m=0;if(d.length===0)return m;for(let g=0;g<d.length;g++)m=(m<<5)-m+d.charCodeAt(g),m|=0;return m}(a);else{if(typeof a!="number")throw new on(`Invalid seed input: ${a}`);c=a}return i+fp(c)()*(n-i)}]});var qa=ad;function hd(t){return{result:"success",value:t}}function la(t){return{result:"error",value:t}}function mp(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function _u(t){return t["property-type"]==="data-driven"}function dd(t){return mp(t.expression,"measure-light")}function _p(t){return mp(t.expression,"zoom")}function fd(t){return!!t.expression&&t.expression.interpolated}function gu(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function gp(t){return t}function pd(t,e){const i=e.type==="color",n=t.stops&&typeof t.stops[0][0]=="object",a=n||!(n||t.property!==void 0),c=t.type||(fd(e)?"exponential":"interval");if(i&&((t=wh({},t)).stops&&(t.stops=t.stops.map(y=>[y[0],Jr.parse(y[1])])),t.default=Jr.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Kh[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let d,m,g;if(c==="exponential")d=yp;else if(c==="interval")d=Q_;else if(c==="categorical"){d=J_,m=Object.create(null);for(const y of t.stops)m[y[0]]=y[1];g=typeof t.stops[0][0]}else{if(c!=="identity")throw new Error(`Unknown function type "${c}"`);d=vp}if(n){const y={},w=[];for(let P=0;P<t.stops.length;P++){const D=t.stops[P],O=D[0].zoom;y[O]===void 0&&(y[O]={zoom:O,type:t.type,property:t.property,default:t.default,stops:[]},w.push(O)),y[O].stops.push([D[0].value,D[1]])}const E=[];for(const P of w)E.push([y[P].zoom,pd(y[P],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:os.interpolationFactor.bind(void 0,M),zoomStops:E.map(P=>P[0]),evaluate:({zoom:P},D)=>yp({stops:E,base:t.base},e,P).evaluate(P,D)}}if(a){const y=c==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:y,interpolationFactor:os.interpolationFactor.bind(void 0,y),zoomStops:t.stops.map(w=>w[0]),evaluate:({zoom:w})=>d(t,e,w,m,g)}}return{kind:"source",evaluate(y,w){const E=w&&w.properties?w.properties[t.property]:void 0;return E===void 0?Kl(t.default,e.default):d(t,e,E,m,g)}}}function Kl(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function J_(t,e,i,n,a){return Kl(typeof i===a?n[i]:void 0,t.default,e.default)}function Q_(t,e,i){if(La(i)!=="number")return Kl(t.default,e.default);const n=t.stops.length;if(n===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[n-1][0])return t.stops[n-1][1];const a=oa(t.stops.map(c=>c[0]),i);return t.stops[a][1]}function yp(t,e,i){const n=t.base!==void 0?t.base:1;if(La(i)!=="number")return Kl(t.default,e.default);const a=t.stops.length;if(a===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[a-1][0])return t.stops[a-1][1];const c=oa(t.stops.map(w=>w[0]),i),d=function(w,E,M,P){const D=P-M,O=w-M;return D===0?0:E===1?O/D:(Math.pow(E,O)-1)/(Math.pow(E,D)-1)}(i,n,t.stops[c][0],t.stops[c+1][0]),m=t.stops[c][1],g=t.stops[c+1][1];let y=Jc[e.type]||gp;if(t.colorSpace&&t.colorSpace!=="rgb"){const w=Kh[t.colorSpace];y=(E,M)=>w.reverse(w.interpolate(w.forward(E),w.forward(M),d))}return typeof m.evaluate=="function"?{evaluate(...w){const E=m.evaluate.apply(void 0,w),M=g.evaluate.apply(void 0,w);if(E!==void 0&&M!==void 0)return y(E,M,d)}}:y(m,g,d)}function vp(t,e,i){return e.type==="color"?i=Jr.parse(i):e.type==="formatted"?i=Sn.fromString(i.toString()):e.type==="resolvedImage"?i=Jt.fromString(i.toString()):La(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Kl(i,t.default,e.default)}class yu{constructor(e,i,n,a){this.expression=e,this._warningHistory={},this._evaluator=new Yf(n,a),this._defaultValue=i?function(c){return c.type==="color"&&(gu(c.default)||Array.isArray(c.default))?new Jr(0,0,0,0):c.type==="color"?Jr.parse(c.default)||null:c.default===void 0?null:c.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,n,a,c,d,m,g){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=n,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=d,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=g||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,n,a,c,d,m,g){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=n||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=c||null,this._evaluator.formattedSection=d||null,this._evaluator.featureTileCoord=m||null,this._evaluator.featureDistanceData=g||null;try{const y=this.expression.evaluate(this._evaluator);if(y==null||typeof y=="number"&&y!=y)return this._defaultValue;if(this._enumValues&&!(y in this._enumValues))throw new on(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(y)} instead.`);return y}catch(y){return this._warningHistory[y.message]||(this._warningHistory[y.message]=!0,typeof console<"u"&&console.warn(y.message)),this._defaultValue}}}function Yl(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in qa}function vu(t,e,i,n){const a=new np(qa,[],e?function(d){const m={color:hs,string:Qi,number:Mt,enum:Qi,boolean:er,formatted:Ca,resolvedImage:kl};return d.type==="array"?Wn(m[d.value]||Vi,d.length):m[d.type]}(e):void 0,void 0,void 0,i,n),c=a.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?hd(new yu(c,e,i,n)):la(a.errors)}class md{constructor(e,i,n){this.kind=e,this._styleExpression=i,this.isLightConstant=n,this.isStateDependent=e!=="constant"&&!ql(i.expression),this.isConfigDependent=!Zl(i.expression)}evaluateWithoutErrorHandling(e,i,n,a,c,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,n,a,c,d)}evaluate(e,i,n,a,c,d){return this._styleExpression.evaluate(e,i,n,a,c,d)}}class Jl{constructor(e,i,n,a,c){this.kind=e,this.zoomStops=n,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!ql(i.expression),this.isLightConstant=c,this.isConfigDependent=!Zl(i.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,i,n,a,c,d){return this._styleExpression.evaluateWithoutErrorHandling(e,i,n,a,c,d)}evaluate(e,i,n,a,c,d){return this._styleExpression.evaluate(e,i,n,a,c,d)}interpolationFactor(e,i,n){return this.interpolationType?os.interpolationFactor(this.interpolationType,e,i,n):0}}function xu(t,e,i,n){if((t=vu(t,e,i,n)).result==="error")return t;const a=t.value.expression,c=Ba(a);if(!c&&!_u(e))return la([new js("","data expressions not supported")]);const d=Mn(a,["zoom","pitch","distance-from-center"]);if(!d&&!_p(e))return la([new js("","zoom expressions not supported")]);const m=Mn(a,["measure-light"]);if(!m&&!dd(e))return la([new js("","measure-light expression not supported")]);const g=e.expression&&e.expression.relaxZoomRestriction,y=ec(a);return y||d||g?y instanceof js?la([y]):y instanceof os&&!fd(e)?la([new js("",'"interpolate" expressions cannot be used with this property')]):hd(y?new Jl(c?"camera":"composite",t.value,y.labels,y instanceof os?y.interpolation:void 0,m):new md(c?"constant":"source",t.value,m)):la([new js("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Ql{constructor(e,i){this._parameters=e,this._specification=i,wh(this,pd(this._parameters,this._specification))}static deserialize(e){return new Ql(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ec(t){let e=null;if(t instanceof Jh)e=ec(t.result);else if(t instanceof Yh){for(const i of t.args)if(e=ec(i),e)break}else(t instanceof Hl||t instanceof os)&&t.input instanceof zi&&t.input.name==="zoom"&&(e=t);return e instanceof js||t.eachChild(i=>{const n=ec(i);n instanceof js?e=n:e&&n&&e!==n&&(e=new js("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var eg=Cs,Is=3;function Cs(t,e,i){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],this.d=(e=a[1])+2*(i=a[2]);for(var c=0;c<this.d*this.d;c++){var d=a[Is+c],m=a[Is+c+1];n.push(d===m?null:a.subarray(d,m))}var g=a[Is+n.length+1];this.keys=a.subarray(a[Is+n.length],g),this.bboxes=a.subarray(g),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var y=0;y<this.d*this.d;y++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var w=i/e*t;this.min=-w,this.max=t+w}Cs.prototype.insert=function(t,e,i,n,a){this._forEachCell(e,i,n,a,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(a)},Cs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Cs.prototype._insertCell=function(t,e,i,n,a,c){this.cells[a].push(c)},Cs.prototype.query=function(t,e,i,n,a){var c=this.min,d=this.max;if(t<=c&&e<=c&&d<=i&&d<=n&&!a)return Array.prototype.slice.call(this.keys);var m=[];return this._forEachCell(t,e,i,n,this._queryCell,m,{},a),m},Cs.prototype._queryCell=function(t,e,i,n,a,c,d,m){var g=this.cells[a];if(g!==null)for(var y=this.keys,w=this.bboxes,E=0;E<g.length;E++){var M=g[E];if(d[M]===void 0){var P=4*M;(m?m(w[P+0],w[P+1],w[P+2],w[P+3]):t<=w[P+2]&&e<=w[P+3]&&i>=w[P+0]&&n>=w[P+1])?(d[M]=!0,c.push(y[M])):d[M]=!1}}},Cs.prototype._forEachCell=function(t,e,i,n,a,c,d,m){for(var g=this._convertToCellCoord(t),y=this._convertToCellCoord(e),w=this._convertToCellCoord(i),E=this._convertToCellCoord(n),M=g;M<=w;M++)for(var P=y;P<=E;P++){var D=this.d*P+M;if((!m||m(this._convertFromCellCoord(M),this._convertFromCellCoord(P),this._convertFromCellCoord(M+1),this._convertFromCellCoord(P+1)))&&a.call(this,t,e,i,n,D,c,d,m))return}},Cs.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Cs.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Cs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Is+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var a=new Int32Array(e+i+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var c=e,d=0;d<t.length;d++){var m=t[d];a[Is+d]=c,a.set(m,c),c+=m.length}return a[Is+t.length]=c,a.set(this.keys,c),a[Is+t.length+1]=c+=this.keys.length,a.set(this.bboxes,c),c+=this.bboxes.length,a.buffer};var to=Xe(eg);const tc={};function Ct(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),tc[e]={klass:t,omit:i.omit||[]}}Ct(Object,"Object"),to.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.add(i),{buffer:i}},to.deserialize=function(t){return new to(t.buffer)},Object.defineProperty(to,"name",{value:"Grid"}),Ct(to,"Grid"),Ct(Jr,"Color"),Ct(Error,"Error"),Ct(Sn,"Formatted"),Ct(Pa,"FormattedSection"),Ct(rn,"AJAXError"),Ct(Jt,"ResolvedImage"),Ct(Ql,"StylePropertyFunction"),Ct(yu,"StyleExpression",{omit:["_evaluator"]}),Ct(Jl,"ZoomDependentExpression"),Ct(md,"ZoomConstantExpression"),Ct(zi,"CompoundExpression",{omit:["_evaluate"]});for(const t in qa)tc[qa[t]._classRegistryKey]||Ct(qa[t],`Expression${t}`);function xp(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function bu(t){return self.ImageBitmap&&t instanceof ImageBitmap}function Do(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(xp(t)||bu(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.add(i.buffer),i}if(t instanceof ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const n of t)i.push(Do(n,e));return i}if(t instanceof Map){const i={$name:"Map"};for(const[n,a]of t.entries())i[n]=Do(a);return i}if(typeof t=="object"){const i=t.constructor,n=i._classRegistryKey;if(!n)throw new Error(`can't serialize object of unregistered class ${n}`);const a=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const c in t)t.hasOwnProperty(c)&&(tc[n].omit.indexOf(c)>=0||(a[c]=Do(t[c],e)));t instanceof Error&&(a.message=t.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(a.$name=n),a}throw new Error("can't serialize object of type "+typeof t)}function ca(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||xp(t)||bu(t)||ArrayBuffer.isView(t)||t instanceof ImageData)return t;if(Array.isArray(t))return t.map(ca);if(typeof t=="object"){const e=t.$name||"Object";if(e==="Map"){const a=new Map;for(const c of Object.keys(t))c!=="$name"&&a.set(c,ca(t[c]));return a}const{klass:i}=tc[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const n=Object.create(i.prototype);for(const a of Object.keys(t))a!=="$name"&&(n[a]=ca(t[a]));return n}throw new Error("can't deserialize object of type "+typeof t)}const zt={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function Oo(t){for(const e of t)if(_d(e.charCodeAt(0)))return!0;return!1}function tg(t){for(const e of t)if(!ig(e.charCodeAt(0)))return!1;return!0}function ig(t){return!(zt.Arabic(t)||zt["Arabic Supplement"](t)||zt["Arabic Extended-A"](t)||zt["Arabic Presentation Forms-A"](t)||zt["Arabic Presentation Forms-B"](t))}function _d(t){return!(t!==746&&t!==747&&(t<4352||!(zt["Bopomofo Extended"](t)||zt.Bopomofo(t)||zt["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||zt["CJK Compatibility Ideographs"](t)||zt["CJK Compatibility"](t)||zt["CJK Radicals Supplement"](t)||zt["CJK Strokes"](t)||!(!zt["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||zt["CJK Unified Ideographs Extension A"](t)||zt["CJK Unified Ideographs"](t)||zt["Enclosed CJK Letters and Months"](t)||zt["Hangul Compatibility Jamo"](t)||zt["Hangul Jamo Extended-A"](t)||zt["Hangul Jamo Extended-B"](t)||zt["Hangul Jamo"](t)||zt["Hangul Syllables"](t)||zt.Hiragana(t)||zt["Ideographic Description Characters"](t)||zt.Kanbun(t)||zt["Kangxi Radicals"](t)||zt["Katakana Phonetic Extensions"](t)||zt.Katakana(t)&&t!==12540||!(!zt["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!zt["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||zt["Unified Canadian Aboriginal Syllabics"](t)||zt["Unified Canadian Aboriginal Syllabics Extended"](t)||zt["Vertical Forms"](t)||zt["Yijing Hexagram Symbols"](t)||zt["Yi Syllables"](t)||zt["Yi Radicals"](t))))}function bp(t){return!(_d(t)||function(e){return!!(zt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||zt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||zt["Letterlike Symbols"](e)||zt["Number Forms"](e)||zt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||zt["Control Pictures"](e)&&e!==9251||zt["Optical Character Recognition"](e)||zt["Enclosed Alphanumerics"](e)||zt["Geometric Shapes"](e)||zt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||zt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||zt["CJK Symbols and Punctuation"](e)||zt.Katakana(e)||zt["Private Use Area"](e)||zt["CJK Compatibility Forms"](e)||zt["Small Form Variants"](e)||zt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function wp(t){return t>=1424&&t<=2303||zt["Arabic Presentation Forms-A"](t)||zt["Arabic Presentation Forms-B"](t)}function Tp(t,e){return!(!e&&wp(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||zt.Khmer(t))}function gd(t){for(const e of t)if(wp(e.charCodeAt(0)))return!0;return!1}const yd="deferred",vd="loading",xd="loaded";let bd=null,Xn="unavailable",zo=null;const Ep=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Xn="error"),bd&&bd(t)};function wd(){Td.fire(new Jo("pluginStateChange",{pluginStatus:Xn,pluginURL:zo}))}const Td=new Ma,ko=function(){return Xn},Ed=function(){if(Xn!==yd||!zo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Xn=vd,wd(),zo&&Ve({url:zo},t=>{t?Ep(t):(Xn=xd,wd())})},as={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Xn===xd||as.applyArabicShaping!=null,isLoading:()=>Xn===vd,setState(t){Xn=t.pluginStatus,zo=t.pluginURL},isParsed:()=>as.applyArabicShaping!=null&&as.processBidirectionalText!=null&&as.processStyledBidirectionalText!=null,getPluginURL:()=>zo};class Or{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,n){for(const a of i)if(!Tp(a.charCodeAt(0),n))return!1;return!0}(e,as.isLoaded())}}class wu{constructor(e,i,n,a){this.property=e,this.value=i,this.expression=function(c,d,m,g){if(gu(c))return new Ql(c,d);if(Yl(c)||Array.isArray(c)&&c.length>0){const y=xu(c,d,m,g);if(y.result==="error")throw new Error(y.value.map(w=>`${w.key}: ${w.message}`).join(", "));return y.value}{let y=c;return typeof c=="string"&&d.type==="color"&&(y=Jr.parse(c)),{kind:"constant",isConfigDependent:!1,evaluate:()=>y}}}(i===void 0?e.specification.default:i,e.specification,n,a)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,n){return this.property.possiblyEvaluate(this,e,i,n)}}class Sd{constructor(e,i,n){this.property=e,this.value=new wu(e,void 0,i,n)}transitioned(e,i){return new Md(this.property,this.value,i,gr({},e.transition,this.transition),e.now)}untransitioned(){return new Md(this.property,this.value,null,{},0)}}class io{constructor(e,i,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=n,this.isConfigDependent=!1}getValue(e){return sr(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Sd(this._values[e].property,this._scope,this._options)),this._values[e].value=new wu(this._values[e].property,i===null?void 0:sr(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,i){i&&(this._options=i);const n=this._properties.properties;if(e)for(const a in e){const c=e[a];if(Gt(a,"-transition")){const d=a.slice(0,-11);n[d]&&this.setTransition(d,c)}else n[a]&&this.setValue(a,c)}}getTransition(e){return sr(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Sd(this._values[e].property)),this._values[e].transition=sr(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const n=this.getValue(i);n!==void 0&&(e[i]=n);const a=this.getTransition(i);a!==void 0&&(e[`${i}-transition`]=a)}return e}transitioned(e,i){const n=new ua(this._properties);for(const a of Object.keys(this._values))n._values[a]=this._values[a].transitioned(e,i._values[a]);return n}untransitioned(){const e=new ua(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Md{constructor(e,i,n,a,c){const d=a.delay||0,m=a.duration||0;c=c||0,this.property=e,this.value=i,this.begin=c+d,this.end=this.begin+m,e.specification.transition&&(a.delay||a.duration)&&(this.prior=n)}possiblyEvaluate(e,i,n){const a=e.now||0,c=this.value.possiblyEvaluate(e,i,n),d=this.prior;if(d){if(a>this.end)return this.prior=null,c;if(this.value.isDataDriven())return this.prior=null,c;if(a<this.begin)return d.possiblyEvaluate(e,i,n);{const m=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(d.possiblyEvaluate(e,i,n),c,tt(m))}}return c}}class ua{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,n){const a=new ic(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(e,i,n);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class rg{constructor(e,i,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=n,this.isConfigDependent=!1}getValue(e){return sr(this._values[e].value)}setValue(e,i){this._values[e]=new wu(this._values[e].property,i===null?void 0:sr(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const i of Object.keys(this._values)){const n=this.getValue(i);n!==void 0&&(e[i]=n)}return e}possiblyEvaluate(e,i,n){const a=new ic(this._properties);for(const c of Object.keys(this._values))a._values[c]=this._values[c].possiblyEvaluate(e,i,n);return a}}class Za{constructor(e,i,n){this.property=e,this.value=i,this.parameters=n}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,n,a){return this.property.evaluate(this.value,this.parameters,e,i,n,a)}}class ic{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class at{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,n){const a=Jc[this.specification.type];return a?a(e,i,n):e}}class Wt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,n,a){return new Za(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},n,a)}:e.expression,i)}interpolate(e,i,n){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Za(this,{kind:"constant",value:void 0},e.parameters);const a=Jc[this.specification.type];return a?new Za(this,{kind:"constant",value:a(e.value.value,i.value.value,n)},e.parameters):e}evaluate(e,i,n,a,c,d){return e.kind==="constant"?e.value:e.evaluate(i,n,a,c,d)}}class ha{constructor(e){this.specification=e}possiblyEvaluate(e,i,n,a){return!!e.expression.evaluate(i,null,{},n,a)}interpolate(){return!1}}class zr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Or(0,{});for(const n in e){const a=e[n];a.specification.overridable&&this.overridableProperties.push(n);const c=this.defaultPropertyValues[n]=new wu(a,void 0),d=this.defaultTransitionablePropertyValues[n]=new Sd(a);this.defaultTransitioningPropertyValues[n]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=c.possiblyEvaluate(i)}}}function rc(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function nc(t){if(Array.isArray(t))return t.map(nc);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=nc(t[i]);return e}return rc(t)}Ct(Wt,"DataDrivenProperty"),Ct(at,"DataConstantProperty"),Ct(ha,"ColorRampProperty");var Te=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ad(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Ad(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function ls(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Ad(t)||(t=sc(t));const i=t;let n=!0;try{n=function(y){if(!Ha(y))return y;let w=nc(y);return Id(w),w=Sp(w),w}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
-This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
-and paste the contents of this message in the report.
-Thank you!
-Filter Expression:
-${JSON.stringify(i,null,2)}
-        `)}const a=Te[`filter_${e}`],c=vu(n,a);let d=null;if(c.result==="error")throw new Error(c.value.map(y=>`${y.key}: ${y.message}`).join(", "));d=(y,w,E)=>c.value.evaluate(y,w,{},E);let m=null,g=null;if(n!==i){const y=vu(i,a);if(y.result==="error")throw new Error(y.value.map(w=>`${w.key}: ${w.message}`).join(", "));m=(w,E,M,P,D)=>y.value.evaluate(w,E,{},M,void 0,void 0,P,D),g=!Ba(y.value.expression)}return{filter:d,dynamicFilter:m||void 0,needGeometry:Mp(n),needFeature:!!g}}function Sp(t){if(!Array.isArray(t))return t;const e=function(i){if(ng.has(i[0])){for(let n=1;n<i.length;n++)if(Ha(i[n]))return!0}return i}(t);return e===!0?e:e.map(i=>Sp(i))}function Id(t){let e=!1;const i=[];if(t[0]==="case"){for(let n=1;n<t.length-1;n+=2)e=e||Ha(t[n]),i.push(t[n+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||Ha(t[1]);for(let n=2;n<t.length-1;n+=2)i.push(t[n+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||Ha(t[1]);for(let n=1;n<t.length-1;n+=2)i.push(t[n+1])}e&&(t.length=0,t.push("any",...i));for(let n=1;n<t.length;n++)Id(t[n])}function Ha(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(Ha(t[i]))return!0;return!1}const ng=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function sg(t,e){return t<e?-1:t>e?1:0}function Mp(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(Mp(t[e]))return!0;return!1}function sc(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?oc(t[1],t[2],"=="):e==="!="?ac(oc(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?oc(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(sc))):e==="all"?["all"].concat(t.slice(1).map(sc)):e==="none"?["all"].concat(t.slice(1).map(sc).map(ac)):e==="in"?Cd(t[1],t.slice(2)):e==="!in"?ac(Cd(t[1],t.slice(2))):e==="has"?Ap(t[1]):e!=="!has"||ac(Ap(t[1]));var i}function oc(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Cd(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(sg)]]:["filter-in-small",t,["literal",e]]}}function Ap(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function ac(t){return["!",t]}const Tu="";function Pd(t,e){return e?`${t}${Tu}${e}`:t}const lc="-transition";class Kn extends Ma{constructor(e,i,n,a){if(super(),this.id=e.id,this.fqid=Pd(this.id,n),this.type=e.type,this.scope=n,this.options=a,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new rg(i.layout,this.scope,a),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new io(i.paint,this.scope,a);for(const c in e.paint)this.setPaintProperty(c,e.paint[c]);for(const c in e.layout)this.setLayoutProperty(c,e.layout[c]);this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ic(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const n=this._unevaluatedLayout;n._properties.properties[e]&&(n.setValue(e,i),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Gt(e,lc)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const n=this._transitionablePaint,a=n._properties.properties;if(Gt(e,lc)){const E=e.slice(0,-11);return a[E]&&n.setTransition(E,i||void 0),!1}if(!a[e])return!1;const c=n._values[e],d=c.value.isDataDriven(),m=c.value;n.setValue(e,i),this.isConfigDependent=this.isConfigDependent||n.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const g=n._values[e].value,y=g.isDataDriven(),w=Gt(e,"pattern")||e==="line-dasharray";return y||d||w||this._handleOverridablePaintPropertyUpdate(e,m,g)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i){return null}_handleOverridablePaintPropertyUpdate(e,i,n){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Xi({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Za&&_u(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ls(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}}const og={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Eu{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ar{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function nr(t,e=1){let i=0,n=0;return{members:t.map(a=>{const c=og[a.type].BYTES_PER_ELEMENT,d=i=cc(i,Math.max(e,c)),m=a.components||1;return n=Math.max(n,c),i+=c*m,{name:a.name,type:a.type,components:m,offset:d}}),size:cc(i,Math.max(n,e)),alignment:e}}function cc(t,e){return Math.ceil(t/e)*e}class Ps extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,i)}emplace(e,i,n){const a=2*e;return this.int16[a+0]=i,this.int16[a+1]=n,e}}Ps.prototype.bytesPerElement=4,Ct(Ps,"StructArrayLayout2i4");class jn extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,n)}emplace(e,i,n,a){const c=3*e;return this.int16[c+0]=i,this.int16[c+1]=n,this.int16[c+2]=a,e}}jn.prototype.bytesPerElement=6,Ct(jn,"StructArrayLayout3i6");class ro extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,n,a)}emplace(e,i,n,a,c){const d=4*e;return this.int16[d+0]=i,this.int16[d+1]=n,this.int16[d+2]=a,this.int16[d+3]=c,e}}ro.prototype.bytesPerElement=8,Ct(ro,"StructArrayLayout4i8");class Rd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,n,a,c)}emplace(e,i,n,a,c,d){const m=5*e;return this.int16[m+0]=i,this.int16[m+1]=n,this.int16[m+2]=a,this.int16[m+3]=c,this.int16[m+4]=d,e}}Rd.prototype.bytesPerElement=10,Ct(Rd,"StructArrayLayout5i10");class Ld extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,d,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,n,a,c,d,m)}emplace(e,i,n,a,c,d,m,g){const y=6*e,w=12*e,E=3*e;return this.int16[y+0]=i,this.int16[y+1]=n,this.uint8[w+4]=a,this.uint8[w+5]=c,this.uint8[w+6]=d,this.uint8[w+7]=m,this.float32[E+2]=g,e}}Ld.prototype.bytesPerElement=12,Ct(Ld,"StructArrayLayout2i4ub1f12");class Bo extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,n,a)}emplace(e,i,n,a,c){const d=4*e;return this.float32[d+0]=i,this.float32[d+1]=n,this.float32[d+2]=a,this.float32[d+3]=c,e}}Bo.prototype.bytesPerElement=16,Ct(Bo,"StructArrayLayout4f16");class Fo extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,n,a,c)}emplace(e,i,n,a,c,d){const m=6*e,g=3*e;return this.uint16[m+0]=i,this.uint16[m+1]=n,this.uint16[m+2]=a,this.uint16[m+3]=c,this.float32[g+2]=d,e}}Fo.prototype.bytesPerElement=12,Ct(Fo,"StructArrayLayout4ui1f12");class Wa extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,n,a)}emplace(e,i,n,a,c){const d=4*e;return this.uint16[d+0]=i,this.uint16[d+1]=n,this.uint16[d+2]=a,this.uint16[d+3]=c,e}}Wa.prototype.bytesPerElement=8,Ct(Wa,"StructArrayLayout4ui8");class Su extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,n,a,c,d)}emplace(e,i,n,a,c,d,m){const g=6*e;return this.int16[g+0]=i,this.int16[g+1]=n,this.int16[g+2]=a,this.int16[g+3]=c,this.int16[g+4]=d,this.int16[g+5]=m,e}}Su.prototype.bytesPerElement=12,Ct(Su,"StructArrayLayout6i12");class uc extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,d,m,g,y,w,E,M){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,n,a,c,d,m,g,y,w,E,M)}emplace(e,i,n,a,c,d,m,g,y,w,E,M,P){const D=12*e;return this.int16[D+0]=i,this.int16[D+1]=n,this.int16[D+2]=a,this.int16[D+3]=c,this.uint16[D+4]=d,this.uint16[D+5]=m,this.uint16[D+6]=g,this.uint16[D+7]=y,this.int16[D+8]=w,this.int16[D+9]=E,this.int16[D+10]=M,this.int16[D+11]=P,e}}uc.prototype.bytesPerElement=24,Ct(uc,"StructArrayLayout4i4ui4i24");class Dd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,n,a,c,d)}emplace(e,i,n,a,c,d,m){const g=10*e,y=5*e;return this.int16[g+0]=i,this.int16[g+1]=n,this.int16[g+2]=a,this.float32[y+2]=c,this.float32[y+3]=d,this.float32[y+4]=m,e}}Dd.prototype.bytesPerElement=20,Ct(Dd,"StructArrayLayout3i3f20");class Od extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Od.prototype.bytesPerElement=4,Ct(Od,"StructArrayLayout1ul4");class Gs extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,i)}emplace(e,i,n){const a=2*e;return this.uint16[a+0]=i,this.uint16[a+1]=n,e}}Gs.prototype.bytesPerElement=4,Ct(Gs,"StructArrayLayout2ui4");class zd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,d,m,g,y,w,E,M,P){const D=this.length;return this.resize(D+1),this.emplace(D,e,i,n,a,c,d,m,g,y,w,E,M,P)}emplace(e,i,n,a,c,d,m,g,y,w,E,M,P,D){const O=20*e,F=10*e;return this.int16[O+0]=i,this.int16[O+1]=n,this.int16[O+2]=a,this.int16[O+3]=c,this.int16[O+4]=d,this.float32[F+3]=m,this.float32[F+4]=g,this.float32[F+5]=y,this.float32[F+6]=w,this.int16[O+14]=E,this.uint32[F+8]=M,this.uint16[O+18]=P,this.uint16[O+19]=D,e}}zd.prototype.bytesPerElement=40,Ct(zd,"StructArrayLayout5i4f1i1ul2ui40");class hc extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,d,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,n,a,c,d,m)}emplace(e,i,n,a,c,d,m,g){const y=8*e;return this.int16[y+0]=i,this.int16[y+1]=n,this.int16[y+2]=a,this.int16[y+4]=c,this.int16[y+5]=d,this.int16[y+6]=m,this.int16[y+7]=g,e}}hc.prototype.bytesPerElement=16,Ct(hc,"StructArrayLayout3i2i2i16");class Mu extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,n,a,c)}emplace(e,i,n,a,c,d){const m=4*e,g=8*e;return this.float32[m+0]=i,this.float32[m+1]=n,this.float32[m+2]=a,this.int16[g+6]=c,this.int16[g+7]=d,e}}Mu.prototype.bytesPerElement=16,Ct(Mu,"StructArrayLayout2f1f2i16");class kd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,n,a)}emplace(e,i,n,a,c){const d=12*e,m=3*e;return this.uint8[d+0]=i,this.uint8[d+1]=n,this.float32[m+1]=a,this.float32[m+2]=c,e}}kd.prototype.bytesPerElement=12,Ct(kd,"StructArrayLayout2ub2f12");class dn extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,n)}emplace(e,i,n,a){const c=3*e;return this.uint16[c+0]=i,this.uint16[c+1]=n,this.uint16[c+2]=a,e}}dn.prototype.bytesPerElement=6,Ct(dn,"StructArrayLayout3ui6");class Xa extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,d,m,g,y,w,E,M,P,D,O,F,V,W,Q,J,oe){const se=this.length;return this.resize(se+1),this.emplace(se,e,i,n,a,c,d,m,g,y,w,E,M,P,D,O,F,V,W,Q,J,oe)}emplace(e,i,n,a,c,d,m,g,y,w,E,M,P,D,O,F,V,W,Q,J,oe,se){const he=30*e,ge=15*e,xe=60*e;return this.int16[he+0]=i,this.int16[he+1]=n,this.int16[he+2]=a,this.float32[ge+2]=c,this.float32[ge+3]=d,this.uint16[he+8]=m,this.uint16[he+9]=g,this.uint32[ge+5]=y,this.uint32[ge+6]=w,this.uint32[ge+7]=E,this.uint16[he+16]=M,this.uint16[he+17]=P,this.uint16[he+18]=D,this.float32[ge+10]=O,this.float32[ge+11]=F,this.uint8[xe+48]=V,this.uint8[xe+49]=W,this.uint8[xe+50]=Q,this.uint32[ge+13]=J,this.int16[he+28]=oe,this.uint8[xe+58]=se,e}}Xa.prototype.bytesPerElement=60,Ct(Xa,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Au extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,d,m,g,y,w,E,M,P,D,O,F,V,W,Q,J,oe,se,he,ge,xe,Ae,be,ze,qe,De,Ge,Pe){const je=this.length;return this.resize(je+1),this.emplace(je,e,i,n,a,c,d,m,g,y,w,E,M,P,D,O,F,V,W,Q,J,oe,se,he,ge,xe,Ae,be,ze,qe,De,Ge,Pe)}emplace(e,i,n,a,c,d,m,g,y,w,E,M,P,D,O,F,V,W,Q,J,oe,se,he,ge,xe,Ae,be,ze,qe,De,Ge,Pe,je){const ut=20*e,Ze=40*e,Lt=80*e;return this.float32[ut+0]=i,this.float32[ut+1]=n,this.int16[Ze+4]=a,this.int16[Ze+5]=c,this.int16[Ze+6]=d,this.int16[Ze+7]=m,this.int16[Ze+8]=g,this.int16[Ze+9]=y,this.int16[Ze+10]=w,this.int16[Ze+11]=E,this.int16[Ze+12]=M,this.uint16[Ze+13]=P,this.uint16[Ze+14]=D,this.uint16[Ze+15]=O,this.uint16[Ze+16]=F,this.uint16[Ze+17]=V,this.uint16[Ze+18]=W,this.uint16[Ze+19]=Q,this.uint16[Ze+20]=J,this.uint16[Ze+21]=oe,this.uint16[Ze+22]=se,this.uint16[Ze+23]=he,this.uint16[Ze+24]=ge,this.uint16[Ze+25]=xe,this.uint16[Ze+26]=Ae,this.uint16[Ze+27]=be,this.uint32[ut+14]=ze,this.float32[ut+15]=qe,this.float32[ut+16]=De,this.float32[ut+17]=Ge,this.float32[ut+18]=Pe,this.uint8[Lt+76]=je,e}}Au.prototype.bytesPerElement=80,Ct(Au,"StructArrayLayout2f9i15ui1ul4f1ub80");class dc extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}dc.prototype.bytesPerElement=4,Ct(dc,"StructArrayLayout1f4");class No extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,n,a,c)}emplace(e,i,n,a,c,d){const m=5*e;return this.float32[m+0]=i,this.float32[m+1]=n,this.float32[m+2]=a,this.float32[m+3]=c,this.float32[m+4]=d,e}}No.prototype.bytesPerElement=20,Ct(No,"StructArrayLayout5f20");class Bd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,d,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,n,a,c,d,m)}emplace(e,i,n,a,c,d,m,g){const y=7*e;return this.float32[y+0]=i,this.float32[y+1]=n,this.float32[y+2]=a,this.float32[y+3]=c,this.float32[y+4]=d,this.float32[y+5]=m,this.float32[y+6]=g,e}}Bd.prototype.bytesPerElement=28,Ct(Bd,"StructArrayLayout7f28");class fc extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,n,a){const c=this.length;return this.resize(c+1),this.emplace(c,e,i,n,a)}emplace(e,i,n,a,c){const d=6*e;return this.uint32[3*e+0]=i,this.uint16[d+2]=n,this.uint16[d+3]=a,this.uint16[d+4]=c,e}}fc.prototype.bytesPerElement=12,Ct(fc,"StructArrayLayout1ul3ui12");class Fd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Fd.prototype.bytesPerElement=2,Ct(Fd,"StructArrayLayout1ui2");class da extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,n)}emplace(e,i,n,a){const c=3*e;return this.float32[c+0]=i,this.float32[c+1]=n,this.float32[c+2]=a,e}}da.prototype.bytesPerElement=12,Ct(da,"StructArrayLayout3f12");class pc extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const n=this.length;return this.resize(n+1),this.emplace(n,e,i)}emplace(e,i,n){const a=2*e;return this.float32[a+0]=i,this.float32[a+1]=n,e}}pc.prototype.bytesPerElement=8,Ct(pc,"StructArrayLayout2f8");class Nd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,d,m,g,y,w,E,M,P,D,O,F){const V=this.length;return this.resize(V+1),this.emplace(V,e,i,n,a,c,d,m,g,y,w,E,M,P,D,O,F)}emplace(e,i,n,a,c,d,m,g,y,w,E,M,P,D,O,F,V){const W=16*e;return this.float32[W+0]=i,this.float32[W+1]=n,this.float32[W+2]=a,this.float32[W+3]=c,this.float32[W+4]=d,this.float32[W+5]=m,this.float32[W+6]=g,this.float32[W+7]=y,this.float32[W+8]=w,this.float32[W+9]=E,this.float32[W+10]=M,this.float32[W+11]=P,this.float32[W+12]=D,this.float32[W+13]=O,this.float32[W+14]=F,this.float32[W+15]=V,e}}Nd.prototype.bytesPerElement=64,Ct(Nd,"StructArrayLayout16f64");class mc extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,n,a,c,d,m){const g=this.length;return this.resize(g+1),this.emplace(g,e,i,n,a,c,d,m)}emplace(e,i,n,a,c,d,m,g){const y=10*e,w=5*e;return this.uint16[y+0]=i,this.uint16[y+1]=n,this.uint16[y+2]=a,this.uint16[y+3]=c,this.float32[w+2]=d,this.float32[w+3]=m,this.float32[w+4]=g,e}}mc.prototype.bytesPerElement=20,Ct(mc,"StructArrayLayout4ui3f20");class Vd extends Ar{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Vd.prototype.bytesPerElement=1,Ct(Vd,"StructArrayLayout1ub1");class Ip extends Eu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ip.prototype.size=40;class Cp extends zd{get(e){return new Ip(this,e)}}Ct(Cp,"CollisionBoxArray");class Pp extends Eu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Pp.prototype.size=60;class Rp extends Xa{get(e){return new Pp(this,e)}}Ct(Rp,"PlacedSymbolArray");class Lp extends Eu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}Lp.prototype.size=80;class Dp extends Au{get(e){return new Lp(this,e)}}Ct(Dp,"SymbolInstanceArray");class Op extends dc{getoffsetX(e){return this.float32[1*e+0]}}Ct(Op,"GlyphOffsetArray");class _c extends Ps{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ct(_c,"SymbolLineVertexArray");class zp extends Eu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}zp.prototype.size=12;class kp extends fc{get(e){return new zp(this,e)}}Ct(kp,"FeatureIndexArray");class gc extends Gs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ct(gc,"FillExtrusionCentroidArray");const ag=nr([{name:"a_pos",components:2,type:"Int16"}],4),Bp=nr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class $r{constructor(e=[]){this.segments=e}_prepareSegment(e,i,n,a){let c=this.segments[this.segments.length-1];return e>$r.MAX_VERTEX_ARRAY_LENGTH&&_e(`Max vertices per segment is ${$r.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!c||c.vertexLength+e>$r.MAX_VERTEX_ARRAY_LENGTH||c.sortKey!==a)&&(c={vertexOffset:i,primitiveOffset:n,vertexLength:0,primitiveLength:0},a!==void 0&&(c.sortKey=a),this.segments.push(c)),c}prepareSegment(e,i,n,a){return this._prepareSegment(e,i.length,n.length,a)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,n,a){return new $r([{vertexOffset:e,primitiveOffset:i,vertexLength:n,primitiveLength:a,vaos:{},sortKey:0}])}}function Ud(t,e){return 256*(t=Nt(Math.floor(t),0,255))+Nt(Math.floor(e),0,255)}$r.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ct($r,"SegmentVector");const Fp=nr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Np=nr([{name:"a_dash",components:4,type:"Uint16"}]);var yc={exports:{}},Iu={exports:{}};(function(t){t.exports=function(e,i){var n,a,c,d,m,g,y,w;for(a=e.length-(n=3&e.length),c=i,m=3432918353,g=461845907,w=0;w<a;)y=255&e.charCodeAt(w)|(255&e.charCodeAt(++w))<<8|(255&e.charCodeAt(++w))<<16|(255&e.charCodeAt(++w))<<24,++w,c=27492+(65535&(d=5*(65535&(c=(c^=y=(65535&(y=(y=(65535&y)*m+(((y>>>16)*m&65535)<<16)&4294967295)<<15|y>>>17))*g+(((y>>>16)*g&65535)<<16)&4294967295)<<13|c>>>19))+((5*(c>>>16)&65535)<<16)&4294967295))+((58964+(d>>>16)&65535)<<16);switch(y=0,n){case 3:y^=(255&e.charCodeAt(w+2))<<16;case 2:y^=(255&e.charCodeAt(w+1))<<8;case 1:c^=y=(65535&(y=(y=(65535&(y^=255&e.charCodeAt(w)))*m+(((y>>>16)*m&65535)<<16)&4294967295)<<15|y>>>17))*g+(((y>>>16)*g&65535)<<16)&4294967295}return c^=e.length,c=2246822507*(65535&(c^=c>>>16))+((2246822507*(c>>>16)&65535)<<16)&4294967295,c=3266489909*(65535&(c^=c>>>13))+((3266489909*(c>>>16)&65535)<<16)&4294967295,(c^=c>>>16)>>>0}})(Iu);var jd=Iu.exports,Vp={exports:{}};(function(t){t.exports=function(e,i){for(var n,a=e.length,c=i^a,d=0;a>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(d)|(255&e.charCodeAt(++d))<<8|(255&e.charCodeAt(++d))<<16|(255&e.charCodeAt(++d))<<24))+((1540483477*(n>>>16)&65535)<<16),c=1540483477*(65535&c)+((1540483477*(c>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),a-=4,++d;switch(a){case 3:c^=(255&e.charCodeAt(d+2))<<16;case 2:c^=(255&e.charCodeAt(d+1))<<8;case 1:c=1540483477*(65535&(c^=255&e.charCodeAt(d)))+((1540483477*(c>>>16)&65535)<<16)}return c=1540483477*(65535&(c^=c>>>13))+((1540483477*(c>>>16)&65535)<<16),(c^=c>>>15)>>>0}})(Vp);var Up=jd,jp=Vp.exports;yc.exports=Up,yc.exports.murmur3=Up,yc.exports.murmur2=jp;var Gd=Xe(yc.exports);class vc{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,n,a){this.ids.push(Gp(e)),this.positions.push(i,n,a)}eachPosition(e,i){const n=Gp(e);let a=0,c=this.ids.length-1;for(;a<c;){const d=a+c>>1;this.ids[d]>=n?c=d:a=d+1}for(;this.ids[a]===n;)i(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,i){const n=new Float64Array(e.ids),a=new Uint32Array(e.positions);return $d(n,a,0,n.length-1),i&&(i.add(n.buffer),i.add(a.buffer)),{ids:n,positions:a}}static deserialize(e){const i=new vc;let n;i.ids=e.ids,i.positions=e.positions;for(const a of i.ids)a!==n&&i.uniqueIds.push(a),n=a;return i.indexed=!0,i}}function Gp(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Gd(String(t))}function $d(t,e,i,n){for(;i<n;){const a=t[i+n>>1];let c=i-1,d=n+1;for(;;){do c++;while(t[c]<a);do d--;while(t[d]>a);if(c>=d)break;Cu(t,c,d),Cu(e,3*c,3*d),Cu(e,3*c+1,3*d+1),Cu(e,3*c+2,3*d+2)}d-i<n-d?($d(t,e,i,d),i=d+1):($d(t,e,d+1,n),n=d)}}function Cu(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}Ct(vc,"FeaturePositionMap");class no{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class Pu extends no{constructor(e){super(e),this.current=0}set(e,i,n){this.fetchUniformLocation(e,i)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}}class zn extends no{constructor(e){super(e),this.current=0}set(e,i,n){this.fetchUniformLocation(e,i)&&this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class Vo extends no{constructor(e){super(e),this.current=[0,0]}set(e,i,n){this.fetchUniformLocation(e,i)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}}class $p extends no{constructor(e){super(e),this.current=[0,0,0]}set(e,i,n){this.fetchUniformLocation(e,i)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}}class u extends no{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,n){this.fetchUniformLocation(e,i)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3])))}}class r extends no{constructor(e){super(e),this.current=Jr.transparent}set(e,i,n){this.fetchUniformLocation(e,i)&&(n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a)))}}const s=new Float32Array(16);class h extends no{constructor(e){super(e),this.current=s}set(e,i,n){if(this.fetchUniformLocation(e,i)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let a=1;a<16;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}}const p=new Float32Array(9),_=new Float32Array(4);class x extends no{constructor(e){super(e),this.current=_}set(e,i,n){if(this.fetchUniformLocation(e,i)){for(let a=0;a<4;a++)if(n[a]!==this.current[a]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}}}function T(t){return[Ud(255*t.r,255*t.g),Ud(255*t.b,255*t.a)]}class S{constructor(e,i,n){this.value=e,this.uniformNames=i.map(a=>`u_${a}`),this.type=n}setUniform(e,i,n,a,c){i.set(e,c,a.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new r(e):new zn(e)}}class I{constructor(e,i){this.uniformNames=i.map(n=>`u_${n}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,n,a,c){const d=c==="u_pattern"||c==="u_dash"?this.pattern:c==="u_pixel_ratio"?this.pixelRatio:null;d&&i.set(e,c,d)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new u(e):new zn(e)}}class C{constructor(e,i,n,a){this.expression=e,this.type=n,this.maxValue=0,this.paintVertexAttributes=i.map(c=>({name:`a_${c}`,type:"Float32",components:n==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,i,n,a,c,d,m){const g=this.paintVertexArray.length,y=this.expression.evaluate(new Or(0,{brightness:d}),i,{},c,a,m);this.paintVertexArray.resize(e),this._setPaintValue(g,e,y)}updatePaintArray(e,i,n,a,c,d,m){const g=this.expression.evaluate({zoom:0,brightness:m},n,a,void 0,c);this._setPaintValue(e,i,g)}_setPaintValue(e,i,n){if(this.type==="color"){const a=T(n);for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,a[0],a[1])}else{for(let a=e;a<i;a++)this.paintVertexArray.emplace(a,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class L{constructor(e,i,n,a,c,d){this.expression=e,this.uniformNames=i.map(m=>`u_${m}_t`),this.type=n,this.useIntegerZoom=a,this.zoom=c,this.maxValue=0,this.paintVertexAttributes=i.map(m=>({name:`a_${m}`,type:"Float32",components:n==="color"?4:2,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,i,n,a,c,d,m){const g=this.expression.evaluate(new Or(this.zoom,{brightness:d}),i,{},c,a,m),y=this.expression.evaluate(new Or(this.zoom+1,{brightness:d}),i,{},c,a,m),w=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(w,e,g,y)}updatePaintArray(e,i,n,a,c,d,m){const g=this.expression.evaluate({zoom:this.zoom,brightness:m},n,a,void 0,c),y=this.expression.evaluate({zoom:this.zoom+1,brightness:m},n,a,void 0,c);this._setPaintValue(e,i,g,y)}_setPaintValue(e,i,n,a){if(this.type==="color"){const c=T(n),d=T(a);for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,c[0],c[1],d[0],d[1])}else{for(let c=e;c<i;c++)this.paintVertexArray.emplace(c,n,a);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,n,a,c){const d=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,m=Nt(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);i.set(e,c,m)}getBinding(e,i){return new zn(e)}}class k{constructor(e,i,n,a,c){this.expression=e,this.layerId=c,this.paintVertexAttributes=(n==="array"?Np:Fp).members;for(let d=0;d<i.length;++d);this.paintVertexArray=new a}populatePaintArray(e,i,n){const a=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(a,e,i.patterns&&i.patterns[this.layerId],n)}updatePaintArray(e,i,n,a,c,d,m){this._setPaintValues(e,i,n.patterns&&n.patterns[this.layerId],d)}_setPaintValues(e,i,n,a){if(!a||!n)return;const c=a[n];if(!c)return;const{tl:d,br:m,pixelRatio:g}=c;for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,d[0],d[1],m[0],m[1],g)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class B{constructor(e,i,n=()=>!0){this.binders={},this._buffers=[];const a=[];for(const c in e.paint._values){const d=e.paint.get(c);if(!n(c)||!(d instanceof Za&&_u(d.property.specification)))continue;const m=$(c,e.type),g=d.value,y=d.property.specification.type,w=!!d.property.useIntegerZoom,E=c==="line-dasharray"||c.endsWith("pattern"),M=c==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(g.kind!=="constant"||M)if(g.kind==="source"||M||E){const P=ee(c,y,"source");this.binders[c]=E?new k(g,m,y,P,e.id):new C(g,m,y,P),a.push(`/a_${c}`)}else{const P=ee(c,y,"composite");this.binders[c]=new L(g,m,y,w,i,P),a.push(`/z_${c}`)}else this.binders[c]=E?new I(g.value,m):new S(g.value,m,y),a.push(`/u_${c}`)}this.cacheKey=a.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof C||i instanceof L?i.maxValue:0}populatePaintArrays(e,i,n,a,c,d,m){for(const g in this.binders){const y=this.binders[g];(y instanceof C||y instanceof L||y instanceof k)&&y.populatePaintArray(e,i,n,a,c,d,m)}}setConstantPatternPositions(e){for(const i in this.binders){const n=this.binders[i];n instanceof I&&n.setConstantPatternPositions(e)}}updatePaintArrays(e,i,n,a,c,d,m,g){let y=!1;const w=Object.keys(e),E=w.length!==0,M=E?w:i.uniqueIds;for(const P in this.binders){const D=this.binders[P];if((D instanceof C||D instanceof L||D instanceof k)&&(D.expression.isStateDependent===!0||D.expression.isLightConstant===!1)){const O=c.paint.get(P);D.expression=O.value;for(const F of M){const V=e[F.toString()];i.eachPosition(F,(W,Q,J)=>{const oe=a.feature(W);D.updatePaintArray(Q,J,oe,V,d,m,g)})}if(!E)for(const F of n.uniqueIds){const V=e[F.toString()];n.eachPosition(F,(W,Q,J)=>{const oe=a.feature(W);D.updatePaintArray(Q,J,oe,V,d,m,g)})}y=!0}}return y}defines(){const e=[];for(const i in this.binders){const n=this.binders[i];(n instanceof S||n instanceof I)&&e.push(...n.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const n=this.binders[i];if(n instanceof C||n instanceof L||n instanceof k)for(let a=0;a<n.paintVertexAttributes.length;a++)e.push(n.paintVertexAttributes[a].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const n=this.binders[i];if(n instanceof S||n instanceof I||n instanceof L)for(const a of n.uniformNames)e.push(a)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const n in this.binders){const a=this.binders[n];if(a instanceof S||a instanceof I||a instanceof L)for(const c of a.uniformNames)i.push({name:c,property:n,binding:a.getBinding(e,c)})}return i}setUniforms(e,i,n,a,c){for(const{name:d,property:m,binding:g}of n)this.binders[m].setUniform(e,g,c,a.get(m),d)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof C||i instanceof L||i instanceof k)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const n=this.binders[i];(n instanceof C||n instanceof L||n instanceof k)&&n.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof C||i instanceof L||i instanceof k)&&i.destroy()}}}class j{constructor(e,i,n=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new B(a,i,n);this.needsUpload=!1,this._featureMap=new vc,this._featureMapWithoutIds=new vc,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,n,a,c,d,m,g){for(const y in this.programConfigurations)this.programConfigurations[y].populatePaintArrays(e,i,a,c,d,m,g);i.id!==void 0?this._featureMap.add(i.id,n,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,n,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,n,a,c,d){for(const m of n)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,m,a,c,d||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const U={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function $(t,e){return U[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const N={"line-pattern":{source:Fo,composite:Fo},"fill-pattern":{source:Fo,composite:Fo},"fill-extrusion-pattern":{source:Fo,composite:Fo},"line-dasharray":{source:Wa,composite:Wa}},H={color:{source:pc,composite:Bo},number:{source:dc,composite:pc}};function ee(t,e,i){const n=N[t];return n&&n[i]||H[e][i]}Ct(S,"ConstantBinder"),Ct(I,"PatternConstantBinder"),Ct(C,"SourceExpressionBinder"),Ct(k,"PatternCompositeBinder"),Ct(L,"CompositeExpressionBinder"),Ct(B,"ProgramConfiguration",{omit:["_buffers"]}),Ct(j,"ProgramConfigurationSet");const X=xt/Math.PI/2,te=5,q=6,re=16383,ae=64,ue=[ae,32,16],me=-X,Me=X;function ye(t,e,i,n=X){return i=dt(i),[t*Math.sin(i)*n,-e*n,t*Math.cos(i)*n]}function Oe(t,e,i){return ye(Math.cos(dt(t)),Math.sin(dt(t)),e,i)}const Le=63710088e-1,We=2*Math.PI*Le;class ve{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ve(Cn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,n=this.lat*i,a=e.lat*i,c=Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.cos((e.lng-this.lng)*i);return Le*Math.acos(Math.min(c,1))}toBounds(e=0){const i=360*e/40075017,n=i/Math.cos(Math.PI/180*this.lat);return new Ce({lng:this.lng-n,lat:this.lat-i},{lng:this.lng+n,lat:this.lat+i})}toEcef(e){return Oe(this.lat,this.lng,X+e*X/Le)}static convert(e){if(e instanceof ve)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new ve(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new ve(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Ce{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ve?new ve(e.lng,e.lat):ve.convert(e),this}setSouthWest(e){return this._sw=e instanceof ve?new ve(e.lng,e.lat):ve.convert(e),this}extend(e){const i=this._sw,n=this._ne;let a,c;if(e instanceof ve)a=e,c=e;else{if(!(e instanceof Ce))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Ce.convert(e)):this.extend(ve.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ve.convert(e)):this;if(a=e._sw,c=e._ne,!a||!c)return this}return i||n?(i.lng=Math.min(a.lng,i.lng),i.lat=Math.min(a.lat,i.lat),n.lng=Math.max(c.lng,n.lng),n.lat=Math.max(c.lat,n.lat)):(this._sw=new ve(a.lng,a.lat),this._ne=new ve(c.lng,c.lat)),this}getCenter(){return new ve((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ve(this.getWest(),this.getNorth())}getSouthEast(){return new ve(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:n}=ve.convert(e);let a=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&a}static convert(e){return!e||e instanceof Ce?e:new Ce(e)}}var fe={};(function(t,e){(function(i){function n(c,d,m){var g=a(256*c,256*(d=Math.pow(2,m)-d-1),m),y=a(256*(c+1),256*(d+1),m);return g[0]+","+g[1]+","+y[0]+","+y[1]}function a(c,d,m){var g=2*Math.PI*6378137/256/Math.pow(2,m);return[c*g-2*Math.PI*6378137/2,d*g-2*Math.PI*6378137/2]}i.getURL=function(c,d,m,g,y,w){return w=w||{},c+"?"+["bbox="+n(m,g,y),"format="+(w.format||"image/png"),"service="+(w.service||"WMS"),"version="+(w.version||"1.1.1"),"request="+(w.request||"GetMap"),"srs="+(w.srs||"EPSG:3857"),"width="+(w.width||256),"height="+(w.height||256),"layers="+d].join("&")},i.getTileBBox=n,i.getMercCoords=a,Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,fe);var we=fe;class Ke{constructor(e,i,n){this.z=e,this.x=i,this.y=n,this.key=_t(0,e,e,i,n)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const n=we.getTileBBox(this.x,this.y,this.z),a=function(c,d,m){let g,y="";for(let w=c;w>0;w--)g=1<<w-1,y+=(d&g?1:0)+(m&g?2:0);return y}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class st{constructor(e,i){this.wrap=e,this.canonical=i,this.key=_t(e,i.z,i.z,i.x,i.y)}}class nt{constructor(e,i,n,a,c){this.overscaledZ=e,this.wrap=i,this.canonical=new Ke(n,+a,+c),this.key=i===0&&e===n?this.canonical.key:_t(i,e,n,a,c)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new nt(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new nt(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return _t(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-e;return _t(this.wrap*+i,e,e,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new nt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,n=2*this.canonical.x,a=2*this.canonical.y;return[new nt(i,this.wrap,i,n,a),new nt(i,this.wrap,i,n+1,a),new nt(i,this.wrap,i,n,a+1),new nt(i,this.wrap,i,n+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new nt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new nt(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new st(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function _t(t,e,i,n,a){const c=1<<Math.min(i,22);let d=c*(a%c)+n%c;return t&&i<22&&(d+=c*c*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*d+i)+(e-i)}const Ot=[t=>{let e=t.canonical.x-1,i=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,i--),new nt(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,i=t.wrap;return e===1<<t.canonical.z&&(e=0,i++),new nt(t.overscaledZ,i,t.canonical.z,e,t.canonical.y)},t=>new nt(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new nt(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Ct(Ke,"CanonicalTileID"),Ct(nt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Zt=0,Bt=25.5;function Ut(t){return We*Math.cos(t*Math.PI/180)}function gi(t){return(180+t)/360}function si(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function di(t,e){return t/Ut(e)}function ui(t){return 360*t-180}function ki(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function pr(t,e){return t*Ut(ki(e))}const Ai=85.051129;function kr(t){return Math.cos(dt(Nt(t,-Ai,Ai)))}function Ii(t,e){const i=Nt(e,Zt,Bt),n=Math.pow(2,i);return kr(t)*We/(512*n)}function Gi(t){return 1/Math.cos(t*Math.PI/180)}function Ci(t,e=0){const i=Math.exp(Math.PI*(1-(t.y+e/xt)/(1<<t.z)*2));return 80150034*i/(i*i+1)/xt/(1<<t.z)}class ji{constructor(e,i,n=0){this.x=+e,this.y=+i,this.z=+n}static fromLngLat(e,i=0){const n=ve.convert(e);return new ji(gi(n.lng),si(n.lat),di(i,n.lat))}toLngLat(){return new ve(ui(this.x),ki(this.y))}toAltitude(){return pr(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/We*Gi(ki(this.y))}}function vr(t,e,i,n,a,c,d,m,g){const y=(e+n)/2,w=(i+a)/2,E=new Ie(y,w);m(E),function(M,P,D,O,F,V){const W=D-F,Q=O-V;return Math.abs((O-P)*W-(D-M)*Q)/Math.hypot(W,Q)}(E.x,E.y,c.x,c.y,d.x,d.y)>=g?(vr(t,e,i,y,w,c,E,m,g),vr(t,y,w,n,a,E,d,m,g)):t.push(d)}function Yi(t,e,i){let n=t[0],a=n.x,c=n.y;e(n);const d=[n];for(let m=1;m<t.length;m++){const g=t[m],{x:y,y:w}=g;e(g),vr(d,a,c,y,w,n,g,e,i),a=y,c=w,n=g}return d}function fn(t,e,i,n){if(n(e,i)){const a=e.add(i)._mult(.5);fn(t,e,a,n),fn(t,a,i,n)}else t.push(i)}function An(t,e){let i=t[0];const n=[i];for(let a=1;a<t.length;a++){const c=t[a];fn(n,i,c,e),i=c}return n}const Yn=Math.pow(2,14)-1,$s=-Yn-1;function Jn(t,e){const i=Math.round(t.x*e),n=Math.round(t.y*e);return t.x=Nt(i,$s,Yn),t.y=Nt(n,$s,Yn),(i<t.x||i>t.x+1||n<t.y||n>t.y+1)&&_e("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function pn(t,e,i){const n=t.loadGeometry(),a=t.extent,c=xt/a;if(e&&i&&i.projection.isReprojectedInTileSpace){const d=1<<e.z,{scale:m,x:g,y,projection:w}=i,E=M=>{const P=ui((e.x+M.x/a)/d),D=ki((e.y+M.y/a)/d),O=w.project(P,D);M.x=(O.x*m-g)*a,M.y=(O.y*m-y)*a};for(let M=0;M<n.length;M++)if(t.type!==1)n[M]=Yi(n[M],E,1);else{const P=[];for(const D of n[M])D.x<0||D.x>=a||D.y<0||D.y>=a||(E(D),P.push(D));n[M]=P}}for(const d of n)for(const m of d)Jn(m,c);return n}function an(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?pn(t):[]}}function kn(t,e,i,n,a){t.emplaceBack(2*e+(n+1)/2,2*i+(a+1)/2)}function Gn(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Qn{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ps,this.indexArray=new dn,this.segments=new $r,this.programConfigurations=new j(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,n,a){const c=this.layers[0],d=[];let m=null;c.type==="circle"&&(m=c.layout.get("circle-sort-key"));for(const{feature:y,id:w,index:E,sourceLayerIndex:M}of e){const P=this.layers[0]._featureFilter.needGeometry,D=an(y,P);if(!this.layers[0]._featureFilter.filter(new Or(this.zoom),D,n))continue;const O=m?m.evaluate(D,{},n):void 0,F={id:w,properties:y.properties,type:y.type,sourceLayerIndex:M,index:E,geometry:P?D.geometry:pn(y,n,a),patterns:{},sortKey:O};d.push(F)}m&&d.sort((y,w)=>y.sortKey-w.sortKey);let g=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new Su,g=a.projection);for(const y of d){const{geometry:w,index:E,sourceLayerIndex:M}=y,P=e[E].feature;this.addFeature(y,w,E,i.availableImages,n,g,i.brightness),i.featureIndex.insert(P,w,E,M,this.index)}}update(e,i,n,a,c){const d=Object.keys(e).length!==0;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,d?this.stateDependentLayers:this.layers,n,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ag.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Bp.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,n,a,c,d,m){for(const g of i)for(const y of g){const w=y.x,E=y.y;if(w<0||w>=xt||E<0||E>=xt)continue;if(d){const D=d.projectTilePoint(w,E,c),O=d.upVector(c,w,E),F=this.globeExtVertexArray;Gn(F,D,O),Gn(F,D,O),Gn(F,D,O),Gn(F,D,O)}const M=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=M.vertexLength;kn(this.layoutVertexArray,w,E,-1,-1),kn(this.layoutVertexArray,w,E,1,-1),kn(this.layoutVertexArray,w,E,1,1),kn(this.layoutVertexArray,w,E,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),M.vertexLength+=4,M.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},a,c,m)}}function qs(t,e){for(let i=0;i<t.length;i++)if(so(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(so(t,e[i]))return!0;return!!bc(t,e)}function Uo(t,e,i){return!!so(t,e)||!!wc(e,t,i)}function fa(t,e){if(t.length===1)return Ru(e,t[0]);for(let i=0;i<e.length;i++){const n=e[i];for(let a=0;a<n.length;a++)if(so(t,n[a]))return!0}for(let i=0;i<t.length;i++)if(Ru(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(bc(t,e[i]))return!0;return!1}function xc(t,e,i){if(t.length>1){if(bc(t,e))return!0;for(let n=0;n<e.length;n++)if(wc(e[n],t,i))return!0}for(let n=0;n<t.length;n++)if(wc(t[n],e,i))return!0;return!1}function bc(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const n=t[i],a=t[i+1];for(let c=0;c<e.length-1;c++)if(qd(n,a,e[c],e[c+1]))return!0}return!1}function qd(t,e,i,n){return Fe(t,i,n)!==Fe(e,i,n)&&Fe(t,e,i)!==Fe(t,e,n)}function wc(t,e,i){const n=i*i;if(e.length===1)return t.distSqr(e[0])<n;for(let a=1;a<e.length;a++)if(Ka(t,e[a-1],e[a])<n)return!0;return!1}function Ka(t,e,i){const n=e.distSqr(i);if(n===0)return t.distSqr(e);const a=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return t.distSqr(a<0?e:a>1?i:i.sub(e)._mult(a)._add(e))}function Ru(t,e){let i,n,a,c=!1;for(let d=0;d<t.length;d++){i=t[d];for(let m=0,g=i.length-1;m<i.length;g=m++)n=i[m],a=i[g],n.y>e.y!=a.y>e.y&&e.x<(a.x-n.x)*(e.y-n.y)/(a.y-n.y)+n.x&&(c=!c)}return c}function so(t,e){let i=!1;for(let n=0,a=t.length-1;n<t.length;a=n++){const c=t[n],d=t[a];c.y>e.y!=d.y>e.y&&e.x<(d.x-c.x)*(e.y-c.y)/(d.y-c.y)+c.x&&(i=!i)}return i}function J0(t,e,i,n,a){for(const d of t)if(e<=d.x&&i<=d.y&&n>=d.x&&a>=d.y)return!0;const c=[new Ie(e,i),new Ie(e,a),new Ie(n,a),new Ie(n,i)];if(t.length>2){for(const d of c)if(so(t,d))return!0}for(let d=0;d<t.length-1;d++)if(tM(t[d],t[d+1],c))return!0;return!1}function tM(t,e,i){const n=i[0],a=i[2];if(t.x<n.x&&e.x<n.x||t.x>a.x&&e.x>a.x||t.y<n.y&&e.y<n.y||t.y>a.y&&e.y>a.y)return!1;const c=Fe(t,e,i[0]);return c!==Fe(t,e,i[1])||c!==Fe(t,e,i[2])||c!==Fe(t,e,i[3])}function Lu(t,e,i,n,a,c){let d=e.y-t.y,m=t.x-e.x;if(c=c||0){const g=d*d+m*m;if(g===0)return!0;const y=Math.sqrt(g);d/=y,m/=y}return!((i.x-t.x)*d+(i.y-t.y)*m-c<0||(n.x-t.x)*d+(n.y-t.y)*m-c<0||(a.x-t.x)*d+(a.y-t.y)*m-c<0)}function lg(t,e,i,n,a,c,d){return!(Lu(t,e,n,a,c,d)||Lu(e,i,n,a,c,d)||Lu(i,t,n,a,c,d)||Lu(n,a,t,e,i,d)||Lu(a,c,t,e,i,d)||Lu(c,n,t,e,i,d))}function Du(t,e,i){const n=e.paint.get(t).value;return n.kind==="constant"?n.value:i.programConfigurations.get(e.id).getMaxValue(t)}function qp(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Q0(t,e,i,n,a){if(!e[0]&&!e[1])return t;const c=Ie.convert(e)._mult(a);i==="viewport"&&c._rotate(-n);const d=[];for(let m=0;m<t.length;m++)d.push(t[m].sub(c));return d}function ev(t,e,i,n){const a=Ie.convert(t)._mult(n);return e==="viewport"&&a._rotate(-i),a}Ct(Qn,"CircleBucket",{omit:["layers"]});const iM=new zr({"circle-sort-key":new Wt(Te.layout_circle["circle-sort-key"]),visibility:new at(Te.layout_circle.visibility)});var rM={paint:new zr({"circle-radius":new Wt(Te.paint_circle["circle-radius"]),"circle-color":new Wt(Te.paint_circle["circle-color"]),"circle-blur":new Wt(Te.paint_circle["circle-blur"]),"circle-opacity":new Wt(Te.paint_circle["circle-opacity"]),"circle-translate":new at(Te.paint_circle["circle-translate"]),"circle-translate-anchor":new at(Te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new at(Te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new at(Te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wt(Te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wt(Te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wt(Te.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new at(Te.paint_circle["circle-emissive-strength"])}),layout:iM},gn={},yn={};Object.defineProperty(yn,"__esModule",{value:!0}),yn.setMatrixArrayType=function(t){yn.ARRAY_TYPE=iv=t},yn.toRadian=function(t){return t*sM},yn.equals=function(t,e){return Math.abs(t-e)<=tv*Math.max(1,Math.abs(t),Math.abs(e))},yn.RANDOM=yn.ARRAY_TYPE=yn.EPSILON=void 0;var tv=1e-6;yn.EPSILON=tv;var iv=typeof Float32Array<"u"?Float32Array:Array;yn.ARRAY_TYPE=iv;var nM=Math.random;yn.RANDOM=nM;var sM=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Br={};function cg(t){return cg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},cg(t)}Object.defineProperty(Br,"__esModule",{value:!0}),Br.create=function(){var t=new Ya.ARRAY_TYPE(4);return Ya.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Br.clone=function(t){var e=new Ya.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Br.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Br.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Br.fromValues=function(t,e,i,n){var a=new Ya.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=n,a},Br.set=function(t,e,i,n,a){return t[0]=e,t[1]=i,t[2]=n,t[3]=a,t},Br.transpose=function(t,e){if(t===e){var i=e[1];t[1]=e[2],t[2]=i}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Br.invert=function(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],d=i*c-a*n;return d?(t[0]=c*(d=1/d),t[1]=-n*d,t[2]=-a*d,t[3]=i*d,t):null},Br.adjoint=function(t,e){var i=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=i,t},Br.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Br.multiply=nv,Br.rotate=function(t,e,i){var n=e[0],a=e[1],c=e[2],d=e[3],m=Math.sin(i),g=Math.cos(i);return t[0]=n*g+c*m,t[1]=a*g+d*m,t[2]=n*-m+c*g,t[3]=a*-m+d*g,t},Br.scale=function(t,e,i){var n=e[1],a=e[2],c=e[3],d=i[0],m=i[1];return t[0]=e[0]*d,t[1]=n*d,t[2]=a*m,t[3]=c*m,t},Br.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t},Br.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Br.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Br.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Br.LDU=function(t,e,i,n){return t[2]=n[2]/n[0],i[0]=n[0],i[1]=n[1],i[3]=n[3]-t[2]*i[1],[t,e,i]},Br.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Br.subtract=sv,Br.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Br.equals=function(t,e){var i=t[0],n=t[1],a=t[2],c=t[3],d=e[0],m=e[1],g=e[2],y=e[3];return Math.abs(i-d)<=Ya.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(n-m)<=Ya.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-g)<=Ya.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(c-y)<=Ya.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))},Br.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Br.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},Br.sub=Br.mul=void 0;var Ya=function(t,e){if(t&&t.__esModule)return t;if(t===null||cg(t)!=="object"&&typeof t!="function")return{default:t};var i=rv(void 0);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,i&&i.set(t,n),n}(yn);function rv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(rv=function(n){return n?i:e})(t)}function nv(t,e,i){var n=e[0],a=e[1],c=e[2],d=e[3],m=i[0],g=i[1],y=i[2],w=i[3];return t[0]=n*m+c*g,t[1]=a*m+d*g,t[2]=n*y+c*w,t[3]=a*y+d*w,t}function sv(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}Br.mul=nv,Br.sub=sv;var Vr={};function ug(t){return ug=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ug(t)}Object.defineProperty(Vr,"__esModule",{value:!0}),Vr.create=function(){var t=new jo.ARRAY_TYPE(6);return jo.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},Vr.clone=function(t){var e=new jo.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},Vr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},Vr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},Vr.fromValues=function(t,e,i,n,a,c){var d=new jo.ARRAY_TYPE(6);return d[0]=t,d[1]=e,d[2]=i,d[3]=n,d[4]=a,d[5]=c,d},Vr.set=function(t,e,i,n,a,c,d){return t[0]=e,t[1]=i,t[2]=n,t[3]=a,t[4]=c,t[5]=d,t},Vr.invert=function(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],d=e[4],m=e[5],g=i*c-n*a;return g?(t[0]=c*(g=1/g),t[1]=-n*g,t[2]=-a*g,t[3]=i*g,t[4]=(a*m-c*d)*g,t[5]=(n*d-i*m)*g,t):null},Vr.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},Vr.multiply=av,Vr.rotate=function(t,e,i){var n=e[0],a=e[1],c=e[2],d=e[3],m=e[4],g=e[5],y=Math.sin(i),w=Math.cos(i);return t[0]=n*w+c*y,t[1]=a*w+d*y,t[2]=n*-y+c*w,t[3]=a*-y+d*w,t[4]=m,t[5]=g,t},Vr.scale=function(t,e,i){var n=e[1],a=e[2],c=e[3],d=e[4],m=e[5],g=i[0],y=i[1];return t[0]=e[0]*g,t[1]=n*g,t[2]=a*y,t[3]=c*y,t[4]=d,t[5]=m,t},Vr.translate=function(t,e,i){var n=e[0],a=e[1],c=e[2],d=e[3],m=e[4],g=e[5],y=i[0],w=i[1];return t[0]=n,t[1]=a,t[2]=c,t[3]=d,t[4]=n*y+c*w+m,t[5]=a*y+d*w+g,t},Vr.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=-i,t[3]=n,t[4]=0,t[5]=0,t},Vr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},Vr.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},Vr.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},Vr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},Vr.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t},Vr.subtract=lv,Vr.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t},Vr.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t},Vr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},Vr.equals=function(t,e){var i=t[0],n=t[1],a=t[2],c=t[3],d=t[4],m=t[5],g=e[0],y=e[1],w=e[2],E=e[3],M=e[4],P=e[5];return Math.abs(i-g)<=jo.EPSILON*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(n-y)<=jo.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(a-w)<=jo.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(c-E)<=jo.EPSILON*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(d-M)<=jo.EPSILON*Math.max(1,Math.abs(d),Math.abs(M))&&Math.abs(m-P)<=jo.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))},Vr.sub=Vr.mul=void 0;var jo=function(t,e){if(t&&t.__esModule)return t;if(t===null||ug(t)!=="object"&&typeof t!="function")return{default:t};var i=ov(void 0);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,i&&i.set(t,n),n}(yn);function ov(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(ov=function(n){return n?i:e})(t)}function av(t,e,i){var n=e[0],a=e[1],c=e[2],d=e[3],m=e[4],g=e[5],y=i[0],w=i[1],E=i[2],M=i[3],P=i[4],D=i[5];return t[0]=n*y+c*w,t[1]=a*y+d*w,t[2]=n*E+c*M,t[3]=a*E+d*M,t[4]=n*P+c*D+m,t[5]=a*P+d*D+g,t}function lv(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t}Vr.mul=av,Vr.sub=lv;var dr={};function hg(t){return hg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hg(t)}Object.defineProperty(dr,"__esModule",{value:!0}),dr.create=function(){var t=new Rs.ARRAY_TYPE(9);return Rs.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},dr.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},dr.clone=function(t){var e=new Rs.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},dr.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},dr.fromValues=function(t,e,i,n,a,c,d,m,g){var y=new Rs.ARRAY_TYPE(9);return y[0]=t,y[1]=e,y[2]=i,y[3]=n,y[4]=a,y[5]=c,y[6]=d,y[7]=m,y[8]=g,y},dr.set=function(t,e,i,n,a,c,d,m,g,y){return t[0]=e,t[1]=i,t[2]=n,t[3]=a,t[4]=c,t[5]=d,t[6]=m,t[7]=g,t[8]=y,t},dr.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},dr.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],a=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=n,t[7]=a}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},dr.invert=function(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],d=e[4],m=e[5],g=e[6],y=e[7],w=e[8],E=w*d-m*y,M=-w*c+m*g,P=y*c-d*g,D=i*E+n*M+a*P;return D?(t[0]=E*(D=1/D),t[1]=(-w*n+a*y)*D,t[2]=(m*n-a*d)*D,t[3]=M*D,t[4]=(w*i-a*g)*D,t[5]=(-m*i+a*c)*D,t[6]=P*D,t[7]=(-y*i+n*g)*D,t[8]=(d*i-n*c)*D,t):null},dr.adjoint=function(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],d=e[4],m=e[5],g=e[6],y=e[7],w=e[8];return t[0]=d*w-m*y,t[1]=a*y-n*w,t[2]=n*m-a*d,t[3]=m*g-c*w,t[4]=i*w-a*g,t[5]=a*c-i*m,t[6]=c*y-d*g,t[7]=n*g-i*y,t[8]=i*d-n*c,t},dr.determinant=function(t){var e=t[3],i=t[4],n=t[5],a=t[6],c=t[7],d=t[8];return t[0]*(d*i-n*c)+t[1]*(-d*e+n*a)+t[2]*(c*e-i*a)},dr.multiply=uv,dr.translate=function(t,e,i){var n=e[0],a=e[1],c=e[2],d=e[3],m=e[4],g=e[5],y=e[6],w=e[7],E=e[8],M=i[0],P=i[1];return t[0]=n,t[1]=a,t[2]=c,t[3]=d,t[4]=m,t[5]=g,t[6]=M*n+P*d+y,t[7]=M*a+P*m+w,t[8]=M*c+P*g+E,t},dr.rotate=function(t,e,i){var n=e[0],a=e[1],c=e[2],d=e[3],m=e[4],g=e[5],y=e[6],w=e[7],E=e[8],M=Math.sin(i),P=Math.cos(i);return t[0]=P*n+M*d,t[1]=P*a+M*m,t[2]=P*c+M*g,t[3]=P*d-M*n,t[4]=P*m-M*a,t[5]=P*g-M*c,t[6]=y,t[7]=w,t[8]=E,t},dr.scale=function(t,e,i){var n=i[0],a=i[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=a*e[3],t[4]=a*e[4],t[5]=a*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},dr.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},dr.fromRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},dr.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},dr.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},dr.fromQuat=function(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],d=i+i,m=n+n,g=a+a,y=i*d,w=n*d,E=n*m,M=a*d,P=a*m,D=a*g,O=c*d,F=c*m,V=c*g;return t[0]=1-E-D,t[3]=w-V,t[6]=M+F,t[1]=w+V,t[4]=1-y-D,t[7]=P-O,t[2]=M-F,t[5]=P+O,t[8]=1-y-E,t},dr.normalFromMat4=function(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],d=e[4],m=e[5],g=e[6],y=e[7],w=e[8],E=e[9],M=e[10],P=e[11],D=e[12],O=e[13],F=e[14],V=e[15],W=i*m-n*d,Q=i*g-a*d,J=i*y-c*d,oe=n*g-a*m,se=n*y-c*m,he=a*y-c*g,ge=w*O-E*D,xe=w*F-M*D,Ae=w*V-P*D,be=E*F-M*O,ze=E*V-P*O,qe=M*V-P*F,De=W*qe-Q*ze+J*be+oe*Ae-se*xe+he*ge;return De?(t[0]=(m*qe-g*ze+y*be)*(De=1/De),t[1]=(g*Ae-d*qe-y*xe)*De,t[2]=(d*ze-m*Ae+y*ge)*De,t[3]=(a*ze-n*qe-c*be)*De,t[4]=(i*qe-a*Ae+c*xe)*De,t[5]=(n*Ae-i*ze-c*ge)*De,t[6]=(O*he-F*se+V*oe)*De,t[7]=(F*J-D*he-V*Q)*De,t[8]=(D*se-O*J+V*W)*De,t):null},dr.projection=function(t,e,i){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/i,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},dr.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},dr.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},dr.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t},dr.subtract=hv,dr.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t},dr.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t},dr.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},dr.equals=function(t,e){var i=t[0],n=t[1],a=t[2],c=t[3],d=t[4],m=t[5],g=t[6],y=t[7],w=t[8],E=e[0],M=e[1],P=e[2],D=e[3],O=e[4],F=e[5],V=e[6],W=e[7],Q=e[8];return Math.abs(i-E)<=Rs.EPSILON*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(n-M)<=Rs.EPSILON*Math.max(1,Math.abs(n),Math.abs(M))&&Math.abs(a-P)<=Rs.EPSILON*Math.max(1,Math.abs(a),Math.abs(P))&&Math.abs(c-D)<=Rs.EPSILON*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(d-O)<=Rs.EPSILON*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(m-F)<=Rs.EPSILON*Math.max(1,Math.abs(m),Math.abs(F))&&Math.abs(g-V)<=Rs.EPSILON*Math.max(1,Math.abs(g),Math.abs(V))&&Math.abs(y-W)<=Rs.EPSILON*Math.max(1,Math.abs(y),Math.abs(W))&&Math.abs(w-Q)<=Rs.EPSILON*Math.max(1,Math.abs(w),Math.abs(Q))},dr.sub=dr.mul=void 0;var Rs=function(t,e){if(t&&t.__esModule)return t;if(t===null||hg(t)!=="object"&&typeof t!="function")return{default:t};var i=cv(void 0);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,i&&i.set(t,n),n}(yn);function cv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(cv=function(n){return n?i:e})(t)}function uv(t,e,i){var n=e[0],a=e[1],c=e[2],d=e[3],m=e[4],g=e[5],y=e[6],w=e[7],E=e[8],M=i[0],P=i[1],D=i[2],O=i[3],F=i[4],V=i[5],W=i[6],Q=i[7],J=i[8];return t[0]=M*n+P*d+D*y,t[1]=M*a+P*m+D*w,t[2]=M*c+P*g+D*E,t[3]=O*n+F*d+V*y,t[4]=O*a+F*m+V*w,t[5]=O*c+F*g+V*E,t[6]=W*n+Q*d+J*y,t[7]=W*a+Q*m+J*w,t[8]=W*c+Q*g+J*E,t}function hv(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t}dr.mul=uv,dr.sub=hv;var xi={};function dg(t){return dg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dg(t)}Object.defineProperty(xi,"__esModule",{value:!0}),xi.create=function(){var t=new Hr.ARRAY_TYPE(16);return Hr.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},xi.clone=function(t){var e=new Hr.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},xi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},xi.fromValues=function(t,e,i,n,a,c,d,m,g,y,w,E,M,P,D,O){var F=new Hr.ARRAY_TYPE(16);return F[0]=t,F[1]=e,F[2]=i,F[3]=n,F[4]=a,F[5]=c,F[6]=d,F[7]=m,F[8]=g,F[9]=y,F[10]=w,F[11]=E,F[12]=M,F[13]=P,F[14]=D,F[15]=O,F},xi.set=function(t,e,i,n,a,c,d,m,g,y,w,E,M,P,D,O,F){return t[0]=e,t[1]=i,t[2]=n,t[3]=a,t[4]=c,t[5]=d,t[6]=m,t[7]=g,t[8]=y,t[9]=w,t[10]=E,t[11]=M,t[12]=P,t[13]=D,t[14]=O,t[15]=F,t},xi.identity=fv,xi.transpose=function(t,e){if(t===e){var i=e[1],n=e[2],a=e[3],c=e[6],d=e[7],m=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=i,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=c,t[11]=e[14],t[12]=a,t[13]=d,t[14]=m}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},xi.invert=function(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],d=e[4],m=e[5],g=e[6],y=e[7],w=e[8],E=e[9],M=e[10],P=e[11],D=e[12],O=e[13],F=e[14],V=e[15],W=i*m-n*d,Q=i*g-a*d,J=i*y-c*d,oe=n*g-a*m,se=n*y-c*m,he=a*y-c*g,ge=w*O-E*D,xe=w*F-M*D,Ae=w*V-P*D,be=E*F-M*O,ze=E*V-P*O,qe=M*V-P*F,De=W*qe-Q*ze+J*be+oe*Ae-se*xe+he*ge;return De?(t[0]=(m*qe-g*ze+y*be)*(De=1/De),t[1]=(a*ze-n*qe-c*be)*De,t[2]=(O*he-F*se+V*oe)*De,t[3]=(M*se-E*he-P*oe)*De,t[4]=(g*Ae-d*qe-y*xe)*De,t[5]=(i*qe-a*Ae+c*xe)*De,t[6]=(F*J-D*he-V*Q)*De,t[7]=(w*he-M*J+P*Q)*De,t[8]=(d*ze-m*Ae+y*ge)*De,t[9]=(n*Ae-i*ze-c*ge)*De,t[10]=(D*se-O*J+V*W)*De,t[11]=(E*J-w*se-P*W)*De,t[12]=(m*xe-d*be-g*ge)*De,t[13]=(i*be-n*xe+a*ge)*De,t[14]=(O*Q-D*oe-F*W)*De,t[15]=(w*oe-E*Q+M*W)*De,t):null},xi.adjoint=function(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],d=e[4],m=e[5],g=e[6],y=e[7],w=e[8],E=e[9],M=e[10],P=e[11],D=e[12],O=e[13],F=e[14],V=e[15];return t[0]=m*(M*V-P*F)-E*(g*V-y*F)+O*(g*P-y*M),t[1]=-(n*(M*V-P*F)-E*(a*V-c*F)+O*(a*P-c*M)),t[2]=n*(g*V-y*F)-m*(a*V-c*F)+O*(a*y-c*g),t[3]=-(n*(g*P-y*M)-m*(a*P-c*M)+E*(a*y-c*g)),t[4]=-(d*(M*V-P*F)-w*(g*V-y*F)+D*(g*P-y*M)),t[5]=i*(M*V-P*F)-w*(a*V-c*F)+D*(a*P-c*M),t[6]=-(i*(g*V-y*F)-d*(a*V-c*F)+D*(a*y-c*g)),t[7]=i*(g*P-y*M)-d*(a*P-c*M)+w*(a*y-c*g),t[8]=d*(E*V-P*O)-w*(m*V-y*O)+D*(m*P-y*E),t[9]=-(i*(E*V-P*O)-w*(n*V-c*O)+D*(n*P-c*E)),t[10]=i*(m*V-y*O)-d*(n*V-c*O)+D*(n*y-c*m),t[11]=-(i*(m*P-y*E)-d*(n*P-c*E)+w*(n*y-c*m)),t[12]=-(d*(E*F-M*O)-w*(m*F-g*O)+D*(m*M-g*E)),t[13]=i*(E*F-M*O)-w*(n*F-a*O)+D*(n*M-a*E),t[14]=-(i*(m*F-g*O)-d*(n*F-a*O)+D*(n*g-a*m)),t[15]=i*(m*M-g*E)-d*(n*M-a*E)+w*(n*g-a*m),t},xi.determinant=function(t){var e=t[0],i=t[1],n=t[2],a=t[3],c=t[4],d=t[5],m=t[6],g=t[7],y=t[8],w=t[9],E=t[10],M=t[11],P=t[12],D=t[13],O=t[14],F=t[15];return(e*d-i*c)*(E*F-M*O)-(e*m-n*c)*(w*F-M*D)+(e*g-a*c)*(w*O-E*D)+(i*m-n*d)*(y*F-M*P)-(i*g-a*d)*(y*O-E*P)+(n*g-a*m)*(y*D-w*P)},xi.multiply=pv,xi.translate=function(t,e,i){var n,a,c,d,m,g,y,w,E,M,P,D,O=i[0],F=i[1],V=i[2];return e===t?(t[12]=e[0]*O+e[4]*F+e[8]*V+e[12],t[13]=e[1]*O+e[5]*F+e[9]*V+e[13],t[14]=e[2]*O+e[6]*F+e[10]*V+e[14],t[15]=e[3]*O+e[7]*F+e[11]*V+e[15]):(a=e[1],c=e[2],d=e[3],m=e[4],g=e[5],y=e[6],w=e[7],E=e[8],M=e[9],P=e[10],D=e[11],t[0]=n=e[0],t[1]=a,t[2]=c,t[3]=d,t[4]=m,t[5]=g,t[6]=y,t[7]=w,t[8]=E,t[9]=M,t[10]=P,t[11]=D,t[12]=n*O+m*F+E*V+e[12],t[13]=a*O+g*F+M*V+e[13],t[14]=c*O+y*F+P*V+e[14],t[15]=d*O+w*F+D*V+e[15]),t},xi.scale=function(t,e,i){var n=i[0],a=i[1],c=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*a,t[5]=e[5]*a,t[6]=e[6]*a,t[7]=e[7]*a,t[8]=e[8]*c,t[9]=e[9]*c,t[10]=e[10]*c,t[11]=e[11]*c,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},xi.rotate=function(t,e,i,n){var a,c,d,m,g,y,w,E,M,P,D,O,F,V,W,Q,J,oe,se,he,ge,xe,Ae,be,ze=n[0],qe=n[1],De=n[2],Ge=Math.hypot(ze,qe,De);return Ge<Hr.EPSILON?null:(ze*=Ge=1/Ge,qe*=Ge,De*=Ge,a=Math.sin(i),c=Math.cos(i),g=e[1],y=e[2],w=e[3],M=e[5],P=e[6],D=e[7],F=e[9],V=e[10],W=e[11],Q=ze*ze*(d=1-c)+c,se=ze*qe*d-De*a,he=qe*qe*d+c,ge=De*qe*d+ze*a,xe=ze*De*d+qe*a,Ae=qe*De*d-ze*a,be=De*De*d+c,t[0]=(m=e[0])*Q+(E=e[4])*(J=qe*ze*d+De*a)+(O=e[8])*(oe=De*ze*d-qe*a),t[1]=g*Q+M*J+F*oe,t[2]=y*Q+P*J+V*oe,t[3]=w*Q+D*J+W*oe,t[4]=m*se+E*he+O*ge,t[5]=g*se+M*he+F*ge,t[6]=y*se+P*he+V*ge,t[7]=w*se+D*he+W*ge,t[8]=m*xe+E*Ae+O*be,t[9]=g*xe+M*Ae+F*be,t[10]=y*xe+P*Ae+V*be,t[11]=w*xe+D*Ae+W*be,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},xi.rotateX=function(t,e,i){var n=Math.sin(i),a=Math.cos(i),c=e[4],d=e[5],m=e[6],g=e[7],y=e[8],w=e[9],E=e[10],M=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=c*a+y*n,t[5]=d*a+w*n,t[6]=m*a+E*n,t[7]=g*a+M*n,t[8]=y*a-c*n,t[9]=w*a-d*n,t[10]=E*a-m*n,t[11]=M*a-g*n,t},xi.rotateY=function(t,e,i){var n=Math.sin(i),a=Math.cos(i),c=e[0],d=e[1],m=e[2],g=e[3],y=e[8],w=e[9],E=e[10],M=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*a-y*n,t[1]=d*a-w*n,t[2]=m*a-E*n,t[3]=g*a-M*n,t[8]=c*n+y*a,t[9]=d*n+w*a,t[10]=m*n+E*a,t[11]=g*n+M*a,t},xi.rotateZ=function(t,e,i){var n=Math.sin(i),a=Math.cos(i),c=e[0],d=e[1],m=e[2],g=e[3],y=e[4],w=e[5],E=e[6],M=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=c*a+y*n,t[1]=d*a+w*n,t[2]=m*a+E*n,t[3]=g*a+M*n,t[4]=y*a-c*n,t[5]=w*a-d*n,t[6]=E*a-m*n,t[7]=M*a-g*n,t},xi.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},xi.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xi.fromRotation=function(t,e,i){var n,a,c,d=i[0],m=i[1],g=i[2],y=Math.hypot(d,m,g);return y<Hr.EPSILON?null:(d*=y=1/y,m*=y,g*=y,n=Math.sin(e),a=Math.cos(e),t[0]=d*d*(c=1-a)+a,t[1]=m*d*c+g*n,t[2]=g*d*c-m*n,t[3]=0,t[4]=d*m*c-g*n,t[5]=m*m*c+a,t[6]=g*m*c+d*n,t[7]=0,t[8]=d*g*c+m*n,t[9]=m*g*c-d*n,t[10]=g*g*c+a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},xi.fromXRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=i,t[7]=0,t[8]=0,t[9]=-i,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xi.fromYRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-i,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=i,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xi.fromZRotation=function(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=0,t[4]=-i,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xi.fromRotationTranslation=mv,xi.fromQuat2=function(t,e){var i=new Hr.ARRAY_TYPE(3),n=-e[0],a=-e[1],c=-e[2],d=e[3],m=e[4],g=e[5],y=e[6],w=e[7],E=n*n+a*a+c*c+d*d;return E>0?(i[0]=2*(m*d+w*n+g*c-y*a)/E,i[1]=2*(g*d+w*a+y*n-m*c)/E,i[2]=2*(y*d+w*c+m*a-g*n)/E):(i[0]=2*(m*d+w*n+g*c-y*a),i[1]=2*(g*d+w*a+y*n-m*c),i[2]=2*(y*d+w*c+m*a-g*n)),mv(t,e,i),t},xi.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},xi.getScaling=_v,xi.getRotation=function(t,e){var i=new Hr.ARRAY_TYPE(3);_v(i,e);var n=1/i[0],a=1/i[1],c=1/i[2],d=e[0]*n,m=e[1]*a,g=e[2]*c,y=e[4]*n,w=e[5]*a,E=e[6]*c,M=e[8]*n,P=e[9]*a,D=e[10]*c,O=d+w+D,F=0;return O>0?(F=2*Math.sqrt(O+1),t[3]=.25*F,t[0]=(E-P)/F,t[1]=(M-g)/F,t[2]=(m-y)/F):d>w&&d>D?(F=2*Math.sqrt(1+d-w-D),t[3]=(E-P)/F,t[0]=.25*F,t[1]=(m+y)/F,t[2]=(M+g)/F):w>D?(F=2*Math.sqrt(1+w-d-D),t[3]=(M-g)/F,t[0]=(m+y)/F,t[1]=.25*F,t[2]=(E+P)/F):(F=2*Math.sqrt(1+D-d-w),t[3]=(m-y)/F,t[0]=(M+g)/F,t[1]=(E+P)/F,t[2]=.25*F),t},xi.fromRotationTranslationScale=function(t,e,i,n){var a=e[0],c=e[1],d=e[2],m=e[3],g=a+a,y=c+c,w=d+d,E=a*g,M=a*y,P=a*w,D=c*y,O=c*w,F=d*w,V=m*g,W=m*y,Q=m*w,J=n[0],oe=n[1],se=n[2];return t[0]=(1-(D+F))*J,t[1]=(M+Q)*J,t[2]=(P-W)*J,t[3]=0,t[4]=(M-Q)*oe,t[5]=(1-(E+F))*oe,t[6]=(O+V)*oe,t[7]=0,t[8]=(P+W)*se,t[9]=(O-V)*se,t[10]=(1-(E+D))*se,t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t},xi.fromRotationTranslationScaleOrigin=function(t,e,i,n,a){var c=e[0],d=e[1],m=e[2],g=e[3],y=c+c,w=d+d,E=m+m,M=c*y,P=c*w,D=c*E,O=d*w,F=d*E,V=m*E,W=g*y,Q=g*w,J=g*E,oe=n[0],se=n[1],he=n[2],ge=a[0],xe=a[1],Ae=a[2],be=(1-(O+V))*oe,ze=(P+J)*oe,qe=(D-Q)*oe,De=(P-J)*se,Ge=(1-(M+V))*se,Pe=(F+W)*se,je=(D+Q)*he,ut=(F-W)*he,Ze=(1-(M+O))*he;return t[0]=be,t[1]=ze,t[2]=qe,t[3]=0,t[4]=De,t[5]=Ge,t[6]=Pe,t[7]=0,t[8]=je,t[9]=ut,t[10]=Ze,t[11]=0,t[12]=i[0]+ge-(be*ge+De*xe+je*Ae),t[13]=i[1]+xe-(ze*ge+Ge*xe+ut*Ae),t[14]=i[2]+Ae-(qe*ge+Pe*xe+Ze*Ae),t[15]=1,t},xi.fromQuat=function(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],d=i+i,m=n+n,g=a+a,y=i*d,w=n*d,E=n*m,M=a*d,P=a*m,D=a*g,O=c*d,F=c*m,V=c*g;return t[0]=1-E-D,t[1]=w+V,t[2]=M-F,t[3]=0,t[4]=w-V,t[5]=1-y-D,t[6]=P+O,t[7]=0,t[8]=M+F,t[9]=P-O,t[10]=1-y-E,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},xi.frustum=function(t,e,i,n,a,c,d){var m=1/(i-e),g=1/(a-n),y=1/(c-d);return t[0]=2*c*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*c*g,t[6]=0,t[7]=0,t[8]=(i+e)*m,t[9]=(a+n)*g,t[10]=(d+c)*y,t[11]=-1,t[12]=0,t[13]=0,t[14]=d*c*2*y,t[15]=0,t},xi.perspectiveNO=gv,xi.perspectiveZO=function(t,e,i,n,a){var c,d=1/Math.tan(e/2);return t[0]=d/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=a*(c=1/(n-a)),t[14]=a*n*c):(t[10]=-1,t[14]=-n),t},xi.perspectiveFromFieldOfView=function(t,e,i,n){var a=Math.tan(e.upDegrees*Math.PI/180),c=Math.tan(e.downDegrees*Math.PI/180),d=Math.tan(e.leftDegrees*Math.PI/180),m=Math.tan(e.rightDegrees*Math.PI/180),g=2/(d+m),y=2/(a+c);return t[0]=g,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=y,t[6]=0,t[7]=0,t[8]=-(d-m)*g*.5,t[9]=(a-c)*y*.5,t[10]=n/(i-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*i/(i-n),t[15]=0,t},xi.orthoNO=yv,xi.orthoZO=function(t,e,i,n,a,c,d){var m=1/(e-i),g=1/(n-a),y=1/(c-d);return t[0]=-2*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=y,t[11]=0,t[12]=(e+i)*m,t[13]=(a+n)*g,t[14]=c*y,t[15]=1,t},xi.lookAt=function(t,e,i,n){var a,c,d,m,g,y,w,E,M,P,D=e[0],O=e[1],F=e[2],V=n[0],W=n[1],Q=n[2],J=i[0],oe=i[1],se=i[2];return Math.abs(D-J)<Hr.EPSILON&&Math.abs(O-oe)<Hr.EPSILON&&Math.abs(F-se)<Hr.EPSILON?fv(t):(w=D-J,E=O-oe,M=F-se,a=W*(M*=P=1/Math.hypot(w,E,M))-Q*(E*=P),c=Q*(w*=P)-V*M,d=V*E-W*w,(P=Math.hypot(a,c,d))?(a*=P=1/P,c*=P,d*=P):(a=0,c=0,d=0),m=E*d-M*c,g=M*a-w*d,y=w*c-E*a,(P=Math.hypot(m,g,y))?(m*=P=1/P,g*=P,y*=P):(m=0,g=0,y=0),t[0]=a,t[1]=m,t[2]=w,t[3]=0,t[4]=c,t[5]=g,t[6]=E,t[7]=0,t[8]=d,t[9]=y,t[10]=M,t[11]=0,t[12]=-(a*D+c*O+d*F),t[13]=-(m*D+g*O+y*F),t[14]=-(w*D+E*O+M*F),t[15]=1,t)},xi.targetTo=function(t,e,i,n){var a=e[0],c=e[1],d=e[2],m=n[0],g=n[1],y=n[2],w=a-i[0],E=c-i[1],M=d-i[2],P=w*w+E*E+M*M;P>0&&(w*=P=1/Math.sqrt(P),E*=P,M*=P);var D=g*M-y*E,O=y*w-m*M,F=m*E-g*w;return(P=D*D+O*O+F*F)>0&&(D*=P=1/Math.sqrt(P),O*=P,F*=P),t[0]=D,t[1]=O,t[2]=F,t[3]=0,t[4]=E*F-M*O,t[5]=M*D-w*F,t[6]=w*O-E*D,t[7]=0,t[8]=w,t[9]=E,t[10]=M,t[11]=0,t[12]=a,t[13]=c,t[14]=d,t[15]=1,t},xi.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},xi.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},xi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t[8]=e[8]+i[8],t[9]=e[9]+i[9],t[10]=e[10]+i[10],t[11]=e[11]+i[11],t[12]=e[12]+i[12],t[13]=e[13]+i[13],t[14]=e[14]+i[14],t[15]=e[15]+i[15],t},xi.subtract=vv,xi.multiplyScalar=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*i,t[9]=e[9]*i,t[10]=e[10]*i,t[11]=e[11]*i,t[12]=e[12]*i,t[13]=e[13]*i,t[14]=e[14]*i,t[15]=e[15]*i,t},xi.multiplyScalarAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t[4]=e[4]+i[4]*n,t[5]=e[5]+i[5]*n,t[6]=e[6]+i[6]*n,t[7]=e[7]+i[7]*n,t[8]=e[8]+i[8]*n,t[9]=e[9]+i[9]*n,t[10]=e[10]+i[10]*n,t[11]=e[11]+i[11]*n,t[12]=e[12]+i[12]*n,t[13]=e[13]+i[13]*n,t[14]=e[14]+i[14]*n,t[15]=e[15]+i[15]*n,t},xi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},xi.equals=function(t,e){var i=t[0],n=t[1],a=t[2],c=t[3],d=t[4],m=t[5],g=t[6],y=t[7],w=t[8],E=t[9],M=t[10],P=t[11],D=t[12],O=t[13],F=t[14],V=t[15],W=e[0],Q=e[1],J=e[2],oe=e[3],se=e[4],he=e[5],ge=e[6],xe=e[7],Ae=e[8],be=e[9],ze=e[10],qe=e[11],De=e[12],Ge=e[13],Pe=e[14],je=e[15];return Math.abs(i-W)<=Hr.EPSILON*Math.max(1,Math.abs(i),Math.abs(W))&&Math.abs(n-Q)<=Hr.EPSILON*Math.max(1,Math.abs(n),Math.abs(Q))&&Math.abs(a-J)<=Hr.EPSILON*Math.max(1,Math.abs(a),Math.abs(J))&&Math.abs(c-oe)<=Hr.EPSILON*Math.max(1,Math.abs(c),Math.abs(oe))&&Math.abs(d-se)<=Hr.EPSILON*Math.max(1,Math.abs(d),Math.abs(se))&&Math.abs(m-he)<=Hr.EPSILON*Math.max(1,Math.abs(m),Math.abs(he))&&Math.abs(g-ge)<=Hr.EPSILON*Math.max(1,Math.abs(g),Math.abs(ge))&&Math.abs(y-xe)<=Hr.EPSILON*Math.max(1,Math.abs(y),Math.abs(xe))&&Math.abs(w-Ae)<=Hr.EPSILON*Math.max(1,Math.abs(w),Math.abs(Ae))&&Math.abs(E-be)<=Hr.EPSILON*Math.max(1,Math.abs(E),Math.abs(be))&&Math.abs(M-ze)<=Hr.EPSILON*Math.max(1,Math.abs(M),Math.abs(ze))&&Math.abs(P-qe)<=Hr.EPSILON*Math.max(1,Math.abs(P),Math.abs(qe))&&Math.abs(D-De)<=Hr.EPSILON*Math.max(1,Math.abs(D),Math.abs(De))&&Math.abs(O-Ge)<=Hr.EPSILON*Math.max(1,Math.abs(O),Math.abs(Ge))&&Math.abs(F-Pe)<=Hr.EPSILON*Math.max(1,Math.abs(F),Math.abs(Pe))&&Math.abs(V-je)<=Hr.EPSILON*Math.max(1,Math.abs(V),Math.abs(je))},xi.sub=xi.mul=xi.ortho=xi.perspective=void 0;var Hr=function(t,e){if(t&&t.__esModule)return t;if(t===null||dg(t)!=="object"&&typeof t!="function")return{default:t};var i=dv(void 0);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,i&&i.set(t,n),n}(yn);function dv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(dv=function(n){return n?i:e})(t)}function fv(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pv(t,e,i){var n=e[0],a=e[1],c=e[2],d=e[3],m=e[4],g=e[5],y=e[6],w=e[7],E=e[8],M=e[9],P=e[10],D=e[11],O=e[12],F=e[13],V=e[14],W=e[15],Q=i[0],J=i[1],oe=i[2],se=i[3];return t[0]=Q*n+J*m+oe*E+se*O,t[1]=Q*a+J*g+oe*M+se*F,t[2]=Q*c+J*y+oe*P+se*V,t[3]=Q*d+J*w+oe*D+se*W,t[4]=(Q=i[4])*n+(J=i[5])*m+(oe=i[6])*E+(se=i[7])*O,t[5]=Q*a+J*g+oe*M+se*F,t[6]=Q*c+J*y+oe*P+se*V,t[7]=Q*d+J*w+oe*D+se*W,t[8]=(Q=i[8])*n+(J=i[9])*m+(oe=i[10])*E+(se=i[11])*O,t[9]=Q*a+J*g+oe*M+se*F,t[10]=Q*c+J*y+oe*P+se*V,t[11]=Q*d+J*w+oe*D+se*W,t[12]=(Q=i[12])*n+(J=i[13])*m+(oe=i[14])*E+(se=i[15])*O,t[13]=Q*a+J*g+oe*M+se*F,t[14]=Q*c+J*y+oe*P+se*V,t[15]=Q*d+J*w+oe*D+se*W,t}function mv(t,e,i){var n=e[0],a=e[1],c=e[2],d=e[3],m=n+n,g=a+a,y=c+c,w=n*m,E=n*g,M=n*y,P=a*g,D=a*y,O=c*y,F=d*m,V=d*g,W=d*y;return t[0]=1-(P+O),t[1]=E+W,t[2]=M-V,t[3]=0,t[4]=E-W,t[5]=1-(w+O),t[6]=D+F,t[7]=0,t[8]=M+V,t[9]=D-F,t[10]=1-(w+P),t[11]=0,t[12]=i[0],t[13]=i[1],t[14]=i[2],t[15]=1,t}function _v(t,e){var i=e[4],n=e[5],a=e[6],c=e[8],d=e[9],m=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(i,n,a),t[2]=Math.hypot(c,d,m),t}function gv(t,e,i,n,a){var c,d=1/Math.tan(e/2);return t[0]=d/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,a!=null&&a!==1/0?(t[10]=(a+n)*(c=1/(n-a)),t[14]=2*a*n*c):(t[10]=-1,t[14]=-2*n),t}function yv(t,e,i,n,a,c,d){var m=1/(e-i),g=1/(n-a),y=1/(c-d);return t[0]=-2*m,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*y,t[11]=0,t[12]=(e+i)*m,t[13]=(a+n)*g,t[14]=(d+c)*y,t[15]=1,t}function vv(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t[4]=e[4]-i[4],t[5]=e[5]-i[5],t[6]=e[6]-i[6],t[7]=e[7]-i[7],t[8]=e[8]-i[8],t[9]=e[9]-i[9],t[10]=e[10]-i[10],t[11]=e[11]-i[11],t[12]=e[12]-i[12],t[13]=e[13]-i[13],t[14]=e[14]-i[14],t[15]=e[15]-i[15],t}xi.perspective=gv,xi.ortho=yv,xi.mul=pv,xi.sub=vv;var pi={},yi={};function fg(t){return fg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fg(t)}Object.defineProperty(yi,"__esModule",{value:!0}),yi.create=bv,yi.clone=function(t){var e=new pa.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},yi.length=wv,yi.fromValues=function(t,e,i){var n=new pa.ARRAY_TYPE(3);return n[0]=t,n[1]=e,n[2]=i,n},yi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},yi.set=function(t,e,i,n){return t[0]=e,t[1]=i,t[2]=n,t},yi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t},yi.subtract=Tv,yi.multiply=Ev,yi.divide=Sv,yi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},yi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},yi.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t},yi.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t},yi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},yi.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t},yi.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t},yi.distance=Mv,yi.squaredDistance=Av,yi.squaredLength=Iv,yi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},yi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},yi.normalize=function(t,e){var i=e[0],n=e[1],a=e[2],c=i*i+n*n+a*a;return c>0&&(c=1/Math.sqrt(c)),t[0]=e[0]*c,t[1]=e[1]*c,t[2]=e[2]*c,t},yi.dot=Cv,yi.cross=function(t,e,i){var n=e[0],a=e[1],c=e[2],d=i[0],m=i[1],g=i[2];return t[0]=a*g-c*m,t[1]=c*d-n*g,t[2]=n*m-a*d,t},yi.lerp=function(t,e,i,n){var a=e[0],c=e[1],d=e[2];return t[0]=a+n*(i[0]-a),t[1]=c+n*(i[1]-c),t[2]=d+n*(i[2]-d),t},yi.hermite=function(t,e,i,n,a,c){var d=c*c,m=d*(2*c-3)+1,g=d*(c-2)+c,y=d*(c-1),w=d*(3-2*c);return t[0]=e[0]*m+i[0]*g+n[0]*y+a[0]*w,t[1]=e[1]*m+i[1]*g+n[1]*y+a[1]*w,t[2]=e[2]*m+i[2]*g+n[2]*y+a[2]*w,t},yi.bezier=function(t,e,i,n,a,c){var d=1-c,m=d*d,g=c*c,y=m*d,w=3*c*m,E=3*g*d,M=g*c;return t[0]=e[0]*y+i[0]*w+n[0]*E+a[0]*M,t[1]=e[1]*y+i[1]*w+n[1]*E+a[1]*M,t[2]=e[2]*y+i[2]*w+n[2]*E+a[2]*M,t},yi.random=function(t,e){e=e||1;var i=2*pa.RANDOM()*Math.PI,n=2*pa.RANDOM()-1,a=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(i)*a,t[1]=Math.sin(i)*a,t[2]=n*e,t},yi.transformMat4=function(t,e,i){var n=e[0],a=e[1],c=e[2],d=i[3]*n+i[7]*a+i[11]*c+i[15];return t[0]=(i[0]*n+i[4]*a+i[8]*c+i[12])/(d=d||1),t[1]=(i[1]*n+i[5]*a+i[9]*c+i[13])/d,t[2]=(i[2]*n+i[6]*a+i[10]*c+i[14])/d,t},yi.transformMat3=function(t,e,i){var n=e[0],a=e[1],c=e[2];return t[0]=n*i[0]+a*i[3]+c*i[6],t[1]=n*i[1]+a*i[4]+c*i[7],t[2]=n*i[2]+a*i[5]+c*i[8],t},yi.transformQuat=function(t,e,i){var n=i[0],a=i[1],c=i[2],d=e[0],m=e[1],g=e[2],y=a*g-c*m,w=c*d-n*g,E=n*m-a*d,M=a*E-c*w,P=c*y-n*E,D=n*w-a*y,O=2*i[3];return w*=O,E*=O,P*=2,D*=2,t[0]=d+(y*=O)+(M*=2),t[1]=m+w+P,t[2]=g+E+D,t},yi.rotateX=function(t,e,i,n){var a=[],c=[];return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],c[0]=a[0],c[1]=a[1]*Math.cos(n)-a[2]*Math.sin(n),c[2]=a[1]*Math.sin(n)+a[2]*Math.cos(n),t[0]=c[0]+i[0],t[1]=c[1]+i[1],t[2]=c[2]+i[2],t},yi.rotateY=function(t,e,i,n){var a=[],c=[];return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],c[0]=a[2]*Math.sin(n)+a[0]*Math.cos(n),c[1]=a[1],c[2]=a[2]*Math.cos(n)-a[0]*Math.sin(n),t[0]=c[0]+i[0],t[1]=c[1]+i[1],t[2]=c[2]+i[2],t},yi.rotateZ=function(t,e,i,n){var a=[],c=[];return a[0]=e[0]-i[0],a[1]=e[1]-i[1],a[2]=e[2]-i[2],c[0]=a[0]*Math.cos(n)-a[1]*Math.sin(n),c[1]=a[0]*Math.sin(n)+a[1]*Math.cos(n),c[2]=a[2],t[0]=c[0]+i[0],t[1]=c[1]+i[1],t[2]=c[2]+i[2],t},yi.angle=function(t,e){var i=t[0],n=t[1],a=t[2],c=e[0],d=e[1],m=e[2],g=Math.sqrt(i*i+n*n+a*a)*Math.sqrt(c*c+d*d+m*m),y=g&&Cv(t,e)/g;return Math.acos(Math.min(Math.max(y,-1),1))},yi.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},yi.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},yi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},yi.equals=function(t,e){var i=t[0],n=t[1],a=t[2],c=e[0],d=e[1],m=e[2];return Math.abs(i-c)<=pa.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(n-d)<=pa.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(a-m)<=pa.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))},yi.forEach=yi.sqrLen=yi.len=yi.sqrDist=yi.dist=yi.div=yi.mul=yi.sub=void 0;var pa=function(t,e){if(t&&t.__esModule)return t;if(t===null||fg(t)!=="object"&&typeof t!="function")return{default:t};var i=xv(void 0);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,i&&i.set(t,n),n}(yn);function xv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(xv=function(n){return n?i:e})(t)}function bv(){var t=new pa.ARRAY_TYPE(3);return pa.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function wv(t){return Math.hypot(t[0],t[1],t[2])}function Tv(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Ev(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function Sv(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t}function Mv(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function Av(t,e){var i=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2];return i*i+n*n+a*a}function Iv(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n}function Cv(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}yi.sub=Tv,yi.mul=Ev,yi.div=Sv,yi.dist=Mv,yi.sqrDist=Av,yi.len=wv,yi.sqrLen=Iv;var ma,oM=(ma=bv(),function(t,e,i,n,a,c){var d,m;for(e||(e=3),i||(i=0),m=n?Math.min(n*e+i,t.length):t.length,d=i;d<m;d+=e)ma[0]=t[d],ma[1]=t[d+1],ma[2]=t[d+2],a(ma,ma,c),t[d]=ma[0],t[d+1]=ma[1],t[d+2]=ma[2];return t});yi.forEach=oM;var Pi={};function pg(t){return pg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pg(t)}Object.defineProperty(Pi,"__esModule",{value:!0}),Pi.create=Rv,Pi.clone=function(t){var e=new Zs.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Pi.fromValues=function(t,e,i,n){var a=new Zs.ARRAY_TYPE(4);return a[0]=t,a[1]=e,a[2]=i,a[3]=n,a},Pi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Pi.set=function(t,e,i,n,a){return t[0]=e,t[1]=i,t[2]=n,t[3]=a,t},Pi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t},Pi.subtract=Lv,Pi.multiply=Dv,Pi.divide=Ov,Pi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},Pi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},Pi.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t[3]=Math.min(e[3],i[3]),t},Pi.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t[3]=Math.max(e[3],i[3]),t},Pi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},Pi.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t},Pi.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t[2]=e[2]+i[2]*n,t[3]=e[3]+i[3]*n,t},Pi.distance=zv,Pi.squaredDistance=kv,Pi.length=Bv,Pi.squaredLength=Fv,Pi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},Pi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},Pi.normalize=function(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],d=i*i+n*n+a*a+c*c;return d>0&&(d=1/Math.sqrt(d)),t[0]=i*d,t[1]=n*d,t[2]=a*d,t[3]=c*d,t},Pi.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},Pi.cross=function(t,e,i,n){var a=i[0]*n[1]-i[1]*n[0],c=i[0]*n[2]-i[2]*n[0],d=i[0]*n[3]-i[3]*n[0],m=i[1]*n[2]-i[2]*n[1],g=i[1]*n[3]-i[3]*n[1],y=i[2]*n[3]-i[3]*n[2],w=e[0],E=e[1],M=e[2],P=e[3];return t[0]=E*y-M*g+P*m,t[1]=-w*y+M*d-P*c,t[2]=w*g-E*d+P*a,t[3]=-w*m+E*c-M*a,t},Pi.lerp=function(t,e,i,n){var a=e[0],c=e[1],d=e[2],m=e[3];return t[0]=a+n*(i[0]-a),t[1]=c+n*(i[1]-c),t[2]=d+n*(i[2]-d),t[3]=m+n*(i[3]-m),t},Pi.random=function(t,e){var i,n,a,c,d,m;e=e||1;do d=(i=2*Zs.RANDOM()-1)*i+(n=2*Zs.RANDOM()-1)*n;while(d>=1);do m=(a=2*Zs.RANDOM()-1)*a+(c=2*Zs.RANDOM()-1)*c;while(m>=1);var g=Math.sqrt((1-d)/m);return t[0]=e*i,t[1]=e*n,t[2]=e*a*g,t[3]=e*c*g,t},Pi.transformMat4=function(t,e,i){var n=e[0],a=e[1],c=e[2],d=e[3];return t[0]=i[0]*n+i[4]*a+i[8]*c+i[12]*d,t[1]=i[1]*n+i[5]*a+i[9]*c+i[13]*d,t[2]=i[2]*n+i[6]*a+i[10]*c+i[14]*d,t[3]=i[3]*n+i[7]*a+i[11]*c+i[15]*d,t},Pi.transformQuat=function(t,e,i){var n=e[0],a=e[1],c=e[2],d=i[0],m=i[1],g=i[2],y=i[3],w=y*n+m*c-g*a,E=y*a+g*n-d*c,M=y*c+d*a-m*n,P=-d*n-m*a-g*c;return t[0]=w*y+P*-d+E*-g-M*-m,t[1]=E*y+P*-m+M*-d-w*-g,t[2]=M*y+P*-g+w*-m-E*-d,t[3]=e[3],t},Pi.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},Pi.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Pi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Pi.equals=function(t,e){var i=t[0],n=t[1],a=t[2],c=t[3],d=e[0],m=e[1],g=e[2],y=e[3];return Math.abs(i-d)<=Zs.EPSILON*Math.max(1,Math.abs(i),Math.abs(d))&&Math.abs(n-m)<=Zs.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(a-g)<=Zs.EPSILON*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(c-y)<=Zs.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))},Pi.forEach=Pi.sqrLen=Pi.len=Pi.sqrDist=Pi.dist=Pi.div=Pi.mul=Pi.sub=void 0;var Zs=function(t,e){if(t&&t.__esModule)return t;if(t===null||pg(t)!=="object"&&typeof t!="function")return{default:t};var i=Pv(void 0);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,i&&i.set(t,n),n}(yn);function Pv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Pv=function(n){return n?i:e})(t)}function Rv(){var t=new Zs.ARRAY_TYPE(4);return Zs.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Lv(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t[3]=e[3]-i[3],t}function Dv(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t[3]=e[3]*i[3],t}function Ov(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t[3]=e[3]/i[3],t}function zv(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function kv(t,e){var i=e[0]-t[0],n=e[1]-t[1],a=e[2]-t[2],c=e[3]-t[3];return i*i+n*n+a*a+c*c}function Bv(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Fv(t){var e=t[0],i=t[1],n=t[2],a=t[3];return e*e+i*i+n*n+a*a}Pi.sub=Lv,Pi.mul=Dv,Pi.div=Ov,Pi.dist=zv,Pi.sqrDist=kv,Pi.len=Bv,Pi.sqrLen=Fv;var aM=function(){var t=Rv();return function(e,i,n,a,c,d){var m,g;for(i||(i=4),n||(n=0),g=a?Math.min(a*i+n,e.length):e.length,m=n;m<g;m+=i)t[0]=e[m],t[1]=e[m+1],t[2]=e[m+2],t[3]=e[m+3],c(t,t,d),e[m]=t[0],e[m+1]=t[1],e[m+2]=t[2],e[m+3]=t[3];return e}}();function mg(t){return mg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},mg(t)}Pi.forEach=aM,Object.defineProperty(pi,"__esModule",{value:!0}),pi.create=_g,pi.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},pi.setAxisAngle=Vv,pi.getAxisAngle=function(t,e){var i=2*Math.acos(e[3]),n=Math.sin(i/2);return n>Tc.EPSILON?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),i},pi.getAngle=function(t,e){var i=Zv(t,e);return Math.acos(2*i*i-1)},pi.multiply=Uv,pi.rotateX=function(t,e,i){i*=.5;var n=e[0],a=e[1],c=e[2],d=e[3],m=Math.sin(i),g=Math.cos(i);return t[0]=n*g+d*m,t[1]=a*g+c*m,t[2]=c*g-a*m,t[3]=d*g-n*m,t},pi.rotateY=function(t,e,i){i*=.5;var n=e[0],a=e[1],c=e[2],d=e[3],m=Math.sin(i),g=Math.cos(i);return t[0]=n*g-c*m,t[1]=a*g+d*m,t[2]=c*g+n*m,t[3]=d*g-a*m,t},pi.rotateZ=function(t,e,i){i*=.5;var n=e[0],a=e[1],c=e[2],d=e[3],m=Math.sin(i),g=Math.cos(i);return t[0]=n*g+a*m,t[1]=a*g-n*m,t[2]=c*g+d*m,t[3]=d*g-c*m,t},pi.calculateW=function(t,e){var i=e[0],n=e[1],a=e[2];return t[0]=i,t[1]=n,t[2]=a,t[3]=Math.sqrt(Math.abs(1-i*i-n*n-a*a)),t},pi.exp=jv,pi.ln=Gv,pi.pow=function(t,e,i){return Gv(t,e),qv(t,t,i),jv(t,t),t},pi.slerp=Hp,pi.random=function(t){var e=Tc.RANDOM(),i=Tc.RANDOM(),n=Tc.RANDOM(),a=Math.sqrt(1-e),c=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*i),t[1]=a*Math.cos(2*Math.PI*i),t[2]=c*Math.sin(2*Math.PI*n),t[3]=c*Math.cos(2*Math.PI*n),t},pi.invert=function(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],d=i*i+n*n+a*a+c*c,m=d?1/d:0;return t[0]=-i*m,t[1]=-n*m,t[2]=-a*m,t[3]=c*m,t},pi.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},pi.fromMat3=$v,pi.fromEuler=function(t,e,i,n){var a=.5*Math.PI/180;e*=a,i*=a,n*=a;var c=Math.sin(e),d=Math.cos(e),m=Math.sin(i),g=Math.cos(i),y=Math.sin(n),w=Math.cos(n);return t[0]=c*g*w-d*m*y,t[1]=d*m*w+c*g*y,t[2]=d*g*y-c*m*w,t[3]=d*g*w+c*m*y,t},pi.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},pi.setAxes=pi.sqlerp=pi.rotationTo=pi.equals=pi.exactEquals=pi.normalize=pi.sqrLen=pi.squaredLength=pi.len=pi.length=pi.lerp=pi.dot=pi.scale=pi.mul=pi.add=pi.set=pi.copy=pi.fromValues=pi.clone=void 0;var Tc=Zp(yn),lM=Zp(dr),_a=Zp(yi),Ls=Zp(Pi);function Nv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Nv=function(n){return n?i:e})(t)}function Zp(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||mg(t)!=="object"&&typeof t!="function")return{default:t};var i=Nv(e);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,i&&i.set(t,n),n}function _g(){var t=new Tc.ARRAY_TYPE(4);return Tc.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Vv(t,e,i){i*=.5;var n=Math.sin(i);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(i),t}function Uv(t,e,i){var n=e[0],a=e[1],c=e[2],d=e[3],m=i[0],g=i[1],y=i[2],w=i[3];return t[0]=n*w+d*m+a*y-c*g,t[1]=a*w+d*g+c*m-n*y,t[2]=c*w+d*y+n*g-a*m,t[3]=d*w-n*m-a*g-c*y,t}function jv(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],d=Math.sqrt(i*i+n*n+a*a),m=Math.exp(c),g=d>0?m*Math.sin(d)/d:0;return t[0]=i*g,t[1]=n*g,t[2]=a*g,t[3]=m*Math.cos(d),t}function Gv(t,e){var i=e[0],n=e[1],a=e[2],c=e[3],d=Math.sqrt(i*i+n*n+a*a),m=d>0?Math.atan2(d,c)/d:0;return t[0]=i*m,t[1]=n*m,t[2]=a*m,t[3]=.5*Math.log(i*i+n*n+a*a+c*c),t}function Hp(t,e,i,n){var a,c,d,m,g,y=e[0],w=e[1],E=e[2],M=e[3],P=i[0],D=i[1],O=i[2],F=i[3];return(c=y*P+w*D+E*O+M*F)<0&&(c=-c,P=-P,D=-D,O=-O,F=-F),1-c>Tc.EPSILON?(a=Math.acos(c),d=Math.sin(a),m=Math.sin((1-n)*a)/d,g=Math.sin(n*a)/d):(m=1-n,g=n),t[0]=m*y+g*P,t[1]=m*w+g*D,t[2]=m*E+g*O,t[3]=m*M+g*F,t}function $v(t,e){var i,n=e[0]+e[4]+e[8];if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var a=0;e[4]>e[0]&&(a=1),e[8]>e[3*a+a]&&(a=2);var c=(a+1)%3,d=(a+2)%3;i=Math.sqrt(e[3*a+a]-e[3*c+c]-e[3*d+d]+1),t[a]=.5*i,t[3]=(e[3*c+d]-e[3*d+c])*(i=.5/i),t[c]=(e[3*c+a]+e[3*a+c])*i,t[d]=(e[3*d+a]+e[3*a+d])*i}return t}pi.clone=Ls.clone,pi.fromValues=Ls.fromValues,pi.copy=Ls.copy,pi.set=Ls.set,pi.add=Ls.add,pi.mul=Uv;var qv=Ls.scale;pi.scale=qv;var Zv=Ls.dot;pi.dot=Zv,pi.lerp=Ls.lerp;var Hv=Ls.length;pi.length=Hv,pi.len=Hv;var Wv=Ls.squaredLength;pi.squaredLength=Wv,pi.sqrLen=Wv;var gg=Ls.normalize;pi.normalize=gg,pi.exactEquals=Ls.exactEquals,pi.equals=Ls.equals;var oo,Xv,Kv,cM=(oo=_a.create(),Xv=_a.fromValues(1,0,0),Kv=_a.fromValues(0,1,0),function(t,e,i){var n=_a.dot(e,i);return n<-.999999?(_a.cross(oo,Xv,e),_a.len(oo)<1e-6&&_a.cross(oo,Kv,e),_a.normalize(oo,oo),Vv(t,oo,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(_a.cross(oo,e,i),t[0]=oo[0],t[1]=oo[1],t[2]=oo[2],t[3]=1+n,gg(t,t))});pi.rotationTo=cM;var yg,vg,uM=(yg=_g(),vg=_g(),function(t,e,i,n,a,c){return Hp(yg,e,a,c),Hp(vg,i,n,c),Hp(t,yg,vg,2*c*(1-c)),t});pi.sqlerp=uM;var ao,hM=(ao=lM.create(),function(t,e,i,n){return ao[0]=i[0],ao[3]=i[1],ao[6]=i[2],ao[1]=n[0],ao[4]=n[1],ao[7]=n[2],ao[2]=-e[0],ao[5]=-e[1],ao[8]=-e[2],gg(t,$v(t,ao))});pi.setAxes=hM;var Ni={};function xg(t){return xg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},xg(t)}Object.defineProperty(Ni,"__esModule",{value:!0}),Ni.create=function(){var t=new cs.ARRAY_TYPE(8);return cs.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Ni.clone=function(t){var e=new cs.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Ni.fromValues=function(t,e,i,n,a,c,d,m){var g=new cs.ARRAY_TYPE(8);return g[0]=t,g[1]=e,g[2]=i,g[3]=n,g[4]=a,g[5]=c,g[6]=d,g[7]=m,g},Ni.fromRotationTranslationValues=function(t,e,i,n,a,c,d){var m=new cs.ARRAY_TYPE(8);m[0]=t,m[1]=e,m[2]=i,m[3]=n;var g=.5*a,y=.5*c,w=.5*d;return m[4]=g*n+y*i-w*e,m[5]=y*n+w*t-g*i,m[6]=w*n+g*e-y*t,m[7]=-g*t-y*e-w*i,m},Ni.fromRotationTranslation=Qv,Ni.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Ni.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Ni.fromMat4=function(t,e){var i=ga.create();Yv.getRotation(i,e);var n=new cs.ARRAY_TYPE(3);return Yv.getTranslation(n,e),Qv(t,i,n),t},Ni.copy=ex,Ni.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Ni.set=function(t,e,i,n,a,c,d,m,g){return t[0]=e,t[1]=i,t[2]=n,t[3]=a,t[4]=c,t[5]=d,t[6]=m,t[7]=g,t},Ni.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Ni.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Ni.getTranslation=function(t,e){var i=e[4],n=e[5],a=e[6],c=e[7],d=-e[0],m=-e[1],g=-e[2],y=e[3];return t[0]=2*(i*y+c*d+n*g-a*m),t[1]=2*(n*y+c*m+a*d-i*g),t[2]=2*(a*y+c*g+i*m-n*d),t},Ni.translate=function(t,e,i){var n=e[0],a=e[1],c=e[2],d=e[3],m=.5*i[0],g=.5*i[1],y=.5*i[2],w=e[4],E=e[5],M=e[6],P=e[7];return t[0]=n,t[1]=a,t[2]=c,t[3]=d,t[4]=d*m+a*y-c*g+w,t[5]=d*g+c*m-n*y+E,t[6]=d*y+n*g-a*m+M,t[7]=-n*m-a*g-c*y+P,t},Ni.rotateX=function(t,e,i){var n=-e[0],a=-e[1],c=-e[2],d=e[3],m=e[4],g=e[5],y=e[6],w=e[7],E=m*d+w*n+g*c-y*a,M=g*d+w*a+y*n-m*c,P=y*d+w*c+m*a-g*n,D=w*d-m*n-g*a-y*c;return ga.rotateX(t,e,i),t[4]=E*(d=t[3])+D*(n=t[0])+M*(c=t[2])-P*(a=t[1]),t[5]=M*d+D*a+P*n-E*c,t[6]=P*d+D*c+E*a-M*n,t[7]=D*d-E*n-M*a-P*c,t},Ni.rotateY=function(t,e,i){var n=-e[0],a=-e[1],c=-e[2],d=e[3],m=e[4],g=e[5],y=e[6],w=e[7],E=m*d+w*n+g*c-y*a,M=g*d+w*a+y*n-m*c,P=y*d+w*c+m*a-g*n,D=w*d-m*n-g*a-y*c;return ga.rotateY(t,e,i),t[4]=E*(d=t[3])+D*(n=t[0])+M*(c=t[2])-P*(a=t[1]),t[5]=M*d+D*a+P*n-E*c,t[6]=P*d+D*c+E*a-M*n,t[7]=D*d-E*n-M*a-P*c,t},Ni.rotateZ=function(t,e,i){var n=-e[0],a=-e[1],c=-e[2],d=e[3],m=e[4],g=e[5],y=e[6],w=e[7],E=m*d+w*n+g*c-y*a,M=g*d+w*a+y*n-m*c,P=y*d+w*c+m*a-g*n,D=w*d-m*n-g*a-y*c;return ga.rotateZ(t,e,i),t[4]=E*(d=t[3])+D*(n=t[0])+M*(c=t[2])-P*(a=t[1]),t[5]=M*d+D*a+P*n-E*c,t[6]=P*d+D*c+E*a-M*n,t[7]=D*d-E*n-M*a-P*c,t},Ni.rotateByQuatAppend=function(t,e,i){var n=i[0],a=i[1],c=i[2],d=i[3],m=e[0],g=e[1],y=e[2],w=e[3];return t[0]=m*d+w*n+g*c-y*a,t[1]=g*d+w*a+y*n-m*c,t[2]=y*d+w*c+m*a-g*n,t[3]=w*d-m*n-g*a-y*c,t[4]=(m=e[4])*d+(w=e[7])*n+(g=e[5])*c-(y=e[6])*a,t[5]=g*d+w*a+y*n-m*c,t[6]=y*d+w*c+m*a-g*n,t[7]=w*d-m*n-g*a-y*c,t},Ni.rotateByQuatPrepend=function(t,e,i){var n=e[0],a=e[1],c=e[2],d=e[3],m=i[0],g=i[1],y=i[2],w=i[3];return t[0]=n*w+d*m+a*y-c*g,t[1]=a*w+d*g+c*m-n*y,t[2]=c*w+d*y+n*g-a*m,t[3]=d*w-n*m-a*g-c*y,t[4]=n*(w=i[7])+d*(m=i[4])+a*(y=i[6])-c*(g=i[5]),t[5]=a*w+d*g+c*m-n*y,t[6]=c*w+d*y+n*g-a*m,t[7]=d*w-n*m-a*g-c*y,t},Ni.rotateAroundAxis=function(t,e,i,n){if(Math.abs(n)<cs.EPSILON)return ex(t,e);var a=Math.hypot(i[0],i[1],i[2]);n*=.5;var c=Math.sin(n),d=c*i[0]/a,m=c*i[1]/a,g=c*i[2]/a,y=Math.cos(n),w=e[0],E=e[1],M=e[2],P=e[3];t[0]=w*y+P*d+E*g-M*m,t[1]=E*y+P*m+M*d-w*g,t[2]=M*y+P*g+w*m-E*d,t[3]=P*y-w*d-E*m-M*g;var D=e[4],O=e[5],F=e[6],V=e[7];return t[4]=D*y+V*d+O*g-F*m,t[5]=O*y+V*m+F*d-D*g,t[6]=F*y+V*g+D*m-O*d,t[7]=V*y-D*d-O*m-F*g,t},Ni.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t[3]=e[3]+i[3],t[4]=e[4]+i[4],t[5]=e[5]+i[5],t[6]=e[6]+i[6],t[7]=e[7]+i[7],t},Ni.multiply=tx,Ni.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t},Ni.lerp=function(t,e,i,n){var a=1-n;return ix(e,i)<0&&(n=-n),t[0]=e[0]*a+i[0]*n,t[1]=e[1]*a+i[1]*n,t[2]=e[2]*a+i[2]*n,t[3]=e[3]*a+i[3]*n,t[4]=e[4]*a+i[4]*n,t[5]=e[5]*a+i[5]*n,t[6]=e[6]*a+i[6]*n,t[7]=e[7]*a+i[7]*n,t},Ni.invert=function(t,e){var i=Wp(e);return t[0]=-e[0]/i,t[1]=-e[1]/i,t[2]=-e[2]/i,t[3]=e[3]/i,t[4]=-e[4]/i,t[5]=-e[5]/i,t[6]=-e[6]/i,t[7]=e[7]/i,t},Ni.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Ni.normalize=function(t,e){var i=Wp(e);if(i>0){i=Math.sqrt(i);var n=e[0]/i,a=e[1]/i,c=e[2]/i,d=e[3]/i,m=e[4],g=e[5],y=e[6],w=e[7],E=n*m+a*g+c*y+d*w;t[0]=n,t[1]=a,t[2]=c,t[3]=d,t[4]=(m-n*E)/i,t[5]=(g-a*E)/i,t[6]=(y-c*E)/i,t[7]=(w-d*E)/i}return t},Ni.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Ni.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Ni.equals=function(t,e){var i=t[0],n=t[1],a=t[2],c=t[3],d=t[4],m=t[5],g=t[6],y=t[7],w=e[0],E=e[1],M=e[2],P=e[3],D=e[4],O=e[5],F=e[6],V=e[7];return Math.abs(i-w)<=cs.EPSILON*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(n-E)<=cs.EPSILON*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(a-M)<=cs.EPSILON*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(c-P)<=cs.EPSILON*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(d-D)<=cs.EPSILON*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(m-O)<=cs.EPSILON*Math.max(1,Math.abs(m),Math.abs(O))&&Math.abs(g-F)<=cs.EPSILON*Math.max(1,Math.abs(g),Math.abs(F))&&Math.abs(y-V)<=cs.EPSILON*Math.max(1,Math.abs(y),Math.abs(V))},Ni.sqrLen=Ni.squaredLength=Ni.len=Ni.length=Ni.dot=Ni.mul=Ni.setReal=Ni.getReal=void 0;var cs=bg(yn),ga=bg(pi),Yv=bg(xi);function Jv(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(Jv=function(n){return n?i:e})(t)}function bg(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||xg(t)!=="object"&&typeof t!="function")return{default:t};var i=Jv(e);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,i&&i.set(t,n),n}function Qv(t,e,i){var n=.5*i[0],a=.5*i[1],c=.5*i[2],d=e[0],m=e[1],g=e[2],y=e[3];return t[0]=d,t[1]=m,t[2]=g,t[3]=y,t[4]=n*y+a*g-c*m,t[5]=a*y+c*d-n*g,t[6]=c*y+n*m-a*d,t[7]=-n*d-a*m-c*g,t}function ex(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function tx(t,e,i){var n=e[0],a=e[1],c=e[2],d=e[3],m=i[4],g=i[5],y=i[6],w=i[7],E=e[4],M=e[5],P=e[6],D=e[7],O=i[0],F=i[1],V=i[2],W=i[3];return t[0]=n*W+d*O+a*V-c*F,t[1]=a*W+d*F+c*O-n*V,t[2]=c*W+d*V+n*F-a*O,t[3]=d*W-n*O-a*F-c*V,t[4]=n*w+d*m+a*y-c*g+E*W+D*O+M*V-P*F,t[5]=a*w+d*g+c*m-n*y+M*W+D*F+P*O-E*V,t[6]=c*w+d*y+n*g-a*m+P*W+D*V+E*F-M*O,t[7]=d*w-n*m-a*g-c*y+D*W-E*O-M*F-P*V,t}Ni.getReal=ga.copy,Ni.setReal=ga.copy,Ni.mul=tx;var ix=ga.dot;Ni.dot=ix;var rx=ga.length;Ni.length=rx,Ni.len=rx;var Wp=ga.squaredLength;Ni.squaredLength=Wp,Ni.sqrLen=Wp;var Mi={};function wg(t){return wg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},wg(t)}Object.defineProperty(Mi,"__esModule",{value:!0}),Mi.create=sx,Mi.clone=function(t){var e=new Ec.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Mi.fromValues=function(t,e){var i=new Ec.ARRAY_TYPE(2);return i[0]=t,i[1]=e,i},Mi.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Mi.set=function(t,e,i){return t[0]=e,t[1]=i,t},Mi.add=function(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t},Mi.subtract=ox,Mi.multiply=ax,Mi.divide=lx,Mi.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Mi.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Mi.min=function(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t},Mi.max=function(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t},Mi.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Mi.scale=function(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t},Mi.scaleAndAdd=function(t,e,i,n){return t[0]=e[0]+i[0]*n,t[1]=e[1]+i[1]*n,t},Mi.distance=cx,Mi.squaredDistance=ux,Mi.length=hx,Mi.squaredLength=dx,Mi.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Mi.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Mi.normalize=function(t,e){var i=e[0],n=e[1],a=i*i+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t},Mi.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Mi.cross=function(t,e,i){var n=e[0]*i[1]-e[1]*i[0];return t[0]=t[1]=0,t[2]=n,t},Mi.lerp=function(t,e,i,n){var a=e[0],c=e[1];return t[0]=a+n*(i[0]-a),t[1]=c+n*(i[1]-c),t},Mi.random=function(t,e){e=e||1;var i=2*Ec.RANDOM()*Math.PI;return t[0]=Math.cos(i)*e,t[1]=Math.sin(i)*e,t},Mi.transformMat2=function(t,e,i){var n=e[0],a=e[1];return t[0]=i[0]*n+i[2]*a,t[1]=i[1]*n+i[3]*a,t},Mi.transformMat2d=function(t,e,i){var n=e[0],a=e[1];return t[0]=i[0]*n+i[2]*a+i[4],t[1]=i[1]*n+i[3]*a+i[5],t},Mi.transformMat3=function(t,e,i){var n=e[0],a=e[1];return t[0]=i[0]*n+i[3]*a+i[6],t[1]=i[1]*n+i[4]*a+i[7],t},Mi.transformMat4=function(t,e,i){var n=e[0],a=e[1];return t[0]=i[0]*n+i[4]*a+i[12],t[1]=i[1]*n+i[5]*a+i[13],t},Mi.rotate=function(t,e,i,n){var a=e[0]-i[0],c=e[1]-i[1],d=Math.sin(n),m=Math.cos(n);return t[0]=a*m-c*d+i[0],t[1]=a*d+c*m+i[1],t},Mi.angle=function(t,e){var i=t[0],n=t[1],a=e[0],c=e[1],d=Math.sqrt(i*i+n*n)*Math.sqrt(a*a+c*c);return Math.acos(Math.min(Math.max(d&&(i*a+n*c)/d,-1),1))},Mi.zero=function(t){return t[0]=0,t[1]=0,t},Mi.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Mi.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Mi.equals=function(t,e){var i=t[0],n=t[1],a=e[0],c=e[1];return Math.abs(i-a)<=Ec.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(n-c)<=Ec.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))},Mi.forEach=Mi.sqrLen=Mi.sqrDist=Mi.dist=Mi.div=Mi.mul=Mi.sub=Mi.len=void 0;var Ec=function(t,e){if(t&&t.__esModule)return t;if(t===null||wg(t)!=="object"&&typeof t!="function")return{default:t};var i=nx(void 0);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,i&&i.set(t,n),n}(yn);function nx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(nx=function(n){return n?i:e})(t)}function sx(){var t=new Ec.ARRAY_TYPE(2);return Ec.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function ox(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t}function ax(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t}function lx(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t}function cx(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function ux(t,e){var i=e[0]-t[0],n=e[1]-t[1];return i*i+n*n}function hx(t){return Math.hypot(t[0],t[1])}function dx(t){var e=t[0],i=t[1];return e*e+i*i}Mi.len=hx,Mi.sub=ox,Mi.mul=ax,Mi.div=lx,Mi.dist=cx,Mi.sqrDist=ux,Mi.sqrLen=dx;var dM=function(){var t=sx();return function(e,i,n,a,c,d){var m,g;for(i||(i=2),n||(n=0),g=a?Math.min(a*i+n,e.length):e.length,m=n;m<g;m+=i)t[0]=e[m],t[1]=e[m+1],c(t,t,d),e[m]=t[0],e[m+1]=t[1];return e}}();function Tg(t){return Tg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Tg(t)}Mi.forEach=dM,Object.defineProperty(gn,"__esModule",{value:!0}),o.a7=gn.vec4=o.N=gn.vec3=gn.vec2=gn.quat2=o.bi=gn.quat=o.a6=gn.mat4=o.co=gn.mat3=gn.mat2d=o.b4=gn.mat2=gn.glMatrix=void 0;var fM=Go(yn);gn.glMatrix=fM;var pM=Go(Br);o.b4=gn.mat2=pM;var mM=Go(Vr);gn.mat2d=mM;var _M=Go(dr);o.co=gn.mat3=_M;var gM=Go(xi);o.a6=gn.mat4=gM;var yM=Go(pi);o.bi=gn.quat=yM;var vM=Go(Ni);gn.quat2=vM;var xM=Go(Mi);gn.vec2=xM;var bM=Go(yi);o.N=gn.vec3=bM;var wM=Go(Pi);function fx(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(fx=function(n){return n?i:e})(t)}function Go(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||Tg(t)!=="object"&&typeof t!="function")return{default:t};var i=fx(e);if(i&&i.has(t))return i.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var c in t)if(c!=="default"&&Object.prototype.hasOwnProperty.call(t,c)){var d=a?Object.getOwnPropertyDescriptor(t,c):null;d&&(d.get||d.set)?Object.defineProperty(n,c,d):n[c]=t[c]}return n.default=t,i&&i.set(t,n),n}o.a7=gn.vec4=wM;class Eg{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,n){const a=o.N.dot(i,this.dir);if(Math.abs(a)<1e-6)return!1;const c=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/a;return n[0]=this.pos[0]+this.dir[0]*c,n[1]=this.pos[1]+this.dir[1]*c,n[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(e,i,n){if(o.N.equals(this.pos,e)||i===0)return n[0]=n[1]=n[2]=0,!1;const[a,c,d]=this.dir,m=this.pos[0]-e[0],g=this.pos[1]-e[1],y=this.pos[2]-e[2],w=a*a+c*c+d*d,E=2*(m*a+g*c+y*d),M=E*E-4*w*(m*m+g*g+y*y-i*i);if(M<0){const P=Math.max(-E/2,0),D=m+a*P,O=g+c*P,F=y+d*P,V=Math.hypot(D,O,F);return n[0]=D*i/V,n[1]=O*i/V,n[2]=F*i/V,!1}{const P=(-E-Math.sqrt(M))/(2*w);if(P<0){const D=Math.hypot(m,g,y);return n[0]=m*i/D,n[1]=g*i/D,n[2]=y*i/D,!1}return n[0]=m+a*P,n[1]=g+c*P,n[2]=y+d*P,!0}}}class Sg{constructor(e,i,n,a,c){this.TL=e,this.TR=i,this.BR=n,this.BL=a,this.horizon=c}static fromInvProjectionMatrix(e,i,n){const a=[-1,1,1],c=[1,1,1],d=[1,-1,1],m=[-1,-1,1],g=o.N.transformMat4(a,a,e),y=o.N.transformMat4(c,c,e),w=o.N.transformMat4(d,d,e),E=o.N.transformMat4(m,m,e);return new Sg(g,y,w,E,i/n)}}function Zd(t,e,i){let n=1/0,a=-1/0;const c=[];for(const d of t){o.N.sub(c,d,e);const m=o.N.dot(c,i);n=Math.min(n,m),a=Math.max(a,m)}return[n,a]}function px(t,e){let i=!0;for(let n=0;n<t.planes.length;n++){const a=t.planes[n];let c=0;for(let d=0;d<e.length;d++)c+=o.N.dot(a,e[d])+a[3]>=0;if(c===0)return 0;c!==e.length&&(i=!1)}return i?2:1}function mx(t,e){for(const i of t.projections){const n=Zd(e,t.points[0],i.axis);if(i.projection[1]<n[0]||i.projection[0]>n[1])return 0}return 1}function _x(t,e){let i=0;const n=[0,0,0,0];for(let a=0;a<t.length;a++)n[0]=t[a][0],n[1]=t[a][1],n[2]=t[a][2],n[3]=1,o.a7.dot(n,e)>=0&&i++;return i}class Mg{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Ur.fromPoints(this.points),this.projections=[],this.frustumEdges=[o.N.sub([],this.points[2],this.points[3]),o.N.sub([],this.points[0],this.points[3]),o.N.sub([],this.points[4],this.points[0]),o.N.sub([],this.points[5],this.points[1]),o.N.sub([],this.points[6],this.points[2]),o.N.sub([],this.points[7],this.points[3])];for(const n of this.frustumEdges){const a=[0,-n[2],n[1]],c=[n[2],0,-n[0]];this.projections.push({axis:a,projection:Zd(this.points,this.points[0],a)}),this.projections.push({axis:c,projection:Zd(this.points,this.points[0],c)})}}static fromInvProjectionMatrix(e,i,n,a){const c=Math.pow(2,n),d=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(y=>{const w=o.a7.transformMat4([],y,e),E=1/w[3]/i*c;return o.a7.mul(w,w,[E,E,a?1/w[3]:E,E])}),m=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(y=>{const w=o.N.sub([],d[y[0]],d[y[1]]),E=o.N.sub([],d[y[2]],d[y[1]]),M=o.N.normalize([],o.N.cross([],w,E)),P=-o.N.dot(M,d[y[1]]);return M.concat(P)}),g=[];for(let y=0;y<d.length;y++)g.push([d[y][0],d[y][1],d[y][2]]);return new Mg(g,m)}intersectsPrecise(e,i,n){for(let a=0;a<i.length;a++)if(!_x(e,i[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!_x(e,this.planes[a]))return 0;for(const a of n)for(const c of this.frustumEdges){const d=o.N.cross([],a,c),m=o.N.length(d);if(m===0)continue;o.N.scale(d,d,1/m);const g=Zd(this.points,this.points[0],d),y=Zd(e,this.points[0],d);if(g[0]>y[1]||y[0]>g[1])return 0}return 1}}class Ur{static fromPoints(e){const i=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(const a of e)o.N.min(i,i,a),o.N.max(n,n,a);return new Ur(i,n)}static fromTileIdAndHeight(e,i,n){const a=1<<e.canonical.z,c=e.canonical.x,d=e.canonical.y;return new Ur([c/a,d/a,i],[(c+1)/a,(d+1)/a,n])}static applyTransform(e,i){const n=e.getCorners();for(let a=0;a<n.length;++a)o.N.transformMat4(n[a],n[a],i);return Ur.fromPoints(n)}static projectAabbCorners(e,i){const n=e.getCorners();for(let a=0;a<n.length;++a)o.N.transformMat4(n[a],n[a],i);return n}constructor(e,i){this.min=e,this.max=i,this.center=o.N.scale([],o.N.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],n=o.N.clone(this.min),a=o.N.clone(this.max);for(let c=0;c<i.length;c++)n[c]=i[c]?this.min[c]:this.center[c],a[c]=i[c]?this.center[c]:this.max[c];return a[2]=this.max[2],new Ur(n,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?px(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?px(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?mx(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?mx(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Ct(Ur,"Aabb");const TM=nr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Xp}=TM,EM=nr([{name:"a_pos_3",components:3,type:"Int16"}]);var gx=nr([{name:"a_pos",type:"Int16",components:2}]);function Kp(t){return t*X/Le}const SM=[new Ur([me,me,me],[Me,Me,Me]),new Ur([me,me,me],[0,0,Me]),new Ur([0,me,me],[Me,0,Me]),new Ur([me,0,me],[0,Me,Me]),new Ur([0,0,me],[Me,Me,Me])];function yx(t,e,i,n=!0){const a=o.N.scale([],t._camera.position,t.worldSize),c=[e,i,1,1];o.a7.transformMat4(c,c,t.pixelMatrixInverse),o.a7.scale(c,c,1/c[3]);const d=o.N.sub([],c,a),m=o.N.normalize([],d),g=t.globeMatrix,y=[g[12],g[13],g[14]],w=o.N.sub([],y,a),E=o.N.length(w),M=o.N.normalize([],w),P=t.worldSize/(2*Math.PI),D=o.N.dot(M,m),O=Math.asin(P/E);if(O<Math.acos(D)){if(!n)return null;const be=[],ze=[];o.N.scale(be,m,E/D),o.N.normalize(ze,o.N.sub(ze,be,w)),o.N.normalize(m,o.N.add(m,w,o.N.scale(m,ze,Math.tan(O)*E)))}const F=[];new Eg(a,m).closestPointOnSphere(y,P,F);const V=o.N.normalize([],ne(g,0)),W=o.N.normalize([],ne(g,1)),Q=o.N.normalize([],ne(g,2)),J=o.N.dot(V,F),oe=o.N.dot(W,F),se=o.N.dot(Q,F),he=Ei(Math.asin(-oe/P));let ge=Ei(Math.atan2(J,se));ge=t.center.lng+function(be,ze){const qe=(ze-be+180)%360-180;return qe<-180?qe+360:qe}(t.center.lng,ge);const xe=gi(ge),Ae=Nt(si(he),0,1);return new ji(xe,Ae)}class MM{constructor(e,i,n){this.a=o.N.sub([],e,n),this.b=o.N.sub([],i,n),this.center=n;const a=o.N.normalize([],this.a),c=o.N.normalize([],this.b);this.angle=Math.acos(o.N.dot(a,c))}}function Ag(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(n,a,c,d){const m=Math.sin(c);return n*(Math.sin((1-d)*c)/m)+a*(Math.sin(d*c)/m)}(t.a[e],t.b[e],t.angle,Nt(i,0,1))+t.center[e]}function $o(t){if(t.z<=1)return SM[t.z+2*t.y+t.x];const e=Ig(Yp(t));return Ur.fromPoints(e)}function ya(t,e,i){return o.N.scale(t,t,1-i),o.N.scaleAndAdd(t,t,e,i)}function vx(t,e,i){for(const n of t)o.N.transformMat4(n,n,e),o.N.scale(n,n,i)}function xx(t,e,i,n){const a=e/t.worldSize,c=t.globeMatrix;if(i.z<=1){const xe=$o(i).getCorners();return vx(xe,c,a),Ur.fromPoints(xe)}const d=Yp(i,n),m=Ig(d,X+Kp(t._tileCoverLift));vx(m,c,a);const g=Number.MAX_VALUE,y=[-g,-g,-g],w=[g,g,g];if(d.contains(t.center)){for(const be of m)o.N.min(w,w,be),o.N.max(y,y,be);y[2]=0;const xe=t.point,Ae=[xe.x*a,xe.y*a,0];return o.N.min(w,w,Ae),o.N.max(y,y,Ae),new Ur(w,y)}if(t._tileCoverLift>0){for(const xe of m)o.N.min(w,w,xe),o.N.max(y,y,xe);return new Ur(w,y)}const E=[c[12]*a,c[13]*a,c[14]*a],M=d.getCenter(),P=Nt(t.center.lat,-Ai,Ai),D=Nt(M.lat,-Ai,Ai),O=gi(t.center.lng),F=si(P);let V=O-gi(M.lng);const W=F-si(D);V>.5?V-=1:V<-.5&&(V+=1);let Q=0;if(Math.abs(V)>Math.abs(W))Q=V>=0?1:3;else{Q=W>=0?0:2;const xe=[c[4]*a,c[5]*a,c[6]*a],Ae=-Math.sin(dt(W>=0?d.getSouth():d.getNorth()))*X;o.N.scaleAndAdd(E,E,xe,Ae)}const J=m[Q],oe=m[(Q+1)%4],se=new MM(J,oe,E),he=[Ag(se,0)||J[0],Ag(se,1)||J[1],Ag(se,2)||J[2]],ge=Ja(t.zoom);if(ge>0){const xe=function({x:be,y:ze,z:qe},De,Ge,Pe,je){const ut=1/(1<<qe);let Ze=be*ut,Lt=Ze+ut,St=ze*ut,Ye=St+ut,ei=0;const Ft=(Ze+Lt)/2-Pe;return Ft>.5?ei=-1:Ft<-.5&&(ei=1),Ze=((Ze+ei)*De-(Pe*=De))*Ge+Pe,Lt=((Lt+ei)*De-Pe)*Ge+Pe,St=(St*De-(je*=De))*Ge+je,Ye=(Ye*De-je)*Ge+je,[[Ze,Ye,0],[Lt,Ye,0],[Lt,St,0],[Ze,St,0]]}(i,e,t._pixelsPerMercatorPixel,O,F);for(let be=0;be<m.length;be++)ya(m[be],xe[be],ge);const Ae=o.N.add([],xe[Q],xe[(Q+1)%4]);o.N.scale(Ae,Ae,.5),ya(he,Ae,ge)}for(const xe of m)o.N.min(w,w,xe),o.N.max(y,y,xe);return w[2]=Math.min(J[2],oe[2]),o.N.min(w,w,he),o.N.max(y,y,he),new Ur(w,y)}function Yp({x:t,y:e,z:i},n=!1){const a=1/(1<<i),c=new ve(ui(t*a),e===(1<<i)-1&&n?-90:ki((e+1)*a)),d=new ve(ui((t+1)*a),e===0&&n?90:ki(e*a));return new Ce(c,d)}function Ig(t,e=X){const i=dt(t.getNorth()),n=dt(t.getSouth()),a=Math.cos(i),c=Math.cos(n),d=Math.sin(i),m=Math.sin(n),g=t.getWest(),y=t.getEast();return[ye(c,m,g,e),ye(c,m,y,e),ye(a,d,y,e),ye(a,d,g,e)]}function Hd(t,e,i,n){const a=1<<i.z,c=(t/xt+i.x)/a;return Oe(ki((e/xt+i.y)/a),ui(c),n)}function Jp({min:t,max:e}){return re/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const bx=new Float64Array(16);function Qp(t){const e=Jp(t),i=o.a6.fromScaling(bx,[e,e,e]);return o.a6.translate(i,i,o.N.negate([],t.min))}function Cg(t){const e=o.a6.fromTranslation(bx,t.min),i=1/Jp(t);return o.a6.scale(e,e,[i,i,i])}function Pg(t){const e=xt/(2*Math.PI);return t/(2*Math.PI)/e}function wx(t,e){return xt/(512*Math.pow(2,t))*Jp($o(e))}function Tx(t,e,i,n,a){const c=Pg(i),d=[t,e,-i/(2*Math.PI)],m=o.a6.identity(new Float64Array(16));return o.a6.translate(m,m,d),o.a6.scale(m,m,[c,c,c]),o.a6.rotateX(m,m,dt(-a)),o.a6.rotateY(m,m,dt(-n)),m}function Ja(t){return Dn(te,q,t)}function Ex(t,e){const i=Oe(e.lat,e.lng),n=function(c){const d=Oe(c._center.lat,c._center.lng),m=o.N.fromValues(0,1,0);let g=o.N.cross([],m,d);const y=o.a6.fromRotation([],-c.angle,d);g=o.N.transformMat4(g,g,y),o.a6.fromRotation(y,-c._pitch,g);const w=o.N.normalize([],d);return o.N.scale(w,w,Kp(c.cameraToCenterDistance/c.pixelsPerMeter)),o.N.transformMat4(w,w,y),o.N.add([],d,w)}(t),a=o.N.subtract([],n,i);return o.N.angle(a,i)}function Rg(t,e){return Ex(t,e)>Math.PI/2*1.01}const Sx=dt(85),AM=Math.cos(Sx),IM=Math.sin(Sx),CM=o.a6.create(),Mx=t=>{const e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Ax(t,e,i,n,a,c,d,m,g){if(c&&t.queryGeometry.isAboveHorizon)return!1;c&&(g*=t.pixelToTileUnitsFactor);const y=t.tileID.canonical,w=i.projection.upVectorScale(y,i.center.lat,i.worldSize).metersToTile;for(const E of e)for(const M of E){const P=M.add(m),D=a&&i.elevation?i.elevation.exaggeration()*a.getElevationAt(P.x,P.y,!0):0,O=i.projection.projectTilePoint(P.x,P.y,y);if(D>0){const Q=i.projection.upVector(y,P.x,P.y);O.x+=Q[0]*w*D,O.y+=Q[1]*w*D,O.z+=Q[2]*w*D}const F=c?P:PM(O.x,O.y,O.z,n),V=c?t.tilespaceRays.map(Q=>LM(Q,D)):t.queryGeometry.screenGeometry,W=o.a7.transformMat4([],[O.x,O.y,O.z,1],n);if(!d&&c?g*=W[3]/i.cameraToCenterDistance:d&&!c&&(g*=i.cameraToCenterDistance/W[3]),c){const Q=ki((M.y/xt+y.y)/(1<<y.z));g/=i.projection.pixelsPerMeter(Q,1)/di(1,Q)}if(Uo(V,F,g))return!0}return!1}function PM(t,e,i,n){const a=o.a7.transformMat4([],[t,e,i,1],n);return new Ie(a[0]/a[3],a[1]/a[3])}const Ix=o.N.fromValues(0,0,0),RM=o.N.fromValues(0,0,1);function LM(t,e){const i=o.N.create();return Ix[2]=e,t.intersectsPlane(Ix,RM,i),new Ie(i[0],i[1])}class Cx extends Qn{}function Px(t,{width:e,height:i},n,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*i*n)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*i*n);return t.width=e,t.height=i,t.data=a,t}function Rx(t,e,i){const{width:n,height:a}=e;n===t.width&&a===t.height||(Lg(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,a)},i),t.width=n,t.height=a,t.data=e.data)}function Lg(t,e,i,n,a,c,d){if(a.width===0||a.height===0)return e;if(a.width>t.width||a.height>t.height||i.x>t.width-a.width||i.y>t.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||n.x>e.width-a.width||n.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const m=t.data,g=e.data,y=c===4&&d;for(let w=0;w<a.height;w++){const E=((i.y+w)*t.width+i.x)*c,M=((n.y+w)*e.width+n.x)*c;if(y)for(let P=0;P<a.width;P++){const D=E+P*c+3,O=M+P*c;g[O+0]=255,g[O+1]=255,g[O+2]=255,g[O+3]=m[D]}else for(let P=0;P<a.width*c;P++)g[M+P]=m[E+P]}return e}Ct(Cx,"HeatmapBucket",{omit:["layers"]});class Qa{constructor(e,i){Px(this,e,1,i)}resize(e){Rx(this,new Qa(e),1)}clone(){return new Qa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,n,a,c){Lg(e,i,n,a,c,1)}}class Ds{constructor(e,i){Px(this,e,4,i)}resize(e){Rx(this,new Ds(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ds({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,n,a,c,d){Lg(e,i,n,a,c,4,d)}}class Lx{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}Ct(Qa,"AlphaImage"),Ct(Ds,"RGBAImage");const DM=new zr({visibility:new at(Te.layout_heatmap.visibility)});var OM={paint:new zr({"heatmap-radius":new Wt(Te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wt(Te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new at(Te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ha(Te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new at(Te.paint_heatmap["heatmap-opacity"])}),layout:DM};function Wd(t){const e={},i=t.resolution||256,n=t.clips?t.clips.length:1,a=t.image||new Ds({width:i,height:n}),c=(d,m,g)=>{e[t.evaluationKey]=g;const y=t.expression.evaluate(e);y&&(a.data[d+m+0]=Math.floor(255*y.r/y.a),a.data[d+m+1]=Math.floor(255*y.g/y.a),a.data[d+m+2]=Math.floor(255*y.b/y.a),a.data[d+m+3]=Math.floor(255*y.a))};if(t.clips)for(let d=0,m=0;d<n;++d,m+=4*i)for(let g=0,y=0;g<i;g++,y+=4){const w=g/(i-1),{start:E,end:M}=t.clips[d];c(m,y,E*(1-w)+M*w)}else for(let d=0,m=0;d<i;d++,m+=4)c(0,m,d/(i-1));return a}const zM=new zr({visibility:new at(Te.layout_hillshade.visibility)});var kM={paint:new zr({"hillshade-illumination-direction":new at(Te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new at(Te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new at(Te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new at(Te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new at(Te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new at(Te.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new at(Te.paint_hillshade["hillshade-emissive-strength"])}),layout:zM};const BM=nr([{name:"a_pos",components:2,type:"Int16"}],4),{members:FM}=BM;var Dg={exports:{}};function em(t,e,i){i=i||2;var n,a,c,d,m,g,y,w=e&&e.length,E=w?e[0]*i:t.length,M=Dx(t,0,E,i,!0),P=[];if(!M||M.next===M.prev)return P;if(w&&(M=function(O,F,V,W){var Q,J,oe,se=[];for(Q=0,J=F.length;Q<J;Q++)(oe=Dx(O,F[Q]*W,Q<J-1?F[Q+1]*W:O.length,W,!1))===oe.next&&(oe.steiner=!0),se.push(ZM(oe));for(se.sort(GM),Q=0;Q<se.length;Q++)V=$M(se[Q],V);return V}(t,e,M,i)),t.length>80*i){n=c=t[0],a=d=t[1];for(var D=i;D<E;D+=i)(m=t[D])<n&&(n=m),(g=t[D+1])<a&&(a=g),m>c&&(c=m),g>d&&(d=g);y=(y=Math.max(c-n,d-a))!==0?32767/y:0}return Xd(M,P,i,n,a,y,0),P}function Dx(t,e,i,n,a){var c,d;if(a===kg(t,e,i,n)>0)for(c=e;c<i;c+=n)d=kx(c,t[c],t[c+1],d);else for(c=i-n;c>=e;c-=n)d=kx(c,t[c],t[c+1],d);return d&&tm(d,d.next)&&(Yd(d),d=d.next),d}function Sc(t,e){if(!t)return t;e||(e=t);var i,n=t;do if(i=!1,n.steiner||!tm(n,n.next)&&cn(n.prev,n,n.next)!==0)n=n.next;else{if(Yd(n),(n=e=n.prev)===n.next)break;i=!0}while(i||n!==e);return e}function Xd(t,e,i,n,a,c,d){if(t){!d&&c&&function(w,E,M,P){var D=w;do D.z===0&&(D.z=Og(D.x,D.y,E,M,P)),D.prevZ=D.prev,D.nextZ=D.next,D=D.next;while(D!==w);D.prevZ.nextZ=null,D.prevZ=null,function(O){var F,V,W,Q,J,oe,se,he,ge=1;do{for(V=O,O=null,J=null,oe=0;V;){for(oe++,W=V,se=0,F=0;F<ge&&(se++,W=W.nextZ);F++);for(he=ge;se>0||he>0&&W;)se!==0&&(he===0||!W||V.z<=W.z)?(Q=V,V=V.nextZ,se--):(Q=W,W=W.nextZ,he--),J?J.nextZ=Q:O=Q,Q.prevZ=J,J=Q;V=W}J.nextZ=null,ge*=2}while(oe>1)}(D)}(t,n,a,c);for(var m,g,y=t;t.prev!==t.next;)if(m=t.prev,g=t.next,c?VM(t,n,a,c):NM(t))e.push(m.i/i|0),e.push(t.i/i|0),e.push(g.i/i|0),Yd(t),t=g.next,y=g.next;else if((t=g)===y){d?d===1?Xd(t=UM(Sc(t),e,i),e,i,n,a,c,2):d===2&&jM(t,e,i,n,a,c):Xd(Sc(t),e,i,n,a,c,1);break}}}function NM(t){var e=t.prev,i=t,n=t.next;if(cn(e,i,n)>=0)return!1;for(var a=e.x,c=i.x,d=n.x,m=e.y,g=i.y,y=n.y,w=a<c?a<d?a:d:c<d?c:d,E=m<g?m<y?m:y:g<y?g:y,M=a>c?a>d?a:d:c>d?c:d,P=m>g?m>y?m:y:g>y?g:y,D=n.next;D!==e;){if(D.x>=w&&D.x<=M&&D.y>=E&&D.y<=P&&Ou(a,m,c,g,d,y,D.x,D.y)&&cn(D.prev,D,D.next)>=0)return!1;D=D.next}return!0}function VM(t,e,i,n){var a=t.prev,c=t,d=t.next;if(cn(a,c,d)>=0)return!1;for(var m=a.x,g=c.x,y=d.x,w=a.y,E=c.y,M=d.y,P=m<g?m<y?m:y:g<y?g:y,D=w<E?w<M?w:M:E<M?E:M,O=m>g?m>y?m:y:g>y?g:y,F=w>E?w>M?w:M:E>M?E:M,V=Og(P,D,e,i,n),W=Og(O,F,e,i,n),Q=t.prevZ,J=t.nextZ;Q&&Q.z>=V&&J&&J.z<=W;){if(Q.x>=P&&Q.x<=O&&Q.y>=D&&Q.y<=F&&Q!==a&&Q!==d&&Ou(m,w,g,E,y,M,Q.x,Q.y)&&cn(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,J.x>=P&&J.x<=O&&J.y>=D&&J.y<=F&&J!==a&&J!==d&&Ou(m,w,g,E,y,M,J.x,J.y)&&cn(J.prev,J,J.next)>=0))return!1;J=J.nextZ}for(;Q&&Q.z>=V;){if(Q.x>=P&&Q.x<=O&&Q.y>=D&&Q.y<=F&&Q!==a&&Q!==d&&Ou(m,w,g,E,y,M,Q.x,Q.y)&&cn(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;J&&J.z<=W;){if(J.x>=P&&J.x<=O&&J.y>=D&&J.y<=F&&J!==a&&J!==d&&Ou(m,w,g,E,y,M,J.x,J.y)&&cn(J.prev,J,J.next)>=0)return!1;J=J.nextZ}return!0}function UM(t,e,i){var n=t;do{var a=n.prev,c=n.next.next;!tm(a,c)&&Ox(a,n,n.next,c)&&Kd(a,c)&&Kd(c,a)&&(e.push(a.i/i|0),e.push(n.i/i|0),e.push(c.i/i|0),Yd(n),Yd(n.next),n=t=c),n=n.next}while(n!==t);return Sc(n)}function jM(t,e,i,n,a,c){var d=t;do{for(var m=d.next.next;m!==d.prev;){if(d.i!==m.i&&HM(d,m)){var g=zx(d,m);return d=Sc(d,d.next),g=Sc(g,g.next),Xd(d,e,i,n,a,c,0),void Xd(g,e,i,n,a,c,0)}m=m.next}d=d.next}while(d!==t)}function GM(t,e){return t.x-e.x}function $M(t,e){var i=function(a,c){var d,m=c,g=a.x,y=a.y,w=-1/0;do{if(y<=m.y&&y>=m.next.y&&m.next.y!==m.y){var E=m.x+(y-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(E<=g&&E>w&&(w=E,d=m.x<m.next.x?m:m.next,E===g))return d}m=m.next}while(m!==c);if(!d)return null;var M,P=d,D=d.x,O=d.y,F=1/0;m=d;do g>=m.x&&m.x>=D&&g!==m.x&&Ou(y<O?g:w,y,D,O,y<O?w:g,y,m.x,m.y)&&(M=Math.abs(y-m.y)/(g-m.x),Kd(m,a)&&(M<F||M===F&&(m.x>d.x||m.x===d.x&&qM(d,m)))&&(d=m,F=M)),m=m.next;while(m!==P);return d}(t,e);if(!i)return e;var n=zx(i,t);return Sc(n,n.next),Sc(i,i.next)}function qM(t,e){return cn(t.prev,t,e.prev)<0&&cn(e.next,t,t.next)<0}function Og(t,e,i,n,a){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*a|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ZM(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Ou(t,e,i,n,a,c,d,m){return(a-d)*(e-m)>=(t-d)*(c-m)&&(t-d)*(n-m)>=(i-d)*(e-m)&&(i-d)*(c-m)>=(a-d)*(n-m)}function HM(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,n){var a=i;do{if(a.i!==i.i&&a.next.i!==i.i&&a.i!==n.i&&a.next.i!==n.i&&Ox(a,a.next,i,n))return!0;a=a.next}while(a!==i);return!1}(t,e)&&(Kd(t,e)&&Kd(e,t)&&function(i,n){var a=i,c=!1,d=(i.x+n.x)/2,m=(i.y+n.y)/2;do a.y>m!=a.next.y>m&&a.next.y!==a.y&&d<(a.next.x-a.x)*(m-a.y)/(a.next.y-a.y)+a.x&&(c=!c),a=a.next;while(a!==i);return c}(t,e)&&(cn(t.prev,t,e.prev)||cn(t,e.prev,e))||tm(t,e)&&cn(t.prev,t,t.next)>0&&cn(e.prev,e,e.next)>0)}function cn(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function tm(t,e){return t.x===e.x&&t.y===e.y}function Ox(t,e,i,n){var a=rm(cn(t,e,i)),c=rm(cn(t,e,n)),d=rm(cn(i,n,t)),m=rm(cn(i,n,e));return a!==c&&d!==m||!(a!==0||!im(t,i,e))||!(c!==0||!im(t,n,e))||!(d!==0||!im(i,t,n))||!(m!==0||!im(i,e,n))}function im(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function rm(t){return t>0?1:t<0?-1:0}function Kd(t,e){return cn(t.prev,t,t.next)<0?cn(t,e,t.next)>=0&&cn(t,t.prev,e)>=0:cn(t,e,t.prev)<0||cn(t,t.next,e)<0}function zx(t,e){var i=new zg(t.i,t.x,t.y),n=new zg(e.i,e.x,e.y),a=t.next,c=e.prev;return t.next=e,e.prev=t,i.next=a,a.prev=i,n.next=i,i.prev=n,c.next=n,n.prev=c,n}function kx(t,e,i,n){var a=new zg(t,e,i);return n?(a.next=n.next,a.prev=n,n.next.prev=a,n.next=a):(a.prev=a,a.next=a),a}function Yd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function zg(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function kg(t,e,i,n){for(var a=0,c=e,d=i-n;c<i;c+=n)a+=(t[d]-t[c])*(t[c+1]+t[d+1]),d=c;return a}Dg.exports=em,Dg.exports.default=em,em.deviation=function(t,e,i,n){var a=e&&e.length,c=Math.abs(kg(t,0,a?e[0]*i:t.length,i));if(a)for(var d=0,m=e.length;d<m;d++)c-=Math.abs(kg(t,e[d]*i,d<m-1?e[d+1]*i:t.length,i));var g=0;for(d=0;d<n.length;d+=3){var y=n[d]*i,w=n[d+1]*i,E=n[d+2]*i;g+=Math.abs((t[y]-t[E])*(t[w+1]-t[y+1])-(t[y]-t[w])*(t[E+1]-t[y+1]))}return c===0&&g===0?0:Math.abs((g-c)/c)},em.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,a=0;a<t.length;a++){for(var c=0;c<t[a].length;c++)for(var d=0;d<e;d++)i.vertices.push(t[a][c][d]);a>0&&i.holes.push(n+=t[a-1].length)}return i};var nm=Xe(Dg.exports);function Bg(t,e){const i=t.length;if(i<=1)return[t];const n=[];let a,c;for(let d=0;d<i;d++){const m=yt(t[d]);m!==0&&(t[d].area=Math.abs(m),c===void 0&&(c=m<0),c===m<0?(a&&n.push(a),a=[t[d]]):a.push(t[d]))}if(a&&n.push(a),e>1)for(let d=0;d<n.length;d++)n[d].length<=e||(N_(n[d],e,1,n[d].length-1,WM),n[d]=n[d].slice(0,e));return n}function WM(t,e){return e.area-t.area}function Fg(t,e,i){const n=i.patternDependencies;let a=!1;for(const c of e){const d=c.paint.get(`${t}-pattern`);d.isConstant()||(a=!0);const m=d.constantOr(null);m&&(a=!0,n[m]=!0)}return a}function Ng(t,e,i,n,a){const c=a.patternDependencies;for(const d of e){const m=d.paint.get(`${t}-pattern`).value;if(m.kind!=="constant"){let g=m.evaluate({zoom:n},i,{},a.availableImages);g=g&&g.name?g.name:g,c[g]=!0,i.patterns[d.id]=g}}return i}class Vg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ps,this.indexArray=new dn,this.indexArray2=new Gs,this.programConfigurations=new j(e.layers,e.zoom),this.segments=new $r,this.segments2=new $r,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,n,a){this.hasPattern=Fg("fill",this.layers,i);const c=this.layers[0].layout.get("fill-sort-key"),d=[];for(const{feature:m,id:g,index:y,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,M=an(m,E);if(!this.layers[0]._featureFilter.filter(new Or(this.zoom),M,n))continue;const P=c?c.evaluate(M,{},n,i.availableImages):void 0,D={id:g,properties:m.properties,type:m.type,sourceLayerIndex:w,index:y,geometry:E?M.geometry:pn(m,n,a),patterns:{},sortKey:P};d.push(D)}c&&d.sort((m,g)=>m.sortKey-g.sortKey);for(const m of d){const{geometry:g,index:y,sourceLayerIndex:w}=m;if(this.hasPattern){const E=Ng("fill",this.layers,m,this.zoom,i);this.patternFeatures.push(E)}else this.addFeature(m,g,y,n,{},i.availableImages,i.brightness);i.featureIndex.insert(e[y].feature,g,y,w,this.index)}}update(e,i,n,a,c){const d=Object.keys(e).length!==0;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,d?this.stateDependentLayers:this.layers,n,a,c)}addFeatures(e,i,n,a,c,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,i,n,a,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,FM),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,n,a,c,d=[],m){for(const g of Bg(i,500)){let y=0;for(const O of g)y+=O.length;const w=this.segments.prepareSegment(y,this.layoutVertexArray,this.indexArray),E=w.vertexLength,M=[],P=[];for(const O of g){if(O.length===0)continue;O!==g[0]&&P.push(M.length/2);const F=this.segments2.prepareSegment(O.length,this.layoutVertexArray,this.indexArray2),V=F.vertexLength;this.layoutVertexArray.emplaceBack(O[0].x,O[0].y),this.indexArray2.emplaceBack(V+O.length-1,V),M.push(O[0].x),M.push(O[0].y);for(let W=1;W<O.length;W++)this.layoutVertexArray.emplaceBack(O[W].x,O[W].y),this.indexArray2.emplaceBack(V+W-1,V+W),M.push(O[W].x),M.push(O[W].y);F.vertexLength+=O.length,F.primitiveLength+=O.length}const D=nm(M,P);for(let O=0;O<D.length;O+=3)this.indexArray.emplaceBack(E+D[O],E+D[O+1],E+D[O+2]);w.vertexLength+=y,w.primitiveLength+=D.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,c,d,a,m)}}Ct(Vg,"FillBucket",{omit:["layers","patternFeatures"]});const XM=new zr({"fill-sort-key":new Wt(Te.layout_fill["fill-sort-key"]),visibility:new at(Te.layout_fill.visibility)});var KM={paint:new zr({"fill-antialias":new at(Te.paint_fill["fill-antialias"]),"fill-opacity":new Wt(Te.paint_fill["fill-opacity"]),"fill-color":new Wt(Te.paint_fill["fill-color"]),"fill-outline-color":new Wt(Te.paint_fill["fill-outline-color"]),"fill-translate":new at(Te.paint_fill["fill-translate"]),"fill-translate-anchor":new at(Te.paint_fill["fill-translate-anchor"]),"fill-pattern":new Wt(Te.paint_fill["fill-pattern"]),"fill-emissive-strength":new at(Te.paint_fill["fill-emissive-strength"])}),layout:XM};const YM=nr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),JM=nr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),QM=nr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),eA=nr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),tA=nr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:iA}=YM;var sm={},rA=_i,Bx=zu;function zu(t,e,i,n,a){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=a,t.readFields(nA,this,e)}function nA(t,e,i){t==1?e.id=i.readVarint():t==2?function(n,a){for(var c=n.readVarint()+n.pos;n.pos<c;){var d=a._keys[n.readVarint()],m=a._values[n.readVarint()];a.properties[d]=m}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function sA(t){for(var e,i,n=0,a=0,c=t.length,d=c-1;a<c;d=a++)n+=((i=t[d]).x-(e=t[a]).x)*(e.y+i.y);return n}zu.types=["Unknown","Point","LineString","Polygon"],zu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,n=1,a=0,c=0,d=0,m=[];t.pos<i;){if(a<=0){var g=t.readVarint();n=7&g,a=g>>3}if(a--,n===1||n===2)c+=t.readSVarint(),d+=t.readSVarint(),n===1&&(e&&m.push(e),e=[]),e.push(new rA(c,d));else{if(n!==7)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&m.push(e),m},zu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,a=0,c=0,d=1/0,m=-1/0,g=1/0,y=-1/0;t.pos<e;){if(n<=0){var w=t.readVarint();i=7&w,n=w>>3}if(n--,i===1||i===2)(a+=t.readSVarint())<d&&(d=a),a>m&&(m=a),(c+=t.readSVarint())<g&&(g=c),c>y&&(y=c);else if(i!==7)throw new Error("unknown command "+i)}return[d,g,m,y]},zu.prototype.toGeoJSON=function(t,e,i){var n,a,c=this.extent*Math.pow(2,i),d=this.extent*t,m=this.extent*e,g=this.loadGeometry(),y=zu.types[this.type];function w(P){for(var D=0;D<P.length;D++){var O=P[D];P[D]=[360*(O.x+d)/c-180,360/Math.PI*Math.atan(Math.exp((180-360*(O.y+m)/c)*Math.PI/180))-90]}}switch(this.type){case 1:var E=[];for(n=0;n<g.length;n++)E[n]=g[n][0];w(g=E);break;case 2:for(n=0;n<g.length;n++)w(g[n]);break;case 3:for(g=function(P){var D=P.length;if(D<=1)return[P];for(var O,F,V=[],W=0;W<D;W++){var Q=sA(P[W]);Q!==0&&(F===void 0&&(F=Q<0),F===Q<0?(O&&V.push(O),O=[P[W]]):O.push(P[W]))}return O&&V.push(O),V}(g),n=0;n<g.length;n++)for(a=0;a<g[n].length;a++)w(g[n][a])}g.length===1?g=g[0]:y="Multi"+y;var M={type:"Feature",geometry:{type:y,coordinates:g},properties:this.properties};return"id"in this&&(M.id=this.id),M};var oA=Bx,Fx=Nx;function Nx(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(aA,this,e),this.length=this._features.length}function aA(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(n){for(var a=null,c=n.readVarint()+n.pos;n.pos<c;){var d=n.readVarint()>>3;a=d===1?n.readString():d===2?n.readFloat():d===3?n.readDouble():d===4?n.readVarint64():d===5?n.readVarint():d===6?n.readSVarint():d===7?n.readBoolean():null}return a}(i))}Nx.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new oA(this._pbf,e,this.extent,this._keys,this._values)};var lA=Fx;function cA(t,e,i){if(t===3){var n=new lA(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}var Ug=sm.VectorTile=function(t,e){this.layers=t.readFields(cA,{},e)},om=sm.VectorTileFeature=Bx;function am(t,e,i,n){const a=[],c=n===0?(d,m,g,y,w,E)=>{d.push(new Ie(E,g+(E-m)/(y-m)*(w-g)))}:(d,m,g,y,w,E)=>{d.push(new Ie(m+(E-g)/(w-g)*(y-m),E))};for(const d of t){const m=[];for(const g of d){if(g.length<=2)continue;const y=[];for(let M=0;M<g.length-1;M++){const P=g[M].x,D=g[M].y,O=g[M+1].x,F=g[M+1].y,V=n===0?P:D,W=n===0?O:F;V<e?W>e&&c(y,P,D,O,F,e):V>i?W<i&&c(y,P,D,O,F,i):y.push(g[M]),W<e&&V>=e&&c(y,P,D,O,F,e),W>i&&V<=i&&c(y,P,D,O,F,i)}let w=g[g.length-1];const E=n===0?w.x:w.y;E>=e&&E<=i&&y.push(w),y.length&&(w=y[y.length-1],y[0].x===w.x&&y[0].y===w.y||y.push(y[0]),m.push(y))}m.length&&a.push(m)}return a}function lm(t,e){return t.x-e.x||t.y-e.y}function Vx(t,e){return lm(t.min,e.min)===0&&lm(t.max,e.max)===0}function Ux(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function jx(t,e,i){const n=1/xt,a=1/(1<<i.canonical.z),c=(e.x*n+i.canonical.x)*a+i.wrap,d=(e.y*n+i.canonical.y)*a;return{min:new Ie((t.x*n+i.canonical.x)*a+i.wrap,(t.y*n+i.canonical.y)*a),max:new Ie(c,d)}}function uA(t,e,i){const n=1<<i.canonical.z,a=((e.x-i.wrap)*n-i.canonical.x)*xt,c=(e.y*n-i.canonical.y)*xt;return{min:new Ie(((t.x-i.wrap)*n-i.canonical.x)*xt,(t.y*n-i.canonical.y)*xt),max:new Ie(a,c)}}function Gx(t,e,i,n,a,c,d){const m=t.indices,g=t.vertices,y=[];for(let w=n;w<n+a;w+=3){const E=e[i[w+0]+c],M=e[i[w+1]+c],P=e[i[w+2]+c],D=Math.min(E.x,M.x,P.x),O=Math.max(E.x,M.x,P.x),F=Math.min(E.y,M.y,P.y),V=Math.max(E.y,M.y,P.y);y.length=0,t.grid.query(new Ie(D,F),new Ie(O,V),y);for(let W=0;W<y.length;W++){const Q=y[W];if(lg(g[m[3*Q+0]],g[m[3*Q+1]],g[m[3*Q+2]],E,M,P,d))return!0}}return!1}function $x(t,e,i,n){if(!t||!i)return!1;let a=t.vertices;if(!e.canonical.equals(n.canonical)||e.wrap!==n.wrap){if(i.vertices.length<t.vertices.length)return $x(i,n,t,e);const c=e.canonical,d=n.canonical,m=Math.pow(2,d.z-c.z);a=t.vertices.map(g=>new Ie(g.x*c.x*xt*m-d.x*xt,g.y*c.y*xt*m-d.y*xt))}return Gx(i,a,t.indices,0,t.indices.length,0,0)}sm.VectorTileLayer=Fx;class qx{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const n=this.toIdx(e,i);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Zx(t,e,i,n){let a=0,c=Number.MAX_VALUE;for(let d=0;d<3;d++)if(Math.abs(n[d])<1e-15){if(i[d]<t[d]||i[d]>e[d])return null}else{const m=1/n[d];let g=(t[d]-i[d])*m,y=(e[d]-i[d])*m;if(g>y){const w=g;g=y,y=w}if(g>a&&(a=g),y<c&&(c=y),a>c)return null}return a}function Hx(t,e,i,n,a,c,d,m,g,y,w){const E=n-t,M=a-e,P=c-i,D=d-t,O=m-e,F=g-i,V=w[1]*F-w[2]*O,W=w[2]*D-w[0]*F,Q=w[0]*O-w[1]*D,J=E*V+M*W+P*Q;if(Math.abs(J)<1e-15)return null;const oe=1/J,se=y[0]-t,he=y[1]-e,ge=y[2]-i,xe=(se*V+he*W+ge*Q)*oe;if(xe<0||xe>1)return null;const Ae=he*P-ge*M,be=ge*E-se*P,ze=se*M-he*E,qe=(w[0]*Ae+w[1]*be+w[2]*ze)*oe;return qe<0||xe+qe>1?null:(D*Ae+O*be+F*ze)*oe}function Wx(t,e,i){return(t-e)/(i-e)}function Xx(t,e,i,n,a,c,d,m,g){const y=1<<i,w=c-n,E=d-a,M=(t+1)/y*w+n,P=(e+0)/y*E+a,D=(e+1)/y*E+a;m[0]=(t+0)/y*w+n,m[1]=P,g[0]=M,g[1]=D}class Kx{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(c){const d=Math.ceil(Math.log2(c.dim/8)),m=[];let g=Math.ceil(Math.pow(2,d));const y=1/g,w=(P,D,O,F,V)=>{const W=F?1:0,Q=(P+1)*O-W,J=D*O,oe=(D+1)*O-W;V[0]=P*O,V[1]=J,V[2]=Q,V[3]=oe};let E=new qx(g);const M=[];for(let P=0;P<g*g;P++){w(P%g,Math.floor(P/g),y,!1,M);const D=el(M[0],M[1],c),O=el(M[2],M[1],c),F=el(M[2],M[3],c),V=el(M[0],M[3],c);E.minimums.push(Math.min(D,O,F,V)),E.maximums.push(Math.max(D,O,F,V)),E.leaves.push(1)}for(m.push(E),g/=2;g>=1;g/=2){const P=m[m.length-1];E=new qx(g);for(let D=0;D<g*g;D++){w(D%g,Math.floor(D/g),2,!0,M);const O=P.getElevation(M[0],M[1]),F=P.getElevation(M[2],M[1]),V=P.getElevation(M[2],M[3]),W=P.getElevation(M[0],M[3]),Q=P.isLeaf(M[0],M[1]),J=P.isLeaf(M[2],M[1]),oe=P.isLeaf(M[2],M[3]),se=P.isLeaf(M[0],M[3]),he=Math.min(O.min,F.min,V.min,W.min),ge=Math.max(O.max,F.max,V.max,W.max),xe=Q&&J&&oe&&se;E.maximums.push(ge),E.minimums.push(he),E.leaves.push(ge-he<=5&&xe?1:0)}m.push(E)}return m}(this.dem),n=i.length-1,a=i[n];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(i,0,0,n,0)}raycastRoot(e,i,n,a,c,d,m=1){return Zx([e,i,-100],[n,a,this.maximums[0]*m],c,d)}raycast(e,i,n,a,c,d,m=1){if(!this.nodeCount)return null;const g=this.raycastRoot(e,i,n,a,c,d,m);if(g==null)return null;const y=[],w=[],E=[],M=[],P=[{idx:0,t:g,nodex:0,nodey:0,depth:0}];for(;P.length>0;){const{idx:D,t:O,nodex:F,nodey:V,depth:W}=P.pop();if(this.leaves[D]){Xx(F,V,W,e,i,n,a,E,M);const J=1<<W,oe=(F+0)/J,se=(F+1)/J,he=(V+0)/J,ge=(V+1)/J,xe=el(oe,he,this.dem)*m,Ae=el(se,he,this.dem)*m,be=el(se,ge,this.dem)*m,ze=el(oe,ge,this.dem)*m,qe=Hx(E[0],E[1],xe,M[0],E[1],Ae,M[0],M[1],be,c,d),De=Hx(M[0],M[1],be,E[0],M[1],ze,E[0],E[1],xe,c,d),Ge=Math.min(qe!==null?qe:Number.MAX_VALUE,De!==null?De:Number.MAX_VALUE);if(Ge!==Number.MAX_VALUE)return Ge;{const Pe=o.N.scaleAndAdd([],c,d,O);if(Yx(xe,Ae,ze,be,Wx(Pe[0],E[0],M[0]),Wx(Pe[1],E[1],M[1]))>=Pe[2])return O}continue}let Q=0;for(let J=0;J<this._siblingOffset.length;J++){Xx((F<<1)+this._siblingOffset[J][0],(V<<1)+this._siblingOffset[J][1],W+1,e,i,n,a,E,M),E[2]=-100,M[2]=this.maximums[this.childOffsets[D]+J]*m;const oe=Zx(E,M,c,d);if(oe!=null){const se=oe;y[J]=se;let he=!1;for(let ge=0;ge<Q&&!he;ge++)se>=y[w[ge]]&&(w.splice(ge,0,J),he=!0);he||(w[Q]=J),Q++}}for(let J=0;J<Q;J++){const oe=w[J];P.push({idx:this.childOffsets[D]+oe,t:y[oe],nodex:(F<<1)+this._siblingOffset[oe][0],nodey:(V<<1)+this._siblingOffset[oe][1],depth:W+1})}}return null}_addNode(e,i,n){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,n,a,c){if(e[a].isLeaf(i,n)===1)return;this.childOffsets[c]||(this.childOffsets[c]=this.nodeCount);const d=a-1,m=e[d];let g=0,y=0;for(let w=0;w<this._siblingOffset.length;w++){const E=2*i+this._siblingOffset[w][0],M=2*n+this._siblingOffset[w][1],P=m.getElevation(E,M),D=m.isLeaf(E,M),O=this._addNode(P.min,P.max,D);D&&(g|=1<<w),y||(y=O)}for(let w=0;w<this._siblingOffset.length;w++)g&1<<w||this._construct(e,2*i+this._siblingOffset[w][0],2*n+this._siblingOffset[w][1],d,y+w)}}function Yx(t,e,i,n,a,c){return Di(Di(t,i,c),Di(e,n,c),a)}function el(t,e,i){const n=i.dim,a=Nt(t*n-.5,0,n-1),c=Nt(e*n-.5,0,n-1),d=Math.floor(a),m=Math.floor(c),g=Math.min(d+1,n-1),y=Math.min(m+1,n-1);return Yx(i.get(d,m),i.get(g,m),i.get(d,y),i.get(g,y),a-d,c-m)}const hA={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function dA(t,e,i){return(256*t*256+256*e+i)/10-1e4}function fA(t,e,i){return 256*t+e+i/256-32768}class cm{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,n,a=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(n&&n!=="mapbox"&&n!=="terrarium")return _e(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const c=this.dim=i.height-2,d=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let g=0;g<c;g++)d[this._idx(-1,g)]=d[this._idx(0,g)],d[this._idx(c,g)]=d[this._idx(c-1,g)],d[this._idx(g,-1)]=d[this._idx(g,0)],d[this._idx(g,c)]=d[this._idx(g,c-1)];d[this._idx(-1,-1)]=d[this._idx(0,0)],d[this._idx(c,-1)]=d[this._idx(c-1,0)],d[this._idx(-1,c)]=d[this._idx(0,c-1)],d[this._idx(c,c)]=d[this._idx(c-1,c-1)]}const m=n==="terrarium"?fA:dA;for(let g=0;g<d.length;++g){const y=4*g;this.floatView[g]=m(this.pixels[y],this.pixels[y+1],this.pixels[y+2])}this._timestamp=Qe.now()}_buildQuadTree(){this._tree=new Kx(this)}get(e,i,n=!1){n&&(e=Nt(e,-1,this.dim),i=Nt(i,-1,this.dim));const a=this._idx(e,i);return this.floatView[a]}set(e,i,n){const a=this._idx(e,i),c=this.floatView[a];return this.floatView[a]=n,n-c}static getUnpackVector(e){return hA[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const n=[0,0,0,0],a=cm.getUnpackVector(i);let c=Math.floor((e+a[3])/a[2]);return n[2]=c%256,c=Math.floor(c/256),n[1]=c%256,c=Math.floor(c/256),n[0]=c,n}getPixels(){return new Lx({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=i*this.dim,c=i*this.dim+this.dim,d=n*this.dim,m=n*this.dim+this.dim;switch(i){case-1:a=c-1;break;case 1:c=a+1}switch(n){case-1:d=m-1;break;case 1:m=d+1}const g=-i*this.dim,y=-n*this.dim;for(let w=d;w<m;w++)for(let E=a;E<c;E++){const M=4*this._idx(E,w),P=4*this._idx(E+g,w+y);this.pixels[M+0]=e.pixels[P+0],this.pixels[M+1]=e.pixels[P+1],this.pixels[M+2]=e.pixels[P+2],this.pixels[M+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ct(cm,"DEMData"),Ct(Kx,"DemMinMaxQuadTree",{omit:["dem"]});class ku{constructor(e,i,n){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=n}static create(e,i,n){const a=n||e.findDEMTileFor(i);if(!a||!a.dem)return;const c=a.dem,d=a.tileID,m=1<<i.canonical.z-d.canonical.z;return new ku(a,c.dim/xt/m,[(i.canonical.x/m-d.canonical.x)*c.dim,(i.canonical.y/m-d.canonical.y)*c.dim])}tileCoordToPixel(e,i){const n=i*this._scale+this._offset[1],a=Math.floor(e*this._scale+this._offset[0]),c=Math.floor(n);return new Ie(a,c)}getElevationAt(e,i,n,a){const c=e*this._scale+this._offset[0],d=i*this._scale+this._offset[1],m=Math.floor(c),g=Math.floor(d),y=this._dem;return a=!!a,n?Di(Di(y.get(m,g,a),y.get(m,g+1,a),d-g),Di(y.get(m+1,g,a),y.get(m+1,g+1,a),d-g),c-m):y.get(m,g,a)}getElevationAtPixel(e,i,n){return this._dem.get(e,i,!!n)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*di(1,e)*this._dem.stride}}const pA=om.types,mA=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],_A=["fill-extrusion-flood-light-ground-radius"],gA=Math.pow(2,13),yA=Math.pow(2,15)-1,Jx=new Ie(0,1),tl=2147483648;function Jd(t,e,i,n,a,c,d,m){t.emplaceBack((e<<1)+d,(i<<1)+c,(Math.floor(n*gA)<<1)+a,Math.round(m))}function um(t,e,i,n,a,c){t.emplaceBack(e.x,e.y,(i.x<<1)+n,(i.y<<1)+a,c)}function Qd(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Qx{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class e1{constructor(){this.centroidXY=new Ie(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ie(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ie(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Ie(this.max.x-this.min.x,this.max.y-this.min.y)}}class t1{constructor(){this.acc=new Ie(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,n){this.accCount++,this.acc._add(i);let a=!!this.borders;i.x<e.min.x?(e.min.x=i.x,a=!0):i.x>e.max.x&&(e.max.x=i.x,a=!0),i.y<e.min.y?(e.min.y=i.y,a=!0):i.y>e.max.y&&(e.max.y=i.y,a=!0),((i.x===0||i.x===xt)&&i.x===n.x)!=((i.y===0||i.y===xt)&&i.y===n.y)&&this.processBorderOverlap(i,n),a&&this.checkBorderIntersection(i,n)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Di(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>xt!=e.x>xt&&this.addBorderIntersection(1,Di(i.y,e.y,(xt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Di(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>xt!=e.y>xt&&this.addBorderIntersection(3,Di(i.x,e.x,(xt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[e];i<n[0]&&(n[0]=i),i>n[1]&&(n[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const n=e.x===0?0:1;this.addBorderIntersection(n,i.y),this.addBorderIntersection(n,e.y)}else{const n=e.y===0?2:3;this.addBorderIntersection(n,i.x),this.addBorderIntersection(n,e.x)}}centroid(){return this.accCount===0?new Ie(0,0):new Ie(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function i1(t,e){const i=t.add(e)._unit(),n=Nt(t.x*i.x+t.y*i.y,-1,1);var a,c,d;return a=Math.acos(n),Math.min(4,Math.max(-4,Math.tan(a)))/4*yA*((c=t).x*(d=e).y-c.y*d.x<0?-1:1)}const vA=[t=>t.x<0,t=>t.x>xt,t=>t.y<0,t=>t.y>xt];function xA(t,e,i,n){const a=[4];if(n===0)return a;i._mult(n);const c=t.sub(i),d=e.sub(i),m=[t,e,c,d];for(let g=0;g<4;g++)for(const y of m)if(vA[g](y)){a.push(g);break}return a}class r1{constructor(e){this.vertexArray=new Rd,this.indexArray=new dn,this.programConfigurations=new j(e.layers,e.zoom,i=>_A.includes(i)),this._segments=new $r,this.hiddenByLandmarkVertexArray=new Vd,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new $r}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,n,a=!1){const c=e.length;if(c>2){let d=Math.max(0,this._segments.get().length-1);const m=this._segments._prepareSegment(4*c,this.vertexArray.length,2*this._segmentToGroundQuads[d].length);let g;d!==this._segments.get().length-1&&(d++,this._segmentToGroundQuads[d]=[],this._segmentToRegionTriCounts[d]=[0,0,0,0,0]);{const y=e[0],w=e[1];g=i1(y.sub(e[c-1])._perp()._unit(),w.sub(y)._perp()._unit())}for(let y=0;y<c;y++){const w=y===c-1?0:y+1,E=e[y],M=e[w],P=e[w===c-1?0:w+1],D=M.sub(E)._perp()._unit(),O=i1(D,P.sub(M)._perp()._unit()),F=g,V=O;if(jg(E,M,i)||a&&o1(E,i)&&o1(M,i)){g=O;continue}const W=m.vertexLength;um(this.vertexArray,E,M,1,1,F),um(this.vertexArray,E,M,1,0,F),um(this.vertexArray,E,M,0,1,V),um(this.vertexArray,E,M,0,0,V),m.vertexLength+=4;const Q=xA(E,M,D,n);for(const J of Q)this._segmentToGroundQuads[d].push({id:W,region:J}),this._segmentToRegionTriCounts[d][J]+=2,m.primitiveLength+=2;g=O}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let n=0;n<i;n++)this._segmentToGroundQuads[n].sort((a,c)=>a.region-c.region);for(let n=0;n<i;n++){const a=this._segmentToGroundQuads[n],c=e[n],d=this._segmentToRegionTriCounts[n];d.reduce((g,y)=>g+y,0);let m=0;for(let g=0;g<=4;g++){const y=d[g];if(y!==0){let w=this.regionSegments[g];w||(w=this.regionSegments[g]=new $r);const E={vertexOffset:c.vertexOffset,primitiveOffset:c.primitiveOffset+m,vertexLength:c.vertexLength,primitiveLength:y};w.get().push(E)}m+=y}for(let g=0;g<a.length;g++){const y=a[g].id;this.indexArray.emplaceBack(y,y+1,y+3),this.indexArray.emplaceBack(y,y+3,y+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,n,a,c,d){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,n,a,c,d)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,JM.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,n,a,c,d){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,n,a,c,d)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const n=e.flags&tl?1:0;for(let a=e.groundVertexArrayOffset;a<i;++a)this.hiddenByLandmarkVertexArray.emplace(a,n);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,eA.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class hm{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new dn,this.footprintVertices=new Ps,this.footprintSegments=[],this.layoutVertexArray=new ro,this.centroidVertexArray=new gc,this.indexArray=new dn,this.programConfigurations=new j(e.layers,e.zoom,i=>mA.includes(i)),this.segments=new $r,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new r1(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,i,n,a){this.features=[],this.hasPattern=Fg("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=Ci(n),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:c,id:d,index:m,sourceLayerIndex:g}of e){const y=this.layers[0]._featureFilter.needGeometry,w=an(c,y);if(!this.layers[0]._featureFilter.filter(new Or(this.zoom),w,n))continue;const E={id:d,sourceLayerIndex:g,index:m,geometry:y?w.geometry:pn(c,n,a),properties:c.properties,type:c.type,patterns:{}},M=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ng("fill-extrusion",this.layers,E,this.zoom,i)):this.addFeature(E,E.geometry,m,n,{},i.availableImages,a,i.brightness),i.featureIndex.insert(c,E.geometry,m,g,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,n,a,c,d){for(const m of this.features){const{geometry:g}=m;this.addFeature(m,g,m.index,i,n,a,c,d)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,n,a,c){const d=Object.keys(e).length!==0;if(d&&!this.stateDependentLayers.length)return;const m=d?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,m,n,a,c),this.groundEffect.update(e,i,m,n,a,c)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,iA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,tA.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,QM.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,n,a,c,d,m,g){const y=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,w=[new Ie(0,0),new Ie(xt,xt)],E=m.projection,M=E.name==="globe",P=pA[e.type]==="Polygon",D=new t1;D.centroidDataIndex=this.centroidData.length;const O=new e1,F=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},a)<=0,V=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},a);O.height=V,O.vertexArrayOffset=this.layoutVertexArray.length,O.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Su);const W=Bg(i,500);for(let ge=W.length-1;ge>=0;ge--){const xe=W[ge];(xe.length===0||(Q=xe[0]).every(Ae=>Ae.x<=0)||Q.every(Ae=>Ae.x>=xt)||Q.every(Ae=>Ae.y<=0)||Q.every(Ae=>Ae.y>=xt))&&W.splice(ge,1)}var Q;let J;if(M)J=u1(W,w,a);else{J=[];for(const ge of W)J.push({polygon:ge,bounds:w})}const oe=P?this.edgeRadius:0,se=oe>0&&this.zoom<17,he=(ge,xe)=>{if(ge.length===0)return!1;const Ae=ge[ge.length-1];return xe.x===Ae.x&&xe.y===Ae.y};for(const{polygon:ge,bounds:xe}of J){let Ae=0,be=0;for(const Ge of ge)P&&!Ge[0].equals(Ge[Ge.length-1])&&Ge.push(Ge[0]),be+=P?Ge.length-1:Ge.length;const ze=this.segments.prepareSegment((P?5:4)*be,this.layoutVertexArray,this.indexArray);O.footprintSegIdx<0&&(O.footprintSegIdx=this.footprintSegments.length),O.polygonSegIdx<0&&(O.polygonSegIdx=this.polygonSegments.length);const qe={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},De=new Qx;if(De.vertexOffset=this.footprintVertices.length,De.indexOffset=3*this.footprintIndices.length,De.ringIndices=[],P){const Ge=[],Pe=[];Ae=ze.vertexLength;for(let ut=0;ut<ge.length;ut++){const Ze=ge[ut];Ze.length&&ut!==0&&Pe.push(Ge.length/2);const Lt=[];let St,Ye;St=Ze[1].sub(Ze[0])._perp()._unit(),De.ringIndices.push(Ze.length-1);for(let ei=1;ei<Ze.length;ei++){const Ft=Ze[ei],Rt=Ze[ei===Ze.length-1?1:ei+1],Je=Ft.clone();if(oe){Ye=Rt.sub(Ft)._perp()._unit();const Xt=St.add(Ye)._unit(),bi=oe*Math.min(4,1/(St.x*Xt.x+St.y*Xt.y));Je.x+=bi*Xt.x,Je.y+=bi*Xt.y,Je.x=Math.round(Je.x),Je.y=Math.round(Je.y),St=Ye}!F||oe!==0&&!se||he(Lt,Je)||Lt.push(Je),Jd(this.layoutVertexArray,Je.x,Je.y,0,0,1,1,0),ze.vertexLength++,this.footprintVertices.emplaceBack(Ft.x,Ft.y),Ge.push(Ft.x,Ft.y),M&&Qd(this.layoutVertexExtArray,E.projectTilePoint(Je.x,Je.y,a),E.upVector(a,Je.x,Je.y))}F&&(oe===0||se)&&(Lt.length!==0&&he(Lt,Lt[0])&&Lt.pop(),this.groundEffect.addData(Lt,xe,y))}const je=nm(Ge,Pe);for(let ut=0;ut<je.length;ut+=3)this.footprintIndices.emplaceBack(De.vertexOffset+je[ut+0],De.vertexOffset+je[ut+1],De.vertexOffset+je[ut+2]),this.indexArray.emplaceBack(Ae+je[ut],Ae+je[ut+2],Ae+je[ut+1]),ze.primitiveLength++;De.indexCount+=je.length,De.vertexCount+=this.footprintVertices.length-De.vertexOffset}for(let Ge=0;Ge<ge.length;Ge++){const Pe=ge[Ge];D.startRing(O,Pe[0]);let je=Pe.length>4&&a1(Pe[Pe.length-2],Pe[0],Pe[1]),ut=oe?bA(Pe[Pe.length-2],Pe[0],Pe[1],oe):0;const Ze=[];let Lt,St,Ye;St=Pe[1].sub(Pe[0])._perp()._unit();let ei=!0;for(let Ft=1,Rt=0;Ft<Pe.length;Ft++){let Je=Pe[Ft-1],Xt=Pe[Ft];const bi=Pe[Ft===Pe.length-1?1:Ft+1];if(D.appendEdge(O,Xt,Je),jg(Xt,Je,xe)){oe&&(St=bi.sub(Xt)._perp()._unit(),ei=!ei);continue}const ti=Xt.sub(Je)._perp(),wi=ti.x/(Math.abs(ti.x)+Math.abs(ti.y)),ci=ti.y>0?1:0,Oi=Je.dist(Xt);if(Rt+Oi>32768&&(Rt=0),oe){Ye=bi.sub(Xt)._perp()._unit();let Hi=s1(Je,Xt,bi,n1(St,Ye),oe);isNaN(Hi)&&(Hi=0);const tr=Xt.sub(Je)._unit();Je=Je.add(tr.mult(ut))._round(),Xt=Xt.add(tr.mult(-Hi))._round(),ut=Hi,St=Ye,F&&this.zoom>=17&&(he(Ze,Je)||Ze.push(Je),he(Ze,Xt)||Ze.push(Xt))}const fi=ze.vertexLength,fr=Pe.length>4&&a1(Je,Xt,bi);let $i=l1(Rt,je,ei);if(Jd(this.layoutVertexArray,Je.x,Je.y,wi,ci,0,0,$i),Jd(this.layoutVertexArray,Je.x,Je.y,wi,ci,0,1,$i),Rt+=Oi,$i=l1(Rt,fr,!ei),je=fr,Jd(this.layoutVertexArray,Xt.x,Xt.y,wi,ci,0,0,$i),Jd(this.layoutVertexArray,Xt.x,Xt.y,wi,ci,0,1,$i),ze.vertexLength+=4,this.indexArray.emplaceBack(fi+0,fi+1,fi+2),this.indexArray.emplaceBack(fi+1,fi+3,fi+2),ze.primitiveLength+=2,oe){const Hi=Ae+(Ft===1?Pe.length-2:Ft-2),tr=Ft===1?Ae:Hi+1;if(this.indexArray.emplaceBack(fi+1,Hi,fi+3),this.indexArray.emplaceBack(Hi,tr,fi+3),ze.primitiveLength+=2,Lt===void 0&&(Lt=fi),!jg(bi,Pe[Ft],xe)){const qi=Ft===Pe.length-1?Lt:ze.vertexLength;this.indexArray.emplaceBack(fi+2,fi+3,qi),this.indexArray.emplaceBack(fi+3,qi+1,qi),this.indexArray.emplaceBack(fi+3,tr,qi+1),ze.primitiveLength+=3}ei=!ei}if(M){const Hi=this.layoutVertexExtArray,tr=E.projectTilePoint(Je.x,Je.y,a),qi=E.projectTilePoint(Xt.x,Xt.y,a),Lr=E.upVector(a,Je.x,Je.y),ar=E.upVector(a,Xt.x,Xt.y);Qd(Hi,tr,Lr),Qd(Hi,tr,Lr),Qd(Hi,qi,ar),Qd(Hi,qi,ar)}}P&&(Ae+=Pe.length-1),F&&oe&&this.zoom>=17&&(Ze.length!==0&&he(Ze,Ze[0])&&Ze.pop(),this.groundEffect.addData(Ze,xe,y,oe>0))}this.footprintSegments.push(De),qe.triangleCount=this.indexArray.length-qe.triangleArrayOffset,this.polygonSegments.push(qe),++O.footprintSegLen,++O.polygonSegLen}if(O.vertexCount=this.layoutVertexArray.length-O.vertexArrayOffset,O.groundVertexCount=this.groundEffect.vertexArray.length-O.groundVertexArrayOffset,O.vertexCount!==0){if(O.centroidXY=D.borders?Jx:this.encodeCentroid(D,O),this.centroidData.push(O),D.borders){this.featuresOnBorder.push(D);const ge=this.featuresOnBorder.length-1;for(let xe=0;xe<D.borders.length;xe++)D.borders[xe][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[xe].push(ge)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,c,d,a,g),this.groundEffect.addPaintPropertiesData(e,n,c,d,a,g),this.maxHeight=Math.max(this.maxHeight,V)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,n)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[n].borders[e][0])}splitToSubtiles(){const e=[];for(let m=0;m<this.centroidData.length;m++){const g=this.centroidData[m],y=+(g.min.y+g.max.y>xt),w=2*y+(+(g.min.x+g.max.x>xt)^y);for(let E=0;E<g.polygonSegLen;E++){const M=g.polygonSegIdx+E;e.push({centroidIdx:m,subtile:w,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const i=new dn;e.sort((m,g)=>m.triangleSegmentIdx===g.triangleSegmentIdx?m.subtile-g.subtile:m.triangleSegmentIdx-g.triangleSegmentIdx);let n=0,a=0,c=0;for(const m of e){if(m.triangleSegmentIdx!==n)break;c++}const d=e.length;for(;a!==e.length;){n=e[a].triangleSegmentIdx;let m=0,g=a,y=a;for(let w=g;w<c&&e[w].subtile===m;w++)y++;for(;g!==c;){const w=e[g];m=w.subtile;const E=this.centroidData[w.centroidIdx].min.clone(),M=this.centroidData[w.centroidIdx].max.clone(),P={vertexOffset:this.segments.segments[n].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[n].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let D=g;D<y;D++){const O=e[D],F=this.polygonSegments[O.polygonSegmentIdx],V=this.centroidData[O.centroidIdx].min,W=this.centroidData[O.centroidIdx].max,Q=this.indexArray.uint16;for(let J=F.triangleArrayOffset;J<F.triangleArrayOffset+F.triangleCount;J++)i.emplaceBack(Q[3*J],Q[3*J+1],Q[3*J+2]);P.primitiveLength+=F.triangleCount,E.x=Math.min(E.x,V.x),E.y=Math.min(E.y,V.y),M.x=Math.max(M.x,W.x),M.y=Math.max(M.y,W.y)}P.primitiveLength>0&&this.triangleSubSegments.push({segment:P,min:E,max:M}),g=y;for(let D=g;D<c&&e[D].subtile===e[g].subtile;D++)y++}a=c;for(let w=a;w<d&&e[w].triangleSegmentIdx===e[a].triangleSegmentIdx;w++)c++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,n){let a=0,c=0;const d=1<<e.canonical.z;if(i){const O=i.getMinMaxForTile(e);O&&(a=O.min,c=O.max)}c+=this.maxHeight;const m=e.toUnwrapped();let g;const y=[m.canonical.x/d+m.wrap,m.canonical.y/d],w=[(m.canonical.x+1)/d+m.wrap,(m.canonical.y+1)/d],E=new $r,M=(O,F,V)=>[O[0]*(1-V[0])+F[0]*V[0],O[1]*(1-V[1])+F[1]*V[1]],P=[],D=[];for(const O of this.triangleSubSegments){P[0]=O.min.x/xt,P[1]=O.min.y/xt,D[0]=O.max.x/xt,D[1]=O.max.y/xt;const F=M(y,w,P),V=M(y,w,D);if(new Ur([F[0],F[1],a],[V[0],V[1],c]).intersectsPrecise(n)===0){g&&(E.segments.push(g),g=void 0);continue}const W=O.segment;g&&g.vertexOffset!==W.vertexOffset&&(E.segments.push(g),g=void 0),g?(g.vertexLength+=W.vertexLength,g.primitiveLength+=W.primitiveLength):g={vertexOffset:W.vertexOffset,primitiveLength:W.primitiveLength,vertexLength:W.vertexLength,primitiveOffset:W.primitiveOffset,sortKey:void 0,vaos:{}}}return g&&E.segments.push(g),E}encodeCentroid(e,i){const n=e.centroid(),a=i.span(),c=Math.min(7,Math.round(a.x*this.tileToMeter/10)),d=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new Ie(Nt(n.x,1,xt-1)<<3|c,Nt(n.y,1,xt-1)<<3|d)}encodeBorderCentroid(e){if(!e.borders)return new Ie(0,0);const i=e.borders,n=Number.MAX_VALUE;if(i[0][0]!==n||i[1][0]!==n){const a=i[0][0]!==n?0:1;return new Ie(6|(i[0][0]!==n?0:65528),(i[a][0]+i[a][1])/2<<3|6)}{const a=i[2][0]!==n?2:3;return new Ie((i[a][0]+i[a][1])/2<<3|6,6|(i[2][0]!==n?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=tl,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,n=e.vertexCount+e.vertexArrayOffset,a=e.flags&tl?Jx:e.centroidXY,c=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==a.y||c!==a.x){for(let d=i;d<n;++d)this.centroidVertexArray.emplace(d,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const n=i.getReplacementRegionsForTile(e.toUnwrapped());if(function(c,d){if(c.length!==d.length)return!1;for(let m=0;m<c.length;m++)if(c[m].sourceId!==d[m].sourceId||!Vx(c[m],d[m]))return!1;return!0}(this.activeReplacements,n))return;if(this.activeReplacements=n,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const c of this.centroidData)c.flags&=2147483647;const a=[];for(const c of this.activeReplacements){const d=Math.pow(2,c.footprintTileId.canonical.z-e.canonical.z);for(const m of this.centroidData)if(!(m.flags&tl||c.min.x>m.max.x||m.min.x>c.max.x||c.min.y>m.max.y||m.min.y>c.max.y))for(let g=0;g<m.footprintSegLen;g++){const y=this.footprintSegments[m.footprintSegIdx+g];if(a.length=0,wA(this.footprintVertices,y.vertexOffset,y.vertexCount,c.footprintTileId.canonical,e.canonical,a),Gx(c.footprint,a,this.footprintIndices.uint16,y.indexOffset,y.indexCount,-y.vertexOffset,-d)){m.flags|=tl;break}}}for(const c of this.centroidData)this.writeCentroidToBuffer(c);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,n){let a=!1;for(let c=0;c<n.footprintSegLen;c++){const d=this.footprintSegments[n.footprintSegIdx+c];let m=0;for(const g of d.ringIndices){for(let y=m,w=g+m-1;y<g+m;w=y++){const E=this.footprintVertices.int16[2*(y+d.vertexOffset)+0],M=this.footprintVertices.int16[2*(y+d.vertexOffset)+1],P=this.footprintVertices.int16[2*(w+d.vertexOffset)+1];M>i!=P>i&&e<(this.footprintVertices.int16[2*(w+d.vertexOffset)+0]-E)*(i-M)/(P-M)+E&&(a=!a)}m=g}}return a}getHeightAtTileCoord(e,i){let n=Number.NEGATIVE_INFINITY,a=!0;const c=4*(e+xt)*xt+(i+xt);if(this.partLookup.hasOwnProperty(c)){const d=this.partLookup[c];return d?{height:d.height,hidden:!!(d.flags&tl)}:void 0}for(const d of this.centroidData)e>d.max.x||d.min.x>e||i>d.max.y||d.min.y>i||this.footprintContainsPoint(e,i,d)&&d&&d.height>n&&(n=d.height,this.partLookup[c]=d,a=!!(d.flags&tl));if(n!==Number.NEGATIVE_INFINITY)return{height:n,hidden:a};this.partLookup[c]=void 0}}function n1(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function bA(t,e,i,n){const a=e.sub(t)._perp()._unit(),c=i.sub(e)._perp()._unit();return s1(t,e,i,n1(a,c),n)}function s1(t,e,i,n,a){const c=Math.sqrt(1-n*n);return Math.min(t.dist(e)/3,e.dist(i)/3,a*c/n)}function jg(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function o1(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function a1(t,e,i){if(t.x<0||t.x>=xt||e.x<0||e.x>=xt||i.x<0||i.x>=xt)return!1;const n=i.sub(e),a=n.perp(),c=t.sub(e);return(n.x*c.x+n.y*c.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(c.x*c.x+c.y*c.y))>-.866&&a.x*c.x+a.y*c.y<0}function l1(t,e,i){const n=e?2|t:-3&t;return i?1|n:-2&n}function c1(){const t=Math.PI/32,e=Math.tan(t),i=Le;return i*Math.sqrt(1+2*e*e)-i}function u1(t,e,i){const n=1<<i.z,a=ui(i.x/n),c=ui((i.x+1)/n),d=ki(i.y/n),m=ki((i.y+1)/n);return function(g,y,w,E,M=0,P){const D=[];if(!g.length||!w||!E)return D;const O=(se,he)=>{for(const ge of se)D.push({polygon:ge,bounds:he})},F=Math.ceil(Math.log2(w)),V=Math.ceil(Math.log2(E)),W=F-V,Q=[];for(let se=0;se<Math.abs(W);se++)Q.push(W>0?0:1);for(let se=0;se<Math.min(F,V);se++)Q.push(0),Q.push(1);let J=g;if(J=am(J,y[0].y-M,y[1].y+M,1),J=am(J,y[0].x-M,y[1].x+M,0),!J.length)return D;const oe=[];for(Q.length?oe.push({polygons:J,bounds:y,depth:0}):O(J,y);oe.length;){const se=oe.pop(),he=se.depth,ge=Q[he],xe=se.bounds[0],Ae=se.bounds[1],be=ge===0?xe.x:xe.y,ze=ge===0?Ae.x:Ae.y,qe=P?P(ge,be,ze):.5*(be+ze),De=am(se.polygons,be-M,qe+M,ge),Ge=am(se.polygons,qe-M,ze+M,ge);if(De.length){const Pe=[xe,new Ie(ge===0?qe:Ae.x,ge===1?qe:Ae.y)];Q.length>he+1?oe.push({polygons:De,bounds:Pe,depth:he+1}):O(De,Pe)}if(Ge.length){const Pe=[new Ie(ge===0?qe:xe.x,ge===1?qe:xe.y),Ae];Q.length>he+1?oe.push({polygons:Ge,bounds:Pe,depth:he+1}):O(Ge,Pe)}}return D}(t,e,Math.ceil((c-a)/11.25),Math.ceil((d-m)/11.25),1,(g,y,w)=>{if(g===0)return .5*(y+w);{const E=ki((i.y+y/xt)/n);return(si(.5*(ki((i.y+w/xt)/n)+E))*n-i.y)*xt}})}function wA(t,e,i,n,a,c){const d=Math.pow(2,n.z-a.z);for(let m=0;m<i;m++){let g=t.int16[2*(m+e)+0],y=t.int16[2*(m+e)+1];g=(g+a.x*xt)*d-n.x*xt,y=(y+a.y*xt)*d-n.y*xt,c.push(new Ie(g,y))}}Ct(hm,"FillExtrusionBucket",{omit:["layers","features"]}),Ct(e1,"PartData"),Ct(Qx,"FootprintSegment"),Ct(t1,"BorderCentroidData"),Ct(r1,"GroundEffect");const TA=new zr({visibility:new at(Te["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new at(Te["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var EA={paint:new zr({"fill-extrusion-opacity":new at(Te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wt(Te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new at(Te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new at(Te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Wt(Te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wt(Te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wt(Te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new at(Te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new at(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new at(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new at(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new at(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new at(Te["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new at(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new at(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Wt(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Wt(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new at(Te["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new at(Te["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new at(Te["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new at(Te["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new at(Te["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:TA};class Bu extends Ie{constructor(e,i,n){super(e,i),this.z=n}}function ef(t,e){return t.x*e.x+t.y*e.y}function h1(t,e){if(t.length===1){let i=0;const n=e[i++];let a;for(;!a||n.equals(a);)if(a=e[i++],!a)return 1/0;for(;i<e.length;i++){const c=e[i],d=t[0],m=a.sub(n),g=c.sub(n),y=d.sub(n),w=ef(m,m),E=ef(m,g),M=ef(g,g),P=ef(y,m),D=ef(y,g),O=w*M-E*E,F=(M*P-E*D)/O,V=(w*D-E*P)/O,W=n.z*(1-F-V)+a.z*F+c.z*V;if(isFinite(W))return W}return 1/0}{let i=1/0;for(const n of e)i=Math.min(i,n.z);return i}}function d1(t,e,i,n,a,c,d,m){const g=d*a.getElevationAt(t,e,!0,!0),y=c[0]!==0,w=y?c[1]===0?d*(c[0]/7-450):d*function(E,M,P){const D=Math.floor(M[0]/8),O=Math.floor(M[1]/8),F=10*(M[0]-8*D),V=10*(M[1]-8*O),W=E.getElevationAt(D,O,!0,!0),Q=E.getMeterToDEM(P),J=Math.floor(.5*(F*Q-1)),oe=Math.floor(.5*(V*Q-1)),se=E.tileCoordToPixel(D,O),he=2*J+1,ge=2*oe+1,xe=function(Ge,Pe,je,ut,Ze){return[Ge.getElevationAtPixel(Pe,je,!0),Ge.getElevationAtPixel(Pe+Ze,je,!0),Ge.getElevationAtPixel(Pe,je+Ze,!0),Ge.getElevationAtPixel(Pe+ut,je+Ze,!0)]}(E,se.x-J,se.y-oe,he,ge),Ae=Math.abs(xe[0]-xe[1]),be=Math.abs(xe[2]-xe[3]),ze=Math.abs(xe[0]-xe[2])+Math.abs(xe[1]-xe[3]),qe=Math.min(.25,.5*Q*(Ae+be)/he),De=Math.min(.25,.5*Q*ze/ge);return W+Math.max(qe*F,De*V)}(a,c,m):g;return{base:g+(i===0)?-1:i,top:y?Math.max(w+n,g+i+2):g+n}}const SA=nr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:MA}=SA,AA=nr([{name:"a_packed",components:4,type:"Float32"}]),{members:IA}=AA;class f1{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Qa({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const n=this.getKey(e,i);return this.positions[n]}trim(){const e=this.width,i=this.height=wn(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,n){const a=[];let c=e.length%2==1?-e[e.length-1]*n:0,d=e[0]*n,m=!0;a.push({left:c,right:d,isDash:m,zeroLength:e[0]===0});let g=e[0];for(let y=1;y<e.length;y++){m=!m;const w=e[y];c=g*n,g+=w,d=g*n,a.push({left:c,right:d,isDash:m,zeroLength:w===0})}return a}addRoundDash(e,i,n){const a=i/2;for(let c=-n;c<=n;c++){const d=this.width*(this.nextRow+n+c);let m=0,g=e[m];for(let y=0;y<this.width;y++){y/g.right>1&&(g=e[++m]);const w=Math.abs(y-g.left),E=Math.abs(y-g.right),M=Math.min(w,E);let P;const D=c/n*(a+1);if(g.isDash){const O=a-Math.abs(D);P=Math.sqrt(M*M+O*O)}else P=a-Math.sqrt(M*M+D*D);this.image.data[d+y]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,i){for(let g=e.length-1;g>=0;--g){const y=e[g],w=e[g+1];y.zeroLength?e.splice(g,1):w&&w.isDash===y.isDash&&(w.left=y.left,e.splice(g,1))}const n=e[0],a=e[e.length-1];n.isDash===a.isDash&&(n.left=a.left-this.width,a.right=n.right+this.width);const c=this.width*this.nextRow;let d=0,m=e[d];for(let g=0;g<this.width;g++){g/m.right>1&&(m=e[++d]);const y=Math.abs(g-m.left),w=Math.abs(g-m.right),E=Math.min(y,w);this.image.data[c+g]=Math.max(0,Math.min(255,(m.isDash?E:-E)+i+128))}}addDash(e,i){const n=this.getKey(e,i);if(this.positions[n])return this.positions[n];const a=i==="round",c=a?7:0,d=2*c+1;if(this.nextRow+d>this.height)return _e("LineAtlas out of space"),null;e.length===0&&e.push(1);let m=0;for(let w=0;w<e.length;w++)e[w]<0&&(_e("Negative value is found in line dasharray, replacing values with 0"),e[w]=0),m+=e[w];if(m!==0){const w=this.width/m,E=this.getDashRanges(e,this.width,w);a?this.addRoundDash(E,w,c):this.addRegularDash(E,i==="square"?.5*w:0)}const g=this.nextRow+c;this.nextRow+=d;const y={tl:[g,c],br:[m,0]};return this.positions[n]=y,y}}Ct(f1,"LineAtlas");const CA=om.types,PA=Math.cos(Math.PI/180*37.5);class Gg{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Ld,this.layoutVertexArray2=new Bo,this.indexArray=new dn,this.programConfigurations=new j(e.layers,e.zoom),this.segments=new $r,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,n,a){this.hasPattern=Fg("line",this.layers,i);const c=this.layers[0].layout.get("line-sort-key"),d=[];for(const{feature:w,id:E,index:M,sourceLayerIndex:P}of e){const D=this.layers[0]._featureFilter.needGeometry,O=an(w,D);if(!this.layers[0]._featureFilter.filter(new Or(this.zoom),O,n))continue;const F=c?c.evaluate(O,{},n):void 0,V={id:E,properties:w.properties,type:w.type,sourceLayerIndex:P,index:M,geometry:D?O.geometry:pn(w,n,a),patterns:{},sortKey:F};d.push(V)}c&&d.sort((w,E)=>w.sortKey-E.sortKey);const{lineAtlas:m,featureIndex:g}=i,y=this.addConstantDashes(m);for(const w of d){const{geometry:E,index:M,sourceLayerIndex:P}=w;if(y&&this.addFeatureDashes(w,m),this.hasPattern){const D=Ng("line",this.layers,w,this.zoom,i);this.patternFeatures.push(D)}else this.addFeature(w,E,M,n,m.positions,i.availableImages,i.brightness);g.insert(e[M].feature,E,M,P,this.index)}}addConstantDashes(e){let i=!1;for(const n of this.layers){const a=n.paint.get("line-dasharray").value,c=n.layout.get("line-cap").value;if(a.kind!=="constant"||c.kind!=="constant")i=!0;else{const d=c.value,m=a.value;if(!m)continue;e.addDash(m,d)}}return i}addFeatureDashes(e,i){const n=this.zoom;for(const a of this.layers){const c=a.paint.get("line-dasharray").value,d=a.layout.get("line-cap").value;if(c.kind==="constant"&&d.kind==="constant")continue;let m,g;if(c.kind==="constant"){if(m=c.value,!m)continue}else m=c.evaluate({zoom:n},e);g=d.kind==="constant"?d.value:d.evaluate({zoom:n},e),i.addDash(m,g),e.patterns[a.id]=i.getKey(m,g)}}update(e,i,n,a,c){const d=Object.keys(e).length!==0;d&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,d?this.stateDependentLayers:this.layers,n,a,c)}addFeatures(e,i,n,a,c,d){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,i,n,a,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,IA)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,MA),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,n,a,c,d,m){const g=this.layers[0].layout,y=g.get("line-join").evaluate(e,{}),w=g.get("line-cap").evaluate(e,{}),E=g.get("line-miter-limit"),M=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const P of i)this.addLine(P,e,y,w,E,M);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,c,d,a,m)}addLine(e,i,n,a,c,d){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let V=0;V<e.length-1;V++)this.totalDistance+=e[V].dist(e[V+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const m=CA[i.type]==="Polygon";let g=e.length;for(;g>=2&&e[g-1].equals(e[g-2]);)g--;let y=0;for(;y<g-1&&e[y].equals(e[y+1]);)y++;if(g<(m?3:2))return;n==="bevel"&&(c=1.05);const w=this.overscaling<=16?15*xt/(512*this.overscaling):0,E=this.segments.prepareSegment(10*g,this.layoutVertexArray,this.indexArray);let M,P,D,O,F;this.e1=this.e2=-1,m&&(M=e[g-2],F=e[y].sub(M)._unit()._perp());for(let V=y;V<g;V++){if(D=V===g-1?m?e[y+1]:void 0:e[V+1],D&&e[V].equals(D))continue;F&&(O=F),M&&(P=M),M=e[V],F=D?D.sub(M)._unit()._perp():O,O=O||F;let W=O.add(F);W.x===0&&W.y===0||W._unit();const Q=O.x*F.x+O.y*F.y,J=W.x*F.x+W.y*F.y,oe=J!==0?1/J:1/0,se=2*Math.sqrt(2-2*J),he=J<PA&&P&&D,ge=O.x*F.y-O.y*F.x>0;if(he&&V>y){const be=M.dist(P);if(be>2*w){const ze=M.sub(M.sub(P)._mult(w/be)._round());this.updateDistance(P,ze),this.addCurrentVertex(ze,O,0,0,E),P=ze}}const xe=P&&D;let Ae=xe?n:m?"butt":a;if(xe&&Ae==="round"&&(oe<d?Ae="miter":oe<=2&&(Ae="fakeround")),Ae==="miter"&&oe>c&&(Ae="bevel"),Ae==="bevel"&&(oe>2&&(Ae="flipbevel"),oe<c&&(Ae="miter")),P&&this.updateDistance(P,M),Ae==="miter")W._mult(oe),this.addCurrentVertex(M,W,0,0,E);else if(Ae==="flipbevel"){if(oe>100)W=F.mult(-1);else{const be=oe*O.add(F).mag()/O.sub(F).mag();W._perp()._mult(be*(ge?-1:1))}this.addCurrentVertex(M,W,0,0,E),this.addCurrentVertex(M,W.mult(-1),0,0,E)}else if(Ae==="bevel"||Ae==="fakeround"){const be=-Math.sqrt(oe*oe-1),ze=ge?be:0,qe=ge?0:be;if(P&&this.addCurrentVertex(M,O,ze,qe,E),Ae==="fakeround"){const De=Math.round(180*se/Math.PI/20);for(let Ge=1;Ge<De;Ge++){let Pe=Ge/De;if(Pe!==.5){const ut=Pe-.5;Pe+=Pe*ut*(Pe-1)*((1.0904+Q*(Q*(3.55645-1.43519*Q)-3.2452))*ut*ut+(.848013+Q*(.215638*Q-1.06021)))}const je=F.sub(O)._mult(Pe)._add(O)._unit()._mult(ge?-1:1);this.addHalfVertex(M,je.x,je.y,!1,ge,0,E)}}D&&this.addCurrentVertex(M,F,-ze,-qe,E)}else if(Ae==="butt")this.addCurrentVertex(M,W,0,0,E);else if(Ae==="square"){const be=P?1:-1;P||this.addCurrentVertex(M,W,be,be,E),this.addCurrentVertex(M,W,0,0,E),P&&this.addCurrentVertex(M,W,be,be,E)}else Ae==="round"&&(P&&(this.addCurrentVertex(M,O,0,0,E),this.addCurrentVertex(M,O,1,1,E,!0)),D&&(this.addCurrentVertex(M,F,-1,-1,E,!0),this.addCurrentVertex(M,F,0,0,E)));if(he&&V<g-1){const be=M.dist(D);if(be>2*w){const ze=M.add(D.sub(M)._mult(w/be)._round());this.updateDistance(M,ze),this.addCurrentVertex(ze,F,0,0,E),M=ze}}}}addCurrentVertex(e,i,n,a,c,d=!1){const m=i.y*a-i.x,g=-i.y-i.x*a;this.addHalfVertex(e,i.x+i.y*n,i.y-i.x*n,d,!1,n,c),this.addHalfVertex(e,m,g,d,!0,-a,c)}addHalfVertex({x:e,y:i},n,a,c,d,m,g){this.layoutVertexArray.emplaceBack((e<<1)+(c?1:0),(i<<1)+(d?1:0),Math.round(63*n)+128,Math.round(63*a)+128,1+(m===0?0:m<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const y=g.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,y),g.primitiveLength++),d?this.e2=y:this.e1=y}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Ct(Gg,"LineBucket",{omit:["layers","patternFeatures"]});const RA=new zr({"line-cap":new Wt(Te.layout_line["line-cap"]),"line-join":new Wt(Te.layout_line["line-join"]),"line-miter-limit":new at(Te.layout_line["line-miter-limit"]),"line-round-limit":new at(Te.layout_line["line-round-limit"]),"line-sort-key":new Wt(Te.layout_line["line-sort-key"]),visibility:new at(Te.layout_line.visibility)});var p1={paint:new zr({"line-opacity":new Wt(Te.paint_line["line-opacity"]),"line-color":new Wt(Te.paint_line["line-color"]),"line-translate":new at(Te.paint_line["line-translate"]),"line-translate-anchor":new at(Te.paint_line["line-translate-anchor"]),"line-width":new Wt(Te.paint_line["line-width"]),"line-gap-width":new Wt(Te.paint_line["line-gap-width"]),"line-offset":new Wt(Te.paint_line["line-offset"]),"line-blur":new Wt(Te.paint_line["line-blur"]),"line-dasharray":new Wt(Te.paint_line["line-dasharray"]),"line-pattern":new Wt(Te.paint_line["line-pattern"]),"line-gradient":new ha(Te.paint_line["line-gradient"]),"line-trim-offset":new at(Te.paint_line["line-trim-offset"]),"line-emissive-strength":new at(Te.paint_line["line-emissive-strength"]),"line-border-width":new Wt(Te.paint_line["line-border-width"]),"line-border-color":new Wt(Te.paint_line["line-border-color"])}),layout:RA};function m1(t,e,i){return e*(xt/(t.tileSize*Math.pow(2,i-t.tileID.overscaledZ)))}function _1(t,e){return 1/m1(t,1,e.tileZoom)}function g1(t,e,i,n){return t.translatePosMatrix(n||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const y1=t=>{const e=[];v1(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=t.paint.get("line-trim-offset");return i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function v1(t){const e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}const x1=new class extends Wt{possiblyEvaluate(t,e){return e=new Or(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,n){return e=gr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,n)}}(p1.paint.properties["line-width"].specification);function b1(t,e){return e>0?e+2*t:t}x1.useIntegerZoom=!0;const LA=nr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),DA=nr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),OA=nr([{name:"a_projected_pos",components:4,type:"Float32"}],4);nr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const zA=nr([{name:"a_z_offset",components:1,type:"Float32"}],4),kA=nr([{name:"a_texb",components:2,type:"Uint16"}]),BA=nr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),FA=nr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);nr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const w1=nr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),NA=nr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);nr([{name:"triangle",components:3,type:"Uint16"}]),nr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),nr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),nr([{type:"Float32",name:"offsetX"}]),nr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Pn=24;const lo=128;function $g(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Or(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:n,interpolationType:a}=i;let c=0;for(;c<n.length&&n[c]<=t;)c++;c=Math.max(0,c-1);let d=c;for(;d<n.length&&n[d]<t+1;)d++;d=Math.min(n.length-1,d);const m=n[c],g=n[d];return i.kind==="composite"?{kind:"composite",minZoom:m,maxZoom:g,interpolationType:a}:{kind:"camera",minZoom:m,maxZoom:g,minSize:i.evaluate(new Or(m)),maxSize:i.evaluate(new Or(g)),interpolationType:a}}}function dm(t,{uSize:e,uSizeT:i},{lowerSize:n,upperSize:a}){return t.kind==="source"?n/lo:t.kind==="composite"?Di(n/lo,a/lo,i):e}function Fu(t,e){let i=0,n=0;if(t.kind==="constant")n=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:a,minZoom:c,maxZoom:d}=t,m=a?Nt(os.interpolationFactor(a,e,c,d),0,1):0;t.kind==="camera"?n=Di(t.minSize,t.maxSize,m):i=m}return{uSizeT:i,uSize:n}}var VA=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:lo,evaluateSizeForFeature:dm,evaluateSizeForZoom:Fu,getSizeData:$g});function UA(t,e,i){return t.sections.forEach(n=>{n.text=function(a,c,d){const m=c.layout.get("text-transform").evaluate(d,{});return m==="uppercase"?a=a.toLocaleUpperCase():m==="lowercase"&&(a=a.toLocaleLowerCase()),as.applyArabicShaping&&(a=as.applyArabicShaping(a)),a}(n.text,e,i)}),t}const tf={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function jA(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function GA(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}var $A={read:function(t,e,i,n,a){var c,d,m=8*a-n-1,g=(1<<m)-1,y=g>>1,w=-7,E=i?a-1:0,M=i?-1:1,P=t[e+E];for(E+=M,c=P&(1<<-w)-1,P>>=-w,w+=m;w>0;c=256*c+t[e+E],E+=M,w-=8);for(d=c&(1<<-w)-1,c>>=-w,w+=n;w>0;d=256*d+t[e+E],E+=M,w-=8);if(c===0)c=1-y;else{if(c===g)return d?NaN:1/0*(P?-1:1);d+=Math.pow(2,n),c-=y}return(P?-1:1)*d*Math.pow(2,c-n)},write:function(t,e,i,n,a,c){var d,m,g,y=8*c-a-1,w=(1<<y)-1,E=w>>1,M=a===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=n?0:c-1,D=n?1:-1,O=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(m=isNaN(e)?1:0,d=w):(d=Math.floor(Math.log(e)/Math.LN2),e*(g=Math.pow(2,-d))<1&&(d--,g*=2),(e+=d+E>=1?M/g:M*Math.pow(2,1-E))*g>=2&&(d++,g/=2),d+E>=w?(m=0,d=w):d+E>=1?(m=(e*g-1)*Math.pow(2,a),d+=E):(m=e*Math.pow(2,E-1)*Math.pow(2,a),d=0));a>=8;t[i+P]=255&m,P+=D,m/=256,a-=8);for(d=d<<a|m,y+=a;y>0;t[i+P]=255&d,P+=D,d/=256,y-=8);t[i+P-D]|=128*O}},T1=Rr,fm=$A;function Rr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Rr.Varint=0,Rr.Fixed64=1,Rr.Bytes=2,Rr.Fixed32=5;var qg=4294967296,E1=1/qg,S1=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function va(t){return t.type===Rr.Bytes?t.readVarint()+t.pos:t.pos+1}function Nu(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function M1(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var a=i.pos-1;a>=t;a--)i.buf[a+n]=i.buf[a]}function qA(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function ZA(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function HA(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function WA(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function XA(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function KA(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function YA(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function JA(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function QA(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function pm(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Vu(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function A1(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Rr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),a=n>>3,c=this.pos;this.type=7&n,t(a,e,this),this.pos===c&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=pm(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=A1(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=pm(this.buf,this.pos)+pm(this.buf,this.pos+4)*qg;return this.pos+=8,t},readSFixed64:function(){var t=pm(this.buf,this.pos)+A1(this.buf,this.pos+4)*qg;return this.pos+=8,t},readFloat:function(){var t=fm.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=fm.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,n=this.buf;return e=127&(i=n[this.pos++]),i<128?e:(e|=(127&(i=n[this.pos++]))<<7,i<128?e:(e|=(127&(i=n[this.pos++]))<<14,i<128?e:(e|=(127&(i=n[this.pos++]))<<21,i<128?e:function(a,c,d){var m,g,y=d.buf;if(m=(112&(g=y[d.pos++]))>>4,g<128||(m|=(127&(g=y[d.pos++]))<<3,g<128)||(m|=(127&(g=y[d.pos++]))<<10,g<128)||(m|=(127&(g=y[d.pos++]))<<17,g<128)||(m|=(127&(g=y[d.pos++]))<<24,g<128)||(m|=(1&(g=y[d.pos++]))<<31,g<128))return Nu(a,m,c);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&S1?function(i,n,a){return S1.decode(i.subarray(n,a))}(this.buf,e,t):function(i,n,a){for(var c="",d=n;d<a;){var m,g,y,w=i[d],E=null,M=w>239?4:w>223?3:w>191?2:1;if(d+M>a)break;M===1?w<128&&(E=w):M===2?(192&(m=i[d+1]))==128&&(E=(31&w)<<6|63&m)<=127&&(E=null):M===3?(g=i[d+2],(192&(m=i[d+1]))==128&&(192&g)==128&&((E=(15&w)<<12|(63&m)<<6|63&g)<=2047||E>=55296&&E<=57343)&&(E=null)):M===4&&(g=i[d+2],y=i[d+3],(192&(m=i[d+1]))==128&&(192&g)==128&&(192&y)==128&&((E=(15&w)<<18|(63&m)<<12|(63&g)<<6|63&y)<=65535||E>=1114112)&&(E=null)),E===null?(E=65533,M=1):E>65535&&(E-=65536,c+=String.fromCharCode(E>>>10&1023|55296),E=56320|1023&E),c+=String.fromCharCode(E),d+=M}return c}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Rr.Bytes)return t.push(this.readVarint(e));var i=va(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Rr.Bytes)return t.push(this.readSVarint());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Rr.Bytes)return t.push(this.readBoolean());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Rr.Bytes)return t.push(this.readFloat());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Rr.Bytes)return t.push(this.readDouble());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Rr.Bytes)return t.push(this.readFixed32());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Rr.Bytes)return t.push(this.readSFixed32());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Rr.Bytes)return t.push(this.readFixed64());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Rr.Bytes)return t.push(this.readSFixed64());var e=va(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Rr.Varint)for(;this.buf[this.pos++]>127;);else if(e===Rr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Rr.Fixed32)this.pos+=4;else{if(e!==Rr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Vu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Vu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Vu(this.buf,-1&t,this.pos),Vu(this.buf,Math.floor(t*E1),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Vu(this.buf,-1&t,this.pos),Vu(this.buf,Math.floor(t*E1),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var n,a;if(e>=0?(n=e%4294967296|0,a=e/4294967296|0):(a=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(c,d,m){m.buf[m.pos++]=127&c|128,c>>>=7,m.buf[m.pos++]=127&c|128,c>>>=7,m.buf[m.pos++]=127&c|128,c>>>=7,m.buf[m.pos++]=127&c|128,m.buf[m.pos]=127&(c>>>=7)}(n,0,i),function(c,d){var m=(7&c)<<4;d.buf[d.pos++]|=m|((c>>>=3)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c|((c>>>=7)?128:0),c&&(d.buf[d.pos++]=127&c)))))}(a,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(n,a,c){for(var d,m,g=0;g<a.length;g++){if((d=a.charCodeAt(g))>55295&&d<57344){if(!m){d>56319||g+1===a.length?(n[c++]=239,n[c++]=191,n[c++]=189):m=d;continue}if(d<56320){n[c++]=239,n[c++]=191,n[c++]=189,m=d;continue}d=m-55296<<10|d-56320|65536,m=null}else m&&(n[c++]=239,n[c++]=191,n[c++]=189,m=null);d<128?n[c++]=d:(d<2048?n[c++]=d>>6|192:(d<65536?n[c++]=d>>12|224:(n[c++]=d>>18|240,n[c++]=d>>12&63|128),n[c++]=d>>6&63|128),n[c++]=63&d|128)}return c}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&M1(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),fm.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),fm.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&M1(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,Rr.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,qA,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,ZA,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,XA,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,HA,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,WA,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,KA,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,YA,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,JA,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,QA,e)},writeBytesField:function(t,e){this.writeTag(t,Rr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Rr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Rr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Rr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Rr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Rr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Rr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Rr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Rr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Rr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Uu=Xe(T1);const Zg=3;function eI(t,e,i){e.glyphs=[],t===1&&i.readMessage(tI,e)}function tI(t,e,i){if(t===3){const{id:n,bitmap:a,width:c,height:d,left:m,top:g,advance:y}=i.readMessage(iI,{});e.glyphs.push({id:n,bitmap:new Qa({width:c+2*Zg,height:d+2*Zg},a),metrics:{width:c,height:d,left:m,top:g,advance:y}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function iI(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}const I1=Zg,Os={horizontal:1,vertical:2,horizontalOnly:3};class rf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const n=new rf;return n.scale=e||1,n.fontStack=i,n}static forImage(e){const i=new rf;return i.imageName=e,i}}class ju{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const n=new ju;for(let a=0;a<e.sections.length;a++){const c=e.sections[a];c.image?n.addImageSection(c):n.addTextSection(c,i)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,n){let a="";for(let c=0;c<i.length;c++){const d=i.charCodeAt(c+1)||null,m=i.charCodeAt(c-1)||null;a+=!n&&(d&&bp(d)&&!tf[i[c+1]]||m&&bp(m)&&!tf[i[c-1]])||!tf[i[c]]?i[c]:tf[i[c]]}return a}(this.text,e)}trim(){let e=0;for(let n=0;n<this.text.length&&mm[this.text.charCodeAt(n)];n++)e++;let i=this.text.length;for(let n=this.text.length-1;n>=0&&n>=e&&mm[this.text.charCodeAt(n)];n--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const n=new ju;return n.text=this.text.substring(e,i),n.sectionIndex=this.sectionIndex.slice(e,i),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(rf.forText(e.scale,e.fontStack||i));const n=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(n)}addImageSection(e){const i=e.image?e.image.namePrimary:"";if(i.length===0)return void _e("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCodePoint(n),this.sections.push(rf.forImage(i)),this.sectionIndex.push(this.sections.length-1)):_e("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Hg(t,e,i,n,a,c,d,m,g,y,w,E,M,P,D){const O=ju.fromFeature(t,a);E===Os.vertical&&O.verticalizePunctuation(M);let F=[];const V=function(se,he,ge,xe,Ae,be){if(!se)return[];const ze=[],qe=function(je,ut,Ze,Lt,St,Ye){let ei=0;for(let Ft=0;Ft<je.length();Ft++){const Rt=je.getSection(Ft);ei+=C1(je.getCodePoint(Ft),Rt,Lt,St,ut,Ye)}return ei/Math.max(1,Math.ceil(ei/Ze))}(se,he,ge,xe,Ae,be),De=se.text.indexOf("​")>=0;let Ge=0;for(let je=0;je<se.length();je++){const ut=se.getSection(je),Ze=se.getCodePoint(je);if(mm[Ze]||(Ge+=C1(Ze,ut,xe,Ae,he,be)),je<se.length()-1){const Lt=!((Pe=Ze)<11904||!(zt["Bopomofo Extended"](Pe)||zt.Bopomofo(Pe)||zt["CJK Compatibility Forms"](Pe)||zt["CJK Compatibility Ideographs"](Pe)||zt["CJK Compatibility"](Pe)||zt["CJK Radicals Supplement"](Pe)||zt["CJK Strokes"](Pe)||zt["CJK Symbols and Punctuation"](Pe)||zt["CJK Unified Ideographs Extension A"](Pe)||zt["CJK Unified Ideographs"](Pe)||zt["Enclosed CJK Letters and Months"](Pe)||zt["Halfwidth and Fullwidth Forms"](Pe)||zt.Hiragana(Pe)||zt["Ideographic Description Characters"](Pe)||zt["Kangxi Radicals"](Pe)||zt["Katakana Phonetic Extensions"](Pe)||zt.Katakana(Pe)||zt["Vertical Forms"](Pe)||zt["Yi Radicals"](Pe)||zt["Yi Syllables"](Pe)));(rI[Ze]||Lt||ut.imageName)&&ze.push(R1(je+1,Ge,qe,ze,nI(Ze,se.getCodePoint(je+1),Lt&&De),!1))}}var Pe;return L1(R1(se.length(),Ge,qe,ze,0,!0))}(O,y,c,e,n,P),{processBidirectionalText:W,processStyledBidirectionalText:Q}=as;if(W&&O.sections.length===1){const se=W(O.toString(),V);for(const he of se){const ge=new ju;ge.text=he,ge.sections=O.sections;for(let xe=0;xe<he.length;xe++)ge.sectionIndex.push(0);F.push(ge)}}else if(Q){const se=Q(O.text,O.sectionIndex,V);for(const he of se){const ge=new ju;ge.text=he[0],ge.sectionIndex=he[1],ge.sections=O.sections,F.push(ge)}}else F=function(se,he){const ge=[],xe=se.text;let Ae=0;for(const be of he)ge.push(se.substring(Ae,be)),Ae=be;return Ae<xe.length&&ge.push(se.substring(Ae,xe.length)),ge}(O,V);const J=[],oe={positionedLines:J,text:O.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:E,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(se,he,ge,xe,Ae,be,ze,qe,De,Ge,Pe,je){let ut=0,Ze=0,Lt=0;const St=qe==="right"?1:qe==="left"?0:.5;let Ye=!1;for(const bi of Ae){const ti=bi.getSections();for(const wi of ti){if(wi.imageName)continue;const ci=he[wi.fontStack];if(ci&&(Ye=ci.ascender!==void 0&&ci.descender!==void 0,!Ye))break}if(!Ye)break}let ei=0;for(const bi of Ae){bi.trim();const ti=bi.getMaxScale(),wi=(ti-1)*Pn,ci={positionedGlyphs:[],lineOffset:0};se.positionedLines[ei]=ci;const Oi=ci.positionedGlyphs;let fi=0;if(!bi.length()){Ze+=be,++ei;continue}let fr=0,$i=0;for(let tr=0;tr<bi.length();tr++){const qi=bi.getSection(tr),Lr=bi.getSectionIndex(tr),ar=bi.getCodePoint(tr);let qr=qi.scale,un=null,In=null,Ir=null,Fr=Pn,vn=0;const xn=!(De===Os.horizontal||!Pe&&!_d(ar)||Pe&&(mm[ar]||(Ft=ar,zt.Arabic(Ft)||zt["Arabic Supplement"](Ft)||zt["Arabic Extended-A"](Ft)||zt["Arabic Presentation Forms-A"](Ft)||zt["Arabic Presentation Forms-B"](Ft))));if(qi.imageName){const bn=xe[qi.imageName];if(!bn)continue;Ir=qi.imageName,se.iconsInText=se.iconsInText||!0,In=bn.paddedRect;const xr=bn.displaySize;qr=qr*Pn/je,un={width:xr[0],height:xr[1],left:0,top:-I1,advance:xn?xr[1]:xr[0],localGlyph:!1},vn=Ye?-un.height*qr:ti*Pn-17-xr[1]*qr,Fr=un.advance;const _s=(xn?xr[0]:xr[1])*qr-Pn*ti;_s>0&&_s>fi&&(fi=_s)}else{const bn=ge[qi.fontStack];if(!bn)continue;bn[ar]&&(In=bn[ar]);const xr=he[qi.fontStack];if(!xr)continue;const _s=xr.glyphs[ar];if(!_s)continue;if(un=_s.metrics,Fr=ar!==8203?Pn:0,Ye){const ll=xr.ascender!==void 0?Math.abs(xr.ascender):0,es=xr.descender!==void 0?Math.abs(xr.descender):0,$n=(ll+es)*qr;fr<$n&&(fr=$n,$i=(ll-es)/2*qr),vn=-ll*qr}else vn=(ti-qr)*Pn-17}xn?(se.verticalizable=!0,Oi.push({glyph:ar,imageName:Ir,x:ut,y:Ze+vn,vertical:xn,scale:qr,localGlyph:un.localGlyph,fontStack:qi.fontStack,sectionIndex:Lr,metrics:un,rect:In}),ut+=Fr*qr+Ge):(Oi.push({glyph:ar,imageName:Ir,x:ut,y:Ze+vn,vertical:xn,scale:qr,localGlyph:un.localGlyph,fontStack:qi.fontStack,sectionIndex:Lr,metrics:un,rect:In}),ut+=un.advance*qr+Ge)}Oi.length!==0&&(Lt=Math.max(ut-Ge,Lt),Ye?D1(Oi,St,fi,$i,be*ti/2):D1(Oi,St,fi,0,be/2)),ut=0;const Hi=be*ti+fi;ci.lineOffset=Math.max(fi,wi),Ze+=Hi,++ei}var Ft;const Rt=Ze,{horizontalAlign:Je,verticalAlign:Xt}=Wg(ze);(function(bi,ti,wi,ci,Oi,fi){const fr=(ti-wi)*Oi,$i=-fi*ci;for(const Hi of bi)for(const tr of Hi.positionedGlyphs)tr.x+=fr,tr.y+=$i})(se.positionedLines,St,Je,Xt,Lt,Rt),se.top+=-Xt*Rt,se.bottom=se.top+Rt,se.left+=-Je*Lt,se.right=se.left+Lt,se.hasBaseline=Ye}(oe,e,i,n,F,d,m,g,E,y,M,D),!function(se){for(const he of se)if(he.positionedGlyphs.length!==0)return!1;return!0}(J)&&oe}const mm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function C1(t,e,i,n,a,c){if(e.imageName){const d=n[e.imageName];return d?d.displaySize[0]*e.scale*Pn/c+a:0}{const d=i[e.fontStack],m=d&&d.glyphs[t];return m?m.metrics.advance*e.scale+a:0}}function P1(t,e,i,n){const a=Math.pow(t-e,2);return n?t<e?a/2:2*a:a+Math.abs(i)*i}function nI(t,e,i){let n=0;return t===10&&(n-=1e4),i&&(n+=150),t!==40&&t!==65288||(n+=50),e!==41&&e!==65289||(n+=50),n}function R1(t,e,i,n,a,c){let d=null,m=P1(e,i,a,c);for(const g of n){const y=P1(e-g.x,i,a,c)+g.badness;y<=m&&(d=g,m=y)}return{index:t,x:e,priorBreak:d,badness:m}}function L1(t){return t?L1(t.priorBreak).concat(t.index):[]}function Wg(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function D1(t,e,i,n,a){if(!(e||i||n||a))return;const c=t.length-1,d=t[c],m=(d.x+d.metrics.advance*d.scale)*e;for(let g=0;g<=c;g++)t[g].x-=m,t[g].y+=i+n+a}function sI(t,e,i,n){const{horizontalAlign:a,verticalAlign:c}=Wg(n),d=i[0]-t.displaySize[0]*a,m=i[1]-t.displaySize[1]*c;return{imagePrimary:t,imageSecondary:e,top:m,bottom:m+t.displaySize[1],left:d,right:d+t.displaySize[0]}}function O1(t,e,i,n,a,c){const d=t.imagePrimary;let m;if(d.content){const F=d.content,V=d.pixelRatio||1;m=[F[0]/V,F[1]/V,d.displaySize[0]-F[2]/V,d.displaySize[1]-F[3]/V]}const g=e.left*c,y=e.right*c;let w,E,M,P;i==="width"||i==="both"?(P=a[0]+g-n[3],E=a[0]+y+n[1]):(P=a[0]+(g+y-d.displaySize[0])/2,E=P+d.displaySize[0]);const D=e.top*c,O=e.bottom*c;return i==="height"||i==="both"?(w=a[1]+D-n[0],M=a[1]+O+n[2]):(w=a[1]+(D+O-d.displaySize[1])/2,M=w+d.displaySize[1]),{imagePrimary:d,imageSecondary:void 0,top:w,right:E,bottom:M,left:P,collisionPadding:m}}class xa extends Ie{constructor(e,i,n,a,c){super(e,i),this.angle=a,this.z=n,c!==void 0&&(this.segment=c)}clone(){return new xa(this.x,this.y,this.z,this.angle,this.segment)}}function z1(t,e,i,n,a){if(e.segment===void 0)return!0;let c=e,d=e.segment+1,m=0;for(;m>-i/2;){if(d--,d<0)return!1;m-=t[d].dist(c),c=t[d]}m+=t[d].dist(t[d+1]),d++;const g=[];let y=0;for(;m<i/2;){const w=t[d],E=t[d+1];if(!E)return!1;let M=t[d-1].angleTo(w)-w.angleTo(E);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),g.push({distance:m,angleDelta:M}),y+=M;m-g[0].distance>n;)y-=g.shift().angleDelta;if(y>a)return!1;d++,m+=w.dist(E)}return!0}function k1(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function B1(t,e,i){return t?.6*e*i:0}function F1(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function oI(t,e,i,n,a,c){const d=B1(i,a,c),m=F1(i,n)*c;let g=0;const y=k1(t)/2;for(let w=0;w<t.length-1;w++){const E=t[w],M=t[w+1],P=E.dist(M);if(g+P>y){const D=(y-g)/P,O=Di(E.x,M.x,D),F=Di(E.y,M.y,D),V=new xa(O,F,0,M.angleTo(E),w);return!d||z1(t,V,m,d,e)?V:void 0}g+=P}}function aI(t,e,i,n,a,c,d,m,g){const y=B1(n,c,d),w=F1(n,a),E=w*d,M=t[0].x===0||t[0].x===g||t[0].y===0||t[0].y===g;return e-E<e/4&&(e=E+e/4),N1(t,M?e/2*m%e:(w/2+2*c)*d*m%e,e,y,i,E,M,!1,g)}function N1(t,e,i,n,a,c,d,m,g){const y=c/2,w=k1(t);let E=0,M=e-i,P=[];for(let D=0;D<t.length-1;D++){const O=t[D],F=t[D+1],V=O.dist(F),W=F.angleTo(O);for(;M+i<E+V;){M+=i;const Q=(M-E)/V,J=Di(O.x,F.x,Q),oe=Di(O.y,F.y,Q);if(J>=0&&J<g&&oe>=0&&oe<g&&M-y>=0&&M+y<=w){const se=new xa(J,oe,0,W,D);n&&!z1(t,se,c,n,a)||P.push(se)}}E+=V}return m||P.length||d||(P=N1(t,E/2,i,n,a,c,d,!0,g)),P}function V1(t,e,i,n,a){const c=[];for(let d=0;d<t.length;d++){const m=t[d];let g;for(let y=0;y<m.length-1;y++){let w=m[y],E=m[y+1];w.x<e&&E.x<e||(w.x<e?w=new Ie(e,w.y+(e-w.x)/(E.x-w.x)*(E.y-w.y))._round():E.x<e&&(E=new Ie(e,w.y+(e-w.x)/(E.x-w.x)*(E.y-w.y))._round()),w.y<i&&E.y<i||(w.y<i?w=new Ie(w.x+(i-w.y)/(E.y-w.y)*(E.x-w.x),i)._round():E.y<i&&(E=new Ie(w.x+(i-w.y)/(E.y-w.y)*(E.x-w.x),i)._round()),w.x>=n&&E.x>=n||(w.x>=n?w=new Ie(n,w.y+(n-w.x)/(E.x-w.x)*(E.y-w.y))._round():E.x>=n&&(E=new Ie(n,w.y+(n-w.x)/(E.x-w.x)*(E.y-w.y))._round()),w.y>=a&&E.y>=a||(w.y>=a?w=new Ie(w.x+(a-w.y)/(E.y-w.y)*(E.x-w.x),a)._round():E.y>=a&&(E=new Ie(w.x+(a-w.y)/(E.y-w.y)*(E.x-w.x),a)._round()),g&&w.equals(g[g.length-1])||(g=[w],c.push(g)),g.push(E)))))}}return c}function U1(t){let e=0,i=0;for(const d of t)e+=d.w*d.h,i=Math.max(i,d.w);t.sort((d,m)=>m.h-d.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let a=0,c=0;for(const d of t)for(let m=n.length-1;m>=0;m--){const g=n[m];if(!(d.w>g.w||d.h>g.h)){if(d.x=g.x,d.y=g.y,c=Math.max(c,d.y+d.h),a=Math.max(a,d.x+d.w),d.w===g.w&&d.h===g.h){const y=n.pop();m<n.length&&(n[m]=y)}else d.h===g.h?(g.x+=d.w,g.w-=d.w):d.w===g.w?(g.y+=d.h,g.h-=d.h):(n.push({x:g.x+d.w,y:g.y,w:g.w-d.w,h:d.h}),g.y+=d.h,g.h-=d.h);break}}return{w:a,h:c,fill:e/(a*c)||0}}Ct(xa,"Anchor");const ms=1;class Xg{constructor(e,{pixelRatio:i,version:n,stretchX:a,stretchY:c,content:d}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=a,this.stretchY=c,this.content=d,this.version=n}get tl(){return[this.paddedRect.x+ms,this.paddedRect.y+ms]}get br(){return[this.paddedRect.x+this.paddedRect.w-ms,this.paddedRect.y+this.paddedRect.h-ms]}get displaySize(){return[(this.paddedRect.w-2*ms)/this.pixelRatio,(this.paddedRect.h-2*ms)/this.pixelRatio]}}class j1{constructor(e,i){const n={},a={};this.haveRenderCallbacks=[];const c=[];this.addImages(e,n,c),this.addImages(i,a,c);const{w:d,h:m}=U1(c),g=new Ds({width:d||1,height:m||1});for(const y in e){const w=e[y],E=n[y].paddedRect;Ds.copy(w.data,g,{x:0,y:0},{x:E.x+ms,y:E.y+ms},w.data,w.sdf)}for(const y in i){const w=i[y],E=a[y].paddedRect,M=E.x+ms,P=E.y+ms,D=w.data.width,O=w.data.height;Ds.copy(w.data,g,{x:0,y:0},{x:M,y:P},w.data),Ds.copy(w.data,g,{x:0,y:O-1},{x:M,y:P-1},{width:D,height:1}),Ds.copy(w.data,g,{x:0,y:0},{x:M,y:P+O},{width:D,height:1}),Ds.copy(w.data,g,{x:D-1,y:0},{x:M-1,y:P},{width:1,height:O}),Ds.copy(w.data,g,{x:0,y:0},{x:M+D,y:P},{width:1,height:O})}this.image=g,this.iconPositions=n,this.patternPositions=a}addImages(e,i,n){for(const a in e){const c=e[a],d={x:0,y:0,w:c.data.width+2*ms,h:c.data.height+2*ms};n.push(d),i[a]=new Xg(d,c),c.hasRenderCallback&&this.haveRenderCallbacks.push(a)}}patchUpdatedImages(e,i,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a,n)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,n);for(const a in e.getUpdatedImages(n))this.patchUpdatedImage(this.iconPositions[a],e.getImage(a,n),i),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a,n),i)}patchUpdatedImage(e,i,n){if(!e||!i||e.version===i.version)return;e.version=i.version;const[a,c]=e.tl,d=!!Object.keys(this.patternPositions).length;n.update(i.data,{useMipmap:d},{x:a,y:c})}}Ct(Xg,"ImagePosition"),Ct(j1,"ImageAtlas");const nf=1e20;function G1(t,e,i,n,a,c,d,m,g){for(let y=e;y<e+n;y++)$1(t,i*c+y,c,a,d,m,g);for(let y=i;y<i+a;y++)$1(t,y*c+e,1,n,d,m,g)}function $1(t,e,i,n,a,c,d){c[0]=0,d[0]=-nf,d[1]=nf,a[0]=t[e];for(let m=1,g=0,y=0;m<n;m++){a[m]=t[e+m*i];const w=m*m;do{const E=c[g];y=(a[m]-a[E]+w-E*E)/(m-E)/2}while(y<=d[g]&&--g>-1);g++,c[g]=m,d[g]=y,d[g+1]=nf}for(let m=0,g=0;m<n;m++){for(;d[g+1]<m;)g++;const y=c[g],w=m-y;t[e+m*i]=a[y]+w*w}}const co=2,Kg={none:0,ideographs:1,all:2};class Gu{constructor(e,i,n){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=n,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,n){const a=[],c=this.urls[i]||K.GLYPHS_URL;for(const d in e)for(const m of e[d])a.push({stack:d,id:m});tn(a,({stack:d,id:m},g)=>{let y=this.entries[d];y||(y=this.entries[d]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=y.glyphs[m];if(w!==void 0)return void g(null,{stack:d,id:m,glyph:w});if(w=this._tinySDF(y,d,m),w)return y.glyphs[m]=w,void g(null,{stack:d,id:m,glyph:w});const E=Math.floor(m/256);if(256*E>65535)return void g(new Error("glyphs > 65535 not supported"));if(y.ranges[E])return void g(null,{stack:d,id:m,glyph:w});let M=y.requests[E];M||(M=y.requests[E]=[],Gu.loadGlyphRange(d,E,c,this.requestManager,(P,D)=>{if(D){y.ascender=D.ascender,y.descender=D.descender;for(const O in D.glyphs)this._doesCharSupportLocalGlyph(+O)||(y.glyphs[+O]=D.glyphs[+O]);y.ranges[E]=!0}for(const O of M)O(P,D);delete y.requests[E]})),M.push((P,D)=>{P?g(P):D&&g(null,{stack:d,id:m,glyph:D.glyphs[m]||null})})},(d,m)=>{if(d)n(d);else if(m){const g={};for(const{stack:y,id:w,glyph:E}of m)g[y]===void 0&&(g[y]={}),g[y].glyphs===void 0&&(g[y].glyphs={}),g[y].glyphs[w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},g[y].ascender=this.entries[y].ascender,g[y].descender=this.entries[y].descender;n(null,g)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Kg.none&&(this.localGlyphMode===Kg.all?!!this.localFontFamily:!!this.localFontFamily&&(zt["CJK Unified Ideographs"](e)||zt["Hangul Syllables"](e)||zt.Hiragana(e)||zt.Katakana(e)||zt["CJK Symbols and Punctuation"](e)||zt["CJK Unified Ideographs Extension A"](e)||zt["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,i,n){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(n))return;let c=e.tinySDF;if(!c){let O="400";/bold/i.test(i)?O="900":/medium/i.test(i)?O="500":/light/i.test(i)&&(O="200"),c=e.tinySDF=new Gu.TinySDF({fontFamily:a,fontWeight:O,fontSize:24*co,buffer:3*co,radius:8*co}),c.fontWeight=O}if(this.localGlyphs[c.fontWeight][n])return this.localGlyphs[c.fontWeight][n];const d=String.fromCodePoint(n),{data:m,width:g,height:y,glyphWidth:w,glyphHeight:E,glyphLeft:M,glyphTop:P,glyphAdvance:D}=c.draw(d);return this.localGlyphs[c.fontWeight][n]={id:n,bitmap:new Qa({width:g,height:y},m),metrics:{width:w/co,height:E/co,left:M/co,top:P/co-27,advance:D/co,localGlyph:!0}}}}Gu.loadGlyphRange=function(t,e,i,n,a){const c=256*e,d=c+255,m=n.transformRequest(n.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${c}-${d}`),Zn.Glyphs);Ve(m,(g,y)=>{if(g)a(g);else if(y){const w={},E=function(M){return new Uu(M).readFields(eI,{})}(y);for(const M of E.glyphs)w[M.id]=M;a(null,{glyphs:w,ascender:E.ascender,descender:E.descender})}})},Gu.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:n=.25,fontFamily:a="sans-serif",fontWeight:c="normal",fontStyle:d="normal"}={}){this.buffer=e,this.cutoff=n,this.radius=i;const m=this.size=t+4*e,g=this._createCanvas(m),y=this.ctx=g.getContext("2d",{willReadFrequently:!0});y.font=`${d} ${c} ${t}px ${a}`,y.textBaseline="alphabetic",y.textAlign="left",y.fillStyle="black",this.gridOuter=new Float64Array(m*m),this.gridInner=new Float64Array(m*m),this.f=new Float64Array(m),this.z=new Float64Array(m+1),this.v=new Uint16Array(m)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:n,actualBoundingBoxLeft:a,actualBoundingBoxRight:c}=this.ctx.measureText(t),d=Math.ceil(i),m=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(c-a))),g=Math.min(this.size-this.buffer,d+Math.ceil(n)),y=m+2*this.buffer,w=g+2*this.buffer,E=Math.max(y*w,0),M=new Uint8ClampedArray(E),P={data:M,width:y,height:w,glyphWidth:m,glyphHeight:g,glyphTop:d,glyphLeft:0,glyphAdvance:e};if(m===0||g===0)return P;const{ctx:D,buffer:O,gridInner:F,gridOuter:V}=this;D.clearRect(O,O,m,g),D.fillText(t,O,O+d);const W=D.getImageData(O,O,m,g);V.fill(nf,0,E),F.fill(0,0,E);for(let Q=0;Q<g;Q++)for(let J=0;J<m;J++){const oe=W.data[4*(Q*m+J)+3]/255;if(oe===0)continue;const se=(Q+O)*y+J+O;if(oe===1)V[se]=0,F[se]=nf;else{const he=.5-oe;V[se]=he>0?he*he:0,F[se]=he<0?he*he:0}}G1(V,0,0,y,w,y,this.f,this.v,this.z),G1(F,O,O,m,g,y,this.f,this.v,this.z);for(let Q=0;Q<E;Q++){const J=Math.sqrt(V[Q])-Math.sqrt(F[Q]);M[Q]=Math.round(255-255*(J/this.radius+this.cutoff))}return P}};const il=ms;function q1(t,e,i,n){const a=[],c=t.imagePrimary,d=c.pixelRatio,m=c.paddedRect.w-2*il,g=c.paddedRect.h-2*il,y=t.right-t.left,w=t.bottom-t.top,E=c.stretchX||[[0,m]],M=c.stretchY||[[0,g]],P=(be,ze)=>be+ze[1]-ze[0],D=E.reduce(P,0),O=M.reduce(P,0),F=m-D,V=g-O;let W=0,Q=D,J=0,oe=O,se=0,he=F,ge=0,xe=V;if(c.content&&n){const be=c.content;W=_m(E,0,be[0]),J=_m(M,0,be[1]),Q=_m(E,be[0],be[2]),oe=_m(M,be[1],be[3]),se=be[0]-W,ge=be[1]-J,he=be[2]-be[0]-Q,xe=be[3]-be[1]-oe}const Ae=(be,ze,qe,De)=>{const Ge=gm(be.stretch-W,Q,y,t.left),Pe=ym(be.fixed-se,he,be.stretch,D),je=gm(ze.stretch-J,oe,w,t.top),ut=ym(ze.fixed-ge,xe,ze.stretch,O),Ze=gm(qe.stretch-W,Q,y,t.left),Lt=ym(qe.fixed-se,he,qe.stretch,D),St=gm(De.stretch-J,oe,w,t.top),Ye=ym(De.fixed-ge,xe,De.stretch,O),ei=new Ie(Ge,je),Ft=new Ie(Ze,je),Rt=new Ie(Ze,St),Je=new Ie(Ge,St),Xt=new Ie(Pe/d,ut/d),bi=new Ie(Lt/d,Ye/d),ti=e*Math.PI/180;if(ti){const $i=Math.sin(ti),Hi=Math.cos(ti),tr=[Hi,-$i,$i,Hi];ei._matMult(tr),Ft._matMult(tr),Je._matMult(tr),Rt._matMult(tr)}const wi=be.stretch+be.fixed,ci=qe.stretch+qe.fixed,Oi=ze.stretch+ze.fixed,fi=De.stretch+De.fixed,fr=t.imageSecondary;return{tl:ei,tr:Ft,bl:Je,br:Rt,texPrimary:{x:c.paddedRect.x+il+wi,y:c.paddedRect.y+il+Oi,w:ci-wi,h:fi-Oi},texSecondary:fr?{x:fr.paddedRect.x+il+wi,y:fr.paddedRect.y+il+Oi,w:ci-wi,h:fi-Oi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xt,pixelOffsetBR:bi,minFontScaleX:he/d/y,minFontScaleY:xe/d/w,isSDF:i}};if(n&&(c.stretchX||c.stretchY)){const be=Z1(E,F,D),ze=Z1(M,V,O);for(let qe=0;qe<be.length-1;qe++){const De=be[qe],Ge=be[qe+1];for(let Pe=0;Pe<ze.length-1;Pe++)a.push(Ae(De,ze[Pe],Ge,ze[Pe+1]))}}else a.push(Ae({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:m+1},{fixed:0,stretch:g+1}));return a}function _m(t,e,i){let n=0;for(const a of t)n+=Math.max(e,Math.min(i,a[1]))-Math.max(e,Math.min(i,a[0]));return n}function Z1(t,e,i){const n=[{fixed:-il,stretch:0}];for(const[a,c]of t){const d=n[n.length-1];n.push({fixed:a-d.stretch,stretch:d.stretch}),n.push({fixed:a-d.stretch,stretch:d.stretch+(c-a)})}return n.push({fixed:e+il,stretch:i}),n}function gm(t,e,i,n){return t/e*i+n}function ym(t,e,i,n){return t-e*i/n}function lI(t,e,i,n){const a=e+t.positionedLines[n].lineOffset;return n===0?i+a/2:i+(a+(e+t.positionedLines[n-1].lineOffset))/2}function cI(t,e=1,i=!1){let n=1/0,a=1/0,c=-1/0,d=-1/0;const m=t[0];for(let P=0;P<m.length;P++){const D=m[P];(!P||D.x<n)&&(n=D.x),(!P||D.y<a)&&(a=D.y),(!P||D.x>c)&&(c=D.x),(!P||D.y>d)&&(d=D.y)}const g=Math.min(c-n,d-a);let y=g/2;const w=new ps([],uI);if(g===0)return new Ie(n,a);for(let P=n;P<c;P+=g)for(let D=a;D<d;D+=g)w.push(new $u(P+y,D+y,y,t));let E=function(P){let D=0,O=0,F=0;const V=P[0];for(let W=0,Q=V.length,J=Q-1;W<Q;J=W++){const oe=V[W],se=V[J],he=oe.x*se.y-se.x*oe.y;O+=(oe.x+se.x)*he,F+=(oe.y+se.y)*he,D+=3*he}return new $u(O/D,F/D,0,P)}(t),M=w.length;for(;w.length;){const P=w.pop();(P.d>E.d||!E.d)&&(E=P,i&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,M)),P.max-E.d<=e||(y=P.h/2,w.push(new $u(P.p.x-y,P.p.y-y,y,t)),w.push(new $u(P.p.x+y,P.p.y-y,y,t)),w.push(new $u(P.p.x-y,P.p.y+y,y,t)),w.push(new $u(P.p.x+y,P.p.y+y,y,t)),M+=4)}return i&&(console.log(`num probes: ${M}`),console.log(`best distance: ${E.d}`)),E.p}function uI(t,e){return e.max-t.max}class $u{constructor(e,i,n,a){this.p=new Ie(e,i),this.h=n,this.d=function(c,d){let m=!1,g=1/0;for(let y=0;y<d.length;y++){const w=d[y];for(let E=0,M=w.length,P=M-1;E<M;P=E++){const D=w[E],O=w[P];D.y>c.y!=O.y>c.y&&c.x<(O.x-D.x)*(c.y-D.y)/(O.y-D.y)+D.x&&(m=!m),g=Math.min(g,Ka(c,D,O))}}return(m?1:-1)*Math.sqrt(g)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const Yg=Number.POSITIVE_INFINITY,hI=Math.sqrt(2);function H1(t,[e,i]){let n=0,a=0;if(i===Yg){e<0&&(e=0);const c=e/hI;switch(t){case"top-right":case"top-left":a=c-7;break;case"bottom-right":case"bottom-left":a=7-c;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(t){case"top-right":case"bottom-right":n=-c;break;case"top-left":case"bottom-left":n=c;break;case"left":n=e;break;case"right":n=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":a=i-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-i}switch(t){case"top-right":case"bottom-right":case"right":n=-e;break;case"top-left":case"bottom-left":case"left":n=e}}return[n,a]}function Jg(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function dI(t,e,i,n,a,c,d,m,g,y,w,E,M,P,D){let O=c.textMaxSize.evaluate(e,{},E);O===void 0&&(O=d);const F=t.layers[0].layout,V=F.get("icon-offset").evaluate(e,{},E),W=X1(i.horizontal)||i.vertical,Q=M.name==="globe",J=Pn,oe=d/J,se=t.tilePixelRatio*O/J,he=(Ge=t.overscaling,t.zoom>18&&Ge>2&&(Ge>>=1),Math.max(xt/(512*Ge),1)*F.get("symbol-spacing")),ge=F.get("text-padding")*t.tilePixelRatio,xe=F.get("icon-padding")*t.tilePixelRatio,Ae=dt(F.get("text-max-angle")),be=F.get("text-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",ze=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",qe=F.get("symbol-placement"),De=he/2;var Ge;const Pe=F.get("icon-text-fit").evaluate(e,{},E),je=F.get("icon-text-fit-padding").evaluate(e,{},E),ut=Pe!=="none";let Ze;t.hasAnyIconTextFit===!1&&ut&&(t.hasAnyIconTextFit=!0),n&&ut&&(t.allowVerticalPlacement&&i.vertical&&(Ze=O1(n,i.vertical,Pe,je,V,oe)),W&&(n=O1(n,W,Pe,je,V,oe)));const Lt=(St,Ye,ei)=>{if(Ye.x<0||Ye.x>=xt||Ye.y<0||Ye.y>=xt)return;let Ft=null;if(Q){const{x:Rt,y:Je,z:Xt}=M.projectTilePoint(Ye.x,Ye.y,ei);Ft={anchor:new xa(Rt,Je,Xt,0,void 0),up:M.upVector(ei,Ye.x,Ye.y)}}(function(Rt,Je,Xt,bi,ti,wi,ci,Oi,fi,fr,$i,Hi,tr,qi,Lr,ar,qr,un,In,Ir,Fr,vn,xn,bn,xr,_s,ll){const es=Rt.addToLineVertexArray(Je,bi);let $n,ks,xf,Nm,Xb,Kb,Yb,Jb=0,Qb=0,ew=0,tw=0,wy=-1,Ty=-1;const qo={};let iw=Gd("");const Cc=Xt?Xt.anchor:Je,Ey=fi.layout.get("icon-text-fit").evaluate(Fr,{},xr)!=="none";let Sy=0,My=0;if(fi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Sy,My]=fi.layout.get("text-offset").evaluate(Fr,{},xr).map(gs=>gs*Pn):(Sy=fi.layout.get("text-radial-offset").evaluate(Fr,{},xr)*Pn,My=Yg),Rt.allowVerticalPlacement&&ti.vertical){const gs=ti.vertical;if(Lr)Kb=Qg(gs),Oi&&(Yb=Qg(Oi));else{const ys=fi.layout.get("text-rotate").evaluate(Fr,{},xr)+90;xf=vm(fr,Cc,Je,$i,Hi,tr,gs,qi,ys,ar),Oi&&(Nm=vm(fr,Cc,Je,$i,Hi,tr,Oi,un,ys))}}if(wi){const gs=fi.layout.get("icon-rotate").evaluate(Fr,{},xr),ys=q1(wi,gs,xn,Ey),Ju=Oi?q1(Oi,gs,xn,Ey):void 0;ks=vm(fr,Cc,Je,$i,Hi,tr,wi,un,gs),Jb=4*ys.length;const rw=Rt.iconSizeData;let Pc=null;rw.kind==="source"?(Pc=[lo*fi.layout.get("icon-size").evaluate(Fr,{},xr)],Pc[0]>rl&&_e(`${Rt.layerIds[0]}: Value for "icon-size" is >= ${sf}. Reduce your "icon-size".`)):rw.kind==="composite"&&(Pc=[lo*vn.compositeIconSizes[0].evaluate(Fr,{},xr),lo*vn.compositeIconSizes[1].evaluate(Fr,{},xr)],(Pc[0]>rl||Pc[1]>rl)&&_e(`${Rt.layerIds[0]}: Value for "icon-size" is >= ${sf}. Reduce your "icon-size".`)),Rt.addSymbols(Rt.icon,ys,Pc,Ir,In,Fr,!1,Xt,Je,es.lineStartIndex,es.lineLength,-1,bn,xr,_s,ll),wy=Rt.icon.placedSymbolArray.length-1,Ju&&(Qb=4*Ju.length,Rt.addSymbols(Rt.icon,Ju,Pc,Ir,In,Fr,Os.vertical,Xt,Je,es.lineStartIndex,es.lineLength,-1,bn,xr,_s,ll),Ty=Rt.icon.placedSymbolArray.length-1)}for(const gs in ti.horizontal){const ys=ti.horizontal[gs];$n||(iw=Gd(ys.text),Lr?Xb=Qg(ys):$n=vm(fr,Cc,Je,$i,Hi,tr,ys,qi,fi.layout.get("text-rotate").evaluate(Fr,{},xr),ar));const Ju=ys.positionedLines.length===1;if(ew+=W1(Rt,Xt,Je,ys,ci,fi,Lr,Fr,ar,es,ti.vertical?Os.horizontal:Os.horizontalOnly,Ju?Object.keys(ti.horizontal):[gs],qo,wy,vn,bn,xr,_s),Ju)break}ti.vertical&&(tw+=W1(Rt,Xt,Je,ti.vertical,ci,fi,Lr,Fr,ar,es,Os.vertical,["vertical"],qo,Ty,vn,bn,xr,_s));let cl=-1;const Ay=(gs,ys)=>gs?Math.max(gs,ys):ys;cl=Ay(Xb,cl),cl=Ay(Kb,cl),cl=Ay(Yb,cl);const PC=cl>-1?1:0;Rt.glyphOffsetArray.length>=65535&&_e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Fr.sortKey!==void 0&&Rt.addToSortKeyRanges(Rt.symbolInstances.length,Fr.sortKey),Rt.symbolInstances.emplaceBack(Je.x,Je.y,Cc.x,Cc.y,Cc.z,qo.right>=0?qo.right:-1,qo.center>=0?qo.center:-1,qo.left>=0?qo.left:-1,qo.vertical>=0?qo.vertical:-1,wy,Ty,iw,$n!==void 0?$n:Rt.collisionBoxArray.length,$n!==void 0?$n+1:Rt.collisionBoxArray.length,xf!==void 0?xf:Rt.collisionBoxArray.length,xf!==void 0?xf+1:Rt.collisionBoxArray.length,ks!==void 0?ks:Rt.collisionBoxArray.length,ks!==void 0?ks+1:Rt.collisionBoxArray.length,Nm||Rt.collisionBoxArray.length,Nm?Nm+1:Rt.collisionBoxArray.length,$i,ew,tw,Jb,Qb,PC,0,Sy,My,cl,0,Ey?1:0)})(t,Ye,Ft,St,i,n,a,Ze,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ge,be,g,0,xe,ze,V,e,c,y,w,E,P,D)};if(qe==="line")for(const St of V1(e.geometry,0,0,xt,xt)){const Ye=aI(St,he,Ae,i.vertical||W,n,J,se,t.overscaling,xt);for(const ei of Ye)W&&fI(t,W.text,De,ei)||Lt(St,ei,E)}else if(qe==="line-center"){for(const St of e.geometry)if(St.length>1){const Ye=oI(St,Ae,i.vertical||W,n,J,se);Ye&&Lt(St,Ye,E)}}else if(e.type==="Polygon")for(const St of Bg(e.geometry,0)){const Ye=cI(St,16);Lt(St[0],new xa(Ye.x,Ye.y,0,0,void 0),E)}else if(e.type==="LineString")for(const St of e.geometry)Lt(St,new xa(St[0].x,St[0].y,0,0,void 0),E);else if(e.type==="Point")for(const St of e.geometry)for(const Ye of St)Lt([Ye],new xa(Ye.x,Ye.y,0,0,void 0),E)}const sf=255,rl=sf*lo;function W1(t,e,i,n,a,c,d,m,g,y,w,E,M,P,D,O,F,V){const W=function(oe,se,he,ge,xe,Ae,be,ze){const qe=[];if(se.positionedLines.length===0)return qe;const De=ge.layout.get("text-rotate").evaluate(Ae,{})*Math.PI/180,Ge=function(Lt){const St=Lt[0],Ye=Lt[1],ei=St*Ye;return ei>0?[St,-Ye]:ei<0?[-St,Ye]:St===0?[Ye,St]:[Ye,-St]}(he);let Pe=Math.abs(se.top-se.bottom);for(const Lt of se.positionedLines)Pe-=Lt.lineOffset;const je=se.positionedLines.length,ut=Pe/je;let Ze=se.top-he[1];for(let Lt=0;Lt<je;++Lt){const St=se.positionedLines[Lt];Ze=lI(se,ut,Ze,Lt);for(const Ye of St.positionedGlyphs){if(!Ye.rect)continue;const ei=Ye.rect||{};let Ft=I1+1,Rt=!0,Je=1,Xt=0;if(Ye.imageName){const Ir=be[Ye.imageName];if(!Ir)continue;if(Ir.sdf){_e("SDF images are not supported in formatted text and will be ignored.");continue}Rt=!1,Je=Ir.pixelRatio,Ft=ms/Je}const bi=(xe||ze)&&Ye.vertical,ti=Ye.metrics.advance*Ye.scale/2,wi=Ye.metrics,ci=Ye.rect;if(ci===null)continue;ze&&se.verticalizable&&(Xt=Ye.imageName?ti-Ye.metrics.width*Ye.scale/2:0);const Oi=xe?[Ye.x+ti,Ye.y]:[0,0];let fi=[0,0],fr=[0,0],$i=!1;xe||(bi?(fr=[Ye.x+ti+Ge[0],Ye.y+Ge[1]-Xt],$i=!0):fi=[Ye.x+ti+he[0],Ye.y+he[1]-Xt]);const Hi=ci.w*Ye.scale/(Je*(Ye.localGlyph?co:1)),tr=ci.h*Ye.scale/(Je*(Ye.localGlyph?co:1));let qi,Lr,ar,qr;if(bi){const Ir=Ye.y-Ze,Fr=new Ie(-ti,ti-Ir),vn=-Math.PI/2,xn=new Ie(...fr);qi=new Ie(-ti+fi[0],fi[1]),qi._rotateAround(vn,Fr)._add(xn),qi.x+=-Ir+ti,qi.y-=(wi.left-Ft)*Ye.scale;const bn=Ye.imageName?wi.advance*Ye.scale:Pn*Ye.scale,xr=String.fromCodePoint(Ye.glyph);jA(xr)?qi.x+=(1-Ft)*Ye.scale:GA(xr)?qi.x+=bn-wi.height*Ye.scale+(-Ft-1)*Ye.scale:qi.x+=Ye.imageName||wi.width+2*Ft===ci.w&&wi.height+2*Ft===ci.h?(bn-tr)/2:(bn-(wi.height+2*Ft)*Ye.scale)/2,Lr=new Ie(qi.x,qi.y-Hi),ar=new Ie(qi.x+tr,qi.y),qr=new Ie(qi.x+tr,qi.y-Hi)}else{const Ir=(wi.left-Ft)*Ye.scale-ti+fi[0],Fr=(-wi.top-Ft)*Ye.scale+fi[1],vn=Ir+Hi,xn=Fr+tr;qi=new Ie(Ir,Fr),Lr=new Ie(vn,Fr),ar=new Ie(Ir,xn),qr=new Ie(vn,xn)}if(De){let Ir;Ir=xe?new Ie(0,0):$i?new Ie(Ge[0],Ge[1]):new Ie(he[0],he[1]),qi._rotateAround(De,Ir),Lr._rotateAround(De,Ir),ar._rotateAround(De,Ir),qr._rotateAround(De,Ir)}const un=new Ie(0,0),In=new Ie(0,0);qe.push({tl:qi,tr:Lr,bl:ar,br:qr,texPrimary:ei,texSecondary:void 0,writingMode:se.writingMode,glyphOffset:Oi,sectionIndex:Ye.sectionIndex,isSDF:Rt,pixelOffsetTL:un,pixelOffsetBR:In,minFontScaleX:0,minFontScaleY:0})}}return qe}(0,n,g,c,d,m,a,t.allowVerticalPlacement),Q=t.textSizeData;let J=null;Q.kind==="source"?(J=[lo*c.layout.get("text-size").evaluate(m,{},F)],J[0]>rl&&_e(`${t.layerIds[0]}: Value for "text-size" is >= ${sf}. Reduce your "text-size".`)):Q.kind==="composite"&&(J=[lo*D.compositeTextSizes[0].evaluate(m,{},F),lo*D.compositeTextSizes[1].evaluate(m,{},F)],(J[0]>rl||J[1]>rl)&&_e(`${t.layerIds[0]}: Value for "text-size" is >= ${sf}. Reduce your "text-size".`)),t.addSymbols(t.text,W,J,g,d,m,w,e,i,y.lineStartIndex,y.lineLength,P,O,F,V,!1);for(const oe of E)M[oe]=t.text.placedSymbolArray.length-1;return 4*W.length}function X1(t){for(const e in t)return t[e];return null}function vm(t,e,i,n,a,c,d,m,g,y){let w=d.top,E=d.bottom,M=d.left,P=d.right;const D=d.collisionPadding;if(D&&(M-=D[0],w-=D[1],P+=D[2],E+=D[3]),g){const O=new Ie(M,w),F=new Ie(P,w),V=new Ie(M,E),W=new Ie(P,E),Q=dt(g);let J=new Ie(0,0);y&&(J=new Ie(y[0],y[1])),O._rotateAround(Q,J),F._rotateAround(Q,J),V._rotateAround(Q,J),W._rotateAround(Q,J),M=Math.min(O.x,F.x,V.x,W.x),P=Math.max(O.x,F.x,V.x,W.x),w=Math.min(O.y,F.y,V.y,W.y),E=Math.max(O.y,F.y,V.y,W.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,M,w,P,E,m,n,a,c),t.length-1}function Qg(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function fI(t,e,i,n){const a=t.compareText;if(e in a){const c=a[e];for(let d=c.length-1;d>=0;d--)if(n.dist(c[d])<i)return!0}else a[e]=[];return a[e].push(n),!1}function K1(t,e){const i=t.fovAboveCenter,n=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,a=(t._camera.position[2]*t.worldSize-n)/Math.cos(t._pitch),c=Math.sin(i)*a/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),d=Math.sin(t._pitch)*c+a;return Math.min(1.01*d,a*(1/t._horizonShift))}function of(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),n=t.x*i,a=(t.x+1)*i,c=t.y*i,d=(t.y+1)*i,m=ui(n),g=ui(a),y=ki(c),w=ki(d),E=e.project(m,y),M=e.project(g,y),P=e.project(g,w),D=e.project(m,w);let O=Math.min(E.x,M.x,P.x,D.x),F=Math.min(E.y,M.y,P.y,D.y),V=Math.max(E.x,M.x,P.x,D.x),W=Math.max(E.y,M.y,P.y,D.y);const Q=i/16;function J(se,he,ge,xe,Ae,be){const ze=(ge+Ae)/2,qe=(xe+be)/2,De=e.project(ui(ze),ki(qe)),Ge=Math.max(0,O-De.x,F-De.y,De.x-V,De.y-W);O=Math.min(O,De.x),V=Math.max(V,De.x),F=Math.min(F,De.y),W=Math.max(W,De.y),Ge>Q&&(J(se,De,ge,xe,ze,qe),J(De,he,ze,qe,Ae,be))}J(E,M,n,c,a,c),J(M,P,a,c,a,d),J(P,D,a,d,n,d),J(D,E,n,d,n,c),O-=Q,F-=Q,V+=Q,W+=Q;const oe=1/Math.max(V-O,W-F);return{scale:oe,x:O*oe,y:F*oe,x2:V*oe,y2:W*oe,projection:e}}function Y1(t,{x:e,y:i},n=0){return new Ie(((e-n)*t.scale-t.x)*xt,(i*t.scale-t.y)*xt)}const pI=o.a6.identity(new Float32Array(16));class nl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new ve(0,0)}projectTilePoint(e,i,n){return{x:e,y:i,z:0}}locationPoint(e,i,n=!0){return e._coordinatePoint(e.locationCoordinate(i),n)}pixelsPerMeter(e,i){return di(1,e)*i}pixelSpaceConversion(e,i,n){return 1}farthestPixelDistance(e){return K1(e,e.pixelsPerMeter)}pointCoordinate(e,i,n,a){const c=e.horizonLineFromTop(!1),d=new Ie(i,Math.max(c,n));return e.rayIntersectionCoordinate(e.pointRayIntersection(d,a))}pointCoordinate3D(e,i,n){const a=new Ie(i,n);if(e.elevation)return e.elevation.pointCoordinate(a);{const c=this.pointCoordinate(e,a.x,a.y,0);return[c.x,c.y,c.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const n=e.horizonLineFromTop();return i.y<n}createInversionMatrix(e,i){return pI}createTileMatrix(e,i,n){let a,c,d;const m=n.canonical,g=o.a6.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const y=of(m,this);a=1,c=y.x+n.wrap*y.scale,d=y.y,o.a6.scale(g,g,[a/y.scale,a/y.scale,e.pixelsPerMeter/i])}else a=i/e.zoomScale(m.z),c=(m.x+Math.pow(2,m.z)*n.wrap)*a,d=m.y*a;return o.a6.translate(g,g,[c,d,0]),o.a6.scale(g,g,[a/xt,a/xt,1]),g}upVector(e,i,n){return[0,0,1]}upVectorScale(e,i,n){return{metersToTile:1}}}class mI extends nl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,n]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(dt(i));this.n=(a+Math.sin(dt(n)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n,c:a,r0:c}=this,d=dt(e-this.center[0]),m=dt(i),g=Math.sqrt(a-2*n*Math.sin(m))/n;return{x:g*Math.sin(d*n),y:g*Math.cos(d*n)-c,z:0}}unproject(e,i){const{n,c:a,r0:c}=this,d=c+i;let m=Math.atan2(e,Math.abs(d))*Math.sign(d);d*n<0&&(m-=Math.PI*Math.sign(e)*Math.sign(d));const g=dt(this.center[0])*n;m=Cn(m,-Math.PI-g,Math.PI-g);const y=Nt(Ei(m/n)+this.center[0],-180,180),w=Math.asin(Nt((a-(e*e+d*d)*n*n)/(2*n),-1,1)),E=Nt(Ei(w),-Ai,Ai);return new ve(y,E)}}const af=1.340264,lf=-.081106,cf=893e-6,uf=.003796,xm=Math.sqrt(3)/2;class _I extends nl{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const n=Math.asin(xm*Math.sin(i)),a=n*n,c=a*a*a;return{x:.5*(e*Math.cos(n)/(xm*(af+3*lf*a+c*(7*cf+9*uf*a)))/Math.PI+.5),y:1-.5*(n*(af+lf*a+c*(cf+uf*a))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let n=i=(2*(1-i)-1)*Math.PI,a=n*n,c=a*a*a;for(let w,E,M,P=0;P<12&&(E=n*(af+lf*a+c*(cf+uf*a))-i,M=af+3*lf*a+c*(7*cf+9*uf*a),w=E/M,n=Nt(n-w,-Math.PI/3,Math.PI/3),a=n*n,c=a*a*a,!(Math.abs(w)<1e-12));++P);const d=xm*e*(af+3*lf*a+c*(7*cf+9*uf*a))/Math.cos(n),m=Math.asin(Math.sin(n)/xm),g=Nt(180*d/Math.PI,-180,180),y=Nt(180*m/Math.PI,-Ai,Ai);return new ve(g,y)}}class gI extends nl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const n=360*(e-.5),a=Nt(360*(.5-i),-Ai,Ai);return new ve(n,a)}}const qu=Math.PI/2;function bm(t){return Math.tan((qu+t)/2)}class yI extends nl{constructor(e){super(e),this.center=e.center||[0,30];const[i,n]=this.parallels=e.parallels||[30,30];let a=dt(i),c=dt(n);this.southernCenter=a+c<0,this.southernCenter&&(a=-a,c=-c);const d=Math.cos(a),m=bm(a);this.n=a===c?Math.sin(a):Math.log(d/Math.cos(c))/Math.log(bm(c)/m),this.f=d*Math.pow(bm(a),this.n)/this.n}project(e,i){i=dt(i),this.southernCenter&&(i=-i),e=dt(e-this.center[0]);const n=1e-6,{n:a,f:c}=this;c>0?i<-qu+n&&(i=-qu+n):i>qu-n&&(i=qu-n);const d=c/Math.pow(bm(i),a);let m=d*Math.sin(a*e),g=c-d*Math.cos(a*e);return m=.5*(m/Math.PI+.5),g=.5*(g/Math.PI+.5),{x:m,y:this.southernCenter?g:1-g,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n,f:a}=this,c=a-i,d=Math.sign(c),m=Math.sign(n)*Math.sqrt(e*e+c*c);let g=Math.atan2(e,Math.abs(c))*d;c*n<0&&(g-=Math.PI*Math.sign(e)*d);const y=Nt(Ei(g/n)+this.center[0],-180,180),w=Nt(Ei(2*Math.atan(Math.pow(a/m,1/n))-qu),-Ai,Ai);return new ve(y,this.southernCenter?-w:w)}}class J1 extends nl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:gi(e),y:si(i),z:0}}unproject(e,i){const n=ui(e),a=ki(i);return new ve(n,a)}}const Q1=dt(Ai);class vI extends nl{project(e,i){const n=(i=dt(i))*i,a=n*n;return{x:.5*((e=dt(e))*(.8707-.131979*n+a*(a*(.003971*n-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+n*(.015085+a*(.028874*n-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let n=i=(2*(1-i)-1)*Math.PI,a=25,c=0,d=n*n;do{d=n*n;const y=d*d;c=(n*(1.007226+d*(.015085+y*(.028874*d-.044475-.005916*y)))-i)/(1.007226+d*(.045255+y*(.259866*d-.311325-.005916*11*y))),n=Nt(n-c,-Q1,Q1)}while(Math.abs(c)>1e-6&&--a>0);d=n*n;const m=Nt(Ei(e/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),g=Ei(n);return new ve(m,g)}}const eb=dt(Ai);class xI extends nl{project(e,i){i=dt(i),e=dt(e);const n=Math.cos(i),a=2/Math.PI,c=Math.acos(n*Math.cos(e/2)),d=Math.sin(c)/c,m=.5*(e*a+2*n*Math.sin(e/2)/d)||0,g=.5*(i+Math.sin(i)/d)||0;return{x:.5*(m/Math.PI+.5),y:1-.5*(g/Math.PI+1),z:0}}unproject(e,i){let n=e=(2*e-.5)*Math.PI,a=i=(2*(1-i)-1)*Math.PI,c=25;const d=1e-6;let m=0,g=0;do{const y=Math.cos(a),w=Math.sin(a),E=2*w*y,M=w*w,P=y*y,D=Math.cos(n/2),O=Math.sin(n/2),F=2*D*O,V=O*O,W=1-P*D*D,Q=W?1/W:0,J=W?Math.acos(y*D)*Math.sqrt(1/W):0,oe=.5*(2*J*y*O+2*n/Math.PI)-e,se=.5*(J*w+a)-i,he=.5*Q*(P*V+J*y*D*M)+1/Math.PI,ge=Q*(F*E/4-J*w*O),xe=.125*Q*(E*O-J*w*P*F),Ae=.5*Q*(M*D+J*V*y)+.5,be=ge*xe-Ae*he;m=(se*ge-oe*Ae)/be,g=(oe*xe-se*he)/be,n=Nt(n-m,-Math.PI,Math.PI),a=Nt(a-g,-eb,eb)}while((Math.abs(m)>d||Math.abs(g)>d)&&--c>0);return new ve(Ei(n),Ei(a))}}class tb extends nl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(dt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:n,cosPhi:a}=this;return{x:dt(e)*a*n+.5,y:-Math.sin(dt(i))/a*n+.5,z:0}}unproject(e,i){const{scale:n,cosPhi:a}=this,c=-(i-.5)/n,d=Nt(Ei((e-.5)/n)/a,-180,180),m=Math.asin(Nt(c*a,-1,1)),g=Nt(Ei(m),-Ai,Ai);return new ve(d,g)}}class bI extends J1{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,n){const a=Hd(e,i,n),c=Qp($o(n));return o.N.transformMat4(a,a,c),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,i){const n=Oe(i.lat,i.lng),a=o.N.normalize([],n),c=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,d=di(1,0)*xt*c;o.N.scaleAndAdd(n,n,a,d);const m=o.a6.identity(new Float64Array(16));return o.a6.multiply(m,e.pixelMatrix,e.globeMatrix),o.N.transformMat4(n,n,m),new Ie(n[0],n[1])}pixelsPerMeter(e,i){return di(1,0)*i}pixelSpaceConversion(e,i,n){const a=di(1,e)*i,c=Di(di(1,45)*i,a,n);return this.pixelsPerMeter(e,i)/c}createTileMatrix(e,i,n){const a=Cg($o(n.canonical));return o.a6.multiply(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,i){const{center:n}=e,a=Qp($o(i));return o.a6.rotateY(a,a,dt(n.lng)),o.a6.rotateX(a,a,dt(n.lat)),o.a6.scale(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,i,n,a){return yx(e,i,n,!0)||new ji(0,0)}pointCoordinate3D(e,i,n){const a=this.pointCoordinate(e,i,n,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,i){return!yx(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(a,c){const d=a.cameraToCenterDistance,m=a._centerAltitude*c,g=a._camera,y=a._camera.forward(),w=o.N.add([],o.N.scale([],y,-d),[0,0,m]),E=a.worldSize/(2*Math.PI),M=[0,0,-E],P=a.width/a.height,D=Math.tan(a.fovAboveCenter),O=o.N.scale([],g.up(),D),F=o.N.scale([],g.right(),D*P),V=o.N.normalize([],o.N.add([],o.N.add([],y,O),F)),W=[];let Q;if(new Eg(w,V).closestPointOnSphere(M,E,W)){const J=o.N.add([],W,M),oe=o.N.sub([],J,w);Q=Math.cos(a.fovAboveCenter)*o.N.length(oe)}else{const J=o.N.sub([],w,M),oe=o.N.sub([],M,w);o.N.normalize(oe,oe);const se=o.N.length(J)-E;Q=Math.sqrt(se*(se+2*E));const he=Math.acos(Q/(E+se))-Math.acos(o.N.dot(y,oe));Q*=Math.cos(he)}return 1.01*Q}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),n=Ja(e.zoom);if(n>0){const a=K1(e,di(1,e.center.lat)*e.worldSize),c=e.worldSize/(2*Math.PI),d=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Di(i,a+c*(1-Math.cos(d)),Math.pow(n,10))}return i}upVector(e,i,n){return Hd(i,n,e,1)}upVectorScale(e){return{metersToTile:Kp(Jp($o(e)))}}}function ib(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new J1(t);case"equirectangular":return new gI(t);case"naturalEarth":return new vI(t);case"equalEarth":return new _I(t);case"winkelTripel":return new xI(t);case"albers":return i?new tb(t):new mI(t);case"lambertConformalConic":return i?new tb(t):new yI(t);case"globe":return new bI(t)}throw new Error(`Invalid projection name: ${t.name}`)}const wI=om.types,TI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wm(t,e,i,n,a,c,d,m,g,y,w,E,M){const P=m?Math.min(rl,Math.round(m[0])):0,D=m?Math.min(rl,Math.round(m[1])):0;t.emplaceBack(e,i,Math.round(32*n),Math.round(32*a),c,d,(P<<1)+(g?1:0),D,16*y,16*w,256*E,256*M)}function Tm(t,e,i){t.emplaceBack(e,i)}function Em(t,e,i,n,a,c,d){t.emplaceBack(e,i,n,a,c,d)}function Sm(t,e,i,n,a){t.emplaceBack(e,i,n,a),t.emplaceBack(e,i,n,a),t.emplaceBack(e,i,n,a),t.emplaceBack(e,i,n,a)}function EI(t){for(const e of t.sections)if(gd(e.text))return!0;return!1}class ey{constructor(e){this.layoutVertexArray=new uc,this.indexArray=new dn,this.programConfigurations=e,this.segments=new $r,this.dynamicLayoutVertexArray=new Bo,this.opacityVertexArray=new Od,this.placedSymbolArray=new Rp,this.iconTransitioningVertexArray=new Gs,this.globeExtVertexArray=new Dd,this.zOffsetVertexArray=new dc}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,n,a,c){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,LA.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,OA.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,TI,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,kA.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,DA.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||c)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,zA.members,!0)),this.opacityVertexBuffer.itemSize=1),(n||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ct(ey,"SymbolBuffers");class ty{constructor(e,i,n){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new n,this.segments=new $r,this.collisionVertexArray=new kd,this.collisionVertexArrayExt=new Bo}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,BA.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,FA.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ct(ty,"CollisionBuffers");class Mm{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(d=>d.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=o.a6.identity([]),this.placementViewportMatrix=o.a6.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=$g(this.zoom,i["text-size"]),this.iconSizeData=$g(this.zoom,i["icon-size"]);const n=this.layers[0].layout,a=n.get("symbol-sort-key"),c=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey=c!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(c==="viewport-y"||c==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(d=>Os[d]),this.stateDependentLayerIds=this.layers.filter(d=>d.isStateDependent()).map(d=>d.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=n.get("symbol-z-elevate")}createArrays(){this.text=new ey(new j(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new ey(new j(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Op,this.lineVertexArray=new _c,this.symbolInstances=new Dp}calculateGlyphDependencies(e,i,n,a,c){for(let d=0;d<e.length;d++){const m=e.codePointAt(d);if(m===void 0)break;if(i[m]=!0,a&&c&&m<=65535){const g=tf[e.charAt(d)];g&&(i[g.charCodeAt(0)]=!0)}}}populate(e,i,n,a){const c=this.layers[0],d=c.layout,m=this.projection.name==="globe",g=d.get("text-font"),y=d.get("text-field"),w=d.get("icon-image"),E=(y.value.kind!=="constant"||y.value.value instanceof Sn&&!y.value.value.isEmpty()||y.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),M=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,P=d.get("symbol-sort-key");if(this.features=[],!E&&!M)return;const D=i.iconDependencies,O=i.glyphDependencies,F=i.availableImages,V=new Or(this.zoom);for(const{feature:W,id:Q,index:J,sourceLayerIndex:oe}of e){const se=c._featureFilter.needGeometry,he=an(W,se);if(!c._featureFilter.filter(V,he,n))continue;if(se||(he.geometry=pn(W,n,a)),m&&W.type!==1&&n.z<=5){const be=he.geometry,ze=.98078528056,qe=(De,Ge)=>{const Pe=Hd(De.x,De.y,n,1),je=Hd(Ge.x,Ge.y,n,1);return o.N.dot(Pe,je)<ze};for(let De=0;De<be.length;De++)be[De]=An(be[De],qe)}let ge,xe;if(E){const be=c.getValueAndResolveTokens("text-field",he,n,F),ze=Sn.factory(be);EI(ze)&&(this.hasRTLText=!0),(!this.hasRTLText||ko()==="unavailable"||this.hasRTLText&&as.isParsed())&&(ge=UA(ze,c,he))}if(M){const be=c.getValueAndResolveTokens("icon-image",he,n,F);xe=be instanceof Jt?be:Jt.fromString(be)}if(!ge&&!xe)continue;const Ae=this.sortFeaturesByKey?P.evaluate(he,{},n):void 0;if(this.features.push({id:Q,text:ge,icon:xe,index:J,sourceLayerIndex:oe,geometry:he.geometry,properties:W.properties,type:wI[W.type],sortKey:Ae}),xe&&(D[xe.namePrimary]=!0,xe.nameSecondary&&(D[xe.nameSecondary]=!0)),ge){const be=g.evaluate(he,{},n).join(","),ze=d.get("text-rotation-alignment")==="map"&&d.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Os.vertical)>=0;for(const qe of ge.sections)if(qe.image)D[qe.image.namePrimary]=!0;else{const De=Oo(ge.toString()),Ge=qe.fontStack||be,Pe=O[Ge]=O[Ge]||{};this.calculateGlyphDependencies(qe.text,Pe,ze,this.allowVerticalPlacement,De)}}}d.get("symbol-placement")==="line"&&(this.features=function(W){const Q={},J={},oe=[];let se=0;function he(be){oe.push(W[be]),se++}function ge(be,ze,qe){const De=J[be];return delete J[be],J[ze]=De,oe[De].geometry[0].pop(),oe[De].geometry[0]=oe[De].geometry[0].concat(qe[0]),De}function xe(be,ze,qe){const De=Q[ze];return delete Q[ze],Q[be]=De,oe[De].geometry[0].shift(),oe[De].geometry[0]=qe[0].concat(oe[De].geometry[0]),De}function Ae(be,ze,qe){const De=qe?ze[0][ze[0].length-1]:ze[0][0];return`${be}:${De.x}:${De.y}`}for(let be=0;be<W.length;be++){const ze=W[be],qe=ze.geometry,De=ze.text?ze.text.toString():null;if(!De){he(be);continue}const Ge=Ae(De,qe),Pe=Ae(De,qe,!0);if(Ge in J&&Pe in Q&&J[Ge]!==Q[Pe]){const je=xe(Ge,Pe,qe),ut=ge(Ge,Pe,oe[je].geometry);delete Q[Ge],delete J[Pe],J[Ae(De,oe[ut].geometry,!0)]=ut,oe[je].geometry=null}else Ge in J?ge(Ge,Pe,qe):Pe in Q?xe(Ge,Pe,qe):(he(be),Q[Ge]=se-1,J[Pe]=se-1)}return oe.filter(be=>be.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((W,Q)=>W.sortKey-Q.sortKey)}update(e,i,n,a,c){const d=Object.keys(e).length!==0;if(d&&!this.stateDependentLayers.length)return;const m=d?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,m,n,a,c),this.icon.programConfigurations.updatePaintArrays(e,i,m,n,a,c)}updateZOffset(){const e=(c,d,m)=>{n+=d,n>c.length&&c.resize(n);for(let g=-d;g<0;g++)c.emplace(g+n,m)},i=(c,d,m)=>{a+=d,a>c.length&&c.resize(a);for(let g=-d;g<0;g++)c.emplace(g+a,m)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let n=0,a=0;for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c),{numHorizontalGlyphVertices:m,numVerticalGlyphVertices:g,numIconVertices:y}=d,w=d.zOffset,E=y>0;if((m>0||g>0)&&(e(this.text.zOffsetVertexArray,m,w),e(this.text.zOffsetVertexArray,g,w)),E){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:P}=d;M>=0&&i(this.icon.zOffsetVertexArray,y,w),P>=0&&i(this.icon.zOffsetVertexArray,d.numVerticalIconVertices,w)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=ib(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const n=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:c}of i)this.lineVertexArray.emplaceBack(a,c);return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(e,i,n,a,c,d,m,g,y,w,E,M,P,D,O,F){const V=e.indexArray,W=e.layoutVertexArray,Q=e.globeExtVertexArray,J=e.segments.prepareSegment(4*i.length,W,V,this.canOverlap?d.sortKey:void 0),oe=this.glyphOffsetArray.length,se=J.vertexLength,he=this.allowVerticalPlacement&&m===Os.vertical?Math.PI/2:0,ge=d.text&&d.text.sections;for(let Ae=0;Ae<i.length;Ae++){const{tl:be,tr:ze,bl:qe,br:De,texPrimary:Ge,texSecondary:Pe,pixelOffsetTL:je,pixelOffsetBR:ut,minFontScaleX:Ze,minFontScaleY:Lt,glyphOffset:St,isSDF:Ye,sectionIndex:ei}=i[Ae],Ft=J.vertexLength,Rt=St[1];if(wm(W,y.x,y.y,be.x,Rt+be.y,Ge.x,Ge.y,n,Ye,je.x,je.y,Ze,Lt),wm(W,y.x,y.y,ze.x,Rt+ze.y,Ge.x+Ge.w,Ge.y,n,Ye,ut.x,je.y,Ze,Lt),wm(W,y.x,y.y,qe.x,Rt+qe.y,Ge.x,Ge.y+Ge.h,n,Ye,je.x,ut.y,Ze,Lt),wm(W,y.x,y.y,De.x,Rt+De.y,Ge.x+Ge.w,Ge.y+Ge.h,n,Ye,ut.x,ut.y,Ze,Lt),g){const{x:Je,y:Xt,z:bi}=g.anchor,[ti,wi,ci]=g.up;Em(Q,Je,Xt,bi,ti,wi,ci),Em(Q,Je,Xt,bi,ti,wi,ci),Em(Q,Je,Xt,bi,ti,wi,ci),Em(Q,Je,Xt,bi,ti,wi,ci),Sm(e.dynamicLayoutVertexArray,Je,Xt,bi,he)}else Sm(e.dynamicLayoutVertexArray,y.x,y.y,y.z,he);if(F){const Je=Pe||Ge;Tm(e.iconTransitioningVertexArray,Je.x,Je.y),Tm(e.iconTransitioningVertexArray,Je.x+Je.w,Je.y),Tm(e.iconTransitioningVertexArray,Je.x,Je.y+Je.h),Tm(e.iconTransitioningVertexArray,Je.x+Je.w,Je.y+Je.h)}V.emplaceBack(Ft,Ft+1,Ft+2),V.emplaceBack(Ft+1,Ft+2,Ft+3),J.vertexLength+=4,J.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(St[0]),Ae!==i.length-1&&ei===i[Ae+1].sectionIndex||e.programConfigurations.populatePaintArrays(W.length,d,d.index,{},P,D,O,ge&&ge[ei])}const xe=g?g.anchor:y;e.placedSymbolArray.emplaceBack(xe.x,xe.y,xe.z,y.x,y.y,oe,this.glyphOffsetArray.length-oe,se,w,E,y.segment,n?n[0]:0,n?n[1]:0,a[0],a[1],m,0,!1,0,M,0)}_commitLayoutVertex(e,i,n,a,c,d,m){e.emplaceBack(i,n,a,c,d,Math.round(m.x),Math.round(m.y))}_addCollisionDebugVertices(e,i,n,a,c,d,m){const g=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),y=g.vertexLength,w=m.tileAnchorX,E=m.tileAnchorY;for(let P=0;P<4;P++)n.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(n.collisionVertexArrayExt,i,e.padding,m.zOffset),this._commitLayoutVertex(n.layoutVertexArray,a,c,d,w,E,new Ie(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,c,d,w,E,new Ie(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,a,c,d,w,E,new Ie(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,a,c,d,w,E,new Ie(e.x1,e.y2)),g.vertexLength+=4;const M=n.indexArray;M.emplaceBack(y,y+1),M.emplaceBack(y+1,y+2),M.emplaceBack(y+2,y+3),M.emplaceBack(y+3,y),g.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,n,a,c,d){for(let m=a;m<c;m++){const g=n.get(m),y=this.getSymbolInstanceTextSize(e,d,i,m);this._addCollisionDebugVertices(g,y,this.textCollisionBox,g.projectedAnchorX,g.projectedAnchorY,g.projectedAnchorZ,d)}}_addIconDebugCollisionBoxes(e,i,n,a,c,d){for(let m=a;m<c;m++){const g=n.get(m),y=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._addCollisionDebugVertices(g,y,this.iconCollisionBox,g.projectedAnchorX,g.projectedAnchorY,g.projectedAnchorZ,d)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ty(hc,w1.members,Gs),this.iconCollisionBox=new ty(hc,w1.members,Gs);const n=Fu(this.iconSizeData,e),a=Fu(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this._addTextDebugCollisionBoxes(a,e,i,d.textBoxStartIndex,d.textBoxEndIndex,d),this._addTextDebugCollisionBoxes(a,e,i,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._addIconDebugCollisionBoxes(n,e,i,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._addIconDebugCollisionBoxes(n,e,i,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}}getSymbolInstanceTextSize(e,i,n,a){const c=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:a),d=dm(this.textSizeData,e,c)/Pn;return this.tilePixelRatio*d}getSymbolInstanceIconSize(e,i,n){const a=this.icon.placedSymbolArray.get(n),c=dm(this.iconSizeData,e,a);return this.tilePixelRatio*c}_commitDebugCollisionVertexUpdate(e,i,n,a){e.emplaceBack(i,-n,-n,a),e.emplaceBack(i,n,-n,a),e.emplaceBack(i,n,n,a),e.emplaceBack(i,-n,n,a)}_updateTextDebugCollisionBoxes(e,i,n,a,c,d){for(let m=a;m<c;m++){const g=n.get(m),y=this.getSymbolInstanceTextSize(e,d,i,m);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,y,g.padding,d.zOffset)}}_updateIconDebugCollisionBoxes(e,i,n,a,c,d){for(let m=a;m<c;m++){const g=n.get(m),y=this.getSymbolInstanceIconSize(e,i,d.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,y,g.padding,d.zOffset)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=Fu(this.iconSizeData,e),a=Fu(this.textSizeData,e);for(let c=0;c<this.symbolInstances.length;c++){const d=this.symbolInstances.get(c);this._updateTextDebugCollisionBoxes(a,e,i,d.textBoxStartIndex,d.textBoxEndIndex,d),this._updateTextDebugCollisionBoxes(a,e,i,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d),this._updateIconDebugCollisionBoxes(n,e,i,d.iconBoxStartIndex,d.iconBoxEndIndex,d),this._updateIconDebugCollisionBoxes(n,e,i,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,n,a,c,d,m,g,y){const w={};if(i<n){const{x1:E,y1:M,x2:P,y2:D,padding:O,projectedAnchorX:F,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Q,tileAnchorY:J,featureIndex:oe}=e.get(i);w.textBox={x1:E,y1:M,x2:P,y2:D,padding:O,projectedAnchorX:F,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Q,tileAnchorY:J},w.textFeatureIndex=oe}if(a<c){const{x1:E,y1:M,x2:P,y2:D,padding:O,projectedAnchorX:F,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Q,tileAnchorY:J,featureIndex:oe}=e.get(a);w.verticalTextBox={x1:E,y1:M,x2:P,y2:D,padding:O,projectedAnchorX:F,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Q,tileAnchorY:J},w.verticalTextFeatureIndex=oe}if(d<m){const{x1:E,y1:M,x2:P,y2:D,padding:O,projectedAnchorX:F,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Q,tileAnchorY:J,featureIndex:oe}=e.get(d);w.iconBox={x1:E,y1:M,x2:P,y2:D,padding:O,projectedAnchorX:F,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Q,tileAnchorY:J},w.iconFeatureIndex=oe}if(g<y){const{x1:E,y1:M,x2:P,y2:D,padding:O,projectedAnchorX:F,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Q,tileAnchorY:J,featureIndex:oe}=e.get(g);w.verticalIconBox={x1:E,y1:M,x2:P,y2:D,padding:O,projectedAnchorX:F,projectedAnchorY:V,projectedAnchorZ:W,tileAnchorX:Q,tileAnchorY:J},w.verticalIconFeatureIndex=oe}return w}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const n=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const n=e.placedSymbolArray.get(i),a=n.vertexStartIndex+4*n.numGlyphs;for(let c=n.vertexStartIndex;c<a;c+=4)e.indexArray.emplaceBack(c,c+1,c+2),e.indexArray.emplaceBack(c+1,c+2,c+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),n=Math.cos(e),a=[],c=[],d=[];for(let m=0;m<this.symbolInstances.length;++m){d.push(m);const g=this.symbolInstances.get(m);a.push(0|Math.round(i*g.tileAnchorX+n*g.tileAnchorY)),c.push(g.featureIndex)}return d.sort((m,g)=>a[m]-a[g]||c[g]-c[m]),d}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===i?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const n=this.symbolInstances.get(i);this.featureSortOrder.push(n.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:c,leftJustifiedTextSymbolIndex:d,verticalPlacedTextSymbolIndex:m,placedIconSymbolIndex:g,verticalPlacedIconSymbolIndex:y}=n;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),c>=0&&c!==a&&this.addIndicesForPlacedSymbol(this.text,c),d>=0&&d!==c&&d!==a&&this.addIndicesForPlacedSymbol(this.text,d),m>=0&&this.addIndicesForPlacedSymbol(this.text,m),g>=0&&this.addIndicesForPlacedSymbol(this.icon,g),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ct(Mm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Mm.addDynamicAttributes=Sm;const SI=new zr({"symbol-placement":new at(Te.layout_symbol["symbol-placement"]),"symbol-spacing":new at(Te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new at(Te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wt(Te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new at(Te.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new at(Te.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new at(Te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new at(Te.layout_symbol["icon-ignore-placement"]),"icon-optional":new at(Te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new at(Te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wt(Te.layout_symbol["icon-size"]),"icon-text-fit":new Wt(Te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Wt(Te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wt(Te.layout_symbol["icon-image"]),"icon-rotate":new Wt(Te.layout_symbol["icon-rotate"]),"icon-padding":new at(Te.layout_symbol["icon-padding"]),"icon-keep-upright":new at(Te.layout_symbol["icon-keep-upright"]),"icon-offset":new Wt(Te.layout_symbol["icon-offset"]),"icon-anchor":new Wt(Te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new at(Te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new at(Te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new at(Te.layout_symbol["text-rotation-alignment"]),"text-field":new Wt(Te.layout_symbol["text-field"]),"text-font":new Wt(Te.layout_symbol["text-font"]),"text-size":new Wt(Te.layout_symbol["text-size"]),"text-max-width":new Wt(Te.layout_symbol["text-max-width"]),"text-line-height":new Wt(Te.layout_symbol["text-line-height"]),"text-letter-spacing":new Wt(Te.layout_symbol["text-letter-spacing"]),"text-justify":new Wt(Te.layout_symbol["text-justify"]),"text-radial-offset":new Wt(Te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new at(Te.layout_symbol["text-variable-anchor"]),"text-anchor":new Wt(Te.layout_symbol["text-anchor"]),"text-max-angle":new at(Te.layout_symbol["text-max-angle"]),"text-writing-mode":new at(Te.layout_symbol["text-writing-mode"]),"text-rotate":new Wt(Te.layout_symbol["text-rotate"]),"text-padding":new at(Te.layout_symbol["text-padding"]),"text-keep-upright":new at(Te.layout_symbol["text-keep-upright"]),"text-transform":new Wt(Te.layout_symbol["text-transform"]),"text-offset":new Wt(Te.layout_symbol["text-offset"]),"text-allow-overlap":new at(Te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new at(Te.layout_symbol["text-ignore-placement"]),"text-optional":new at(Te.layout_symbol["text-optional"]),visibility:new at(Te.layout_symbol.visibility)});var iy={paint:new zr({"icon-opacity":new Wt(Te.paint_symbol["icon-opacity"]),"icon-emissive-strength":new Wt(Te.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Wt(Te.paint_symbol["text-emissive-strength"]),"icon-color":new Wt(Te.paint_symbol["icon-color"]),"icon-halo-color":new Wt(Te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wt(Te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wt(Te.paint_symbol["icon-halo-blur"]),"icon-translate":new at(Te.paint_symbol["icon-translate"]),"icon-translate-anchor":new at(Te.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Wt(Te.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Wt(Te.paint_symbol["text-opacity"]),"text-color":new Wt(Te.paint_symbol["text-color"],{runtimeType:hs,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Wt(Te.paint_symbol["text-halo-color"]),"text-halo-width":new Wt(Te.paint_symbol["text-halo-width"]),"text-halo-blur":new Wt(Te.paint_symbol["text-halo-blur"]),"text-translate":new at(Te.paint_symbol["text-translate"]),"text-translate-anchor":new at(Te.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new at(Te.paint_symbol["icon-color-saturation"])}),layout:SI};class rb{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Aa,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ct(rb,"FormatSectionOverride",{omit:["defaultValue"]});class Am extends Kn{constructor(e,i,n){super(e,iy,i,n)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const a=[];for(const c of n)a.indexOf(c)<0&&a.push(c);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,n,a){const c=this.layout.get(e).evaluate(i,{},n,a),d=this._unevaluatedLayout._values[e];return d.isDataDriven()||Yl(d.value)||!c?c:function(m,g){return g.replace(/{([^{}]+)}/g,(y,w)=>w in m?String(m[w]):"")}(i.properties,c)}createBucket(e){return new Mm(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of iy.paint.overridableProperties){if(!Am.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),n=new rb(i),a=new yu(n,i.property.specification,this.scope,this.options);let c=null;c=i.value.kind==="constant"||i.value.kind==="source"?new md("source",a):new Jl("composite",a,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Za(i.property,c,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,n){return!(!this.layout||i.isDataDriven()||n.isDataDriven())&&Am.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const n=e.get("text-field"),a=iy.paint.properties[i];let c=!1;const d=m=>{for(const g of m)if(a.overrides&&a.overrides.hasOverride(g))return void(c=!0)};if(n.value.kind==="constant"&&n.value.value instanceof Sn)d(n.value.value.sections);else if(n.value.kind==="source"){const m=y=>{c||(y instanceof Ys&&sn(y.value)===Ca?d(y.value.sections):y instanceof Ra?d(y.sections):y.eachChild(m))},g=n.value;g._styleExpression&&m(g._styleExpression.expression)}return c}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,n=[];return e&&n.push("symbolIcon"),i&&n.push("symbolSDF"),n}getDefaultProgramParams(e,i){return{config:new B(this,i),overrideFog:!1}}}const MI=new zr({visibility:new at(Te.layout_background.visibility)});var AI={paint:new zr({"background-color":new at(Te.paint_background["background-color"]),"background-pattern":new at(Te.paint_background["background-pattern"]),"background-opacity":new at(Te.paint_background["background-opacity"]),"background-emissive-strength":new at(Te.paint_background["background-emissive-strength"])}),layout:MI};const II=new zr({visibility:new at(Te.layout_raster.visibility)});var CI={paint:new zr({"raster-opacity":new at(Te.paint_raster["raster-opacity"]),"raster-color":new ha(Te.paint_raster["raster-color"]),"raster-color-mix":new at(Te.paint_raster["raster-color-mix"]),"raster-color-range":new at(Te.paint_raster["raster-color-range"]),"raster-hue-rotate":new at(Te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new at(Te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new at(Te.paint_raster["raster-brightness-max"]),"raster-saturation":new at(Te.paint_raster["raster-saturation"]),"raster-contrast":new at(Te.paint_raster["raster-contrast"]),"raster-resampling":new at(Te.paint_raster["raster-resampling"]),"raster-fade-duration":new at(Te.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new at(Te.paint_raster["raster-emissive-strength"]),"raster-array-band":new at(Te.paint_raster["raster-array-band"]),"raster-elevation":new at(Te.paint_raster["raster-elevation"])}),layout:II},ry=nr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ny{constructor(e,i,n,a){this.context=e,this.format=n,this.texture=e.gl.createTexture(),this.update(i,a)}update(e,i,n){const{width:a,height:c}=e,{context:d}=this,{gl:m}=d;if(m.bindTexture(m.TEXTURE_2D,this.texture),d.pixelStoreUnpackFlipY.set(!1),d.pixelStoreUnpack.set(1),d.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA&&(!i||i.premultiply!==!1)),n||this.size&&this.size[0]===a&&this.size[1]===c){const{x:g,y}=n||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)m.texSubImage2D(m.TEXTURE_2D,0,g,y,m.RGBA,m.UNSIGNED_BYTE,e);else{let w=this.format,E=m.UNSIGNED_BYTE;this.format===m.R32F&&(w=m.RED,E=m.FLOAT),m.texSubImage2D(m.TEXTURE_2D,0,g,y,a,c,w,E,e.data)}}else if(this.size=[a,c],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let g=this.format;this.format===m.R8&&(g=m.RED),m.texImage2D(m.TEXTURE_2D,0,this.format,g,m.UNSIGNED_BYTE,e)}else{let g=this.format,y=this.format,w=m.UNSIGNED_BYTE;this.format===m.DEPTH_COMPONENT&&(g=m.DEPTH_COMPONENT16,w=m.UNSIGNED_SHORT),this.format===m.R8&&(y=m.RED),this.format===m.R32F&&(w=m.FLOAT,y=m.RED),m.texImage2D(m.TEXTURE_2D,0,g,a,c,0,y,w,e.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,i,n=!1){const{context:a}=this,{gl:c}=a;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.minFilter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap&&!n?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,i),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,n,a){const{context:c}=this,{gl:d}=c;d.bindTexture(d.TEXTURE_2D,this.texture),i!==this.magFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,this.useMipmap?e===d.NEAREST?d.NEAREST_MIPMAP_NEAREST:d.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),n!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,n),this.wrapS=n),a!==this.wrapT&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,a),this.wrapT=a)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Im{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:n}=this,{gl:a}=n;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapS=i)}}function Cm(t,e,i,n,a,c,d,m){const g=[t,e,1,i,n,1,a,c,1],y=[d,m,1],w=o.co.adjoint([],g),[E,M,P]=o.N.transformMat3(y,y,w);return o.co.multiply(g,g,[E,0,0,0,M,0,0,0,P])}function nb(t,e,i,n,a,c,d,m){const g=function(y,w,E,M,P,D,O,F){const V=Cm(0,0,1,0,1,1,0,1),W=Cm(y,w,E,M,P,D,O,F),Q=o.co.adjoint([],V);return o.co.multiply(W,W,Q)}(t,e,i,n,a,c,d,m);return[g[2]/g[8]/xt,g[5]/g[8]/xt]}function Pm(t){return[t[0],Math.min(Math.max(t[1],-Ai),Ai)]}class sb extends Ma{constructor(e,i,n,a){super(),this.id=e,this.dispatcher=n,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Jo("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=vt(this.map._requestManager.transformRequest(this.url,Zn.Image),(n,a)=>{this._imageRequest=null,this._loaded=!0,n?this.fire(new vh(n)):a&&(this.image=a instanceof HTMLImageElement?Qe.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Im(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Jo("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Im||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],n=e[0][1];for(const c of e)c[1]>n&&(n=c[1]),c[1]<i&&(i=c[1]);const a=(n+i)/2;if(a>Ai?this.onNorthPole=!0:a<-Ai&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const c=e.map(ji.fromLngLat);this.tileID=function(d){let m=1/0,g=1/0,y=-1/0,w=-1/0;for(const O of d)m=Math.min(m,O.x),g=Math.min(g,O.y),y=Math.max(y,O.x),w=Math.max(w,O.y);const E=Math.max(y-m,w-g),M=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),P=Math.pow(2,M);let D=Math.floor((m+y)/2*P);return D>1&&(D-=1),new Ke(M,D,Math.floor((g+w)/2*P))}(c),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Jo("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const V in this.tiles){const W=this.tiles[V];W.state!=="loaded"&&(W.state="loaded",W.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=of(new Ke(0,0,0),this.map.transform.projection),n=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(V){const W=V[1].x-V[0].x,Q=V[1].y-V[0].y,J=V[2].x-V[1].x,oe=V[2].y-V[1].y,se=V[3].x-V[2].x,he=V[3].y-V[2].y,ge=V[0].x-V[3].x,xe=V[0].y-V[3].y,Ae=W*oe-J*Q,be=J*he-se*oe,ze=se*xe-ge*he,qe=ge*Q-W*xe;return Ae>0&&be>0&&ze>0&&qe>0||Ae<0&&be<0&&ze<0&&qe<0}(n))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const a=of(this.tileID,this.map.transform.projection),[c,d,m,g]=this.coordinates.map(V=>{const W=a.projection.project(V[0],V[1]);return Y1(a,W)._round()});this.perspectiveTransform=nb(c.x,c.y,d.x,d.y,m.x,m.y,g.x,g.y);const y=this._boundsArray=new ro;y.emplaceBack(c.x,c.y,0,0),y.emplaceBack(d.x,d.y,xt,0),y.emplaceBack(g.x,g.y,0,xt),y.emplaceBack(m.x,m.y,xt,xt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(y,ry.members),this.boundsSegments=$r.simpleSegment(0,0,4,2);const w=[],E=[Pm((M=this.coordinates)[0]),Pm(M[1]),Pm(M[2]),Pm(M[3])];var M;const[P,D,O,F]=function(V){let W=V[0][0],Q=W,J=V[0][1],oe=J;for(let se=1;se<V.length;se++)V[se][0]<W?W=V[se][0]:V[se][0]>Q&&(Q=V[se][0]),V[se][1]<J?J=V[se][1]:V[se][1]>oe&&(oe=V[se][1]);return[W,J,Q-W,oe-J]}(E);{const V=new ro,[W,Q,J,oe]=function(je){let ut=je[0].x,Ze=ut,Lt=je[0].y,St=Lt;for(let Ye=1;Ye<je.length;Ye++)je[Ye].x<ut?ut=je[Ye].x:je[Ye].x>Ze&&(Ze=je[Ye].x),je[Ye].y<Lt?Lt=je[Ye].y:je[Ye].y>St&&(St=je[Ye].y);return[ut,Lt,Ze-ut,St-Lt]}(n),se=je=>[(je.x-W)/J,(je.y-Q)/oe],[he,ge,xe,Ae]=n.map(se),be=function(je,ut,Ze,Lt,St,Ye,ei,Ft){const Rt=Cm(0,0,1,0,1,1,0,1),Je=Cm(je,ut,Ze,Lt,St,Ye,ei,Ft),Xt=o.co.adjoint([],Je);return o.co.multiply(Rt,Rt,Xt)}(he[0],he[1],ge[0],ge[1],xe[0],xe[1],Ae[0],Ae[1]);this.elevatedGlobePerspectiveTransform=nb(he[0],he[1],ge[0],ge[1],xe[0],xe[1],Ae[0],Ae[1]);const ze=(je,ut)=>{w.push(je.lng);const Ze=Math.round((je.lng-P)/O*xt),Lt=Math.round((je.lat-D)/F*xt),St=se(ut),Ye=o.N.transformMat3([],[St[0],St[1],1],be),ei=Math.round(Ye[0]/Ye[2]*xt),Ft=Math.round(Ye[1]/Ye[2]*xt);V.emplaceBack(Ze,Lt,ei,Ft)},qe=n[3].x-n[0].x,De=n[3].y-n[0].y,Ge=n[2].x-n[1].x,Pe=n[2].y-n[1].y;for(let je=0;je<65;je++){const ut=je/64,Ze=[n[0].x+ut*qe,n[0].y+ut*De],Lt=[n[1].x+ut*Ge,n[1].y+ut*Pe],St=Lt[0]-Ze[0],Ye=Lt[1]-Ze[1];for(let ei=0;ei<65;ei++){const Ft=ei/64,Rt={x:Ze[0]+St*Ft,y:Ze[1]+Ye*Ft,z:0};ze(i.projection.unproject(Rt.x,Rt.y),Rt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(V,ry.members)}{this.maxLongitudeTriangleSize=0;let V=[],W=new dn;const Q=(J,oe,se)=>{W.emplaceBack(J,oe,se);const he=w[J],ge=w[oe],xe=w[se],Ae=Math.min(Math.min(he,ge),xe),be=Math.max(Math.max(he,ge),xe)-Ae;be>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=be),V.push(Ae+be/2)};for(let J=0;J<64;J++)for(let oe=0;oe<64;oe++){const se=65*J+oe,he=se+1,ge=se+65,xe=ge+1;Q(se,ge,he),Q(he,ge,xe)}[V,W]=function(J,oe){const se=Array.from({length:J.length},(xe,Ae)=>Ae);se.sort((xe,Ae)=>J[xe]-J[Ae]);const he=[],ge=new dn;for(let xe=0;xe<se.length;xe++){const Ae=se[xe];he.push(J[Ae]);const be=3*Ae,ze=be+1;ge.emplaceBack(oe.uint16[be],oe.uint16[ze],oe.uint16[ze+1])}return[he,ge]}(V,W),this.elevatedGlobeTrianglesCenterLongitudes=V,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(W)}this.elevatedGlobeSegments=$r.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,O/xt,0,F/xt,0,0,D,P,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,n=i.gl;!this._dirty||this.texture instanceof Im||(this.texture?this.texture.update(this.image):(this.texture=new ny(i,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const n=this.elevatedGlobeTrianglesCenterLongitudes;let a=((w,E)=>w+360*Math.round((E-w)/360))(e+180,n[0]);const c=new $r,d=(w,E)=>{c.segments.push({vertexOffset:0,primitiveOffset:w,vertexLength:i.segments[0].vertexLength,primitiveLength:E,sortKey:void 0,vaos:{}})},m=.51*this.maxLongitudeTriangleSize;if(Math.abs(n[0]-a)<=m){const w=Re(n,0,n.length,a+m);return w===n.length||d(w,le(n,w+1,n.length,a+360-m)-w),c}a<n[0]&&(a+=360);const g=le(n,0,n.length,a-m);if(g===n.length)return d(0,n.length),c;d(0,g-0);const y=Re(n,g+1,n.length,a+m);return y!==n.length&&d(y,n.length-y),c}}const PI=(Math.pow(256,2)-1)/16907520;class ob extends Kn{constructor(e,i,n){super(e,CI,i,n),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isLayerDraped(e){return!(e&&e._source instanceof sb&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[n,a]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(n)&&isNaN(a)||n===this._curRampRange[0]&&a===this._curRampRange[1]||(this.colorRamp=Wd({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:n,end:a}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[n,a])}}const RI=new zr({visibility:new at(Te["layout_raster-particle"].visibility)});var LI={paint:new zr({"raster-particle-array-band":new at(Te["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new at(Te["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new ha(Te["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new at(Te["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new at(Te["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new at(Te["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new at(Te["paint_raster-particle"]["raster-particle-reset-rate-factor"])}),layout:RI};class ab extends Kn{constructor(e,i,n){super(e,LI,i,n),this._updateColorRamp(),this.onRemove=a=>{this.colorRampTexture&&this.colorRampTexture.destroy(),this.transformFeedbackObject&&a.painter.context.gl.deleteTransformFeedback(this.transformFeedbackObject),this.tileFramebuffer&&this.tileFramebuffer.destroy()},this.lastInvalidatedAt=Qe.now()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isLayerDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Wd({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Qe.now()}}class DI extends Kn{constructor(e,i){super(e,{},i),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const OI=new zr({visibility:new at(Te.layout_sky.visibility)});var zI={paint:new zr({"sky-type":new at(Te.paint_sky["sky-type"]),"sky-atmosphere-sun":new at(Te.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new at(Te.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new at(Te.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new at(Te.paint_sky["sky-gradient-radius"]),"sky-gradient":new ha(Te.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new at(Te.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new at(Te.paint_sky["sky-atmosphere-color"]),"sky-opacity":new at(Te.paint_sky["sky-opacity"])}),layout:OI};function sy(t,e,i){const n=[0,0,1],a=o.bi.identity([]);return o.bi.rotateY(a,a,i?-dt(t)+Math.PI:dt(t)),o.bi.rotateX(a,a,-dt(e)),o.N.transformQuat(n,n,a),o.N.normalize(n,n)}var kI={paint:new zr({})};function lb(t,e){const i=Rm(t.projection,t.zoom,t.width,t.height),n=function(c,d,m,g,y){const w=new ve(m.lng-180*sl,m.lat),E=new ve(m.lng+180*sl,m.lat),M=c.project(w.lng,w.lat),P=c.project(E.lng,E.lat),D=-Math.atan2(P.y-M.y,P.x-M.x),O=ji.fromLngLat(m);O.y=Nt(O.y,-1+sl,1-sl);const F=O.toLngLat(),V=c.project(F.lng,F.lat),W=ji.fromLngLat(F);W.x+=sl;const Q=W.toLngLat(),J=c.project(Q.lng,Q.lat),oe=hb(J.x-V.x,J.y-V.y,D),se=ji.fromLngLat(F);se.y+=sl;const he=se.toLngLat(),ge=c.project(he.lng,he.lat),xe=hb(ge.x-V.x,ge.y-V.y,D),Ae=Math.abs(oe.x)/Math.abs(xe.y),be=o.a6.identity([]);o.a6.rotateZ(be,be,-D*(1-(y?0:g)));const ze=o.a6.identity([]);return o.a6.scale(ze,ze,[1,1-(1-Ae)*g,1]),ze[4]=-xe.x/xe.y*g,o.a6.rotateZ(ze,ze,D),o.a6.multiply(ze,be,ze),ze}(t.projection,0,t.center,i,e),a=cb(t);return o.a6.scale(n,n,[a,a,1]),n}function cb(t){const e=t.projection,i=Rm(t.projection,t.zoom,t.width,t.height),n=ub(e,t.center),a=ub(e,ve.convert(e.center));return Math.pow(2,n*i+(1-i)*a)}function Rm(t,e,i,n,a=1/0){const c=t.range;if(!c)return 0;const d=Math.min(a,Math.max(i,n)),m=Math.log(d/1024)/Math.LN2;return Dn(c[0]+m,c[1]+m,e)}const sl=1/4e4;function ub(t,e){const i=Nt(e.lat,-Ai,Ai),n=new ve(e.lng-180*sl,i),a=new ve(e.lng+180*sl,i),c=t.project(n.lng,i),d=t.project(a.lng,i),m=ji.fromLngLat(n),g=ji.fromLngLat(a),y=d.x-c.x,w=d.y-c.y,E=g.x-m.x,M=g.y-m.y,P=Math.sqrt((E*E+M*M)/(y*y+w*w));return Math.log(P)/Math.LN2}function hb(t,e,i){const n=Math.cos(i),a=Math.sin(i);return{x:t*n-e*a,y:t*a+e*n}}function db(t,e,i){o.a6.identity(t),o.a6.rotateZ(t,t,dt(e[2])),o.a6.rotateX(t,t,dt(e[0])),o.a6.rotateY(t,t,dt(e[1])),o.a6.scale(t,t,i),o.a6.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Lm(t,e,i,n,a,c,d,m){const g=[i[0]-e[0],i[1]-e[1],0],y=[n[0]-e[0],n[1]-e[1],0];if(o.N.length(g)<1e-12||o.N.length(y)<1e-12)return o.bi.identity(t);const w=o.N.cross([],g,y);o.N.normalize(w,w),o.N.subtract(y,n,e),g[2]=(c-a)*m,y[2]=(d-a)*m;const E=g;return o.N.cross(E,g,y),o.N.normalize(E,E),o.bi.rotationTo(t,w,E)}function oy(t,e,i=!1){const n=Ja(e.zoom),a=function(c,d,m){const g=d.worldSize,y=[c[12],c[13],c[14]],w=ki(y[1]/g),E=ui(y[0]/g),M=o.a6.identity([]),P=di(1,w)*g,D=di(1,0)*g*Ii(w,d.zoom),O=1/Pg(g);let F=D*O;if(m){const J=Rm(d.projection,d.zoom,d.width,d.height,1024);F=O*d.projection.pixelSpaceConversion(d.center.lat,g,J)}const V=Oe(w,E);o.N.add(V,V,o.N.scale([],o.N.normalize([],V),P*F*y[2]));const W=function(J){const oe=[J[0],J[1],J[2]];let se=[0,1,0];const he=o.N.cross([],se,oe);return o.N.cross(se,oe,he),o.N.squaredLength(se)===0&&(se=[0,1,0],o.N.cross(he,oe,se)),o.N.normalize(he,he),o.N.normalize(se,se),o.N.normalize(oe,oe),[he[0],he[1],he[2],0,se[0],se[1],se[2],0,oe[0],oe[1],oe[2],0,J[0],J[1],J[2],1]}(V);o.a6.scale(M,M,[F,F,F*P]),o.a6.translate(M,M,[-y[0],-y[1],-y[2]]);const Q=o.a6.multiply([],d.globeMatrix,W);return o.a6.multiply(Q,Q,M),o.a6.multiply(Q,Q,c),Q}(t,e,i);if(n>0){const c=function(d,m){const g=m.worldSize,y=di(1,0)*g*Ii(m.center.lat,m.zoom)/Pg(g),w=di(1,m.center.lat)*g,E=o.a6.identity([]);return o.a6.rotateY(E,E,dt(m.center.lng)),o.a6.rotateX(E,E,dt(m.center.lat)),o.a6.translate(E,E,[0,0,X]),o.a6.scale(E,E,[y,y,y*w]),o.a6.translate(E,E,[m.point.x-.5*g,m.point.y-.5*g,0]),o.a6.multiply(E,E,d),o.a6.multiply(E,m.globeMatrix,E)}(t,e);return function(d,m,g){const y=(D,O,F)=>{const V=o.N.length(D),W=o.N.length(O),Q=ya(D,O,F);return o.N.scale(Q,Q,1/o.N.length(Q)*Di(V,W,F))},w=y([d[0],d[1],d[2]],[m[0],m[1],m[2]],g),E=y([d[4],d[5],d[6]],[m[4],m[5],m[6]],g),M=y([d[8],d[9],d[10]],[m[8],m[9],m[10]],g),P=ya([d[12],d[13],d[14]],[m[12],m[13],m[14]],g);return[w[0],w[1],w[2],0,E[0],E[1],E[2],0,M[0],M[1],M[2],0,P[0],P[1],P[2],1]}(a,c,n)}return a}function fb(t,e,i,n){const a=Ur.projectAabbCorners(n,i);let c=Number.MAX_VALUE,d=-1;for(let y=0;y<a.length;++y){const w=a[y];w[0]=(.5*w[0]+.5)*e.width,w[1]=(.5-.5*w[1])*e.height,w[2]<c&&(d=y,c=w[2])}const m=y=>new Ie(a[y][0],a[y][1]);let g;switch(d){case 0:case 6:g=[m(1),m(5),m(4),m(7),m(3),m(2),m(1)];break;case 1:case 7:g=[m(0),m(4),m(5),m(6),m(2),m(3),m(0)];break;case 3:case 5:g=[m(1),m(0),m(4),m(7),m(6),m(2),m(1)];break;default:g=[m(1),m(5),m(6),m(7),m(3),m(0),m(1)]}if(qs(t,g))return c}const BI=nr([{name:"a_pos_3f",components:3,type:"Float32"}]),FI=nr([{name:"a_color_3f",components:3,type:"Float32"}]),NI=nr([{name:"a_color_4f",components:4,type:"Float32"}]),VI=nr([{name:"a_uv_2f",components:2,type:"Float32"}]),UI=nr([{name:"a_normal_3f",components:3,type:"Float32"}]),jI=nr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),GI=nr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class pb{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class mb{constructor(){this.instancedDataArray=new Nd,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class ay{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,i,n,a){this.tileToMeter=Ci(n);const c=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:d,id:m,index:g,sourceLayerIndex:y}of e){const w=an(d,c);if(!this.layers[0]._featureFilter.filter(new Or(this.zoom),w,n))continue;const E={id:m,sourceLayerIndex:y,index:g,geometry:c?w.geometry:pn(d,n,a),properties:d.properties,type:d.type,patterns:{}},M=this.addFeature(E,E.geometry,w);M&&i.featureIndex.insert(d,E.geometry,g,y,this.index,this.instancesPerModel[M].instancedDataArray.length,xt/32)}this.lookup=null}update(e,i,n,a){for(const c in this.instancesPerModel){const d=this.instancesPerModel[c];for(const m in e)d.idToFeaturesIndex.hasOwnProperty(m)&&this.evaluate(d.features[d.idToFeaturesIndex[m]],e[m],d,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const n=this.instancesPerModel[i];for(const a of n.features){const c=this.layers[0],d=a.feature,m=this.canonical,g=c.paint.get("model-rotation").evaluate(d,{},m),y=c.paint.get("model-scale").evaluate(d,{},m),w=c.paint.get("model-translation").evaluate(d,{},m);o.N.exactEquals(a.rotation,g)&&o.N.exactEquals(a.scale,y)&&o.N.exactEquals(a.translation,w)||(this.evaluate(a,a.featureStates,n,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const n=this.instancesPerModel[i];n.instancedDataArray.length<0||n.instancedDataArray.length===0||(n.instancedDataBuffer?n.instancedDataBuffer.updateData(n.instancedDataArray):n.instancedDataBuffer=e.createVertexBuffer(n.instancedDataArray,jI.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}}addFeature(e,i,n){const a=this.layers[0],c=a.layout.get("model-id").evaluate(n,{},this.canonical);if(!c)return _e(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),c;this.instancesPerModel[c]||(this.instancesPerModel[c]=new mb);const d=this.instancesPerModel[c],m=d.instancedDataArray,g=new pb(n,m.length);for(const y of i)for(const w of y){if(w.x<0||w.x>=xt||w.y<0||w.y>=xt)continue;const E=(this.lookupDim-1)/xt,M=this.lookupDim*(w.y*E|0)+w.x*E|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const P=m.length;m.resize(P+1),d.instancesEvaluatedElevation.push(0),m.float32[16*P]=w.x,m.float32[16*P+1]=w.y}return g.instancedDataCount=d.instancedDataArray.length-g.instancedDataOffset,g.instancedDataCount>0&&(e.id&&(d.idToFeaturesIndex[e.id]=d.features.length),d.features.push(g),this.evaluate(g,{},d,!1)),c}evaluate(e,i,n,a){const c=this.layers[0],d=e.feature,m=this.canonical,g=e.rotation=c.paint.get("model-rotation").evaluate(d,i,m),y=e.scale=c.paint.get("model-scale").evaluate(d,i,m),w=e.translation=c.paint.get("model-translation").evaluate(d,i,m),E=c.paint.get("model-color").evaluate(d,i,m);E.a=c.paint.get("model-color-mix-intensity").evaluate(d,i,m);const M=[];this.maxVerticalOffset<w[2]&&(this.maxVerticalOffset=w[2]),this.maxScale=Math.max(Math.max(this.maxScale,y[0]),Math.max(y[1],y[2])),db(M,g,y);const P=Math.round(100*E.a)+E.b/1.05;for(let D=0;D<e.instancedDataCount;++D){const O=e.instancedDataOffset+D,F=16*O,V=n.instancedDataArray.float32;let W=0;a&&(W=V[F+6]-n.instancesEvaluatedElevation[O]);const Q=0|V[F+1];V[F]=(0|V[F])+E.r/1.05,V[F+1]=Q+E.g/1.05,V[F+2]=P,V[F+3]=1/(m.z>10?this.tileToMeter:Ci(m,Q)),V[F+4]=w[0],V[F+5]=w[1],V[F+6]=w[2]+W,V[F+7]=M[0],V[F+8]=M[1],V[F+9]=M[2],V[F+10]=M[4],V[F+11]=M[5],V[F+12]=M[6],V[F+13]=M[8],V[F+14]=M[9],V[F+15]=M[10],n.instancesEvaluatedElevation[O]=w[2]}}}Ct(ay,"ModelBucket",{omit:["layers"]}),Ct(mb,"PerModelAttributes"),Ct(pb,"ModelFeature");const $I=new zr({visibility:new at(Te.layout_model.visibility),"model-id":new Wt(Te.layout_model["model-id"])});var qI={paint:new zr({"model-opacity":new at(Te.paint_model["model-opacity"]),"model-rotation":new Wt(Te.paint_model["model-rotation"]),"model-scale":new Wt(Te.paint_model["model-scale"]),"model-translation":new Wt(Te.paint_model["model-translation"]),"model-color":new Wt(Te.paint_model["model-color"]),"model-color-mix-intensity":new Wt(Te.paint_model["model-color-mix-intensity"]),"model-type":new at(Te.paint_model["model-type"]),"model-cast-shadows":new at(Te.paint_model["model-cast-shadows"]),"model-receive-shadows":new at(Te.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new at(Te.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Wt(Te.paint_model["model-emissive-strength"]),"model-roughness":new Wt(Te.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Wt(Te.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new at(Te.paint_model["model-cutoff-fade-range"])}),layout:$I};const Mc=64,Zu={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function _b(t,e,i,n,a,c,d,m,g,y=!1){const w=i.zoom,E=i.project(n),M=Ii(n.lat,w),P=1/M;o.a6.identity(t),o.a6.translate(t,t,[E.x+d[0]*P,E.y+d[1]*P,d[2]]);let D=1,O=1;const F=i.worldSize;if(y){if(i.projection.name==="mercator"){let J=0;i.elevation&&(J=i.elevation.getAtPointOrZero(new ji(E.x/F,E.y/F),0));const oe=o.a7.transformMat4([],[E.x,E.y,J,1],i.projMatrix)[3]/i.cameraToCenterDistance;D=oe,O=oe*Ii(i.center.lat,w)}else if(i.projection.name==="globe"){const J=oy(t,i),oe=o.a6.multiply([],i.projMatrix,J),se=[0,0,0,1];o.a7.transformMat4(se,se,oe);const he=se[3]/i.cameraToCenterDistance,ge=Ja(w),xe=i.projection.pixelsPerMeter(n.lat,F)*Ii(n.lat,w),Ae=i.projection.pixelsPerMeter(i.center.lat,F)*Ii(i.center.lat,w);D=he/Di(xe,kr(i.center.lat),ge),O=he*M/xe,D*=Ae,O*=Ae}}else D=P;o.a6.scale(t,t,[D,D,O]);const V=[...t],W=e.orientation,Q=[];if(db(Q,[W[0]+a[0],W[1]+a[1],W[2]+a[2]],c),o.a6.multiply(t,V,Q),m&&i.elevation){let J=0;const oe=[];if(g&&i.elevation){J=function(ge,xe,Ae,be,ze){const qe=xe.elevation;if(!qe)return 0;const De=Ur.projectAabbCorners(Ae,be),Ge=di(1,ze.lat)*xe.worldSize,Pe=function(Xt,bi){const ti=[0,0,1],wi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ci of wi){const Oi=Xt[ci.corners[0]],fi=Xt[ci.corners[1]],fr=Xt[ci.corners[2]],$i=[fi[0]-Oi[0],fi[1]-Oi[1],bi*(fi[2]-Oi[2])],Hi=o.N.cross($i,$i,[fr[0]-Oi[0],fr[1]-Oi[1],bi*(fr[2]-Oi[2])]);o.N.normalize(Hi,Hi),ci.dotProductWithUp=o.N.dot(Hi,ti)}return wi.sort((ci,Oi)=>ci.dotProductWithUp-Oi.dotProductWithUp),wi[0].corners}(De,Ge),je=De[Pe[0]],ut=De[Pe[1]],Ze=De[Pe[2]],Lt=De[Pe[3]],St=qe.getAtPointOrZero(new ji(je[0]/xe.worldSize,je[1]/xe.worldSize),0),Ye=qe.getAtPointOrZero(new ji(ut[0]/xe.worldSize,ut[1]/xe.worldSize),0),ei=qe.getAtPointOrZero(new ji(Ze[0]/xe.worldSize,Ze[1]/xe.worldSize),0),Ft=qe.getAtPointOrZero(new ji(Lt[0]/xe.worldSize,Lt[1]/xe.worldSize),0),Rt=(St+Ft)/2,Je=(Ye+ei)/2;return Rt>Je?Ye<ei?Lm(ge,ut,Lt,je,Ye,Ft,St,Ge):Lm(ge,Ze,je,Lt,ei,St,Ft,Ge):St<Ft?Lm(ge,je,ut,Ze,St,Ye,ei,Ge):Lm(ge,Lt,Ze,ut,Ft,ei,Ye,Ge),Math.max(Rt,Je)}(oe,i,e.aabb,t,n);const se=o.a6.fromQuat([],oe),he=o.a6.multiply([],se,Q);o.a6.multiply(t,V,he)}else J=i.elevation.getAtPointOrZero(new ji(E.x/F,E.y/F),0);J!==0&&(t[14]+=J)}}function hf(t,e,i=!1){t.uploaded||(t.gfxTexture=new ny(e,t.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function ZI(t,e,i){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,BI.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,UI.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,VI.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?FI:NI).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,GI.members,!0)),t.segments=$r.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);const n=t.material;n.pbrMetallicRoughness.baseColorTexture&&hf(n.pbrMetallicRoughness.baseColorTexture,e),n.pbrMetallicRoughness.metallicRoughnessTexture&&hf(n.pbrMetallicRoughness.metallicRoughnessTexture,e),n.normalTexture&&hf(n.normalTexture,e),n.occlusionTexture&&hf(n.occlusionTexture,e,i),n.emissionTexture&&hf(n.emissionTexture,e)}function ly(t,e,i){if(t.meshes)for(const n of t.meshes)ZI(n,e,i);if(t.children)for(const n of t.children)ly(n,e,i)}function Dm(t){if(t.meshes)for(const e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(const e of t.children)Dm(e)}function cy(t){if(t.meshes)for(const i of t.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(const i of t.children)cy(i)}class HI{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class WI{constructor(){this.tasks={},this.taskQueue=[],Qt(["process"],this),this.invoker=new HI(this.process),this.nextId=0}add(e,i){const n=this.nextId++,a=function({type:c,isSymbolTile:d,zoom:m}){return m=m||0,c==="message"?0:c!=="maybePrepare"||d?c!=="parseTile"||d?c==="parseTile"&&d?300-m:c==="maybePrepare"&&d?400-m:500:200-m:100-m}(i);if(a===0){bt();try{e()}finally{}return null}return this.tasks[n]={fn:e,metadata:i,priority:a,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){bt();try{if(this.taskQueue=this.taskQueue.filter(n=>!!this.tasks[n]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let a=0;a<this.taskQueue.length;a++){const c=this.tasks[this.taskQueue[a]];c.priority<i&&(i=c.priority,e=a)}if(e===null)return null;const n=this.taskQueue[e];return this.taskQueue.splice(e,1),n}remove(){this.invoker.remove()}}class gb{constructor(e,i,n){this.target=e,this.parent=i,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Qt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new WI}send(e,i,n,a,c=!1,d){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=d,this.callbacks[m]=n);const g=new Set;return this.target.postMessage({id:m,type:e,hasCallback:!!n,targetMapId:a,mustQueue:c,sourceMapId:this.mapId,data:Do(i,g)},g),{cancel:()=>{n&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const i=e.data,n=i.id;if(n&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const a=this.cancelCallbacks[n];delete this.cancelCallbacks[n],a&&a.cancel()}else if(i.mustQueue||bt()){const a=this.callbacks[n],c=this.scheduler.add(()=>this.processTask(n,i),a&&a.metadata||{type:"message"});c&&(this.cancelCallbacks[n]=c)}else this.processTask(n,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const n=this.callbacks[e];delete this.callbacks[e],n&&(i.error?n(ca(i.error)):n(null,ca(i.data)))}else{const n=new Set,a=i.hasCallback?(d,m)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:d?Do(d):null,data:Do(m,n)},n)}:d=>{},c=ca(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,c,a);else if(this.parent.getWorkerSource){const d=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,d[0],c.source,c.scope)[d[1]](c,a)}else a(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Hu{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=ns();const n=this.workerPool.acquire(this.id);for(let a=0;a<n.length;a++){const c=new Hu.Actor(n[a],i,this.id);c.name=`Worker ${a}`,this.actors.push(c)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,n){tn(this.actors,(a,c)=>{a.send(e,i,c)},n=n||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}Hu.Actor=gb;var df={workerUrl:"",workerClass:null,workerParams:void 0};function XI(){return df.workerClass!=null?new df.workerClass:new self.Worker(df.workerUrl,df.workerParams)}const uy="mapboxgl_preloaded_worker_pool";class ff{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<ff.workerCount;)this.workers.push(new XI);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[uy]}numActive(){return Object.keys(this.active).length}}let pf;function Om(){return pf||(pf=new ff),pf}ff.workerCount=2;let zm,hy,uo,Wu,dy,Xu=null;function yb(){return bt()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:hy||K.DRACO_URL}function vb(){if(bt()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Wu)return Wu;const t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Wu=WebAssembly.validate(t)?K.MESHOPT_SIMD_URL:K.MESHOPT_URL,Wu}const km={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},KI={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},mf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function xb(t,e,i){const n=i.json.bufferViews.length,a=i.buffers.length;e.bufferView=n,i.json.bufferViews[n]={buffer:a,byteLength:t.byteLength},i.buffers[a]=t}const fy="KHR_draco_mesh_compression";function YI(t,e){const i=t.extensions&&t.extensions[fy];if(!i)return;const n=new uo.Decoder,a=Eb(e,i.bufferView),c=new uo.Mesh;if(!n.DecodeArrayToMesh(a,a.byteLength,c))throw new Error("Failed to decode Draco mesh");const d=e.json.accessors[t.indices],m=km[d.componentType],g=d.count*m.BYTES_PER_ELEMENT,y=uo._malloc(g);m===Uint16Array?n.GetTrianglesUInt16Array(c,g,y):n.GetTrianglesUInt32Array(c,g,y),xb(uo.memory.buffer.slice(y,y+g),d,e),uo._free(y);for(const w of Object.keys(i.attributes)){const E=n.GetAttributeByUniqueId(c,i.attributes[w]),M=e.json.accessors[t.attributes[w]],P=KI[M.componentType],D=M.count*mf[M.type]*km[M.componentType].BYTES_PER_ELEMENT,O=uo._malloc(D);n.GetAttributeDataArrayForAllPoints(c,E,uo[P],D,O),xb(uo.memory.buffer.slice(O,O+D),M,e),uo._free(O)}n.destroy(),c.destroy(),delete t.extensions[fy]}const Bm="EXT_meshopt_compression";function JI(t,e){if(!t.extensions||!t.extensions[Bm])return;const i=t.extensions[Bm],n=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),a=new Uint8Array(i.count*i.byteStride);dy.decodeGltfBuffer(a,i.count,i.byteStride,n,i.mode,i.filter),t.buffer=e.buffers.length,t.byteOffset=0,e.buffers[t.buffer]=a.buffer,delete t.extensions[Bm]}const bb=1179937895,wb=new TextDecoder("utf8");function Tb(t,e){return new URL(t,e).href}function QI(t,e,i,n){return fetch(Tb(t.uri,n)).then(a=>a.arrayBuffer()).then(a=>{e.buffers[i]=a})}function Eb(t,e){const i=t.json.bufferViews[e];return new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function eC(t,e,i,n){if(t.uri){const a=Tb(t.uri,n);return fetch(a).then(c=>c.blob()).then(c=>createImageBitmap(c)).then(c=>{e.images[i]=c})}if(t.bufferView!==void 0){const a=Eb(e,t.bufferView),c=new Blob([a],{type:t.mimeType});return createImageBitmap(c).then(d=>{e.images[i]=d})}}function Sb(t,e=0,i){const n={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===bb){const w=new Uint32Array(t,e);let E=2;const M=(w[E++]>>2)-3,P=w[E++]>>2;if(E++,n.json=JSON.parse(wb.decode(w.subarray(E,E+P))),E+=P,E<M){const D=w[E++];E++;const O=e+(E<<2);n.buffers[0]=t.slice(O,O+D)}}else n.json=JSON.parse(wb.decode(new Uint8Array(t,e)));const{buffers:a,images:c,meshes:d,extensionsUsed:m,bufferViews:g}=n.json;let y=Promise.resolve();if(a){const w=[];for(let E=0;E<a.length;E++){const M=a[E];M.uri?w.push(QI(M,n,E,i)):n.buffers[E]||(n.buffers[E]=null)}y=Promise.all(w)}return y.then(()=>{const w=[],E=m&&m.includes(fy),M=m&&m.includes(Bm);if(E&&w.push(function(){if(!uo)return zm||(zm=function(P){let D,O=null;function F(){D=new Uint8Array(O.buffer)}function V(){throw new Error("Unexpected Draco error.")}const W={a:{a:V,d:function(Q,J,oe){return D.copyWithin(Q,J,J+oe)},c:function(Q){const J=D.length,oe=Math.max(Q>>>0,Math.ceil(1.2*J)),se=Math.ceil((oe-J)/65536);try{return O.grow(se),F(),!0}catch{return!1}},b:V}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(P,W):P.then(Q=>Q.arrayBuffer()).then(Q=>WebAssembly.instantiate(Q,W))).then(Q=>{const{Rb:J,Qb:oe,P:se,T:he,X:ge,Ja:xe,La:Ae,Qa:be,Va:ze,Wa:qe,eb:De,jb:Ge,f:Pe,e:je,yb:ut,zb:Ze,Ab:Lt,Bb:St,Db:Ye,Gb:ei}=Q.instance.exports;O=je;const Ft=(()=>{let Rt=0,Je=0,Xt=0,bi=0;return ti=>{Xt&&(J(bi),J(Rt),Je+=Xt,Xt=Rt=0),Rt||(Je+=128,Rt=oe(Je));const wi=ti.length+7&-8;let ci=Rt;wi>=Je&&(Xt=wi,ci=bi=oe(wi));for(let Oi=0;Oi<ti.length;Oi++)D[ci+Oi]=ti[Oi];return ci}})();return F(),Pe(),{memory:je,_free:J,_malloc:oe,Mesh:class{constructor(){this.ptr=se()}destroy(){he(this.ptr)}},Decoder:class{constructor(){this.ptr=xe()}destroy(){Ge(this.ptr)}DecodeArrayToMesh(Rt,Je,Xt){const bi=Ft(Rt),ti=Ae(this.ptr,bi,Je,Xt.ptr);return!!ge(ti)}GetAttributeByUniqueId(Rt,Je){return{ptr:be(this.ptr,Rt.ptr,Je)}}GetTrianglesUInt16Array(Rt,Je,Xt){ze(this.ptr,Rt.ptr,Je,Xt)}GetTrianglesUInt32Array(Rt,Je,Xt){qe(this.ptr,Rt.ptr,Je,Xt)}GetAttributeDataArrayForAllPoints(Rt,Je,Xt,bi,ti){De(this.ptr,Rt.ptr,Je.ptr,Xt,bi,ti)}},DT_INT8:ut(),DT_UINT8:Ze(),DT_INT16:Lt(),DT_UINT16:St(),DT_UINT32:Ye(),DT_FLOAT32:ei()}})}(fetch(yb())),zm.then(P=>{uo=P,zm=void 0}))}()),M&&w.push(function(){if(dy)return;const P=function(D){let O;const F=WebAssembly.instantiateStreaming(D,{}).then(Q=>{O=Q.instance,O.exports.__wasm_call_ctors()}),V={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},W={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:F,supported:!0,decodeGltfBuffer(Q,J,oe,se,he,ge){(function(xe,Ae,be,ze,qe,De,Ge){const Pe=xe.exports.sbrk,je=ze+3&-4,ut=Pe(je*qe),Ze=Pe(De.length),Lt=new Uint8Array(xe.exports.memory.buffer);Lt.set(De,Ze);const St=Ae(ut,ze,qe,Ze,De.length);if(St===0&&Ge&&Ge(ut,je,qe),be.set(Lt.subarray(ut,ut+ze*qe)),Pe(ut-Pe(0)),St!==0)throw new Error(`Malformed buffer data: ${St}`)})(O,O.exports[W[he]],Q,J,oe,se,O.exports[V[ge]])}}}(fetch(vb()));return P.ready.then(()=>{dy=P})}()),c)for(let P=0;P<c.length;P++)w.push(eC(c[P],n,P,i));return(w.length?Promise.all(w):Promise.resolve()).then(()=>{if(E&&d)for(const{primitives:P}of d)for(const D of P)YI(D,n);if(M&&d&&g)for(const P of g)JI(P,n);return n})})}class Mb{constructor(e,i,n){if(this.triangleCount=i.length/3,this.min=new Ie(0,0),this.max=new Ie(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||n===0)return;const a=e.map(w=>w.x),c=e.map(w=>w.y);this.min=new Ie(Math.min(...a),Math.min(...c)),this.max=new Ie(Math.max(...a),Math.max(...c));const d=this.max.sub(this.min);d.x=Math.max(d.x,1),d.y=Math.max(d.y,1);const m=Math.max(d.x,d.y)/n;this.cellsX=Math.max(1,Math.ceil(d.x/m)),this.cellsY=Math.max(1,Math.ceil(d.y/m)),this.xScale=1/m,this.yScale=1/m;const g=[];for(let w=0;w<this.triangleCount;w++){const E=e[i[3*w+0]].sub(this.min),M=e[i[3*w+1]].sub(this.min),P=e[i[3*w+2]].sub(this.min),D=ol(Math.floor(Math.min(E.x,M.x,P.x)),this.xScale,this.cellsX),O=ol(Math.floor(Math.max(E.x,M.x,P.x)),this.xScale,this.cellsX),F=ol(Math.floor(Math.min(E.y,M.y,P.y)),this.yScale,this.cellsY),V=ol(Math.floor(Math.max(E.y,M.y,P.y)),this.yScale,this.cellsY),W=new Ie(0,0),Q=new Ie(0,0),J=new Ie(0,0),oe=new Ie(0,0);for(let se=F;se<=V;++se){W.y=Q.y=se*m,J.y=oe.y=(se+1)*m;for(let he=D;he<=O;++he)W.x=J.x=he*m,Q.x=oe.x=(he+1)*m,(lg(E,M,P,W,Q,oe)||lg(E,M,P,W,oe,J))&&g.push({cellIdx:se*this.cellsX+he,triIdx:w})}}if(g.length===0)return;g.sort((w,E)=>w.cellIdx-E.cellIdx||w.triIdx-E.triIdx);let y=0;for(;y<g.length;){const w=g[y].cellIdx,E={start:this.payload.length,len:0};for(;y<g.length&&g[y].cellIdx===w;)++E.len,this.payload.push(g[y++].triIdx);this.cells[w]=E}}query(e,i,n){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let g=0;g<this.lookup.length;g++)this.lookup[g]=0;const a=ol(e.x-this.min.x,this.xScale,this.cellsX),c=ol(i.x-this.min.x,this.xScale,this.cellsX),d=ol(e.y-this.min.y,this.yScale,this.cellsY),m=ol(i.y-this.min.y,this.yScale,this.cellsY);for(let g=d;g<=m;g++)for(let y=a;y<=c;y++){const w=this.cells[g*this.cellsX+y];if(w)for(let E=0;E<w.len;E++){const M=this.payload[w.start+E],P=Math.floor(M/8),D=1<<M%8;if(!(this.lookup[P]&D)&&(this.lookup[P]|=D,n.push(M),n.length===this.triangleCount))return}}}}function ol(t,e,i){return Math.max(0,Math.min(i-1,Math.floor(t*e)))}function Ac(t,e){const i=t.json.bufferViews[e.bufferView],n=km[e.componentType];return new n(t.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==mf[e.type]*n.BYTES_PER_ELEMENT?i.byteStride/n.BYTES_PER_ELEMENT:mf[e.type]))}function py(t,e,i,n){const a=km[e.componentType],c=function(w){switch(w){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(a),d=t.json.bufferViews[e.bufferView],m=d.byteStride?d.byteStride/a.BYTES_PER_ELEMENT:mf[e.type],g=i.float32,y=g.length/i.capacity;for(let w=0,E=0;w<e.count*m;w+=m,E+=y)for(let M=0;M<y;M++)g[E+M]=n[w+M]*c;i._trim()}function tC(t,e,i){const n=t.indices,a=t.attributes,c={};c.indexArray=new dn;const d=e.json.accessors[n],m=d.count/3;c.indexArray.reserve(m);const g=Ac(e,d);for(let M=0;M<m;M++)c.indexArray.emplaceBack(g[3*M],g[3*M+1],g[3*M+2]);c.indexArray._trim(),c.vertexArray=new da;const y=e.json.accessors[a.POSITION];c.vertexArray.reserve(y.count);const w=Ac(e,y);for(let M=0;M<y.count;M++)c.vertexArray.emplaceBack(w[3*M],w[3*M+1],w[3*M+2]);if(c.vertexArray._trim(),c.aabb=new Ur(y.min,y.max),c.centroid=function(M,P){const D=[0,0,0],O=M.length;if(O>0){for(let F=0;F<O;F++){const V=3*M[F];D[0]+=P[V],D[1]+=P[V+1],D[2]+=P[V+2]}D[0]/=O,D[1]/=O,D[2]/=O}return D}(g,w),a.COLOR_0!==void 0){const M=e.json.accessors[a.COLOR_0],P=mf[M.type],D=Ac(e,M);c.colorArray=P===3?new da:new Bo,c.colorArray.resize(M.count),py(e,M,c.colorArray,D)}if(a.NORMAL!==void 0){c.normalArray=new da;const M=e.json.accessors[a.NORMAL];c.normalArray.resize(M.count);const P=Ac(e,M);py(e,M,c.normalArray,P)}if(a.TEXCOORD_0!==void 0&&i.length>0){c.texcoordArray=new pc;const M=e.json.accessors[a.TEXCOORD_0];c.texcoordArray.resize(M.count);const P=Ac(e,M);py(e,M,c.texcoordArray,P)}if(a._FEATURE_ID_RGBA4444!==void 0){const M=e.json.accessors[a._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(c.featureData=Ac(e,M))}a._FEATURE_RGBA4444!==void 0&&(c.featureData=new Uint32Array(Ac(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer));const E=t.material;return c.material=function(M,P){const{emissiveFactor:D=[0,0,0],alphaMode:O="OPAQUE",alphaCutoff:F=.5,normalTexture:V,occlusionTexture:W,emissiveTexture:Q,doubleSided:J}=M,{baseColorFactor:oe=[1,1,1,1],metallicFactor:se=1,roughnessFactor:he=1,baseColorTexture:ge,metallicRoughnessTexture:xe}=M.pbrMetallicRoughness||{},Ae=W?P[W.index]:void 0;if(W&&W.extensions&&W.extensions.KHR_texture_transform&&Ae){const be=W.extensions.KHR_texture_transform;Ae.offsetScale=[be.offset[0],be.offset[1],be.scale[0],be.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Jr(...oe),metallicFactor:se,roughnessFactor:he,baseColorTexture:ge?P[ge.index]:void 0,metallicRoughnessTexture:xe?P[xe.index]:void 0},doubleSided:J,emissiveFactor:D,alphaMode:O,alphaCutoff:F,normalTexture:V?P[V.index]:void 0,occlusionTexture:Ae,emissionTexture:Q?P[Q.index]:void 0,defined:M.defined===void 0}}(E!==void 0?e.json.materials[E]:{defined:!1},i),c}function Ab(t,e,i){const{matrix:n,rotation:a,translation:c,scale:d,mesh:m,extras:g,children:y}=t,w={};if(w.matrix=n||o.a6.fromRotationTranslationScale([],a||[0,0,0,1],c||[0,0,0],d||[1,1,1]),m!==void 0){w.meshes=i[m];const E=w.anchor=[0,0];for(const M of w.meshes){const{min:P,max:D}=M.aabb;E[0]+=P[0]+D[0],E[1]+=P[1]+D[1]}E[0]=Math.floor(E[0]/w.meshes.length/2),E[1]=Math.floor(E[1]/w.meshes.length/2)}if(g&&(g.id&&(w.id=g.id),g.lights&&(w.lights=function(E){if(!E.length)return[];const M=function(V){const W=atob(V),Q=new Uint8Array(W.length);for(let J=0;J<W.length;J++)Q[J]=W.codePointAt(J);return Q}(E),P=[],D=M.length/24,O=new Uint16Array(M.buffer),F=new Float32Array(M.buffer);for(let V=0;V<D;V++){const W=O[2*V*6]/30,Q=O[2*V*6+1]/30,J=O[2*V*6+10]/100,oe=F[6*V+1],se=F[6*V+2],he=F[6*V+3],ge=F[6*V+4],xe=he-oe,Ae=ge-se,be=Math.hypot(xe,Ae);P.push({pos:[oe+.5*xe,se+.5*Ae,Q],normal:[Ae/be,-xe/be,0],width:be,height:W,depth:J,points:[oe,se,he,ge]})}return P}(g.lights))),y){const E=[];for(const M of y)E.push(Ab(e.json.nodes[M],e,i));w.children=E}return w}function iC(t){if(t.vertices.length===0||t.indices.length===0)return null;const[e,i]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let d=1;d<t.vertices.length;++d){const m=t.vertices[d];e.x=Math.min(e.x,m.x),e.y=Math.min(e.y,m.y),i.x=Math.max(i.x,m.x),i.y=Math.max(i.y,m.y)}const n=Math.ceil(Math.max(i.x-e.x,i.y-e.y)/256),a=Math.max(8,n),c=new Mb(t.vertices,t.indices,a);return{vertices:t.vertices,indices:t.indices,grid:c,min:e,max:i}}function rC(t){if(!t.extras||!t.extras.ground)return null;const e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const n=[];for(const d of i){if(!Array.isArray(d)||d.length!==2)continue;const m=d[0],g=d[1];typeof m=="number"&&typeof g=="number"&&n.push(new Ie(m,g))}if(n.length<3)return null;n.length>1&&n[n.length-1].equals(n[0])&&n.pop();let a=0;for(let d=0;d<n.length;d++){const m=n[d],g=n[(d+1)%n.length],y=n[(d+2)%n.length];a+=(m.x-g.x)*(y.y-g.y)-(y.x-g.x)*(m.y-g.y)}a>0&&n.reverse();const c=nm(n.flatMap(d=>[d.x,d.y]),[]);return c.length===0?null:{vertices:n,indices:c}}function nC(t){const e=[],i=[];let n=0;for(const a of t){n=e.length;const c=a.vertexArray.float32,d=a.indexArray.uint16;for(let m=0;m<a.vertexArray.length;m++)e.push(new Ie(c[3*m+0],c[3*m+1]));for(let m=0;m<3*a.indexArray.length;m++)i.push(d[m]+n)}if(i.length%3!=0)return null;for(let a=0;a<i.length;a+=3){const c=e[i[a+0]],d=e[i[a+1]],m=e[i[a+2]];(c.x-d.x)*(m.y-d.y)-(m.x-d.x)*(c.y-d.y)>0&&([i[a+1],i[a+2]]=[i[a+2],i[a+1]])}return{vertices:e,indices:i}}function Ib(t){const e=function(g,y){const w=[],E=WebGL2RenderingContext;if(g.json.textures)for(const M of g.json.textures){const P={magFilter:E.LINEAR,minFilter:E.NEAREST,wrapS:E.REPEAT,wrapT:E.REPEAT};M.sampler!==void 0&&Object.assign(P,g.json.samplers[M.sampler]),w.push({image:y[M.source],sampler:P,uploaded:!1})}return w}(t,t.images),i=function(g,y){const w=[];for(const E of g.json.meshes){const M=[];for(const P of E.primitives)M.push(tC(P,g,y));w.push(M)}return w}(t,e),{scenes:n,scene:a,nodes:c}=t.json,d=n?n[a||0].nodes:c,m=[];for(const g of d)m.push(Ab(c[g],t,i));return function(g,y,w){const E={},M=new Set;for(let P=0;P<g.length;P++){const D=w[y[P]];if(!D.extras)continue;const O=D.extras["mapbox:footprint:version"],F=D.extras["mapbox:footprint:id"];(O||F)&&M.add(P),O==="1.0.0"&&F&&(E[F]=P)}for(let P=0;P<g.length;P++){if(M.has(P))continue;const D=g[P],O=w[y[P]];if(!O.extras)continue;let F=null;D.id in E&&(F=nC(g[E[D.id]].meshes)),F||(F=rC(O)),F&&(D.footprint=iC(F))}if(M.size>0){const P=Array.from(M.values()).sort((D,O)=>D-O);for(let D=P.length-1;D>=0;D--)g.splice(P[D],1)}}(m,d,t.json.nodes),m}function sC(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);const e=t.vertexArray.float32,i=t.aabb.min[0]-1,n=t.aabb.min[1]-1,a=Mc/(t.aabb.max[0]-i+2),c=Mc/(t.aabb.max[1]-n+2);for(let d=0;d<e.length;d+=3){const m=e[d+2],g=(e[d+0]-i)*a|0,y=(e[d+1]-n)*c|0;m>t.heightmap[y*Mc+g]&&(t.heightmap[y*Mc+g]=m)}}function oC(t,e){const i={};i.indexArray=new dn,i.indexArray.reserve(4*t.length),i.vertexArray=new da,i.vertexArray.reserve(10*t.length),i.colorArray=new Bo,i.vertexArray.reserve(10*t.length);let n=0;for(const d of t){const m=Math.min(10,Math.max(4,1.3*d.height))*e,g=[-d.normal[1],d.normal[0],0],y=Math.min(.29,.1*d.width/d.depth),w=d.width-2*d.depth*e*(y+.01),E=o.N.scaleAndAdd([],d.pos,g,w/2),M=o.N.scaleAndAdd([],d.pos,g,-w/2),P=[E[0],E[1],E[2]+d.height],D=[M[0],M[1],M[2]+d.height],O=o.N.scaleAndAdd([],d.normal,g,y);o.N.scale(O,O,m);const F=o.N.scaleAndAdd([],d.normal,g,-y);o.N.scale(F,F,m),o.N.add(O,E,O),o.N.add(F,M,F),E[2]+=.1,M[2]+=.1,i.vertexArray.emplaceBack(O[0],O[1],O[2]),i.vertexArray.emplaceBack(F[0],F[1],F[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(D[0],D[1],D[2]),i.vertexArray.emplaceBack(E[0],E[1],E[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(O[0],O[1],O[2]),i.vertexArray.emplaceBack(F[0],F[1],F[2]);const V=w/m/2;i.colorArray.emplaceBack(-V-y,-1,V,.8),i.colorArray.emplaceBack(V+y,-1,V,.8),i.colorArray.emplaceBack(-V,0,V,1.3),i.colorArray.emplaceBack(V,0,V,1.3),i.colorArray.emplaceBack(V+y,-.8,V,.7),i.colorArray.emplaceBack(V+y,-.8,V,.7),i.colorArray.emplaceBack(0,0,V,1.3),i.colorArray.emplaceBack(0,0,V,1.3),i.colorArray.emplaceBack(V+y,-1.2,V,.8),i.colorArray.emplaceBack(V+y,-1.2,V,.8),i.indexArray.emplaceBack(6+n,4+n,8+n),i.indexArray.emplaceBack(7+n,9+n,5+n),i.indexArray.emplaceBack(0+n,1+n,2+n),i.indexArray.emplaceBack(1+n,3+n,2+n),n+=10}const a={defined:!0,emissiveFactor:[0,0,0]},c={};return c.baseColorFactor=Jr.white,a.pbrMetallicRoughness=c,i.material=a,i.aabb=new Ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}Ct(Mb,"TriangleGridIndex");class Cb{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const n=e[i];this._stringToNumber[n]=i,this._numberToString[i]=n}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const aC=["tile","layer","source","sourceLayer","state"];class Pb{constructor(e,i,n,a,c){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=n,this._y=a,this.properties=e.properties,this.id=c}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of aC)this[i]!==void 0&&(e[i]=this[i]);return e}}class Rb{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new to(xt,16,0),this.featureIndexArray=new kp,this.promoteId=i,this.is3DTile=!1}insert(e,i,n,a,c,d=0,m=0){const g=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,a,c,d);const y=this.grid;for(let w=0;w<i.length;w++){const E=i[w],M=[1/0,1/0,-1/0,-1/0];for(let P=0;P<E.length;P++){const D=E[P];M[0]=Math.min(M[0],D.x),M[1]=Math.min(M[1],D.y),M[2]=Math.max(M[2],D.x),M[3]=Math.max(M[3],D.y)}m!==0&&(M[0]-=m,M[1]-=m,M[2]+=m,M[3]+=m),M[0]<xt&&M[1]<xt&&M[2]>=0&&M[3]>=0&&y.insert(g,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ug(new Uu(this.rawTileData)).layers,this.sourceLayerCoder=new Cb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,n,a){this.loadVTLayers();const c=e.params||{},d=ls(c.filter),m=e.tileResult,g=e.transform,y=m.bufferedTilespaceBounds,w=this.grid.query(y.min.x,y.min.y,y.max.x,y.max.y,(D,O,F,V)=>J0(m.bufferedTilespaceGeometry,D,O,F,V));w.sort(lC);let E=null;g.elevation&&w.length>0&&(E=ku.create(g.elevation,this.tileID));const M={};let P;for(let D=0;D<w.length;D++){const O=w[D];if(O===P)continue;P=O;const F=this.featureIndexArray.get(O);let V=null;if(this.is3DTile){const W=this.bucketLayerIDs[0][0],Q=i[W];if(Q.type!=="model")continue;const{queryFeature:J,intersectionZ:oe}=Q.queryIntersectsMatchingFeature(m,F.featureIndex,d,g);J&&this.appendToResult(M,W,F.featureIndex,J,oe)}else this.loadMatchingFeature(M,F,d,c.layers,c.availableImages,i,n,a,(W,Q,J,oe=0)=>(V||(V=pn(W,this.tileID.canonical,e.tileTransform)),Q.queryIntersectsFeature(m,W,J,V,this.z,e.transform,e.pixelPosMatrix,E,oe)))}return M}loadMatchingFeature(e,i,n,a,c,d,m,g,y){const{featureIndex:w,bucketIndex:E,sourceLayerIndex:M,layoutVertexArrayOffset:P}=i,D=this.bucketLayerIDs[E];if(a&&!function(W,Q){for(let J=0;J<W.length;J++)if(Q.indexOf(W[J])>=0)return!0;return!1}(a,D))return;const O=this.sourceLayerCoder.decode(M),F=this.vtLayers[O].feature(w);if(n.needGeometry){const W=an(F,!0);if(!n.filter(new Or(this.tileID.overscaledZ),W,this.tileID.canonical))return}else if(!n.filter(new Or(this.tileID.overscaledZ),F))return;const V=this.getId(F,O);for(let W=0;W<D.length;W++){const Q=D[W];if(a&&a.indexOf(Q)<0)continue;const J=d[Q];if(!J)continue;let oe={};V!==void 0&&g&&(oe=g.getState(J.sourceLayer||"_geojsonTileLayer",V));const se=!y||y(F,J,oe,P);if(!se)continue;const he=new Pb(F,this.z,this.x,this.y,V),ge=gr({},m[Q]);ge.paint=Lb(ge.paint,J.paint,F,oe,c),ge.layout=Lb(ge.layout,J.layout,F,oe,c),he.layer=ge,this.appendToResult(e,Q,w,he,se)}}appendToResult(e,i,n,a,c){let d=e[i];d===void 0&&(d=e[i]=[]),d.push({featureIndex:n,feature:a,intersectionZ:c})}lookupSymbolFeatures(e,i,n,a,c,d,m,g){const y={};this.loadVTLayers();const w=ls(c);for(const E of e)this.loadMatchingFeature(y,{bucketIndex:n,sourceLayerIndex:a,featureIndex:E,layoutVertexArrayOffset:0},w,d,m,g,i);return y}loadFeature(e){const{featureIndex:i,sourceLayerIndex:n}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(n),c=this.vtFeatures[a];if(c[i])return c[i];const d=this.vtLayers[a].feature(i);return c[i]=d,d}hasLayer(e){for(const i of this.bucketLayerIDs)for(const n of i)if(e===n)return!0;return!1}getId(e,i){let n=e.id;if(this.promoteId){const a=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];a!=null&&(n=e.properties[a]),typeof n=="boolean"&&(n=Number(n))}return n}}function Lb(t,e,i,n,a){return Kt(t,(c,d)=>{const m=e instanceof ic?e.get(d):null;return m&&m.evaluate?m.evaluate(i,n,a):m})}function lC(t,e){return e-t}Ct(Rb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const my=new Float32Array(262144),Ic=new Uint8Array(262144);function Db(t){let e=0;if(t.meshes)for(const i of t.meshes)e=Math.max(e,i.aabb.max[2]);if(t.children)for(const i of t.children)e=Math.max(e,Db(i));return e}function Ob(t,e,i){if(t.meshes)for(const n of t.meshes)n.aabb.min[0]!==1/0&&i.insert(e,n.aabb.min[0],n.aabb.min[1],n.aabb.max[0],n.aabb.max[1]);if(t.children)for(const n of t.children)Ob(n,e,i)}const zb=["","wall","door","roof","window","lamp","logo"];class kb{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Db(e)}}}getLocalBounds(){if(!this.node.meshes)return new Ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const n of this.node.meshes)this.node.lightMeshIndex!==e&&i.encapsulate(n.aabb),e++;this.aabb=i}return this.aabb}}class Fm{constructor(e,i,n,a,c,d){this.id=i,this.modelTraits|=Zu.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,n&&(this.modelTraits|=Zu.HasMapboxMeshFeatures),a&&(this.modelTraits|=Zu.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=c,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const m of e)this.nodesInfo.push(new kb(m)),Ob(m,d.featureIndexArray.length,d.grid),d.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,d.bucketLayerIDs.length-1,0)}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const n of i){const a=n.node;this.uploaded?this.updatePbrBuffer(a):ly(a,e,!0)}for(const n of i)Dm(n.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const n of e.meshes)n.pbrBuffer&&(n.pbrBuffer.updateData(n.featureArray),i=!0);return i}needsReEvaluation(e,i,n){const a=e.transform.projectionOptions,c=e.style.getBrightness(),d=this.brightness!==c;return!!(!this.uploaded||this.dirty||a.name!==this.projection.name||_f(n.paint.get("model-color").value,d)||_f(n.paint.get("model-color-mix-intensity").value,d)||_f(n.paint.get("model-roughness").value,d)||_f(n.paint.get("model-emissive-strength").value,d)||_f(n.paint.get("model-height-based-emissive-strength-multiplier").value,d))&&(this.projection=a,this.brightness=c,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const n=this.getNodesInfo(),a=this.id.canonical;for(const c of n){const d=c.feature;c.evaluatedScale=i.paint.get("model-scale").evaluate(d,{},a)}}evaluate(e){const i=this.getNodesInfo();for(const n of i){if(!n.node.meshes)continue;const a=n.feature,c=n.node.meshes&&n.node.meshes[0].featureData,d=n.evaluatedColor[2],m=n.evaluatedRMEA[2],g=this.id.canonical;if(n.hasTranslucentParts=!1,c){for(let y=0;y<zb.length;y++){const w=zb[y];w.length&&(a.properties.part=w);const E=e.paint.get("model-color").evaluate(a,{},g),M=e.paint.get("model-color-mix-intensity").evaluate(a,{},g);n.evaluatedColor[y]=[E.r,E.g,E.b,M],n.evaluatedRMEA[y][0]=e.paint.get("model-roughness").evaluate(a,{},g),n.evaluatedRMEA[y][2]=e.paint.get("model-emissive-strength").evaluate(a,{},g),n.evaluatedRMEA[y][3]=E.a,n.emissionHeightBasedParams[y]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(a,{},g),!n.hasTranslucentParts&&E.a<1&&(n.hasTranslucentParts=!0)}delete a.properties.part,uC(n,d!==n.evaluatedColor[2]||m!==n.evaluatedRMEA[2],this.modelTraits)}else n.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(a,{},g);n.evaluatedScale=e.paint.get("model-scale").evaluate(a,{},g),this.updatePbrBuffer(n.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,n,a){const c=e.findDEMTileFor(n);if(c&&(c.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(c.dem&&c.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=c.tileID.overscaledZ;const d=ku.create(e,n,c);if(!d)return;this.modelTraits&Zu.HasMapboxMeshFeatures&&this.updateDEM(e,d,n,a);for(const m of this.getNodesInfo()){const g=m.node;if(!g.footprint||!g.footprint.vertices||!g.footprint.vertices.length)continue;const y=g.footprint.vertices;let w=d.getElevationAt(y[0].x,y[0].y,!0,!0);for(let E=1;E<y.length;E++)w=Math.min(w,d.getElevationAt(y[E].x,y[E].y,!0,!0));g.elevation=w}}this.terrainTile=c.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,n,a){let c=i._dem._modifiedForSources[a];if(c===void 0&&(i._dem._modifiedForSources[a]=[],c=i._dem._modifiedForSources[a]),c.includes(n.canonical))return;const d=i._dem.dim;c.push(n.canonical);let m=!1;for(const g of this.getNodesInfo()){const y=g.node;if(!y.footprint||!y.footprint.grid)continue;const w=y.footprint.grid,E=i.tileCoordToPixel(w.min.x,w.min.y),M=i.tileCoordToPixel(w.max.x,w.max.y),P=Math.min(Math.min(d-M.y,E.x),Math.min(E.y,d-M.x));if(P<0)continue;const D=Nt(P,2,5);let O=Math.max(0,E.x-D),F=Math.max(0,E.y-D),V=Math.min(M.x+D,d-1),W=Math.min(M.y+D,d-1);for(let se=F;se<=W;++se)for(let he=O;he<=V;++he)Ic[se*d+he]=255;let Q=0,J=0;for(let se=0;se<w.cellsY;++se)for(let he=0;he<w.cellsX;++he){if(!w.cells[se*w.cellsX+he])continue;const ge=i.tileCoordToPixel(w.min.x+he/w.xScale,w.min.y+se/w.yScale),xe=i.tileCoordToPixel(w.min.x+(he+1)/w.xScale,w.min.y+(se+1)/w.yScale);for(let Ae=ge.y;Ae<=Math.min(xe.y+1,d-1);++Ae)for(let be=ge.x;be<=Math.min(xe.x+1,d-1);++be)Ic[Ae*d+be]===255&&(Ic[Ae*d+be]=0,Q+=i.getElevationAtPixel(be,Ae),J++)}const oe=Q/J;O=Math.max(1,E.x-D),F=Math.max(1,E.y-D),V=Math.min(M.x+D,d-2),W=Math.min(M.y+D,d-2),m=!0;for(let se=F;se<=W;++se)for(let he=O;he<=V;++he)Ic[se*d+he]===0&&(my[se*d+he]=i._dem.set(he,se,oe));for(let se=1;se<D;++se){O=Math.max(1,E.x-se),F=Math.max(1,E.y-se),V=Math.min(M.x+se,d-2),W=Math.min(M.y+se,d-2);for(let he=F;he<=W;++he)for(let ge=O;ge<=V;++ge){const xe=he*d+ge;if(Ic[xe]===255){let Ae=0,be=0,ze=-1,qe=-1;for(let De=-1;De<=1;++De)for(let Ge=-1;Ge<=1;++Ge){const Pe=(he+De)*d+ge+Ge;if(Ic[Pe]>=se)continue;const je=my[Pe],ut=Math.abs(je);ut>be&&(Ae=je,be=ut,ze=Ge,qe=De)}if(be>.1){const De=1-(se+.5*Math.abs(ze*qe))/D;let Ge=i._dem.get(ge,he)+Ae*De;const Pe=i._dem.get(ge+ze,he+qe),je=i._dem.get(ge-ze,he-qe,!0);(Ge-Pe)*(Ge-je)>0&&(Ge=(Pe+je)/2),my[xe]=i._dem.set(ge,he,Ge),Ic[xe]=se}}}}}m&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Qe.now())}getNodesInfo(){return this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)Dm(i.node),cy(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const n=i.getReplacementRegionsForTile(e.toUnwrapped()),a=this.getNodesInfo();for(let c=0;c<this.nodesInfo.length;c++){const d=a[c].node;a[c].hiddenByReplacement=!!d.footprint&&!n.find(m=>m.footprint===d.footprint)}}getHeightAtTileCoord(e,i){const n=this.getNodesInfo(),a=[];for(let c=0;c<this.nodesInfo.length;c++){const d=n[c],m=d.node.meshes[0];if(e<m.aabb.min[0]||i<m.aabb.min[1]||e>m.aabb.max[0]||i>m.aabb.max[1])continue;const g=(e-m.aabb.min[0])/(m.aabb.max[0]-m.aabb.min[0])*Mc|0,y=Math.min(63,(i-m.aabb.min[1])/(m.aabb.max[1]-m.aabb.min[1])*Mc|0)*Mc+Math.min(63,g);if(!(m.heightmap[y]<0&&d.node.footprint))return d.hiddenByReplacement?void 0:{height:m.heightmap[y],maxHeight:d.feature.properties.height,hidden:!1,verticalScale:d.evaluatedScale[2]};if(d.node.footprint.grid.query(new Ie(e,i),new Ie(e,i),a),a.length>0)return{height:void 0,maxHeight:d.feature.properties.height,hidden:d.hiddenByReplacement,verticalScale:d.evaluatedScale[2]}}}}function _f(t,e){return!t.isLightConstant&&e}function cC(t,e,i,n,a,c,d,m){let g=(61440&e|(61440&e)>>4)>>8,y=(3840&e|(3840&e)>>4)>>4,w=240&e|(240&e)>>4;i[3]>0&&(g=Di(g,255*i[0],i[3]),y=Di(y,255*i[1],i[3]),w=Di(w,255*i[2],i[3]));const E=g<<8|y,M=w<<8|Math.floor(255*n[3]),P=function(se){const he=Nt(se,0,2);return Math.min(Math.round(.5*he*255),255)}(n[2])<<8|15*n[0]<<4|15*n[1],D=Nt(a[0],0,1),O=Nt(a[1],0,1),F=Nt(a[2],0,1),V=Nt(a[3],0,1);let W,Q,J,oe;if(D!==O&&d!==c&&O!==D){const se=d-c;Q=1/(se*(O-D)),J=-(c+se*D)/(se*(O-D));const he=Nt(a[4],-1,1);oe=Math.pow(10,he),W=255*F<<8|255*V}else W=65535,Q=0,J=1,oe=1;if(t.emplaceBack(E,M,P,W,Q,J,oe),m){const se=m.length;m.clear();for(let he=0;he<se;he++)m.emplaceBack(E,M,P,W,Q,J,oe)}}function uC(t,e,i){const n=t.node;let a=0;const c=i&Zu.HasMeshoptCompression;for(const d of n.meshes){if(n.lights&&n.lightMeshIndex===a||!d.featureData)continue;d.featureArray=new mc,d.featureArray.reserve(d.featureData.length);let m=e;for(const g of d.featureData){const y=c?65535&g:g>>16&65535,w=c?g>>16&65535:65535&g,E=(15&w)<8?15&w:0,M=t.evaluatedRMEA[E],P=t.evaluatedColor[E],D=t.emissionHeightBasedParams[E];let O;if(m&&E===2&&n.lights&&(O=new mc,O.resize(10*n.lights.length)),cC(d.featureArray,y,P,M,D,d.aabb.min[2],d.aabb.max[2],O),O&&m){m=!1;const F=n.meshes[n.lightMeshIndex];F.featureArray=O,F.featureArray._trim()}}d.featureArray._trim(),a++}}function Bb(t,e,i,n){const a=1<<t.z;e.lat=ki((n/xt+t.y)/a),e.lng=ui((i/xt+t.x)/a)}Ct(Fm,"Tiled3dModelBucket",{omit:["layers"]}),Ct(kb,"Tiled3dModelFeature");const hC={circle:class extends Kn{constructor(t,e,i){super(t,rM,e,i)}createBucket(t){return new Qn(t)}queryRadius(t){const e=t;return Du("circle-radius",this,e)+Du("circle-stroke-width",this,e)+qp(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,n,a,c,d,m){const g=ev(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),y=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Ax(t,n,c,d,m,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",g,y)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){const i=Mx(this);return{config:new B(this,e),defines:i,overrideFog:!1}}},heatmap:class extends Kn{createBucket(t){return new Cx(t)}constructor(t,e,i){super(t,OM,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Wd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Du("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,n,a,c,d,m){const g=this.paint.get("heatmap-radius").evaluate(e,i);return Ax(t,n,c,d,m,!0,!0,new Ie(0,0),g)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new B(this,e),overrideFog:!1}:{}}},hillshade:class extends Kn{constructor(t,e,i){super(t,kM,e,i)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends Kn{constructor(t,e,i){super(t,KM,e,i)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(t,e){return{config:new B(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Vg(t)}queryRadius(){return qp(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,n,a,c){return!t.queryGeometry.isAboveHorizon&&fa(Q0(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),n)}isTileClipped(){return!0}},"fill-extrusion":class extends Kn{constructor(t,e,i){super(t,EA,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new hm(t)}queryRadius(){return qp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,i,n,a,c,d,m,g){const y=ev(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),w=this.paint.get("fill-extrusion-height").evaluate(e,i),E=this.paint.get("fill-extrusion-base").evaluate(e,i),M=[0,0],P=m&&c.elevation,D=c.elevation?c.elevation.exaggeration():1,O=t.tile.getBucket(this);if(P&&O instanceof hm){const J=O.centroidVertexArray,oe=g+1;oe<J.length&&(M[0]=J.geta_centroid_pos0(oe),M[1]=J.geta_centroid_pos1(oe))}if(M[0]===0&&M[1]===1)return!1;c.projection.name==="globe"&&(n=u1([n],[new Ie(0,0),new Ie(xt,xt)],t.tileID.canonical).map(J=>J.polygon).flat());const F=P?m:null,[V,W]=function(J,oe,se,he,ge,xe,Ae,be,ze,qe,De){return J.projection.name==="globe"?function(Ge,Pe,je,ut,Ze,Lt,St,Ye,ei,Ft,Rt){const Je=[],Xt=[],bi=Ge.projection.upVectorScale(Rt,Ge.center.lat,Ge.worldSize).metersToTile,ti=[0,0,0,1],wi=[0,0,0,1],ci=(fi,fr,$i,Hi)=>{fi[0]=fr,fi[1]=$i,fi[2]=Hi,fi[3]=1},Oi=c1();je>0&&(je+=Oi),ut+=Oi;for(const fi of Pe){const fr=[],$i=[];for(const Hi of fi){const tr=Hi.x+Ze.x,qi=Hi.y+Ze.y,Lr=Ge.projection.projectTilePoint(tr,qi,Rt),ar=Ge.projection.upVector(Rt,Hi.x,Hi.y);let qr=je,un=ut;if(St){const In=d1(tr,qi,je,ut,St,Ye,ei,Ft);qr+=In.base,un+=In.top}je!==0?ci(ti,Lr.x+ar[0]*bi*qr,Lr.y+ar[1]*bi*qr,Lr.z+ar[2]*bi*qr):ci(ti,Lr.x,Lr.y,Lr.z),ci(wi,Lr.x+ar[0]*bi*un,Lr.y+ar[1]*bi*un,Lr.z+ar[2]*bi*un),o.N.transformMat4(ti,ti,Lt),o.N.transformMat4(wi,wi,Lt),fr.push(new Bu(ti[0],ti[1],ti[2])),$i.push(new Bu(wi[0],wi[1],wi[2]))}Je.push(fr),Xt.push($i)}return[Je,Xt]}(J,oe,se,he,ge,xe,Ae,be,ze,qe,De):Ae?function(Ge,Pe,je,ut,Ze,Lt,St,Ye,ei){const Ft=[],Rt=[],Je=[0,0,0,1];for(const Xt of Ge){const bi=[],ti=[];for(const wi of Xt){const ci=wi.x+ut.x,Oi=wi.y+ut.y,fi=d1(ci,Oi,Pe,je,Lt,St,Ye,ei);Je[0]=ci,Je[1]=Oi,Je[2]=fi.base,Je[3]=1,o.a7.transformMat4(Je,Je,Ze),Je[3]=Math.max(Je[3],1e-5);const fr=new Bu(Je[0]/Je[3],Je[1]/Je[3],Je[2]/Je[3]);Je[0]=ci,Je[1]=Oi,Je[2]=fi.top,Je[3]=1,o.a7.transformMat4(Je,Je,Ze),Je[3]=Math.max(Je[3],1e-5);const $i=new Bu(Je[0]/Je[3],Je[1]/Je[3],Je[2]/Je[3]);bi.push(fr),ti.push($i)}Ft.push(bi),Rt.push(ti)}return[Ft,Rt]}(oe,se,he,ge,xe,Ae,be,ze,qe):function(Ge,Pe,je,ut,Ze){const Lt=[],St=[],Ye=Ze[8]*Pe,ei=Ze[9]*Pe,Ft=Ze[10]*Pe,Rt=Ze[11]*Pe,Je=Ze[8]*je,Xt=Ze[9]*je,bi=Ze[10]*je,ti=Ze[11]*je;for(const wi of Ge){const ci=[],Oi=[];for(const fi of wi){const fr=fi.x+ut.x,$i=fi.y+ut.y,Hi=Ze[0]*fr+Ze[4]*$i+Ze[12],tr=Ze[1]*fr+Ze[5]*$i+Ze[13],qi=Ze[2]*fr+Ze[6]*$i+Ze[14],Lr=Ze[3]*fr+Ze[7]*$i+Ze[15],ar=Hi+Ye,qr=tr+ei,un=qi+Ft,In=Math.max(Lr+Rt,1e-5),Ir=Hi+Je,Fr=tr+Xt,vn=qi+bi,xn=Math.max(Lr+ti,1e-5);ci.push(new Bu(ar/In,qr/In,un/In)),Oi.push(new Bu(Ir/xn,Fr/xn,vn/xn))}Lt.push(ci),St.push(Oi)}return[Lt,St]}(oe,se,he,ge,xe)}(c,n,E,w,y,d,F,M,D,c.center.lat,t.tileID.canonical),Q=t.queryGeometry;return function(J,oe,se){let he=1/0;fa(se,oe)&&(he=h1(se,oe[0]));for(let ge=0;ge<oe.length;ge++){const xe=oe[ge],Ae=J[ge];for(let be=0;be<xe.length-1;be++){const ze=xe[be],qe=[ze,xe[be+1],Ae[be+1],Ae[be],ze];qs(se,qe)&&(he=Math.min(he,h1(se,qe)))}}return he!==1/0&&he}(V,W,Q.isPointQuery()?Q.screenBounds:Q.screenGeometry)}},line:class extends Kn{constructor(t,e,i){super(t,p1,e,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Hl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=x1.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Gg(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){const i=y1(this);return{config:new B(this,e),defines:i,overrideFog:!1}}queryRadius(t){const e=t,i=b1(Du("line-width",this,e),Du("line-gap-width",this,e)),n=Du("line-offset",this,e);return i/2+Math.abs(n)+qp(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,n,a,c){if(t.queryGeometry.isAboveHorizon)return!1;const d=Q0(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),c.angle,t.pixelToTileUnitsFactor),m=t.pixelToTileUnitsFactor/2*b1(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),g=this.paint.get("line-offset").evaluate(e,i);return g&&(n=function(y,w){const E=[],M=new Ie(0,0);for(let P=0;P<y.length;P++){const D=y[P],O=[];for(let F=0;F<D.length;F++){const V=D[F],W=D[F+1],Q=F===0?M:V.sub(D[F-1])._unit()._perp(),J=F===D.length-1?M:W.sub(V)._unit()._perp(),oe=Q._add(J)._unit();oe._mult(1/(oe.x*J.x+oe.y*J.y)),O.push(oe._mult(w)._add(V))}E.push(O)}return E}(n,g*t.pixelToTileUnitsFactor)),function(y,w,E){for(let M=0;M<w.length;M++){const P=w[M];if(y.length>=3){for(let D=0;D<P.length;D++)if(so(y,P[D]))return!0}if(xc(y,P,E))return!0}return!1}(d,n,m)}isTileClipped(){return!0}},symbol:Am,background:class extends Kn{constructor(t,e,i){super(t,AI,e,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:ob,"raster-particle":ab,sky:class extends Kn{constructor(t,e,i){super(t,zI,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Wd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const n=this.paint.get("sky-atmosphere-sun"),a=!n,c=t.style.light,d=c.properties.get("position");return a&&c.properties.get("anchor")==="viewport"&&_e("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?sy(d.azimuthal,90-d.polar,e):sy(n[0],90-n[1],e)}const i=this.paint.get("sky-gradient-center");return sy(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends Kn{constructor(t,e,i){super(t,kI,e)}},model:class extends Kn{constructor(t,e,i){super(t,qI,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new ay(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(t){return t instanceof Fm?xt-1:0}queryIntersectsFeature(t,e,i,n,a,c){if(!this.modelManager)return!1;const d=this.modelManager,m=t.tile.getBucket(this);if(!(m&&m instanceof ay))return!1;const g=m;for(const y in g.instancesPerModel){const w=g.instancesPerModel[y];if(w.idToFeaturesIndex.hasOwnProperty(e.id)){const E=w.features[w.idToFeaturesIndex[e.id]],M=d.getModel(y,this.scope);if(!M)return!1;let P=o.a6.create();const D=new ve(0,0),O=g.canonical;let F=Number.MAX_VALUE;for(let V=0;V<E.instancedDataCount;++V){const W=16*(E.instancedDataOffset+V),Q=w.instancedDataArray.float32,J=[Q[W+4],Q[W+5],Q[W+6]];Bb(O,D,Q[W],0|Q[W+1]),_b(P,M,c,D,E.rotation,E.scale,J,!1,!1,!1),c.projection.name==="globe"&&(P=oy(P,c));const oe=o.a6.multiply([],c.projMatrix,P),se=t.queryGeometry,he=fb(se.isPointQuery()?se.screenBounds:se.screenGeometry,c,oe,M.aabb);he!=null&&(F=Math.min(he,F))}return F!==Number.MAX_VALUE&&F}}return!1}_handleOverridablePaintPropertyUpdate(t,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){const e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Jl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}queryIntersectsMatchingFeature(t,e,i,n){const a=t.tile,c=a.getBucket(this);let d=null,m=Number.MAX_VALUE;if(!(c&&c instanceof Fm))return{queryFeature:d,intersectionZ:m};const g=c.getNodesInfo()[e];if(g.hiddenByReplacement||!g.node.meshes||!i.filter(new Or(a.tileID.overscaledZ),g.feature,a.tileID.canonical))return{queryFeature:d,intersectionZ:m};const y=g.node,w=n.calculatePosMatrix(a.tileID.toUnwrapped(),n.worldSize),E=g.evaluatedScale;let M=0;n.elevation&&y.elevation&&(M=y.elevation*n.elevation.exaggeration()),o.a6.translate(w,w,[(y.anchor?y.anchor[0]:0)*(E[0]-1),(y.anchor?y.anchor[1]:0)*(E[1]-1),M]),o.a6.scale(w,w,E),o.a6.multiply(w,w,y.matrix);const P=t.queryGeometry,D=P.isPointQuery()?P.screenBounds:P.screenGeometry,O=function(V){const W=o.a6.multiply([],w,V.matrix),Q=o.a6.multiply(W,n.expandedFarZProjMatrix,W);for(let J=0;J<V.meshes.length;++J){const oe=V.meshes[J];if(J===V.lightMeshIndex)continue;const se=fb(D,n,Q,oe.aabb);se!=null&&(m=Math.min(se,m))}if(V.children)for(const J of V.children)O(J)};if(O(y),m===Number.MAX_VALUE)return{queryFeature:d,intersectionZ:m};const F=new ve(0,0);return Bb(a.tileID.canonical,F,g.node.anchor[0],g.node.anchor[1]),d={type:"Feature",geometry:{type:"Point",coordinates:[F.lng,F.lat]},properties:g.feature.properties,id:g.feature.id,state:{},layer:this.serialize()},{queryFeature:d,intersectionZ:m}}}},mi={read:function(t,e){return t.readFields(mi._readField,{header_length:0,x:0,y:0,z:0,layers:[]},e)},_readField:function(t,e,i){t===1?e.header_length=i.readFixed32():t===2?e.x=i.readVarint():t===3?e.y=i.readVarint():t===4?e.z=i.readVarint():t===5&&e.layers.push(mi.Layer.read(i,i.readVarint()+i.pos))},PixelFormat:{PIXEL_FORMAT_UNKNOWN:{value:0,options:{}},PIXEL_FORMAT_UINT32:{value:1,options:{}},PIXEL_FORMAT_UINT16:{value:2,options:{}},PIXEL_FORMAT_UINT8:{value:3,options:{}}},Filter:{}};mi.Filter.read=function(t,e){return t.readFields(mi.Filter._readField,{delta_filter:null,filter:null,zigzag_filter:null,bitshuffle_filter:null,byteshuffle_filter:null},e)},mi.Filter._readField=function(t,e,i){t===1?(e.delta_filter=mi.Filter.Delta.read(i,i.readVarint()+i.pos),e.filter="delta_filter"):t===2?(e.zigzag_filter=mi.Filter.Zigzag.read(i,i.readVarint()+i.pos),e.filter="zigzag_filter"):t===3?(e.bitshuffle_filter=mi.Filter.BitShuffle.read(i,i.readVarint()+i.pos),e.filter="bitshuffle_filter"):t===4&&(e.byteshuffle_filter=mi.Filter.ByteShuffle.read(i,i.readVarint()+i.pos),e.filter="byteshuffle_filter")},mi.Filter.Delta={},mi.Filter.Delta.read=function(t,e){return t.readFields(mi.Filter.Delta._readField,{block_size:0},e)},mi.Filter.Delta._readField=function(t,e,i){t===1&&(e.block_size=i.readVarint())},mi.Filter.Zigzag={},mi.Filter.Zigzag.read=function(t,e){return t.readFields(mi.Filter.Zigzag._readField,{},e)},mi.Filter.Zigzag._readField=function(t,e,i){},mi.Filter.BitShuffle={},mi.Filter.BitShuffle.read=function(t,e){return t.readFields(mi.Filter.BitShuffle._readField,{},e)},mi.Filter.BitShuffle._readField=function(t,e,i){},mi.Filter.ByteShuffle={},mi.Filter.ByteShuffle.read=function(t,e){return t.readFields(mi.Filter.ByteShuffle._readField,{},e)},mi.Filter.ByteShuffle._readField=function(t,e,i){},mi.Codec={},mi.Codec.read=function(t,e){return t.readFields(mi.Codec._readField,{gzip_data:null,codec:null,jpeg_image:null,webp_image:null,png_image:null},e)},mi.Codec._readField=function(t,e,i){t===1?(e.gzip_data=mi.Codec.GzipData.read(i,i.readVarint()+i.pos),e.codec="gzip_data"):t===2?(e.jpeg_image=mi.Codec.JpegImage.read(i,i.readVarint()+i.pos),e.codec="jpeg_image"):t===3?(e.webp_image=mi.Codec.WebpImage.read(i,i.readVarint()+i.pos),e.codec="webp_image"):t===4&&(e.png_image=mi.Codec.PngImage.read(i,i.readVarint()+i.pos),e.codec="png_image")},mi.Codec.GzipData={},mi.Codec.GzipData.read=function(t,e){return t.readFields(mi.Codec.GzipData._readField,{},e)},mi.Codec.GzipData._readField=function(t,e,i){},mi.Codec.JpegImage={},mi.Codec.JpegImage.read=function(t,e){return t.readFields(mi.Codec.JpegImage._readField,{},e)},mi.Codec.JpegImage._readField=function(t,e,i){},mi.Codec.WebpImage={},mi.Codec.WebpImage.read=function(t,e){return t.readFields(mi.Codec.WebpImage._readField,{},e)},mi.Codec.WebpImage._readField=function(t,e,i){},mi.Codec.PngImage={},mi.Codec.PngImage.read=function(t,e){return t.readFields(mi.Codec.PngImage._readField,{},e)},mi.Codec.PngImage._readField=function(t,e,i){},mi.DataIndexEntry={},mi.DataIndexEntry.read=function(t,e){return t.readFields(mi.DataIndexEntry._readField,{first_byte:0,last_byte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},e)},mi.DataIndexEntry._readField=function(t,e,i){t===1?e.first_byte=i.readFixed64():t===2?e.last_byte=i.readFixed64():t===3?e.filters.push(mi.Filter.read(i,i.readVarint()+i.pos)):t===4?e.codec=mi.Codec.read(i,i.readVarint()+i.pos):t===5?e.offset=i.readFloat():t===6?e.scale=i.readFloat():t===7&&e.bands.push(i.readString())},mi.Layer={},mi.Layer.read=function(t,e){return t.readFields(mi.Layer._readField,{version:0,name:"",units:"",tilesize:0,buffer:0,pixel_format:0,data_index:[]},e)},mi.Layer._readField=function(t,e,i){t===1?e.version=i.readVarint():t===2?e.name=i.readString():t===3?e.units=i.readString():t===4?e.tilesize=i.readVarint():t===5?e.buffer=i.readVarint():t===6?e.pixel_format=i.readVarint():t===7&&e.data_index.push(mi.DataIndexEntry.read(i,i.readVarint()+i.pos))};const ho={read:function(t,e){return t.readFields(ho._readField,{uint32_values:null,values:null,fixed32_values:null},e)},_readField:function(t,e,i){t===2?(e.uint32_values=ho.Uint32Values.read(i,i.readVarint()+i.pos),e.values="uint32_values"):t===3&&(e.fixed32_values=ho.Fixed32Values.read(i,i.readVarint()+i.pos),e.values="fixed32_values")},Uint32Values:{}};ho.Uint32Values.read=function(t,e){return t.readFields(ho.Uint32Values._readField,{values:[]},e)},ho.Uint32Values._readField=function(t,e,i){t===1&&(e.readValuesInto=function(n){if(n.type!==2)throw new Error(`Unsupported pbf type "${n.type}"`);const a=function(d){return d.type===2?d.readVarint()+d.pos:d.pos+1}(n),c=n.pos;return n.pos=a,function(d){n.pos=c;let m=0;for(;n.pos<a;){const g=n.readVarint();d[m++]=g}return d}}(i))},ho.Fixed32Values={},ho.Fixed32Values.read=function(t,e){return t.readFields(ho.Fixed32Values._readField,{values:[]},e)},ho.Fixed32Values._readField=function(t,e,i){throw new Error("Not implemented")};/**
- * tiny-lru
- *
- * @copyright 2023 Jason Mulligan <jason.mulligan@avoidwork.com>
- * @license BSD-3-Clause
- * @version 11.2.5
- */class dC{constructor(e=0,i=0,n=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=e,this.resetTtl=n,this.size=0,this.ttl=i}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(e){if(this.has(e)){const i=this.items[e];delete this.items[e],this.size--,i.prev!==null&&(i.prev.next=i.next),i.next!==null&&(i.next.prev=i.prev),this.first===i&&(this.first=i.next),this.last===i&&(this.last=i.prev)}return this}entries(e=this.keys()){return e.map(i=>[i,this.get(i)])}evict(e=!1){if(e||this.size>0){const i=this.first;delete this.items[i.key],--this.size==0?(this.first=null,this.last=null):(this.first=i.next,this.first.prev=null)}return this}expiresAt(e){let i;return this.has(e)&&(i=this.items[e].expiry),i}get(e){let i;if(this.has(e)){const n=this.items[e];this.ttl>0&&n.expiry<=Date.now()?this.delete(e):(i=n.value,this.set(e,i,!0))}return i}has(e){return e in this.items}keys(){const e=[];let i=this.first;for(;i!==null;)e.push(i.key),i=i.next;return e}set(e,i,n=!1,a=this.resetTtl){let c;if(n||this.has(e)){if(c=this.items[e],c.value=i,n===!1&&a&&(c.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.last!==c){const d=this.last,m=c.next,g=c.prev;this.first===c&&(this.first=c.next),c.next=null,c.prev=this.last,d.next=c,g!==null&&(g.next=m),m!==null&&(m.prev=g)}}else this.max>0&&this.size===this.max&&this.evict(!0),c=this.items[e]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:e,prev:this.last,next:null,value:i},++this.size==1?this.first=c:this.last.next=c;return this.last=c,this}values(e=this.keys()){return e.map(i=>this.get(i))}}function fC(t,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let n=2;n>=1;n--){const a=n===1?1:0,c=n===2?1:0;for(let d=0;d<e[0];d++){const m=e[1]*d;for(let g=a;g<e[1];g++){const y=e[2]*(g+m);for(let w=c;w<e[2];w++){const E=e[3]*(w+y);for(let M=0;M<e[3];M++){const P=E+M;t[P]+=t[P-i]}}}}i*=e[n]}return t}function pC(t){for(let e=0,i=t.length;e<i;e++)t[e]=t[e]>>>1^-(1&t[e]);return t}function mC(t,e){switch(e){case"uint32":return t;case"uint16":for(let i=0;i<t.length;i+=2){const n=t[i],a=t[i+1];t[i]=(240&n)>>4|(61440&n)>>8|(240&a)<<4|61440&a,t[i+1]=15&n|(3840&n)>>4|(15&a)<<8|(3840&a)<<4}return t;case"uint8":for(let i=0;i<t.length;i+=4){const n=t[i],a=t[i+1],c=t[i+2],d=t[i+3];t[i+0]=(192&n)>>6|(192&a)>>4|(192&c)>>2|192&d,t[i+1]=(48&n)>>4|(48&a)>>2|48&c|(48&d)<<2,t[i+2]=(12&n)>>2|12&a|(12&c)<<2|(12&d)<<4,t[i+3]=3&n|(3&a)<<2|(3&c)<<4|(3&d)<<6}return t;default:throw new Error(`Invalid pixel format, "${e}"`)}}class al extends Error{constructor(e){super(e),this.name="MRTError"}}var zs=Uint8Array,Ku=Uint16Array,_C=Int32Array,Fb=new zs([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Nb=new zs([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gC=new zs([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Vb=function(t,e){for(var i=new Ku(31),n=0;n<31;++n)i[n]=e+=1<<t[n-1];var a=new _C(i[30]);for(n=1;n<30;++n)for(var c=i[n];c<i[n+1];++c)a[c]=c-i[n]<<5|n;return{b:i,r:a}},Ub=Vb(Fb,2),jb=Ub.b,yC=Ub.r;jb[28]=258,yC[258]=28;for(var vC=Vb(Nb,0).b,_y=new Ku(32768),Qr=0;Qr<32768;++Qr){var Yu=(43690&Qr)>>1|(21845&Qr)<<1;_y[Qr]=((65280&(Yu=(61680&(Yu=(52428&Yu)>>2|(13107&Yu)<<2))>>4|(3855&Yu)<<4))>>8|(255&Yu)<<8)>>1}var gf=function(t,e,i){for(var n=t.length,a=0,c=new Ku(e);a<n;++a)t[a]&&++c[t[a]-1];var d,m=new Ku(e);for(a=1;a<e;++a)m[a]=m[a-1]+c[a-1]<<1;if(i){d=new Ku(1<<e);var g=15-e;for(a=0;a<n;++a)if(t[a])for(var y=a<<4|t[a],w=e-t[a],E=m[t[a]-1]++<<w,M=E|(1<<w)-1;E<=M;++E)d[_y[E]>>g]=y}else for(d=new Ku(n),a=0;a<n;++a)t[a]&&(d[a]=_y[m[t[a]-1]++]>>15-t[a]);return d},yf=new zs(288);for(Qr=0;Qr<144;++Qr)yf[Qr]=8;for(Qr=144;Qr<256;++Qr)yf[Qr]=9;for(Qr=256;Qr<280;++Qr)yf[Qr]=7;for(Qr=280;Qr<288;++Qr)yf[Qr]=8;var Gb=new zs(32);for(Qr=0;Qr<32;++Qr)Gb[Qr]=5;var xC=gf(yf,9,1),bC=gf(Gb,5,1),gy=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},fo=function(t,e,i){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(7&e)&i},yy=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},wC=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],po=function(t,e,i){var n=new Error(e||wC[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,po),!i)throw n;return n},TC=new zs(0),EC=typeof TextDecoder<"u"&&new TextDecoder;try{EC.decode(TC,{stream:!0})}catch{}const SC={gzip_data:"gzip"},MC={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},AC={uint32:1,uint16:2,uint8:4},IC={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};class $b{constructor(e=1){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){return this.layers[e]}getHeaderLength(e){const i=new Uint8Array(e),n=new DataView(e);if(i[0]!==13)throw new al("File is not a valid MRT.");return n.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),n=this.getHeaderLength(e);if(i.length<n)throw new al(`Expected header with length >= ${n} but got buffer of length ${i.length}`);const a=new Uu(i.subarray(0,n)),c=mi.read(a);if(!isNaN(this.x)&&(this.x!==c.x||this.y!==c.y||this.z!==c.z))throw new al(`Invalid attempt to parse header ${c.z}/${c.x}/${c.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=c.x,this.y=c.y,this.z=c.z;for(const d of c.layers)this.layers[d.name]=new CC(d,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],n=this.getLayer(e.layerName);for(let a=0;a<n.dataIndex.length;a++){const c=n.dataIndex[a],d=c.first_byte-e.firstByte,m=c.last_byte+1-e.firstByte;if(a<e.firstBlock||a>e.lastBlock||n._blocksInProgress.has(a))continue;const g={layerName:n.name,firstByte:d,lastByte:m,pixelFormat:n.pixelFormat,blockIndex:a,blockShape:[c.bands.length].concat(n.bandShape),buffer:n.buffer,codec:c.codec.codec,filters:c.filters.map(y=>y.filter)};n._blocksInProgress.add(a),i.push(g)}return new qb(i,()=>{i.forEach(a=>n._blocksInProgress.delete(a.blockIndex))},(a,c)=>{if(i.forEach(d=>n._blocksInProgress.delete(d.blockIndex)),a)throw a;c.forEach(d=>{this.getLayer(d.layerName).processDecodedData(d)})})}}class CC{constructor({version:e,name:i,units:n,tilesize:a,pixel_format:c,buffer:d,data_index:m},g){if(this.version=e,this.version!==1)throw new al(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=n,this.tileSize=a,this.buffer=d,this.pixelFormat=MC[c],this.dataIndex=m,this.bandShape=[a+2*d,a+2*d,AC[this.pixelFormat]],this._decodedBlocks=function(y=1e3,w=0,E=!1){if(isNaN(y)||y<0)throw new TypeError("Invalid max value");if(isNaN(w)||w<0)throw new TypeError("Invalid ttl value");if(typeof E!="boolean")throw new TypeError("Invalid resetTtl value");return new dC(y,w,E)}(g?g.cacheSize:5),this._blocksInProgress=new Set}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.set(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[n,a]of this.dataIndex.entries()){for(const[c,d]of a.bands.entries())if(d===e)return{bandIndex:i+c,blockIndex:n,blockBandIndex:c};i+=a.bands.length}break;case"number":for(const[n,a]of this.dataIndex.entries()){if(e>=i&&e<i+a.bands.length)return{bandIndex:e,blockIndex:n,blockBandIndex:e-i};i+=a.bands.length}break;default:throw new al(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}throw new al(`Band not found: ${JSON.stringify(e)}`)}getDataRange(e){let i=1/0,n=-1/0,a=1/0,c=-1/0;for(const d of e){const{blockIndex:m}=this.getBlockForBand(d);if(m<0)throw new al(`Invalid band: ${JSON.stringify(d)}`);const g=this.dataIndex[m];a=Math.min(a,m),c=Math.max(c,m),i=Math.min(i,g.first_byte),n=Math.max(n,g.last_byte)}return{layerName:this.name,firstByte:i,lastByte:n,firstBlock:a,lastBlock:c}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:n}=this.getBlockForBand(e),a=this._decodedBlocks.get(i.toString());if(!a)throw new al(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const c=this.dataIndex[i],d=this.bandShape.reduce((y,w)=>y*w,1),m=n*d,g=a.subarray(m,m+d);return{data:g,bytes:new Uint8Array(g.buffer).subarray(g.byteOffset,g.byteOffset+g.byteLength),tileSize:this.tileSize,buffer:this.buffer,offset:c.offset,scale:c.scale}}}class qb{constructor(e,i,n){this.tasks=e,this._onCancel=i,this._onComplete=n,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}$b.performDecoding=function(t,e){return Promise.all(e.tasks.map(i=>{const{layerName:n,firstByte:a,lastByte:c,pixelFormat:d,blockShape:m,blockIndex:g,filters:y,codec:w}=i,E=new Uint8Array(t).subarray(a,c+1),M=new Uint32Array(m[0]*m[1]*m[2]);let P;if(w!=="gzip_data")throw new Error(`Unhandled codec: ${w}`);return P=function(D,O){if(!globalThis.DecompressionStream&&O==="gzip_data")return Promise.resolve(((Q=function(se){se[0]==31&&se[1]==139&&se[2]==8||po(6,"invalid gzip data");var he=se[3],ge=10;4&he&&(ge+=2+(se[10]|se[11]<<8));for(var xe=(he>>3&1)+(he>>4&1);xe>0;xe-=!se[ge++]);return ge+(2&he)}(W=D))+8>W.length&&po(6,"invalid gzip data"),function(se,he,ge,xe){var Ae=se.length;if(!Ae||he.f&&!he.l)return ge||new zs(0);var be=!ge,ze=be||he.i!=2,qe=he.i;be&&(ge=new zs(3*Ae));var De=function(es){var $n=ge.length;if(es>$n){var ks=new zs(Math.max(2*$n,es));ks.set(ge),ge=ks}},Ge=he.f||0,Pe=he.p||0,je=he.b||0,ut=he.l,Ze=he.d,Lt=he.m,St=he.n,Ye=8*Ae;do{if(!ut){Ge=fo(se,Pe,1);var ei=fo(se,Pe+1,3);if(Pe+=3,!ei){var Ft=se[($i=4+((Pe+7)/8|0))-4]|se[$i-3]<<8,Rt=$i+Ft;if(Rt>Ae){qe&&po(0);break}ze&&De(je+Ft),ge.set(se.subarray($i,Rt),je),he.b=je+=Ft,he.p=Pe=8*Rt,he.f=Ge;continue}if(ei==1)ut=xC,Ze=bC,Lt=9,St=5;else if(ei==2){var Je=fo(se,Pe,31)+257,Xt=fo(se,Pe+10,15)+4,bi=Je+fo(se,Pe+5,31)+1;Pe+=14;for(var ti=new zs(bi),wi=new zs(19),ci=0;ci<Xt;++ci)wi[gC[ci]]=fo(se,Pe+3*ci,7);Pe+=3*Xt;var Oi=gy(wi),fi=(1<<Oi)-1,fr=gf(wi,Oi,1);for(ci=0;ci<bi;){var $i,Hi=fr[fo(se,Pe,fi)];if(Pe+=15&Hi,($i=Hi>>4)<16)ti[ci++]=$i;else{var tr=0,qi=0;for($i==16?(qi=3+fo(se,Pe,3),Pe+=2,tr=ti[ci-1]):$i==17?(qi=3+fo(se,Pe,7),Pe+=3):$i==18&&(qi=11+fo(se,Pe,127),Pe+=7);qi--;)ti[ci++]=tr}}var Lr=ti.subarray(0,Je),ar=ti.subarray(Je);Lt=gy(Lr),St=gy(ar),ut=gf(Lr,Lt,1),Ze=gf(ar,St,1)}else po(1);if(Pe>Ye){qe&&po(0);break}}ze&&De(je+131072);for(var qr=(1<<Lt)-1,un=(1<<St)-1,In=Pe;;In=Pe){var Ir=(tr=ut[yy(se,Pe)&qr])>>4;if((Pe+=15&tr)>Ye){qe&&po(0);break}if(tr||po(2),Ir<256)ge[je++]=Ir;else{if(Ir==256){In=Pe,ut=null;break}var Fr=Ir-254;Ir>264&&(Fr=fo(se,Pe,(1<<(bn=Fb[ci=Ir-257]))-1)+jb[ci],Pe+=bn);var vn=Ze[yy(se,Pe)&un],xn=vn>>4;if(vn||po(3),Pe+=15&vn,ar=vC[xn],xn>3){var bn=Nb[xn];ar+=yy(se,Pe)&(1<<bn)-1,Pe+=bn}if(Pe>Ye){qe&&po(0);break}ze&&De(je+131072);var xr=je+Fr;if(je<ar){var _s=0-ar,ll=Math.min(ar,xr);for(_s+je<0&&po(3);je<ll;++je)ge[je]=xe[_s+je]}for(;je<xr;++je)ge[je]=ge[je-ar]}}he.l=ut,he.p=In,he.b=je,he.f=Ge,ut&&(Ge=1,he.m=Lt,he.d=Ze,he.n=St)}while(!Ge);return je!=ge.length&&be?function(es,$n,ks){return($n==null||$n<0)&&($n=0),(ks==null||ks>es.length)&&(ks=es.length),new zs(es.subarray($n,ks))}(ge,0,je):ge.subarray(0,je)}(W.subarray(Q,-8),{i:2},new zs(((F=W)[(V=F.length)-4]|F[V-3]<<8|F[V-2]<<16|F[V-1]<<24)>>>0),void 0)));var F,V,W,Q;const J=SC[O];if(!J)throw new Error(`Unhandled codec: ${O}`);const oe=new globalThis.DecompressionStream(J);return new Response(new Blob([D]).stream().pipeThrough(oe)).arrayBuffer().then(se=>new Uint8Array(se))}(E,w).then(D=>{const O=ho.read(new Uu(D));if(O.values==="uint32_values")return O.uint32_values.readValuesInto(M),new IC[d](M.buffer);throw new Error(`Unhandled numeric data "${O.values}"`)}),P.then(D=>{for(let O=y.length-1;O>=0;O--)switch(y[O]){case"delta_filter":fC(D,m);break;case"zigzag_filter":pC(D);break;case"bitshuffle_filter":mC(D,d);break;default:throw new Error(`Unhandled filter "${y[O]}"`)}return{layerName:n,blockIndex:g,data:D}}).catch(D=>{throw D})}))},Ct(qb,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});const Zb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class vy{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,n]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const a=n>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);const c=Zb[15&n];if(!c)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(e,2,1),[m]=new Uint32Array(e,4,1);return new vy(m,d,c,e)}constructor(e,i=64,n=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=n,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const c=Zb.indexOf(this.ArrayType),d=2*e*this.ArrayType.BYTES_PER_ELEMENT,m=e*this.IndexArrayType.BYTES_PER_ELEMENT,g=(8-m%8)%8;if(c<0)throw new Error(`Unexpected typed array class: ${n}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+g,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+d+m+g),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+m+g,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+c]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const n=this._pos>>1;return this.ids[n]=n,this.coords[this._pos++]=e,this.coords[this._pos++]=i,n}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return xy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,n,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:c,coords:d,nodeSize:m}=this,g=[0,c.length-1,0],y=[];for(;g.length;){const w=g.pop()||0,E=g.pop()||0,M=g.pop()||0;if(E-M<=m){for(let F=M;F<=E;F++){const V=d[2*F],W=d[2*F+1];V>=e&&V<=n&&W>=i&&W<=a&&y.push(c[F])}continue}const P=M+E>>1,D=d[2*P],O=d[2*P+1];D>=e&&D<=n&&O>=i&&O<=a&&y.push(c[P]),(w===0?e<=D:i<=O)&&(g.push(M),g.push(P-1),g.push(1-w)),(w===0?n>=D:a>=O)&&(g.push(P+1),g.push(E),g.push(1-w))}return y}within(e,i,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:c,nodeSize:d}=this,m=[0,a.length-1,0],g=[],y=n*n;for(;m.length;){const w=m.pop()||0,E=m.pop()||0,M=m.pop()||0;if(E-M<=d){for(let F=M;F<=E;F++)Wb(c[2*F],c[2*F+1],e,i)<=y&&g.push(a[F]);continue}const P=M+E>>1,D=c[2*P],O=c[2*P+1];Wb(D,O,e,i)<=y&&g.push(a[P]),(w===0?e-n<=D:i-n<=O)&&(m.push(M),m.push(P-1),m.push(1-w)),(w===0?e+n>=D:i+n>=O)&&(m.push(P+1),m.push(E),m.push(1-w))}return g}}function xy(t,e,i,n,a,c){if(a-n<=i)return;const d=n+a>>1;Hb(t,e,d,n,a,c),xy(t,e,i,n,d-1,1-c),xy(t,e,i,d+1,a,1-c)}function Hb(t,e,i,n,a,c){for(;a>n;){if(a-n>600){const y=a-n+1,w=i-n+1,E=Math.log(y),M=.5*Math.exp(2*E/3),P=.5*Math.sqrt(E*M*(y-M)/y)*(w-y/2<0?-1:1);Hb(t,e,i,Math.max(n,Math.floor(i-w*M/y+P)),Math.min(a,Math.floor(i+(y-w)*M/y+P)),c)}const d=e[2*i+c];let m=n,g=a;for(vf(t,e,n,i),e[2*a+c]>d&&vf(t,e,n,a);m<g;){for(vf(t,e,m,g),m++,g--;e[2*m+c]<d;)m++;for(;e[2*g+c]>d;)g--}e[2*n+c]===d?vf(t,e,n,g):(g++,vf(t,e,g,a)),g<=i&&(n=g+1),i<=g&&(a=g-1)}}function vf(t,e,i,n){by(t,i,n),by(e,2*i,2*n),by(e,2*i+1,2*n+1)}function by(t,e,i){const n=t[e];t[e]=t[i],t[i]=n}function Wb(t,e,i,n){const a=t-i,c=e-n;return a*a+c*c}o.$=Y1,o.A=gu,o.B=dd,o.C=zi,o.D=Te,o.E=Ma,o.F=zr,o.G=at,o.H=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return rt(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Di(t.x,e.x,i),y:Di(t.y,e.y,i),z:Di(t.z,e.z,i),azimuthal:Di(t.azimuthal,e.azimuthal,i),polar:Di(t.polar,e.polar,i)}}},o.I=Xg,o.J=io,o.K=Or,o.L=ji,o.M=class{constructor(t,e,i,n){this.id=t,this.position=e!=null?new ve(e[0],e[1]):new ve(0,0),this.orientation=i??[0,0,0],this.nodes=n,this.uploaded=!1,this.aabb=new Ur([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(t,e){if(o.a6.multiply(t.matrix,e,t.matrix),t.meshes)for(const i of t.meshes){const n=Ur.applyTransform(i.aabb,t.matrix);this.aabb.encapsulate(n)}if(t.children)for(const i of t.children)this._applyTransformations(i,t.matrix)}computeBoundsAndApplyParent(){const t=o.a6.identity([]);for(const e of this.nodes)this._applyTransformations(e,t)}computeModelMatrix(t,e,i,n,a,c,d=!1){_b(this.matrix,this,t.transform,this.position,e,i,n,a,c,d)}upload(t){if(!this.uploaded){for(const e of this.nodes)ly(e,t);for(const e of this.nodes)Dm(e);this.uploaded=!0}}destroy(){for(const t of this.nodes)cy(t)}},o.O=Dn,o.P=Ie,o.Q=ic,o.R=Zn,o.S=Ja,o.T=ny,o.U=Di,o.V=xt,o.W=Xf,o.X=class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([i,n]){const a=rt([1,i,n]);return{x:a.x,y:a.y,z:a.z}}(t.expression.evaluate(e))}interpolate(t,e,i){return{x:Di(t.x,e.x,i),y:Di(t.y,e.y,i),z:Di(t.z,e.z,i)}}},o.Y=function(t,e,i=0,n=!0){const a=new Ie(i,i),c=t.sub(a),d=e.add(a),m=[c,new Ie(d.x,c.y),d,new Ie(c.x,d.y)];return n&&m.push(c.clone()),m},o.Z=Jl,o._=function(t,e){const i=[];for(let n=0;n<t.length;n++){const a=Cn(n-1,-1,t.length-1),c=Cn(n+1,-1,t.length-1),d=t[n],m=t[c],g=t[a].sub(d).unit(),y=m.sub(d).unit(),w=y.angleWithSep(g.x,g.y),E=g.add(y).unit().mult(-1*e/Math.sin(w/2));i.push(d.add(E))}return i},o.a=vh,o.a$=function(t){const e=[];for(const i in t)e.push(t[i]);return e},o.a0=J0,o.a1=function(t,e,i=0){return o.N.fromValues(((e.x-i)*t.scale-t.x)*xt,(e.y*t.scale-t.y)*xt,pr(e.z,e.y))},o.a2=Eg,o.a3=m1,o.a4=function(t){let e=1/0,i=1/0,n=-1/0,a=-1/0;for(const c of t)e=Math.min(e,c.x),i=Math.min(i,c.y),n=Math.max(n,c.x),a=Math.max(a,c.y);return{min:new Ie(e,i),max:new Ie(n,a)}},o.a5=gi,o.a8=so,o.a9=Yi,o.aA=fp,o.aB=$r,o.aC=ns,o.aD=Cp,o.aE=Mm,o.aF=function(){as.isLoading()||as.isLoaded()||ko()!=="deferred"||Ed()},o.aG=ls,o.aH=an,o.aI=Pb,o.aJ=qt,o.aK=Gg,o.aL=Vg,o.aM=pn,o.aN=Ps,o.aO=Fd,o.aP=gx,o.aQ=nm,o.aR=ry,o.aS=function(t,e){const i=Ja(e.zoom);if(i===0)return $o(t);const n=Yp(t),a=Ig(n),c=gi(n.getWest())*e.worldSize,d=gi(n.getEast())*e.worldSize,m=si(n.getNorth())*e.worldSize,g=si(n.getSouth())*e.worldSize,y=[c,m,0],w=[d,m,0],E=[c,g,0],M=[d,g,0],P=o.a6.invert([],e.globeMatrix);return o.N.transformMat4(y,y,P),o.N.transformMat4(w,w,P),o.N.transformMat4(E,E,P),o.N.transformMat4(M,M,P),a[0]=ya(a[0],E,i),a[1]=ya(a[1],M,i),a[2]=ya(a[2],w,i),a[3]=ya(a[3],y,i),Ur.fromPoints(a)},o.aT=Qp,o.aU=Hd,o.aV=ya,o.aW=jn,o.aX=EM,o.aY=Qt,o.aZ=$b,o.a_=Ve,o.aa=Nt,o.ab=X,o.ac=function(t,e){const i={};for(let n=0;n<e.length;n++){const a=e[n];a in t&&(i[a]=t[a])}return i},o.ad=Ce,o.ae=si,o.af=class{constructor(t){this.entries={},this.scheduler=t}request(t,e,i,n){const a=this.entries[t]=this.entries[t]||{callbacks:[]};if(a.result){const[c,d]=a.result;return this.scheduler?this.scheduler.add(()=>{n(c,d)},e):n(c,d),()=>{}}return a.callbacks.push(n),a.cancel||(a.cancel=i((c,d)=>{a.result=[c,d];for(const m of a.callbacks)this.scheduler?this.scheduler.add(()=>{m(c,d)},e):m(c,d);setTimeout(()=>delete this.entries[t],3e3)})),()=>{a.result||(a.callbacks=a.callbacks.filter(c=>c!==n),a.callbacks.length||(a.cancel(),delete this.entries[t]))}}},o.ag=Pd,o.ah=function(t,e,i){const n=JSON.stringify(t.request);return t.data&&(this.deduped.entries[n]={result:[null,t.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},a=>{const c=Ve(t.request,(d,m,g,y)=>{d?a(d):m&&a(null,{vectorTile:i?void 0:new Ug(new Uu(m)),rawData:m,cacheControl:g,expires:y})});return()=>{c.cancel(),a()}},e)},o.ai=function(t){rr++,rr>Dt&&(t.getActor().send("enforceCacheSizeLimit",Be),rr=0)},o.aj=nn,o.ak=Ne,o.al=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},o.am=nt,o.an=ob,o.ao=ab,o.ap=sb,o.aq=function(t,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let n=0;n<t.length;n++){const a=document.createElement("source");it(t[n])||(i.crossOrigin="Anonymous"),a.src=t[n],i.appendChild(a)}return{cancel:()=>{}}},o.ar=Im,o.as=of,o.at=ui,o.au=ki,o.av=ro,o.aw=dn,o.ax=Jr,o.ay=nr,o.az=da,o.b=Jo,o.b$=Ep,o.b0=function(t,e){const i=[];for(const n in t)n in e||i.push(n);return i},o.b1=tn,o.b2=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.b3=function(t,e){const{x:i,y:n}=t.point,a=Tx(i,n,t.worldSize/t._pixelsPerMercatorPixel,0,0);return o.a6.multiply(a,a,Cg($o(e)))},o.b5=Fu,o.b6=Os,o.b7=dm,o.b8=function(t,e,i,n,a){const c=5*e+2;t.float32[c+0]=i,t.float32[c+1]=n,t.float32[c+2]=a},o.b9=Sm,o.bA=Rm,o.bB=lb,o.bC=function(t){const e=lb(t,!0);return o.b4.invert([],[e[0],e[1],e[4],e[5]])},o.bD=Sg,o.bE=function(t){const{x:e,y:i}=t.point,{lng:n,lat:a}=t._center;return Tx(e,i,t.worldSize,n,a)},o.bF=Ei,o.bG=te,o.bH=function(t){const e=Math.round((t+45+360)%360/90)%4;return Dr[e]},o.bI=45,o.bJ=Ut,o.bK=h,o.bL=Vo,o.bM=$p,o.bN=zn,o.bO=Pu,o.bP=u,o.bQ=function(t,e,i){const n=Math.sqrt(t*t+e*e+i*i),a=n>0?Math.acos(i/n)*Wi:0;let c=t!==0||e!==0?Math.atan2(-e,-t)*Wi+90:0;return c<0&&(c+=360),[n,c,a]},o.bR=Ci,o.bS=Ur,o.bT=rt,o.bU=function(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]},o.bV=function(t){return t({pluginStatus:Xn,pluginURL:zo}),Td.on("pluginStateChange",t),t},o.bW=Hu,o.bX=Om,o.bY=Gu,o.bZ=Kg,o.b_=Yr,o.ba=V1,o.bb=qs,o.bc=Pn,o.bd=H1,o.be=Jg,o.bf=Wg,o.bg=vy,o.bh=Cn,o.bj=dt,o.bk=ne,o.bl=di,o.bm=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},o.bn=ve,o.bo=ib,o.bp=st,o.bq=Mg,o.br=cb,o.bs=Ke,o.bt=xx,o.bu=function(t,e,i,n,a,c,d,m,g){if(g.name==="globe")return xx(t,e,new Ke(i,n,a),!1);const y=of({z:i,x:n,y:a},g);return new Ur([(c+y.x/y.scale)*e,e*(y.y/y.scale),d],[(c+y.x2/y.scale)*e,e*(y.y2/y.scale),m])},o.bv=function(t,e,i){let n=0;for(let a=0;a<2;++a){const c=i?i[a]:0;t[a]>c&&(n+=(t[a]-c)*(t[a]-c)),e[a]<c&&(n+=(c-e[a])*(c-e[a]))}return n},o.bw=Ai,o.bx=q,o.by=function(t){const e=o.a6.identity(new Float64Array(16));o.a6.multiply(e,t.pixelMatrix,t.globeMatrix);const i=[0,me,0],n=[0,Me,0];return o.N.transformMat4(i,i,e),o.N.transformMat4(n,n,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!Rg(t,new ve(t.center.lat,90)),n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Rg(t,new ve(t.center.lat,-90))]},o.bz=function(t,e){const{scale:i}=t.tileTransform,n=i*xt/(t.tileSize*Math.pow(2,e.zoom-t.tileID.overscaledZ+t.tileID.canonical.z));return o.b4.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[n,n])},o.c=Ib,o.c$=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.c0=ce,o.c1=sr,o.c2=function(t,e,i){return t.type==="custom"?new DI(t,e):new hC[t.type](t,e,i)},o.c3=function(t){const e=t.indexOf(Tu);return e>=0?t.slice(0,e):t},o.c4=function(t){return t.indexOf(Tu)>=0},o.c5=function(t){const e=t.indexOf(Tu);return e>=0?t.slice(e+1):""},o.c6=function(t){const e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.c7=Xi,o.c8=Td,o.c9=ke,o.cA=y1,o.cB=(t,e,i,n,a,c)=>{const d=t.transform;return{u_matrix:g1(t,e,i,n),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:d.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_image:0,u_tile_units_to_pixels:_1(e,d),u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:c}},o.cC=(t,e,i,n,a,c,d)=>{const m=t.transform,g=m.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:g1(t,e,i,n),u_pixels_to_tile_units:g,u_device_pixel_ratio:c,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:v1(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:_1(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:d,u_emissive_strength:i.paint.get("line-emissive-strength")}},o.cD=wn,o.cE=Wd,o.cF=c1,o.cG=Ot,o.cH=hm,o.cI=tl,o.cJ=450,o.cK=7,o.cL=PI,o.cM=256,o.cN=Cg,o.cO=No,o.cP=Bd,o.cQ=function(t,e,i,n,a){return Nt((t-e)/(i-e)*(a-n)+n,n,a)},o.cR=Ii,o.cS=oy,o.cT=[1,1,1],o.cU=ku,o.cV=Zu,o.cW=Gs,o.cX=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(t){const e=jx(new Ie(0,0),new Ie(xt,xt),t),i=[];for(const n of this._activeRegions){if(n.hiddenByOverlap||!Ux(e,n))continue;const a=uA(n.min,n.max,t);i.push({min:a.min,max:a.max,sourceId:this._sourceIds[n.priority],footprint:n.footprint,footprintTileId:n.tileId})}return i}setSources(t){this._setSources(t.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const n of e.cache.getVisibleCoordinates()){const a=e.cache.getTile(n).buckets[e.layer];if(a)for(const c of a.getNodesInfo()){const d=c.node;d.footprint&&i.push({footprint:d.footprint,id:n.toUnwrapped()})}}return i}})))}_addSource(t){const e=t.getFootprints();if(e.length!==0){for(const i of e){if(!i.footprint)continue;const n=jx(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:n.min,max:n.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(t.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||lm(e.min,i.min)||lm(e.max,i.max));let t=this._activeRegions.length!==this._prevRegions.length;if(!t){let e=0,i=0;for(;!t&&e!==this._activeRegions.length;){const n=this._activeRegions[e],a=this._prevRegions[i];t=n.priority!==a.priority||!Vx(n,a),++e,++i}}if(t){++this._updateTime;const e=i=>{const n=this._activeRegions;if(i>=n.length)return i;const a=n[i].priority;for(;i<n.length&&n[i].priority===a;)++i;return i};if(this._sourceIds.length>1){let i=0,n=e(i);for(;i!==n;){let a=i;const c=i;for(;a!==n;){const d=this._activeRegions[a];d.hiddenByOverlap=!1;for(let m=0;m<c;m++){const g=this._activeRegions[m];if(!g.hiddenByOverlap&&Ux(d,g)&&(d.hiddenByOverlap=$x(d.footprint,d.tileId,g.footprint,g.tileId),d.hiddenByOverlap))break}++a}i=n,n=e(i)}}}}_setSources(t){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=t.length-1;e>=0;e--)this._addSource(t[e]);this._computeReplacement()}},o.cY=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy()}_fillGridMeshWithLods(t,e){const i=new Ps,n=new dn,a=[],c=t+1+2,d=e[0]+1,m=e[0]+1+(1+e.length),g=(y,w,E)=>{let M=y===c-1?y-2:y===0?y:y-1;return M+=E?24575:0,[M,w]};for(let y=0;y<c;++y)i.emplaceBack(...g(y,0,!0));for(let y=0;y<d;++y)for(let w=0;w<c;++w)i.emplaceBack(...g(w,y,(w===0||w===c-1)&&!0));for(let y=0;y<e.length;++y){const w=e[y];for(let E=0;E<c;++E)i.emplaceBack(...g(E,w,!0))}for(let y=0;y<e.length;++y){const w=n.length,E=e[y]+1+2,M=new dn;for(let O=0;O<E-1;O++){const F=O===E-2,V=F?c*(m-e.length+y-O):c;for(let W=0;W<c-1;W++){const Q=O*c+W;O===0||F||W===0||W===c-2?(M.emplaceBack(Q+1,Q,Q+V),M.emplaceBack(Q+V,Q+V+1,Q+1)):(n.emplaceBack(Q+1,Q,Q+V),n.emplaceBack(Q+V,Q+V+1,Q+1))}}const P=$r.simpleSegment(0,w,i.length,n.length-w);for(let O=0;O<M.uint16.length;O+=3)n.emplaceBack(M.uint16[O],M.uint16[O+1],M.uint16[O+2]);const D=$r.simpleSegment(0,w,i.length,n.length-w);a.push({withoutSkirts:P,withSkirts:D})}return{vertices:i,indices:n,segments:a}}_createGrid(t){const e=this._fillGridMeshWithLods(ae,ue);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,gx.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new dn;for(let d=0;d<=ae;d++)e.emplaceBack(0,d+1,d+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new No,n=new No,a=new No,c=new No;this._poleSegments=[];for(let d=0,m=0;d<te;d++){const g=360/(1<<d);i.emplaceBack(0,-X,0,.5,0),n.emplaceBack(0,-X,0,.5,1),a.emplaceBack(0,-X,0,.5,.5),c.emplaceBack(0,-X,0,.5,.5);for(let y=0;y<=ae;y++){let w=y/ae,E=0;const M=Di(0,g,w),[P,D,O]=ye(AM,IM,M,X);i.emplaceBack(P,D,O,w,E),n.emplaceBack(P,D,O,w,1-E);const F=dt(M);w=.5+.5*Math.sin(F),E=.5+.5*Math.cos(F),a.emplaceBack(P,D,O,w,E),c.emplaceBack(P,D,O,w,1-E)}this._poleSegments.push($r.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,Xp,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(n,Xp,!1),this._texturedPoleNorthVertexBuffer=t.createVertexBuffer(a,Xp,!1),this._texturedPoleSouthVertexBuffer=t.createVertexBuffer(c,Xp,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}},o.cZ=function(t){return wo.has(t)},o.c_=Ri,o.ca=r,o.cb=class extends no{constructor(t){super(t),this.current=p}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let n=0;n<9;n++)if(i[n]!==this.current[n]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.cc=tt,o.cd=function(t,e,i){const n=Ja(i.zoom),a=t.style.map._antialias,c=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return n===0&&!a&&!c},o.ce=function(t){const e=t.pixelsPerMeter,i=e/di(1,t.center.lat),n=o.a6.identity(new Float64Array(16));return o.a6.translate(n,n,[t.point.x,t.point.y,0]),o.a6.scale(n,n,[i,i,e]),Float32Array.from(n)},o.cf=Yp,o.cg=function(t){const e=Ai-5;t=Nt(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(dt(t))),3);return Math.round(i*(ue.length-1))},o.ch=function(t,e,i,n){const a=e.getNorth(),c=e.getSouth(),d=e.getWest(),m=e.getEast(),g=1<<t.z,y=m-d,w=a-c,E=y/ae,M=-w/ue[i],P=[0,E,0,M,0,0,a,d,0];if(t.z>0){const D=180/n;o.co.multiply(P,P,[D/y+1,0,0,0,D/w+1,0,-.5*D/E,.5*D/M,1])}return P[2]=g,P[5]=t.x,P[8]=t.y,P},o.ci=$o,o.cj=function(t,e,i){const n=o.a6.identity(new Float64Array(16)),a=(e/(1<<t)-.5)*Math.PI*2;return o.a6.rotateY(n,i.globeMatrix,a),Float32Array.from(n)},o.ck=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,n=1<<i,a=Math.floor(t.x),c=Math.floor((t.x-a)*n),d=Math.floor(t.y*n),m=this.findDEMTileFor(new nt(i,a,i,c,d));return!(!m||!m.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const n=this._source();if(!n||t.y<0||t.y>1)return e;const a=n.getSource().maxzoom,c=1<<a,d=Math.floor(t.x),m=t.x-d,g=new nt(a,d,a,Math.floor(m*c),Math.floor(t.y*c)),y=this.findDEMTileFor(g);if(!y||!y.dem)return e;const w=y.dem,E=1<<y.tileID.canonical.z,M=(m*E-y.tileID.canonical.x)*w.dim,P=(t.y*E-y.tileID.canonical.y)*w.dim,D=Math.floor(M),O=Math.floor(P);return(i?this.exaggeration():1)*Di(Di(w.get(D,O),w.get(D,O+1),P-O),Di(w.get(D+1,O),w.get(D+1,O+1),P-O),M-D)}getAtTileOffset(t,e,i){const n=1<<t.canonical.z;return this.getAtPointOrZero(new ji(t.wrap+(t.canonical.x+e/xt)/n,(t.canonical.y+i/xt)/n))}getAtTileOffsetFunc(t,e,i,n){return a=>{const c=this.getAtTileOffset(t,a.x,a.y),d=n.upVector(t.canonical,a.x,a.y),m=n.upVectorScale(t.canonical,e,i).metersToTile;return o.N.scale(d,d,c*m),d}}getForTilePoints(t,e,i,n){if(this.isUsingMockSource())return!1;const a=ku.create(this,t,n);return!!a&&(e.forEach(c=>{c[2]=this.exaggeration()*a.getElevationAt(c[0],c[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,n=e.tileID,a=1<<t.canonical.z-n.canonical.z;let c=t.canonical.x/a-n.canonical.x,d=t.canonical.y/a-n.canonical.y,m=0;for(let g=0;g<t.canonical.z-n.canonical.z&&!i.leaves[m];g++){c*=2,d*=2;const y=2*Math.floor(d)+Math.floor(c);m=i.childOffsets[m]+y,c%=1,d%=1}return{min:this.exaggeration()*i.minimums[m],max:this.exaggeration()*i.maximums[m]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const t=this.visibleDemTiles;if(t.length===0)return null;let e=!1,i=Number.MAX_VALUE,n=Number.MIN_VALUE;for(const a of t){const c=this.getMinMaxForTile(a.tileID);c&&(i=Math.min(i,c.min),n=Math.max(n,c.max),e=!0)}return e?{min:i,max:n}:null}},o.cl=Kp,o.cm=Lx,o.cn=function(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]},o.cp=wx,o.cq=256,o.cr=function(t,e){const i=[0,0,0],n=Qp($o(e.canonical));return o.N.transformMat4(i,i,n),o.N.transformMat4(i,i,t),i},o.cs=t=>({u_camera_to_center_distance:new zn(t),u_extrude_scale:new x(t),u_device_pixel_ratio:new zn(t),u_matrix:new h(t),u_inv_rot_matrix:new h(t),u_merc_center:new Vo(t),u_tile_id:new $p(t),u_zoom_transition:new zn(t),u_up_dir:new $p(t),u_emissive_strength:new zn(t)}),o.ct=t=>({u_matrix:new h(t),u_pixels_to_tile_units:new x(t),u_device_pixel_ratio:new zn(t),u_units_to_pixels:new Vo(t),u_dash_image:new Pu(t),u_gradient_image:new Pu(t),u_image_height:new zn(t),u_texsize:new Vo(t),u_tile_units_to_pixels:new zn(t),u_alpha_discard_threshold:new zn(t),u_trim_offset:new Vo(t),u_emissive_strength:new zn(t)}),o.cu=t=>({u_matrix:new h(t),u_texsize:new Vo(t),u_pixels_to_tile_units:new x(t),u_device_pixel_ratio:new zn(t),u_image:new Pu(t),u_units_to_pixels:new Vo(t),u_tile_units_to_pixels:new zn(t),u_alpha_discard_threshold:new zn(t),u_trim_offset:new Vo(t)}),o.cv=Mu,o.cw=NA,o.cx=VA,o.cy=Mx,o.cz=(t,e,i,n,a,c)=>{const d=t.transform,m=d.projection.name==="globe";let g;if(c.paint.get("circle-pitch-alignment")==="map")if(m){const w=wx(d.zoom,e.canonical)*d._pixelsPerMercatorPixel;g=Float32Array.from([w,0,0,w])}else g=d.calculatePixelsToTileUnitsMatrix(i);else g=new Float32Array([d.pixelsToGLUnits[0],0,0,d.pixelsToGLUnits[1]]);const y={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(d.projection),u_matrix:t.translatePosMatrix(e.projMatrix,i,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Qe.devicePixelRatio,u_extrude_scale:g,u_inv_rot_matrix:CM,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:c.paint.get("circle-emissive-strength")};if(m){y.u_inv_rot_matrix=n,y.u_merc_center=a,y.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],y.u_zoom_transition=Ja(d.zoom);const w=a[0]*xt,E=a[1]*xt;y.u_up_dir=d.projection.upVector(new Ke(0,0,0),w,E)}return y},o.d=vt,o.d0=Zi,o.d1=Gi,o.d2=Oe,o.d3=function([t,e,i]){const n=Math.hypot(t,e,i),a=Math.atan2(t,i),c=.5*Math.PI-Math.acos(-e/n);return new ve(Ei(a),Ei(c))},o.d4=Le,o.d5=K,o.d6=Rg,o.d7=Ex,o.d8=function(t){const e=[0,0,0],i=o.a6.identity(new Float64Array(16));return o.a6.multiply(i,t.pixelMatrix,t.globeMatrix),o.N.transformMat4(e,e,i),new Ie(e[0],e[1])},o.d9=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!function(i){if(Se==null){const n=i.navigator?i.navigator.userAgent:null;Se=!!i.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return Se}(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},o.dA=co,o.dB=Cb,o.dC=Rb,o.dD=f1,o.dE=Kt,o.dF=j1,o.dG=function(t,e,i,n,a,c,d,m,g,y,w){t.createArrays(),t.tilePixelRatio=xt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const E=t.layers[0].layout,M=t.layers[0]._unevaluatedLayout._values,P={};if(t.textSizeData.kind==="composite"){const{minZoom:V,maxZoom:W}=t.textSizeData;P.compositeTextSizes=[M["text-size"].possiblyEvaluate(new Or(V),m),M["text-size"].possiblyEvaluate(new Or(W),m)]}if(t.iconSizeData.kind==="composite"){const{minZoom:V,maxZoom:W}=t.iconSizeData;P.compositeIconSizes=[M["icon-size"].possiblyEvaluate(new Or(V),m),M["icon-size"].possiblyEvaluate(new Or(W),m)]}P.layoutTextSize=M["text-size"].possiblyEvaluate(new Or(g+1),m),P.layoutIconSize=M["icon-size"].possiblyEvaluate(new Or(g+1),m),P.textMaxSize=M["text-size"].possiblyEvaluate(new Or(18),m);const D=E.get("text-rotation-alignment")==="map"&&E.get("symbol-placement")!=="point",O=E.get("text-size");let F=!1;for(const V of t.features)if(V.icon&&V.icon.nameSecondary){F=!0;break}for(const V of t.features){const W=E.get("text-font").evaluate(V,{},m).join(","),Q=O.evaluate(V,{},m),J=P.layoutTextSize.evaluate(V,{},m),oe=(P.layoutIconSize.evaluate(V,{},m),{horizontal:{},vertical:void 0}),se=V.text;let he,ge=[0,0];if(se){const be=se.toString(),ze=E.get("text-letter-spacing").evaluate(V,{},m)*Pn,qe=E.get("text-line-height").evaluate(V,{},m)*Pn,De=tg(be)?ze:0,Ge=E.get("text-anchor").evaluate(V,{},m),Pe=E.get("text-variable-anchor");if(!Pe){const St=E.get("text-radial-offset").evaluate(V,{},m);ge=St?H1(Ge,[St*Pn,Yg]):E.get("text-offset").evaluate(V,{},m).map(Ye=>Ye*Pn)}let je=D?"center":E.get("text-justify").evaluate(V,{},m);const ut=E.get("symbol-placement")==="point",Ze=ut?E.get("text-max-width").evaluate(V,{},m)*Pn:1/0,Lt=St=>{t.allowVerticalPlacement&&Oo(be)&&(oe.vertical=Hg(se,e,i,a,W,Ze,qe,Ge,St,De,ge,Os.vertical,!0,J,Q))};if(!D&&Pe){const St=je==="auto"?Pe.map(ei=>Jg(ei)):[je];let Ye=!1;for(let ei=0;ei<St.length;ei++){const Ft=St[ei];if(!oe.horizontal[Ft])if(Ye)oe.horizontal[Ft]=oe.horizontal[0];else{const Rt=Hg(se,e,i,a,W,Ze,qe,"center",Ft,De,ge,Os.horizontal,!1,J,Q);Rt&&(oe.horizontal[Ft]=Rt,Ye=Rt.positionedLines.length===1)}}Lt("left")}else{if(je==="auto"&&(je=Jg(Ge)),ut||E.get("text-writing-mode").indexOf("horizontal")>=0||!Oo(be)){const St=Hg(se,e,i,a,W,Ze,qe,Ge,je,De,ge,Os.horizontal,!1,J,Q);St&&(oe.horizontal[je]=St)}Lt(ut?"left":je)}}let xe=!1;if(V.icon&&V.icon.namePrimary){const be=n[V.icon.namePrimary];be&&(he=sI(a[V.icon.namePrimary],V.icon.nameSecondary?a[V.icon.nameSecondary]:void 0,E.get("icon-offset").evaluate(V,{},m),E.get("icon-anchor").evaluate(V,{},m)),xe=be.sdf,t.sdfIcons===void 0?t.sdfIcons=be.sdf:t.sdfIcons!==be.sdf&&_e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(be.pixelRatio!==t.pixelRatio||E.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Ae=X1(oe.horizontal)||oe.vertical;t.iconsInText||(t.iconsInText=!!Ae&&Ae.iconsInText),(Ae||he)&&dI(t,V,oe,he,n,P,J,0,ge,xe,d,m,y,w,F)}c&&t.generateCollisionDebugBuffers(g,t.collisionBoxArray)},o.dH=Ug,o.dI=Uu,o.dJ=cm,o.dK=Xe,o.dL=om,o.dM=sm,o.dN=_i,o.dO=T1,o.dP=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==bb){const i=new Uint32Array(t,0,7),[,,n,a,c,d]=i;e=i.byteLength+a+c+d+c,(n!==t.byteLength||e>=t.byteLength)&&_e("Invalid b3dm header information.")}return Sb(t,e)},o.dQ=function(t,e){const i=Ib(t);for(const n of i){for(const a of n.meshes)sC(a);n.lights&&(n.lightMeshIndex=n.meshes.length,n.meshes.push(oC(n.lights,e)))}return i},o.dR=Fm,o.dS=gb,o.dT=as,o.dU=function(t){cr(),mt&&mt.then(e=>{e.keys().then(i=>{for(let n=0;n<i.length-t;n++)e.delete(i[n])})})},o.da=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ct,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!ce(t))return t;const i=ii(t);return i.params.push(`sdk=js-${Y}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!ce(t))return t;const i=ii(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeModelURL(t,e){if(!ce(t))return t;const i=ii(t);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,n){if(!ce(t))return t;const a=ii(t);return a.path=`/v4/${a.authority}.json`,a.params.push("secure"),i&&a.params.push(`language=${i}`),n&&a.params.push(`worldview=${n}`),this._makeAPIURL(a,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,n){const a=ii(t);return ce(t)?(a.path=`/styles/v1${a.path}/sprite${e}${i}`,this._makeAPIURL(a,this._customAccessToken||n)):(a.path+=`${e}${i}`,Li(a))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ce(t))return t;const n=ii(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&n.authority!=="raster"&&i===512?"@2x":""}${Ji.supported?".webp":"$1"}`),n.authority==="raster"?n.path=`/${K.RASTER_URL_PREFIX}${n.path}`:n.authority==="rasterarrays"?n.path=`/${K.RASTERARRAYS_URL_PREFIX}${n.path}`:(n.path=n.path.replace(/^.+\/v4\//,"/"),n.path=`/${K.TILE_URL_VERSION}${n.path}`);const a=this._customAccessToken||function(c){for(const d of c){const m=d.match(/^access_token=(.*)$/);if(m)return m[1]}return null}(n.params)||K.ACCESS_TOKEN;return K.REQUIRE_ACCESS_TOKEN&&a&&this._skuToken&&n.params.push(`sku=${this._skuToken}`),this._makeAPIURL(n,a)}canonicalizeTileURL(t,e){const i=ii(t);if(!i.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let n="mapbox://";i.path.match(/^\/raster\/v1\//)?n+=`raster/${i.path.replace(`/${K.RASTER_URL_PREFIX}/`,"")}`:i.path.match(/^\/rasterarrays\/v1\//)?n+=`rasterarrays/${i.path.replace(`/${K.RASTERARRAYS_URL_PREFIX}/`,"")}`:n+=`tiles/${i.path.replace(`/${K.TILE_URL_VERSION}/`,"")}`;let a=i.params;return e&&(a=a.filter(c=>!c.match(/^access_token=/))),a.length&&(n+=`?${a.join("&")}`),n}canonicalizeTileset(t,e){const i=!!e&&ce(e),n=[];for(const a of t.tiles||[])de(a)?n.push(this.canonicalizeTileURL(a,i)):n.push(a);return n}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",n=ii(K.API_URL);if(t.protocol=n.protocol,t.authority=n.authority,t.protocol==="http"){const a=t.params.indexOf("secure");a>=0&&t.params.splice(a,1)}if(n.path!=="/"&&(t.path=`${n.path}${t.path}`),!K.REQUIRE_ACCESS_TOKEN)return Li(t);if(e=e||K.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(a=>a.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Li(t)}},o.db=function(t,e){e?wo.add(t):wo.delete(t)},o.dc=Ji,o.dd=Es,o.de=zl,o.df=Et,o.dg=Ki,o.dh=function(t){wo.delete(t)},o.di=En,o.dj=Tn,o.dk=Y,o.dl=function(t,e){Be=t,Dt=e},o.dm=function(t,e,i=!1){if(Xn===yd||Xn===vd||Xn===xd)throw new Error("setRTLTextPlugin cannot be called multiple times.");zo=Qe.resolveURL(t),Xn=yd,bd=e,wd(),i||Ed()},o.dn=ko,o.dp=function(){Om().acquire(uy)},o.dq=function(){const t=pf;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(uy),pf=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.dr=ff,o.ds=function(t){const e=vi();if(!e)return;const i=e.delete(Pt);t&&i.catch(t).then(()=>t())},o.dt=df,o.du=yb,o.dv=function(t){hy=Qe.resolveURL(t),Xu||(Xu=new Hu(Om(),new Ma)),Xu.broadcast("setDracoUrl",hy)},o.dw=vb,o.dx=function(t){Wu=Qe.resolveURL(t),Xu||(Xu=new Hu(Om(),new Ma)),Xu.broadcast("setMeshoptUrl",Wu)},o.dy=Ct,o.dz=Qa,o.e=gr,o.f=Qe,o.g=function(t,e){return ke(gr(t,{type:"json"}),e)},o.h=Ds,o.i=La,o.j=wh,o.k=_u,o.l=function(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>Sb(e,0,t))},o.m=_p,o.n=Yl,o.o=nc,o.p=U1,o.q=xu,o.r=vu,o.s=fd,o.t=ql,o.u=rc,o.v=Mn,o.w=_e,o.x=Ba,o.z=Ad}),z(["./shared"],function(o){function Y(Se){const Z=Se?Se.url.toString():void 0;return Z?performance.getEntriesByName(Z):[]}function ie(Se){if(typeof Se=="number"||typeof Se=="boolean"||typeof Se=="string"||Se==null)return JSON.stringify(Se);if(Array.isArray(Se)){let ne="[";for(const le of Se)ne+=`${ie(le)},`;return`${ne}]`}let Z="{";for(const ne of Object.keys(Se).sort())Z+=`${ne}:${ie(Se[ne])},`;return`${Z}}`}function K(Se){let Z="";for(const ne of o.b2)Z+=`/${ie(Se[ne])}`;return Z}class de{constructor(Z){this.keyCache={},this._layers={},this._layerConfigs={},Z&&this.replace(Z)}replace(Z,ne){this._layerConfigs={},this._layers={},this.update(Z,[],ne)}update(Z,ne,le){this._options=le;for(const Ne of Z)this._layerConfigs[Ne.id]=Ne,(this._layers[Ne.id]=o.c2(Ne,this.scope,this._options)).compileFilter(),this.keyCache[Ne.id]&&delete this.keyCache[Ne.id];for(const Ne of ne)delete this.keyCache[Ne],delete this._layerConfigs[Ne],delete this._layers[Ne];this.familiesBySource={};const Re=function(Ne,Qe){const Pt={};for(let Dt=0;Dt<Ne.length;Dt++){const mt=Qe&&Qe[Ne[Dt].id]||K(Ne[Dt]);Qe&&(Qe[Ne[Dt].id]=mt);let It=Pt[mt];It||(It=Pt[mt]=[]),It.push(Ne[Dt])}const Be=[];for(const Dt in Pt)Be.push(Pt[Dt]);return Be}(o.a$(this._layerConfigs),this.keyCache);for(const Ne of Re){const Qe=Ne.map(vi=>this._layers[vi.id]),Pt=Qe[0];if(Pt.visibility==="none")continue;const Be=Pt.source||"";let Dt=this.familiesBySource[Be];Dt||(Dt=this.familiesBySource[Be]={});const mt=Pt.sourceLayer||"_geojsonTileLayer";let It=Dt[mt];It||(It=Dt[mt]=[]),It.push(Qe)}}}const ce=1*o.dA;class Ee{constructor(Z){const ne={},le=[];for(const Pt in Z){const Be=Z[Pt],Dt=ne[Pt]={};for(const mt in Be.glyphs){const It=Be.glyphs[+mt];if(!It||It.bitmap.width===0||It.bitmap.height===0)continue;const vi=It.metrics.localGlyph?ce:1,cr={x:0,y:0,w:It.bitmap.width+2*vi,h:It.bitmap.height+2*vi};le.push(cr),Dt[mt]=cr}}const{w:Re,h:Ne}=o.p(le),Qe=new o.dz({width:Re||1,height:Ne||1});for(const Pt in Z){const Be=Z[Pt];for(const Dt in Be.glyphs){const mt=Be.glyphs[+Dt];if(!mt||mt.bitmap.width===0||mt.bitmap.height===0)continue;const It=ne[Pt][Dt],vi=mt.metrics.localGlyph?ce:1;o.dz.copy(mt.bitmap,Qe,{x:0,y:0},{x:It.x+vi,y:It.y+vi},mt.bitmap)}}this.image=Qe,this.positions=ne}}o.dy(Ee,"GlyphAtlas");class Ue{constructor(Z){this.tileID=new o.am(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.scope=Z.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Z.showCollisionBoxes,this.collectResourceTiming=!!Z.collectResourceTiming,this.promoteId=Z.promoteId,this.isSymbolTile=Z.isSymbolTile,this.tileTransform=o.as(Z.tileID.canonical,Z.projection),this.projection=Z.projection,this.brightness=Z.brightness,this.extraShadowCaster=!!Z.extraShadowCaster}parse(Z,ne,le,Re,Ne){this.status="parsing",this.data=Z,this.collisionBoxArray=new o.aD;const Qe=new o.dB(Object.keys(Z.layers).sort()),Pt=new o.dC(this.tileID,this.promoteId);Pt.bucketLayerIDs=[];const Be={},Dt=new o.dD(256,256),mt={featureIndex:Pt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Dt,availableImages:le,brightness:this.brightness},It=ne.familiesBySource[this.source];for(const or in It){const yr=Z.layers[or];if(!yr)continue;let hn=!1,Tr=!1,Vn=!1;for(const rn of It[or])rn[0].type==="symbol"?hn=!0:Tr=!0,rn[0].is3D()&&rn[0].type!=="model"&&(Vn=!0);if(this.extraShadowCaster&&!Vn||this.isSymbolTile===!0&&!hn||this.isSymbolTile===!1&&!Tr)continue;yr.version===1&&o.w(`Vector tile source "${this.source}" layer "${or}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const On=Qe.encode(or),Zn=[];for(let rn=0;rn<yr.length;rn++){const Yr=yr.feature(rn),ke=Pt.getId(Yr,or);Zn.push({feature:Yr,id:ke,index:rn,sourceLayerIndex:On})}for(const rn of It[or]){const Yr=rn[0];(!this.extraShadowCaster||Yr.is3D()&&Yr.type!=="model")&&(this.isSymbolTile!==void 0&&Yr.type==="symbol"!==this.isSymbolTile||Yr.minzoom&&this.zoom<Math.floor(Yr.minzoom)||Yr.maxzoom&&this.zoom>=Yr.maxzoom||Yr.visibility!=="none"&&($e(rn,this.zoom,mt.brightness,le),(Be[Yr.id]=Yr.createBucket({index:Pt.bucketLayerIDs.length,layers:rn,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:On,sourceID:this.source,projection:this.projection.spec})).populate(Zn,mt,this.tileID.canonical,this.tileTransform),Pt.bucketLayerIDs.push(rn.map(ke=>ke.id))))}}let vi,cr,Mr,ur;Dt.trim();const rr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ji=()=>{if(vi)return this.status="done",Ne(vi);if(this.extraShadowCaster)this.status="done",Ne(null,{buckets:o.a$(Be).filter(or=>!or.isEmpty()),featureIndex:Pt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:mt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(cr&&Mr&&ur){const or=new Ee(cr),yr=new o.dF(Mr,ur);for(const hn in Be){const Tr=Be[hn];Tr instanceof o.aE?($e(Tr.layers,this.zoom,mt.brightness,le),o.dG(Tr,cr,or.positions,Mr,yr.iconPositions,this.showCollisionBoxes,le,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):Tr.hasPattern&&(Tr instanceof o.aK||Tr instanceof o.aL||Tr instanceof o.cH)&&($e(Tr.layers,this.zoom,mt.brightness,le),Tr.addFeatures(mt,this.tileID.canonical,yr.patternPositions,le,this.tileTransform,this.brightness))}this.status="done",Ne(null,{buckets:o.a$(Be).filter(hn=>!hn.isEmpty()),featureIndex:Pt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:or.image,lineAtlas:Dt,imageAtlas:yr,brightness:mt.brightness})}};if(!this.extraShadowCaster){const or=o.dE(mt.glyphDependencies,Tr=>Object.keys(Tr).map(Number));Object.keys(or).length?Re.send("getGlyphs",{uid:this.uid,stacks:or,scope:this.scope},(Tr,Vn)=>{vi||(vi=Tr,cr=Vn,Ji())},void 0,!1,rr):cr={};const yr=Object.keys(mt.iconDependencies);yr.length?Re.send("getImages",{icons:yr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Tr,Vn)=>{vi||(vi=Tr,Mr=Vn,Ji())},void 0,!1,rr):Mr={};const hn=Object.keys(mt.patternDependencies);hn.length?Re.send("getImages",{icons:hn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Tr,Vn)=>{vi||(vi=Tr,ur=Vn,Ji())},void 0,!1,rr):ur={}}Ji()}}function $e(Se,Z,ne,le){const Re=new o.K(Z,{brightness:ne});for(const Ne of Se)Ne.recalculate(Re,le)}class et extends o.E{constructor(Z,ne,le,Re,Ne,Qe){super(),this.actor=Z,this.layerIndex=ne,this.availableImages=le,this.loadVectorData=Ne||o.ah,this.loading={},this.loaded={},this.deduped=new o.af(Z.scheduler),this.isSpriteLoaded=Re,this.scheduler=Z.scheduler,this.brightness=Qe}loadTile(Z,ne){const le=Z.uid,Re=Z&&Z.request,Ne=Re&&Re.collectResourceTiming,Qe=this.loading[le]=new Ue(Z);Qe.abort=this.loadVectorData(Z,(Pt,Be)=>{const Dt=!this.loading[le];if(delete this.loading[le],Dt||Pt||!Be)return Qe.status="done",Dt||(this.loaded[le]=Qe),ne(Pt);const mt=Be.rawData,It={};Be.expires&&(It.expires=Be.expires),Be.cacheControl&&(It.cacheControl=Be.cacheControl),Qe.vectorTile=Be.vectorTile||new o.dH(new o.dI(mt));const vi=()=>{Qe.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.actor,(cr,Mr)=>{if(cr||!Mr)return ne(cr);const ur={};if(Ne){const rr=Y(Re);rr.length>0&&(ur.resourceTiming=JSON.parse(JSON.stringify(rr)))}ne(null,o.e({rawTileData:mt.slice(0)},Mr,It,ur))})};this.isSpriteLoaded?vi():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(vi,{type:"parseTile",isSymbolTile:Z.isSymbolTile,zoom:Z.tileZoom}):vi()}),this.loaded=this.loaded||{},this.loaded[le]=Qe})}reloadTile(Z,ne){const le=this.loaded,Re=Z.uid,Ne=this;if(le&&le[Re]){const Qe=le[Re];Qe.showCollisionBoxes=Z.showCollisionBoxes,Qe.projection=Z.projection,Qe.brightness=Z.brightness,Qe.tileTransform=o.as(Z.tileID.canonical,Z.projection),Qe.extraShadowCaster=Z.extraShadowCaster;const Pt=(Be,Dt)=>{const mt=Qe.reloadCallback;mt&&(delete Qe.reloadCallback,Qe.parse(Qe.vectorTile,Ne.layerIndex,this.availableImages,Ne.actor,mt)),ne(Be,Dt)};Qe.status==="parsing"?Qe.reloadCallback=Pt:Qe.status==="done"&&(Qe.vectorTile?Qe.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.actor,Pt):Pt())}else ne(null,void 0)}abortTile(Z,ne){const le=Z.uid,Re=this.loading[le];Re&&(Re.abort&&Re.abort(),delete this.loading[le]),ne()}removeTile(Z,ne){const le=this.loaded,Re=Z.uid;le&&le[Re]&&delete le[Re],ne()}}class ht{loadTile(Z,ne){const{uid:le,encoding:Re,rawImageData:Ne,padding:Qe}=Z,Pt=ImageBitmap&&Ne instanceof ImageBitmap?this.getImageData(Ne,Qe):Ne;ne(null,new o.dJ(le,Pt,Re,Qe<1))}getImageData(Z,ne){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Z.width,Z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Z.width,this.offscreenCanvas.height=Z.height,this.offscreenCanvasContext.drawImage(Z,0,0,Z.width,Z.height);const le=this.offscreenCanvasContext.getImageData(-ne,-ne,Z.width+2*ne,Z.height+2*ne);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),le}}class Xe{decodeRasterArray({task:Z,buffer:ne},le){o.aZ.performDecoding(ne,Z).then(Re=>{le(null,Re)},Re=>{le(Re)})}}function $t(Se,Z){if(Se.length!==0){kt(Se[0],Z);for(var ne=1;ne<Se.length;ne++)kt(Se[ne],!Z)}}function kt(Se,Z){for(var ne=0,le=0,Re=0,Ne=Se.length,Qe=Ne-1;Re<Ne;Qe=Re++){var Pt=(Se[Re][0]-Se[Qe][0])*(Se[Qe][1]+Se[Re][1]),Be=ne+Pt;le+=Math.abs(ne)>=Math.abs(Pt)?ne-Be+Pt:Pt-Be+ne,ne=Be}ne+le>=0!=!!Z&&Se.reverse()}var At=o.dK(function Se(Z,ne){var le,Re=Z&&Z.type;if(Re==="FeatureCollection")for(le=0;le<Z.features.length;le++)Se(Z.features[le],ne);else if(Re==="GeometryCollection")for(le=0;le<Z.geometries.length;le++)Se(Z.geometries[le],ne);else if(Re==="Feature")Se(Z.geometry,ne);else if(Re==="Polygon")$t(Z.coordinates,ne);else if(Re==="MultiPolygon")for(le=0;le<Z.coordinates.length;le++)$t(Z.coordinates[le],ne);return Z});const _i=o.dL.prototype.toGeoJSON;let ai=class{constructor(Se){this._feature=Se,this.extent=o.V,this.type=Se.type,this.properties=Se.tags,"id"in Se&&!isNaN(Se.id)&&(this.id=parseInt(Se.id,10))}loadGeometry(){if(this._feature.type===1){const Se=[];for(const Z of this._feature.geometry)Se.push([new o.P(Z[0],Z[1])]);return Se}{const Se=[];for(const Z of this._feature.geometry){const ne=[];for(const le of Z)ne.push(new o.P(le[0],le[1]));Se.push(ne)}return Se}}toGeoJSON(Se,Z,ne){return _i.call(this,Se,Z,ne)}},Ie=class{constructor(Se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=o.V,this.length=Se.length,this._features=Se}feature(Se){return new ai(this._features[Se])}};var Ti={exports:{}},Wi=o.dN,dt=o.dM.VectorTileFeature,Ei=Dr;function Dr(Se,Z){this.options=Z||{},this.features=Se,this.length=Se.length}function tt(Se,Z){this.id=typeof Se.id=="number"?Se.id:void 0,this.type=Se.type,this.rawGeometry=Se.type===1?[Se.geometry]:Se.geometry,this.properties=Se.tags,this.extent=Z||4096}Dr.prototype.feature=function(Se){return new tt(this.features[Se],this.options.extent)},tt.prototype.loadGeometry=function(){var Se=this.rawGeometry;this.geometry=[];for(var Z=0;Z<Se.length;Z++){for(var ne=Se[Z],le=[],Re=0;Re<ne.length;Re++)le.push(new Wi(ne[Re][0],ne[Re][1]));this.geometry.push(le)}return this.geometry},tt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Se=this.geometry,Z=1/0,ne=-1/0,le=1/0,Re=-1/0,Ne=0;Ne<Se.length;Ne++)for(var Qe=Se[Ne],Pt=0;Pt<Qe.length;Pt++){var Be=Qe[Pt];Z=Math.min(Z,Be.x),ne=Math.max(ne,Be.x),le=Math.min(le,Be.y),Re=Math.max(Re,Be.y)}return[Z,le,ne,Re]},tt.prototype.toGeoJSON=dt.prototype.toGeoJSON;var Ri=o.dO,Zi=Ei;function Nt(Se){var Z=new Ri;return function(ne,le){for(var Re in ne.layers)le.writeMessage(3,Dn,ne.layers[Re])}(Se,Z),Z.finish()}function Dn(Se,Z){var ne;Z.writeVarintField(15,Se.version||1),Z.writeStringField(1,Se.name||""),Z.writeVarintField(5,Se.extent||4096);var le={keys:[],values:[],keycache:{},valuecache:{}};for(ne=0;ne<Se.length;ne++)le.feature=Se.feature(ne),Z.writeMessage(2,Cn,le);var Re=le.keys;for(ne=0;ne<Re.length;ne++)Z.writeStringField(3,Re[ne]);var Ne=le.values;for(ne=0;ne<Ne.length;ne++)Z.writeMessage(4,Us,Ne[ne])}function Cn(Se,Z){var ne=Se.feature;ne.id!==void 0&&Z.writeVarintField(1,ne.id),Z.writeMessage(2,tn,Se),Z.writeVarintField(3,ne.type),Z.writeMessage(4,ns,ne)}function tn(Se,Z){var ne=Se.feature,le=Se.keys,Re=Se.values,Ne=Se.keycache,Qe=Se.valuecache;for(var Pt in ne.properties){var Be=ne.properties[Pt],Dt=Ne[Pt];if(Be!==null){Dt===void 0&&(le.push(Pt),Ne[Pt]=Dt=le.length-1),Z.writeVarint(Dt);var mt=typeof Be;mt!=="string"&&mt!=="boolean"&&mt!=="number"&&(Be=JSON.stringify(Be));var It=mt+":"+Be,vi=Qe[It];vi===void 0&&(Re.push(Be),Qe[It]=vi=Re.length-1),Z.writeVarint(vi)}}}function gr(Se,Z){return(Z<<3)+(7&Se)}function qn(Se){return Se<<1^Se>>31}function ns(Se,Z){for(var ne=Se.loadGeometry(),le=Se.type,Re=0,Ne=0,Qe=ne.length,Pt=0;Pt<Qe;Pt++){var Be=ne[Pt],Dt=1;le===1&&(Dt=Be.length),Z.writeVarint(gr(1,Dt));for(var mt=le===3?Be.length-1:Be.length,It=0;It<mt;It++){It===1&&le!==1&&Z.writeVarint(gr(2,mt-1));var vi=Be[It].x-Re,cr=Be[It].y-Ne;Z.writeVarint(qn(vi)),Z.writeVarint(qn(cr)),Re+=vi,Ne+=cr}le===3&&Z.writeVarint(gr(7,1))}}function Us(Se,Z){var ne=typeof Se;ne==="string"?Z.writeStringField(1,Se):ne==="boolean"?Z.writeBooleanField(7,Se):ne==="number"&&(Se%1!=0?Z.writeDoubleField(3,Se):Se<0?Z.writeSVarintField(6,Se):Z.writeVarintField(5,Se))}Ti.exports=Nt,Ti.exports.fromVectorTileJs=Nt,Ti.exports.fromGeojsonVt=function(Se,Z){Z=Z||{};var ne={};for(var le in Se)ne[le]=new Zi(Se[le].features,Z),ne[le].name=le,ne[le].version=Z.version,ne[le].extent=Z.extent;return Nt({layers:ne})},Ti.exports.GeoJSONWrapper=Zi;var wn=o.dK(Ti.exports);const lt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Se=>Se},Qt=Math.fround||(Gt=new Float32Array(1),Se=>(Gt[0]=+Se,Gt[0]));var Gt;const Kt=3,Xi=5,sr=6;class pe{constructor(Z){this.options=Object.assign(Object.create(lt),Z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Z){const{log:ne,minZoom:le,maxZoom:Re}=this.options;ne&&console.time("total time");const Ne=`prepare ${Z.length} points`;ne&&console.time(Ne),this.points=Z;const Qe=[];for(let Be=0;Be<Z.length;Be++){const Dt=Z[Be];if(!Dt.geometry)continue;const[mt,It]=Dt.geometry.coordinates,vi=Qt(yt(mt)),cr=Qt(rt(It));Qe.push(vi,cr,1/0,Be,-1,1),this.options.reduce&&Qe.push(0)}let Pt=this.trees[Re+1]=this._createTree(Qe);ne&&console.timeEnd(Ne);for(let Be=Re;Be>=le;Be--){const Dt=+Date.now();Pt=this.trees[Be]=this._createTree(this._cluster(Pt,Be)),ne&&console.log("z%d: %d clusters in %dms",Be,Pt.numItems,+Date.now()-Dt)}return ne&&console.timeEnd("total time"),this}getClusters(Z,ne){let le=((Z[0]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,Z[1]));let Ne=Z[2]===180?180:((Z[2]+180)%360+360)%360-180;const Qe=Math.max(-90,Math.min(90,Z[3]));if(Z[2]-Z[0]>=360)le=-180,Ne=180;else if(le>Ne){const It=this.getClusters([le,Re,180,Qe],ne),vi=this.getClusters([-180,Re,Ne,Qe],ne);return It.concat(vi)}const Pt=this.trees[this._limitZoom(ne)],Be=Pt.range(yt(le),rt(Qe),yt(Ne),rt(Re)),Dt=Pt.data,mt=[];for(const It of Be){const vi=this.stride*It;mt.push(Dt[vi+Xi]>1?_e(Dt,vi,this.clusterProps):this.points[Dt[vi+Kt]])}return mt}getChildren(Z){const ne=this._getOriginId(Z),le=this._getOriginZoom(Z),Re="No cluster with the specified id.",Ne=this.trees[le];if(!Ne)throw new Error(Re);const Qe=Ne.data;if(ne*this.stride>=Qe.length)throw new Error(Re);const Pt=this.options.radius/(this.options.extent*Math.pow(2,le-1)),Be=Ne.within(Qe[ne*this.stride],Qe[ne*this.stride+1],Pt),Dt=[];for(const mt of Be){const It=mt*this.stride;Qe[It+4]===Z&&Dt.push(Qe[It+Xi]>1?_e(Qe,It,this.clusterProps):this.points[Qe[It+Kt]])}if(Dt.length===0)throw new Error(Re);return Dt}getLeaves(Z,ne,le){const Re=[];return this._appendLeaves(Re,Z,ne=ne||10,le=le||0,0),Re}getTile(Z,ne,le){const Re=this.trees[this._limitZoom(Z)],Ne=Math.pow(2,Z),{extent:Qe,radius:Pt}=this.options,Be=Pt/Qe,Dt=(le-Be)/Ne,mt=(le+1+Be)/Ne,It={features:[]};return this._addTileFeatures(Re.range((ne-Be)/Ne,Dt,(ne+1+Be)/Ne,mt),Re.data,ne,le,Ne,It),ne===0&&this._addTileFeatures(Re.range(1-Be/Ne,Dt,1,mt),Re.data,Ne,le,Ne,It),ne===Ne-1&&this._addTileFeatures(Re.range(0,Dt,Be/Ne,mt),Re.data,-1,le,Ne,It),It.features.length?It:null}getClusterExpansionZoom(Z){let ne=this._getOriginZoom(Z)-1;for(;ne<=this.options.maxZoom;){const le=this.getChildren(Z);if(ne++,le.length!==1)break;Z=le[0].properties.cluster_id}return ne}_appendLeaves(Z,ne,le,Re,Ne){const Qe=this.getChildren(ne);for(const Pt of Qe){const Be=Pt.properties;if(Be&&Be.cluster?Ne+Be.point_count<=Re?Ne+=Be.point_count:Ne=this._appendLeaves(Z,Be.cluster_id,le,Re,Ne):Ne<Re?Ne++:Z.push(Pt),Z.length===le)break}return Ne}_createTree(Z){const ne=new o.bg(Z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let le=0;le<Z.length;le+=this.stride)ne.add(Z[le],Z[le+1]);return ne.finish(),ne.data=Z,ne}_addTileFeatures(Z,ne,le,Re,Ne,Qe){for(const Pt of Z){const Be=Pt*this.stride,Dt=ne[Be+Xi]>1;let mt,It,vi;if(Dt)mt=Fe(ne,Be,this.clusterProps),It=ne[Be],vi=ne[Be+1];else{const ur=this.points[ne[Be+Kt]];mt=ur.properties;const[rr,Ji]=ur.geometry.coordinates;It=yt(rr),vi=rt(Ji)}const cr={type:1,geometry:[[Math.round(this.options.extent*(It*Ne-le)),Math.round(this.options.extent*(vi*Ne-Re))]],tags:mt};let Mr;Mr=Dt||this.options.generateId?ne[Be+Kt]:this.points[ne[Be+Kt]].id,Mr!==void 0&&(cr.id=Mr),Qe.features.push(cr)}}_limitZoom(Z){return Math.max(this.options.minZoom,Math.min(Math.floor(+Z),this.options.maxZoom+1))}_cluster(Z,ne){const{radius:le,extent:Re,reduce:Ne,minPoints:Qe}=this.options,Pt=le/(Re*Math.pow(2,ne)),Be=Z.data,Dt=[],mt=this.stride;for(let It=0;It<Be.length;It+=mt){if(Be[It+2]<=ne)continue;Be[It+2]=ne;const vi=Be[It],cr=Be[It+1],Mr=Z.within(Be[It],Be[It+1],Pt),ur=Be[It+Xi];let rr=ur;for(const Ji of Mr){const or=Ji*mt;Be[or+2]>ne&&(rr+=Be[or+Xi])}if(rr>ur&&rr>=Qe){let Ji,or=vi*ur,yr=cr*ur,hn=-1;const Tr=(It/mt<<5)+(ne+1)+this.points.length;for(const Vn of Mr){const On=Vn*mt;if(Be[On+2]<=ne)continue;Be[On+2]=ne;const Zn=Be[On+Xi];or+=Be[On]*Zn,yr+=Be[On+1]*Zn,Be[On+4]=Tr,Ne&&(Ji||(Ji=this._map(Be,It,!0),hn=this.clusterProps.length,this.clusterProps.push(Ji)),Ne(Ji,this._map(Be,On)))}Be[It+4]=Tr,Dt.push(or/rr,yr/rr,1/0,Tr,-1,rr),Ne&&Dt.push(hn)}else{for(let Ji=0;Ji<mt;Ji++)Dt.push(Be[It+Ji]);if(rr>1)for(const Ji of Mr){const or=Ji*mt;if(!(Be[or+2]<=ne)){Be[or+2]=ne;for(let yr=0;yr<mt;yr++)Dt.push(Be[or+yr])}}}}return Dt}_getOriginId(Z){return Z-this.points.length>>5}_getOriginZoom(Z){return(Z-this.points.length)%32}_map(Z,ne,le){if(Z[ne+Xi]>1){const Qe=this.clusterProps[Z[ne+sr]];return le?Object.assign({},Qe):Qe}const Re=this.points[Z[ne+Kt]].properties,Ne=this.options.map(Re);return le&&Ne===Re?Object.assign({},Ne):Ne}}function _e(Se,Z,ne){return{type:"Feature",id:Se[Z+Kt],properties:Fe(Se,Z,ne),geometry:{type:"Point",coordinates:[(le=Se[Z],360*(le-.5)),bt(Se[Z+1])]}};var le}function Fe(Se,Z,ne){const le=Se[Z+Xi],Re=le>=1e4?`${Math.round(le/1e3)}k`:le>=1e3?Math.round(le/100)/10+"k":le,Ne=Se[Z+sr],Qe=Ne===-1?{}:Object.assign({},ne[Ne]);return Object.assign(Qe,{cluster:!0,cluster_id:Se[Z+Kt],point_count:le,point_count_abbreviated:Re})}function yt(Se){return Se/360+.5}function rt(Se){const Z=Math.sin(Se*Math.PI/180),ne=.5-.25*Math.log((1+Z)/(1-Z))/Math.PI;return ne<0?0:ne>1?1:ne}function bt(Se){const Z=(180-360*Se)*Math.PI/180;return 360*Math.atan(Math.exp(Z))/Math.PI-90}var qt={exports:{}};qt.exports=function(){function Se(ke,Ve,it,ft){for(var ot,gt=ft,vt=it-Ve>>1,ct=it-Ve,Et=ke[Ve],pt=ke[Ve+1],ii=ke[it],Li=ke[it+1],jt=Ve+3;jt<it;jt+=3){var hr=Z(ke[jt],ke[jt+1],Et,pt,ii,Li);if(hr>gt)ot=jt,gt=hr;else if(hr===gt){var Pr=Math.abs(jt-vt);Pr<ct&&(ot=jt,ct=Pr)}}gt>ft&&(ot-Ve>3&&Se(ke,Ve,ot,ft),ke[ot+2]=gt,it-ot>3&&Se(ke,ot,it,ft))}function Z(ke,Ve,it,ft,ot,gt){var vt=ot-it,ct=gt-ft;if(vt!==0||ct!==0){var Et=((ke-it)*vt+(Ve-ft)*ct)/(vt*vt+ct*ct);Et>1?(it=ot,ft=gt):Et>0&&(it+=vt*Et,ft+=ct*Et)}return(vt=ke-it)*vt+(ct=Ve-ft)*ct}function ne(ke,Ve,it,ft){var ot={id:ke===void 0?null:ke,type:Ve,geometry:it,tags:ft,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(gt){var vt=gt.geometry,ct=gt.type;if(ct==="Point"||ct==="MultiPoint"||ct==="LineString")le(gt,vt);else if(ct==="Polygon"||ct==="MultiLineString")for(var Et=0;Et<vt.length;Et++)le(gt,vt[Et]);else if(ct==="MultiPolygon")for(Et=0;Et<vt.length;Et++)for(var pt=0;pt<vt[Et].length;pt++)le(gt,vt[Et][pt])}(ot),ot}function le(ke,Ve){for(var it=0;it<Ve.length;it+=3)ke.minX=Math.min(ke.minX,Ve[it]),ke.minY=Math.min(ke.minY,Ve[it+1]),ke.maxX=Math.max(ke.maxX,Ve[it]),ke.maxY=Math.max(ke.maxY,Ve[it+1])}function Re(ke,Ve,it,ft){if(Ve.geometry){var ot=Ve.geometry.coordinates,gt=Ve.geometry.type,vt=Math.pow(it.tolerance/((1<<it.maxZoom)*it.extent),2),ct=[],Et=Ve.id;if(it.promoteId?Et=Ve.properties[it.promoteId]:it.generateId&&(Et=ft||0),gt==="Point")Ne(ot,ct);else if(gt==="MultiPoint")for(var pt=0;pt<ot.length;pt++)Ne(ot[pt],ct);else if(gt==="LineString")Qe(ot,ct,vt,!1);else if(gt==="MultiLineString"){if(it.lineMetrics){for(pt=0;pt<ot.length;pt++)Qe(ot[pt],ct=[],vt,!1),ke.push(ne(Et,"LineString",ct,Ve.properties));return}Pt(ot,ct,vt,!1)}else if(gt==="Polygon")Pt(ot,ct,vt,!0);else{if(gt!=="MultiPolygon"){if(gt==="GeometryCollection"){for(pt=0;pt<Ve.geometry.geometries.length;pt++)Re(ke,{id:Et,geometry:Ve.geometry.geometries[pt],properties:Ve.properties},it,ft);return}throw new Error("Input data is not a valid GeoJSON object.")}for(pt=0;pt<ot.length;pt++){var ii=[];Pt(ot[pt],ii,vt,!0),ct.push(ii)}}ke.push(ne(Et,gt,ct,Ve.properties))}}function Ne(ke,Ve){Ve.push(Be(ke[0])),Ve.push(Dt(ke[1])),Ve.push(0)}function Qe(ke,Ve,it,ft){for(var ot,gt,vt=0,ct=0;ct<ke.length;ct++){var Et=Be(ke[ct][0]),pt=Dt(ke[ct][1]);Ve.push(Et),Ve.push(pt),Ve.push(0),ct>0&&(vt+=ft?(ot*pt-Et*gt)/2:Math.sqrt(Math.pow(Et-ot,2)+Math.pow(pt-gt,2))),ot=Et,gt=pt}var ii=Ve.length-3;Ve[2]=1,Se(Ve,0,ii,it),Ve[ii+2]=1,Ve.size=Math.abs(vt),Ve.start=0,Ve.end=Ve.size}function Pt(ke,Ve,it,ft){for(var ot=0;ot<ke.length;ot++){var gt=[];Qe(ke[ot],gt,it,ft),Ve.push(gt)}}function Be(ke){return ke/360+.5}function Dt(ke){var Ve=Math.sin(ke*Math.PI/180),it=.5-.25*Math.log((1+Ve)/(1-Ve))/Math.PI;return it<0?0:it>1?1:it}function mt(ke,Ve,it,ft,ot,gt,vt,ct){if(ft/=Ve,gt>=(it/=Ve)&&vt<ft)return ke;if(vt<it||gt>=ft)return null;for(var Et=[],pt=0;pt<ke.length;pt++){var ii=ke[pt],Li=ii.geometry,jt=ii.type,hr=ot===0?ii.minX:ii.minY,Pr=ot===0?ii.maxX:ii.maxY;if(hr>=it&&Pr<ft)Et.push(ii);else if(!(Pr<it||hr>=ft)){var mr=[];if(jt==="Point"||jt==="MultiPoint")It(Li,mr,it,ft,ot);else if(jt==="LineString")vi(Li,mr,it,ft,ot,!1,ct.lineMetrics);else if(jt==="MultiLineString")Mr(Li,mr,it,ft,ot,!1);else if(jt==="Polygon")Mr(Li,mr,it,ft,ot,!0);else if(jt==="MultiPolygon")for(var nn=0;nn<Li.length;nn++){var Tn=[];Mr(Li[nn],Tn,it,ft,ot,!0),Tn.length&&mr.push(Tn)}if(mr.length){if(ct.lineMetrics&&jt==="LineString"){for(nn=0;nn<mr.length;nn++)Et.push(ne(ii.id,jt,mr[nn],ii.tags));continue}jt!=="LineString"&&jt!=="MultiLineString"||(mr.length===1?(jt="LineString",mr=mr[0]):jt="MultiLineString"),jt!=="Point"&&jt!=="MultiPoint"||(jt=mr.length===3?"Point":"MultiPoint"),Et.push(ne(ii.id,jt,mr,ii.tags))}}}return Et.length?Et:null}function It(ke,Ve,it,ft,ot){for(var gt=0;gt<ke.length;gt+=3){var vt=ke[gt+ot];vt>=it&&vt<=ft&&(Ve.push(ke[gt]),Ve.push(ke[gt+1]),Ve.push(ke[gt+2]))}}function vi(ke,Ve,it,ft,ot,gt,vt){for(var ct,Et,pt=cr(ke),ii=ot===0?rr:Ji,Li=ke.start,jt=0;jt<ke.length-3;jt+=3){var hr=ke[jt],Pr=ke[jt+1],mr=ke[jt+2],nn=ke[jt+3],Tn=ke[jt+4],Ki=ot===0?hr:Pr,ss=ot===0?nn:Tn,Es=!1;vt&&(ct=Math.sqrt(Math.pow(hr-nn,2)+Math.pow(Pr-Tn,2))),Ki<it?ss>it&&(Et=ii(pt,hr,Pr,nn,Tn,it),vt&&(pt.start=Li+ct*Et)):Ki>ft?ss<ft&&(Et=ii(pt,hr,Pr,nn,Tn,ft),vt&&(pt.start=Li+ct*Et)):ur(pt,hr,Pr,mr),ss<it&&Ki>=it&&(Et=ii(pt,hr,Pr,nn,Tn,it),Es=!0),ss>ft&&Ki<=ft&&(Et=ii(pt,hr,Pr,nn,Tn,ft),Es=!0),!gt&&Es&&(vt&&(pt.end=Li+ct*Et),Ve.push(pt),pt=cr(ke)),vt&&(Li+=ct)}var En=ke.length-3;hr=ke[En],Pr=ke[En+1],mr=ke[En+2],(Ki=ot===0?hr:Pr)>=it&&Ki<=ft&&ur(pt,hr,Pr,mr),En=pt.length-3,gt&&En>=3&&(pt[En]!==pt[0]||pt[En+1]!==pt[1])&&ur(pt,pt[0],pt[1],pt[2]),pt.length&&Ve.push(pt)}function cr(ke){var Ve=[];return Ve.size=ke.size,Ve.start=ke.start,Ve.end=ke.end,Ve}function Mr(ke,Ve,it,ft,ot,gt){for(var vt=0;vt<ke.length;vt++)vi(ke[vt],Ve,it,ft,ot,gt,!1)}function ur(ke,Ve,it,ft){ke.push(Ve),ke.push(it),ke.push(ft)}function rr(ke,Ve,it,ft,ot,gt){var vt=(gt-Ve)/(ft-Ve);return ke.push(gt),ke.push(it+(ot-it)*vt),ke.push(1),vt}function Ji(ke,Ve,it,ft,ot,gt){var vt=(gt-it)/(ot-it);return ke.push(Ve+(ft-Ve)*vt),ke.push(gt),ke.push(1),vt}function or(ke,Ve){for(var it=[],ft=0;ft<ke.length;ft++){var ot,gt=ke[ft],vt=gt.type;if(vt==="Point"||vt==="MultiPoint"||vt==="LineString")ot=yr(gt.geometry,Ve);else if(vt==="MultiLineString"||vt==="Polygon"){ot=[];for(var ct=0;ct<gt.geometry.length;ct++)ot.push(yr(gt.geometry[ct],Ve))}else if(vt==="MultiPolygon")for(ot=[],ct=0;ct<gt.geometry.length;ct++){for(var Et=[],pt=0;pt<gt.geometry[ct].length;pt++)Et.push(yr(gt.geometry[ct][pt],Ve));ot.push(Et)}it.push(ne(gt.id,vt,ot,gt.tags))}return it}function yr(ke,Ve){var it=[];it.size=ke.size,ke.start!==void 0&&(it.start=ke.start,it.end=ke.end);for(var ft=0;ft<ke.length;ft+=3)it.push(ke[ft]+Ve,ke[ft+1],ke[ft+2]);return it}function hn(ke,Ve){if(ke.transformed)return ke;var it,ft,ot,gt=1<<ke.z,vt=ke.x,ct=ke.y;for(it=0;it<ke.features.length;it++){var Et=ke.features[it],pt=Et.geometry,ii=Et.type;if(Et.geometry=[],ii===1)for(ft=0;ft<pt.length;ft+=2)Et.geometry.push(Tr(pt[ft],pt[ft+1],Ve,gt,vt,ct));else for(ft=0;ft<pt.length;ft++){var Li=[];for(ot=0;ot<pt[ft].length;ot+=2)Li.push(Tr(pt[ft][ot],pt[ft][ot+1],Ve,gt,vt,ct));Et.geometry.push(Li)}}return ke.transformed=!0,ke}function Tr(ke,Ve,it,ft,ot,gt){return[Math.round(it*(ke*ft-ot)),Math.round(it*(Ve*ft-gt))]}function Vn(ke,Ve,it,ft,ot){for(var gt=Ve===ot.maxZoom?0:ot.tolerance/((1<<Ve)*ot.extent),vt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:it,y:ft,z:Ve,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ct=0;ct<ke.length;ct++){vt.numFeatures++,On(vt,ke[ct],gt,ot);var Et=ke[ct].minX,pt=ke[ct].minY,ii=ke[ct].maxX,Li=ke[ct].maxY;Et<vt.minX&&(vt.minX=Et),pt<vt.minY&&(vt.minY=pt),ii>vt.maxX&&(vt.maxX=ii),Li>vt.maxY&&(vt.maxY=Li)}return vt}function On(ke,Ve,it,ft){var ot=Ve.geometry,gt=Ve.type,vt=[];if(gt==="Point"||gt==="MultiPoint")for(var ct=0;ct<ot.length;ct+=3)vt.push(ot[ct]),vt.push(ot[ct+1]),ke.numPoints++,ke.numSimplified++;else if(gt==="LineString")Zn(vt,ot,ke,it,!1,!1);else if(gt==="MultiLineString"||gt==="Polygon")for(ct=0;ct<ot.length;ct++)Zn(vt,ot[ct],ke,it,gt==="Polygon",ct===0);else if(gt==="MultiPolygon")for(var Et=0;Et<ot.length;Et++){var pt=ot[Et];for(ct=0;ct<pt.length;ct++)Zn(vt,pt[ct],ke,it,!0,ct===0)}if(vt.length){var ii=Ve.tags||null;if(gt==="LineString"&&ft.lineMetrics){for(var Li in ii={},Ve.tags)ii[Li]=Ve.tags[Li];ii.mapbox_clip_start=ot.start/ot.size,ii.mapbox_clip_end=ot.end/ot.size}var jt={geometry:vt,type:gt==="Polygon"||gt==="MultiPolygon"?3:gt==="LineString"||gt==="MultiLineString"?2:1,tags:ii};Ve.id!==null&&(jt.id=Ve.id),ke.features.push(jt)}}function Zn(ke,Ve,it,ft,ot,gt){var vt=ft*ft;if(ft>0&&Ve.size<(ot?vt:ft))it.numPoints+=Ve.length/3;else{for(var ct=[],Et=0;Et<Ve.length;Et+=3)(ft===0||Ve[Et+2]>vt)&&(it.numSimplified++,ct.push(Ve[Et]),ct.push(Ve[Et+1])),it.numPoints++;ot&&function(pt,ii){for(var Li=0,jt=0,hr=pt.length,Pr=hr-2;jt<hr;Pr=jt,jt+=2)Li+=(pt[jt]-pt[Pr])*(pt[jt+1]+pt[Pr+1]);if(Li>0===ii)for(jt=0,hr=pt.length;jt<hr/2;jt+=2){var mr=pt[jt],nn=pt[jt+1];pt[jt]=pt[hr-2-jt],pt[jt+1]=pt[hr-1-jt],pt[hr-2-jt]=mr,pt[hr-1-jt]=nn}}(ct,gt),ke.push(ct)}}function rn(ke,Ve){var it=(Ve=this.options=function(ot,gt){for(var vt in gt)ot[vt]=gt[vt];return ot}(Object.create(this.options),Ve)).debug;if(it&&console.time("preprocess data"),Ve.maxZoom<0||Ve.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Ve.promoteId&&Ve.generateId)throw new Error("promoteId and generateId cannot be used together.");var ft=function(ot,gt){var vt=[];if(ot.type==="FeatureCollection")for(var ct=0;ct<ot.features.length;ct++)Re(vt,ot.features[ct],gt,ct);else Re(vt,ot.type==="Feature"?ot:{geometry:ot},gt);return vt}(ke,Ve);this.tiles={},this.tileCoords=[],it&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Ve.indexMaxZoom,Ve.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ft=function(ot,gt){var vt=gt.buffer/gt.extent,ct=ot,Et=mt(ot,1,-1-vt,vt,0,-1,2,gt),pt=mt(ot,1,1-vt,2+vt,0,-1,2,gt);return(Et||pt)&&(ct=mt(ot,1,-vt,1+vt,0,-1,2,gt)||[],Et&&(ct=or(Et,1).concat(ct)),pt&&(ct=ct.concat(or(pt,-1)))),ct}(ft,Ve)).length&&this.splitTile(ft,0,0,0),it&&(ft.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Yr(ke,Ve,it){return 32*((1<<ke)*it+Ve)+ke}return rn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},rn.prototype.splitTile=function(ke,Ve,it,ft,ot,gt,vt){for(var ct=[ke,Ve,it,ft],Et=this.options,pt=Et.debug;ct.length;){ft=ct.pop(),it=ct.pop(),Ve=ct.pop(),ke=ct.pop();var ii=1<<Ve,Li=Yr(Ve,it,ft),jt=this.tiles[Li];if(!jt&&(pt>1&&console.time("creation"),jt=this.tiles[Li]=Vn(ke,Ve,it,ft,Et),this.tileCoords.push({z:Ve,x:it,y:ft}),pt)){pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Ve,it,ft,jt.numFeatures,jt.numPoints,jt.numSimplified),console.timeEnd("creation"));var hr="z"+Ve;this.stats[hr]=(this.stats[hr]||0)+1,this.total++}if(jt.source=ke,ot){if(Ve===Et.maxZoom||Ve===ot)continue;var Pr=1<<ot-Ve;if(it!==Math.floor(gt/Pr)||ft!==Math.floor(vt/Pr))continue}else if(Ve===Et.indexMaxZoom||jt.numPoints<=Et.indexMaxPoints)continue;if(jt.source=null,ke.length!==0){pt>1&&console.time("clipping");var mr,nn,Tn,Ki,ss,Es,En=.5*Et.buffer/Et.extent,zl=.5-En,wo=.5+En,Sa=1+En;mr=nn=Tn=Ki=null,ss=mt(ke,ii,it-En,it+wo,0,jt.minX,jt.maxX,Et),Es=mt(ke,ii,it+zl,it+Sa,0,jt.minX,jt.maxX,Et),ke=null,ss&&(mr=mt(ss,ii,ft-En,ft+wo,1,jt.minY,jt.maxY,Et),nn=mt(ss,ii,ft+zl,ft+Sa,1,jt.minY,jt.maxY,Et),ss=null),Es&&(Tn=mt(Es,ii,ft-En,ft+wo,1,jt.minY,jt.maxY,Et),Ki=mt(Es,ii,ft+zl,ft+Sa,1,jt.minY,jt.maxY,Et),Es=null),pt>1&&console.timeEnd("clipping"),ct.push(mr||[],Ve+1,2*it,2*ft),ct.push(nn||[],Ve+1,2*it,2*ft+1),ct.push(Tn||[],Ve+1,2*it+1,2*ft),ct.push(Ki||[],Ve+1,2*it+1,2*ft+1)}}},rn.prototype.getTile=function(ke,Ve,it){var ft=this.options,ot=ft.extent,gt=ft.debug;if(ke<0||ke>24)return null;var vt=1<<ke,ct=Yr(ke,Ve=(Ve%vt+vt)%vt,it);if(this.tiles[ct])return hn(this.tiles[ct],ot);gt>1&&console.log("drilling down to z%d-%d-%d",ke,Ve,it);for(var Et,pt=ke,ii=Ve,Li=it;!Et&&pt>0;)pt--,ii=Math.floor(ii/2),Li=Math.floor(Li/2),Et=this.tiles[Yr(pt,ii,Li)];return Et&&Et.source?(gt>1&&console.log("found parent tile z%d-%d-%d",pt,ii,Li),gt>1&&console.time("drilling down"),this.splitTile(Et.source,pt,ii,Li,ke,Ve,it),gt>1&&console.timeEnd("drilling down"),this.tiles[ct]?hn(this.tiles[ct],ot):null):null},function(ke,Ve){return new rn(ke,Ve)}}();var wt=o.dK(qt.exports);function Vt(Se,Z){const ne=Se.tileID.canonical;if(!this._geoJSONIndex)return Z(null,null);const le=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!le)return Z(null,null);const Re=new Ie(le.features);let Ne=wn(Re);Ne.byteOffset===0&&Ne.byteLength===Ne.buffer.byteLength||(Ne=new Uint8Array(Ne)),Z(null,{vectorTile:Re,rawData:Ne.buffer})}class Tt extends et{constructor(Z,ne,le,Re,Ne,Qe){super(Z,ne,le,Re,Vt,Qe),Ne&&(this.loadGeoJSON=Ne)}loadData(Z,ne){const le=Z&&Z.request,Re=le&&le.collectResourceTiming;this.loadGeoJSON(Z,(Ne,Qe)=>{if(Ne||!Qe)return ne(Ne);if(typeof Qe!="object")return ne(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));{At(Qe,!0);try{if(Z.filter){const Be=o.r(Z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(mt=>`${mt.key}: ${mt.message}`).join(", "));Qe={type:"FeatureCollection",features:Qe.features.filter(mt=>Be.value.evaluate({zoom:0},mt))}}this._geoJSONIndex=Z.cluster?new pe(function({superclusterOptions:Be,clusterProperties:Dt}){if(!Dt||!Be)return Be;const mt={},It={},vi={accumulated:null,zoom:0},cr={properties:null},Mr=Object.keys(Dt);for(const ur of Mr){const[rr,Ji]=Dt[ur],or=o.r(Ji),yr=o.r(typeof rr=="string"?[rr,["accumulated"],["get",ur]]:rr);mt[ur]=or.value,It[ur]=yr.value}return Be.map=ur=>{cr.properties=ur;const rr={};for(const Ji of Mr)rr[Ji]=mt[Ji].evaluate(vi,cr);return rr},Be.reduce=(ur,rr)=>{cr.properties=rr;for(const Ji of Mr)vi.accumulated=ur[Ji],ur[Ji]=It[Ji].evaluate(vi,cr)},Be}(Z)).load(Qe.features):wt(Qe,Z.geojsonVtOptions)}catch(Be){return ne(Be)}this.loaded={};const Pt={};if(Re){const Be=Y(le);Be&&(Pt.resourceTiming={},Pt.resourceTiming[Z.source]=JSON.parse(JSON.stringify(Be)))}ne(null,Pt)}})}reloadTile(Z,ne){const le=this.loaded;return le&&le[Z.uid]?super.reloadTile(Z,ne):this.loadTile(Z,ne)}loadGeoJSON(Z,ne){if(Z.request)o.g(Z.request,ne);else{if(typeof Z.data!="string")return ne(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`));try{return ne(null,JSON.parse(Z.data))}catch{return ne(new Error(`Input data given to '${Z.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Z,ne){try{ne(null,this._geoJSONIndex.getClusterExpansionZoom(Z.clusterId))}catch(le){ne(le)}}getClusterChildren(Z,ne){try{ne(null,this._geoJSONIndex.getChildren(Z.clusterId))}catch(le){ne(le)}}getClusterLeaves(Z,ne){try{ne(null,this._geoJSONIndex.getLeaves(Z.clusterId,Z.limit,Z.offset))}catch(le){ne(le)}}}class Ht{constructor(Z,ne){this.tileID=new o.am(Z.tileID.overscaledZ,Z.tileID.wrap,Z.tileID.canonical.z,Z.tileID.canonical.x,Z.tileID.canonical.y),this.tileZoom=Z.tileZoom,this.uid=Z.uid,this.zoom=Z.zoom,this.canonical=Z.tileID.canonical,this.pixelRatio=Z.pixelRatio,this.tileSize=Z.tileSize,this.source=Z.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Z.projection,this.brightness=ne}parse(Z,ne,le,Re){this.status="parsing";const Ne=new o.am(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),Qe={},Pt=ne.familiesBySource[le.source],Be=new o.dC(Ne,le.promoteId);return Be.bucketLayerIDs=[],Be.is3DTile=!0,o.dP(Z).then(Dt=>{if(!Dt)return Re(new Error("Could not parse tile"));const mt=o.dQ(Dt,1/o.bR(le.tileID.canonical)),It=Dt.json.extensionsUsed&&Dt.json.extensionsUsed.includes("MAPBOX_mesh_features")||Dt.json.asset.extras&&Dt.json.asset.extras.MAPBOX_mesh_features,vi=Dt.json.extensionsUsed&&Dt.json.extensionsUsed.includes("EXT_meshopt_compression"),cr=new o.K(this.zoom,{brightness:this.brightness});for(const Mr in Pt)for(const ur of Pt[Mr]){const rr=ur[0];Be.bucketLayerIDs.push(ur.map(or=>or.id)),rr.recalculate(cr,[]);const Ji=new o.dR(mt,Ne,It,vi,this.brightness,Be);It||(Ji.needsUpload=!0),Qe[rr.fqid]=Ji,Ji.evaluate(rr)}this.status="done",Re(null,{buckets:Qe,featureIndex:Be})}).catch(Dt=>Re(new Error(Dt.message)))}}class oi{constructor(Z,ne,le,Re,Ne,Qe){this.actor=Z,this.layerIndex=ne,this.brightness=Qe,this.loading={},this.loaded={}}loadTile(Z,ne){const le=Z.uid,Re=this.loading[le]=new Ht(Z,this.brightness);o.a_(Z.request,(Ne,Qe)=>{const Pt=!this.loading[le];return delete this.loading[le],Pt||Ne?(Re.status="done",Pt||(this.loaded[le]=Re),ne(Ne)):Qe&&Qe.byteLength!==0?void Re.parse(Qe,this.layerIndex,Z,(Be,Dt)=>{Re.status="done",this.loaded=this.loaded||{},this.loaded[le]=Re,Be||!Dt?ne(Be):ne(null,Dt)}):(Re.status="done",this.loaded[le]=Re,ne())})}reloadTile(Z,ne){const le=this.loaded,Re=Z.uid;if(le&&le[Re]){const Ne=le[Re];Ne.projection=Z.projection,Ne.brightness=Z.brightness;const Qe=(Pt,Be)=>{Ne.reloadCallback&&(delete Ne.reloadCallback,this.loadTile(Z,ne)),ne(Pt,Be)};Ne.status==="parsing"?Ne.reloadCallback=Qe:Ne.status==="done"&&this.loadTile(Z,ne)}}abortTile(Z,ne){const le=Z.uid;this.loading[le]&&delete this.loading[le],ne()}removeTile(Z,ne){const le=this.loaded,Re=Z.uid;le&&le[Re]&&delete le[Re],ne()}}class ni{constructor(Z){this.self=Z,this.actor=new o.dS(Z,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=o.bo({name:"mercator"}),this.workerSourceTypes={vector:et,geojson:Tt,"batched-model":oi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ne,le)=>{if(this.workerSourceTypes[ne])throw new Error(`Worker source with name "${ne}" already registered.`);this.workerSourceTypes[ne]=le},this.self.registerRTLTextPlugin=ne=>{if(o.dT.isParsed())throw new Error("RTL text plugin already registered.");o.dT.applyArabicShaping=ne.applyArabicShaping,o.dT.processBidirectionalText=ne.processBidirectionalText,o.dT.processStyledBidirectionalText=ne.processStyledBidirectionalText}}clearCaches(Z,ne,le){delete this.layerIndexes[Z],delete this.availableImages[Z],delete this.workerSources[Z],delete this.demWorkerSources[Z],delete this.rasterArrayWorkerSource,le()}checkIfReady(Z,ne,le){le()}setReferrer(Z,ne){this.referrer=ne}spriteLoaded(Z,{scope:ne,isLoaded:le}){if(this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={}),this.isSpriteLoaded[Z][ne]=le,this.workerSources[Z]&&this.workerSources[Z][ne])for(const Re in this.workerSources[Z][ne]){const Ne=this.workerSources[Z][ne][Re];for(const Qe in Ne)Ne[Qe]instanceof et&&(Ne[Qe].isSpriteLoaded=le,Ne[Qe].fire(new o.b("isSpriteLoaded")))}}setImages(Z,{scope:ne,images:le},Re){if(this.availableImages[Z]||(this.availableImages[Z]={}),this.availableImages[Z][ne]=le,this.workerSources[Z]&&this.workerSources[Z][ne]){for(const Ne in this.workerSources[Z][ne]){const Qe=this.workerSources[Z][ne][Ne];for(const Pt in Qe)Qe[Pt].availableImages=le}Re()}else Re()}setProjection(Z,ne){this.projections[Z]=o.bo(ne)}setBrightness(Z,ne,le){this.brightness=ne,le()}setLayers(Z,ne,le){this.getLayerIndex(Z,ne.scope).replace(ne.layers,ne.options),le()}updateLayers(Z,ne,le){this.getLayerIndex(Z,ne.scope).update(ne.layers,ne.removedIds,ne.options),le()}loadTile(Z,ne,le){ne.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,ne.type,ne.source,ne.scope).loadTile(ne,le)}loadDEMTile(Z,ne,le){this.getDEMWorkerSource(Z,ne.source,ne.scope).loadTile(ne,le)}decodeRasterArray(Z,ne,le){this.getRasterArrayWorkerSource().decodeRasterArray(ne,le)}reloadTile(Z,ne,le){ne.projection=this.projections[Z]||this.defaultProjection,this.getWorkerSource(Z,ne.type,ne.source,ne.scope).reloadTile(ne,le)}abortTile(Z,ne,le){this.getWorkerSource(Z,ne.type,ne.source,ne.scope).abortTile(ne,le)}removeTile(Z,ne,le){this.getWorkerSource(Z,ne.type,ne.source,ne.scope).removeTile(ne,le)}removeSource(Z,ne,le){if(!(this.workerSources[Z]&&this.workerSources[Z][ne.scope]&&this.workerSources[Z][ne.scope][ne.type]&&this.workerSources[Z][ne.scope][ne.type][ne.source]))return;const Re=this.workerSources[Z][ne.scope][ne.type][ne.source];delete this.workerSources[Z][ne.scope][ne.type][ne.source],Re.removeSource!==void 0?Re.removeSource(ne,le):le()}loadWorkerSource(Z,ne,le){try{this.self.importScripts(ne.url),le()}catch(Re){le(Re.toString())}}syncRTLPluginState(Z,ne,le){try{o.dT.setState(ne);const Re=o.dT.getPluginURL();if(o.dT.isLoaded()&&!o.dT.isParsed()&&Re!=null){this.self.importScripts(Re);const Ne=o.dT.isParsed();le(Ne?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Re}`),Ne)}}catch(Re){le(Re.toString())}}setDracoUrl(Z,ne){this.dracoUrl=ne}getAvailableImages(Z,ne){this.availableImages[Z]||(this.availableImages[Z]={});let le=this.availableImages[Z][ne];return le||(le=[]),le}getLayerIndex(Z,ne){this.layerIndexes[Z]||(this.layerIndexes[Z]={});let le=this.layerIndexes[Z][ne];return le||(le=this.layerIndexes[Z][ne]=new de,le.scope=ne),le}getWorkerSource(Z,ne,le,Re){if(this.workerSources[Z]||(this.workerSources[Z]={}),this.workerSources[Z][Re]||(this.workerSources[Z][Re]={}),this.workerSources[Z][Re][ne]||(this.workerSources[Z][Re][ne]={}),this.isSpriteLoaded[Z]||(this.isSpriteLoaded[Z]={}),!this.workerSources[Z][Re][ne][le]){const Ne={send:(Qe,Pt,Be,Dt,mt,It)=>{this.actor.send(Qe,Pt,Be,Z,mt,It)},scheduler:this.actor.scheduler};this.workerSources[Z][Re][ne][le]=new this.workerSourceTypes[ne](Ne,this.getLayerIndex(Z,Re),this.getAvailableImages(Z,Re),this.isSpriteLoaded[Z][Re],void 0,this.brightness)}return this.workerSources[Z][Re][ne][le]}getDEMWorkerSource(Z,ne,le){return this.demWorkerSources[Z]||(this.demWorkerSources[Z]={}),this.demWorkerSources[Z][le]||(this.demWorkerSources[Z][le]={}),this.demWorkerSources[Z][le][ne]||(this.demWorkerSources[Z][le][ne]=new ht),this.demWorkerSources[Z][le][ne]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Xe),this.rasterArrayWorkerSource}enforceCacheSizeLimit(Z,ne){o.dU(ne)}getWorkerPerformanceMetrics(Z,ne,le){le(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ni(self)),ni}),z(["./shared"],function(o){function Y(u,r){if(Array.isArray(u)){if(!Array.isArray(r)||u.length!==r.length)return!1;for(let s=0;s<u.length;s++)if(!Y(u[s],r[s]))return!1;return!0}if(typeof u=="object"&&u!==null&&r!==null){if(typeof r!="object"||Object.keys(u).length!==Object.keys(r).length)return!1;for(const s in u)if(!Y(u[s],r[s]))return!1;return!0}return u===r}var ie=K;function K(u){return!function(r){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var h,p,_=new Blob([""],{type:"text/javascript"}),x=URL.createObjectURL(_);try{p=new Worker(x),h=!0}catch{h=!1}return p&&p.terminate(),URL.revokeObjectURL(x),h}()?function(){var h=document.createElement("canvas");h.width=h.height=1;var p=h.getContext("2d");if(!p)return!1;var _=p.getImageData(0,0,1,1);return _&&_.width===h.width}()?(de[s=r&&r.failIfMajorPerformanceCaveat]===void 0&&(de[s]=function(h){var p,_=function(x){var T=document.createElement("canvas"),S=Object.create(K.webGLContextAttributes);return S.failIfMajorPerformanceCaveat=x,T.getContext("webgl2",S)}(h);if(!_)return!1;try{p=_.createShader(_.VERTEX_SHADER)}catch{return!1}return!(!p||_.isContextLost())&&(_.shaderSource(p,"void main() {}"),_.compileShader(p),_.getShaderParameter(p,_.COMPILE_STATUS)===!0)}(s)),de[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var s}(u)}var de={};function ce(u,r,s){const h=document.createElement(u);return r!=null&&(h.className=r),s&&s.appendChild(h),h}function Ee(u,r,s){const h=document.createElementNS("http://www.w3.org/2000/svg",u);for(const p of Object.keys(r))h.setAttributeNS(null,p,String(r[p]));return s&&s.appendChild(h),h}K.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ue=typeof document<"u"?document.documentElement&&document.documentElement.style:null,$e=Ue&&Ue.userSelect!==void 0?"userSelect":"WebkitUserSelect";let et;function ht(){Ue&&$e&&(et=Ue[$e],Ue[$e]="none")}function Xe(){Ue&&$e&&(Ue[$e]=et)}function $t(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",$t,!0)}function kt(){window.addEventListener("click",$t,!0),window.setTimeout(()=>{window.removeEventListener("click",$t,!0)},0)}function At(u,r){const s=u.getBoundingClientRect();return Ie(u,s,r)}function _i(u,r){const s=u.getBoundingClientRect(),h=[];for(let p=0;p<r.length;p++)h.push(Ie(u,s,r[p]));return h}function ai(u){return window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button}function Ie(u,r,s){const h=u.offsetWidth===r.width?1:u.offsetWidth/r.width;return new o.P((s.clientX-r.left)*h,(s.clientY-r.top)*h)}class Ti{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,s){this._updatedSourceCaches[r]=s,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const s=r.scope;this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._updatedLayers[s].add(r.id),this.setDirty()}removeLayer(r){const s=r.scope;this._removedLayers[s]=this._removedLayers[s]||{},this._updatedLayers[s]=this._updatedLayers[s]||new Set,this._removedLayers[s][r.id]=r,this._updatedLayers[s].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const s in this._updatedLayers)r[s]=r[s]||{},r[s].updatedIds=Array.from(this._updatedLayers[s].values());for(const s in this._removedLayers)r[s]=r[s]||{},r[s].removedIds=Object.keys(this._removedLayers[s]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(r){this._updatedImages.add(r),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}class Wi extends o.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.numModelsLoading={}}loadModel(r,s){return o.l(this.requestManager.transformRequest(s,o.R.Model).url).then(h=>{if(!h)return;const p=o.c(h),_=new o.M(r,void 0,void 0,p);return _.computeBoundsAndApplyParent(),_}).catch(h=>{this.fire(new o.a(new Error(`Could not load model ${r} from ${s}: ${h.message}`)))})}load(r,s){this.models[s]||(this.models[s]={});const h=Object.keys(r);this.numModelsLoading[s]=(this.numModelsLoading[s]||0)+h.length;const p=[];for(const _ of h)p.push(this.loadModel(_,r[_]));Promise.allSettled(p).then(_=>{for(let x=0;x<_.length;x++){const{status:T,value:S}=_[x];T==="fulfilled"&&S&&(this.models[s][h[x]]=S)}this.numModelsLoading[s]-=h.length,this.fire(new o.b("data",{dataType:"style"}))}).catch(_=>{this.fire(new o.a(new Error(`Could not load models: ${_.message}`)))})}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,s){return!!this.getModel(r,s)}getModel(r,s){return this.models[s]||(this.models[s]={}),this.models[s][r]}addModel(r,s,h){this.models[h]||(this.models[h]={}),this.hasModel(r,h)&&this.removeModel(r,h),this.load({[r]:this.requestManager.normalizeModelURL(s)},h)}addModels(r,s){const h={};for(const p in r)h[p]=this.requestManager.normalizeModelURL(r[p]);this.load(h,s)}removeModel(r,s){this.models[s]||(this.models[s]={});const h=this.models[s][r];delete this.models[s][r],h.destroy()}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,s){this.models[s]||(this.models[s]={});for(const h in this.models[s])this.models[s][h].upload(r.context)}}class dt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,s,h){const p=String(s);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][p]=this.stateChanges[r][p]||{},o.e(this.stateChanges[r][p],h),this.deletedStates[r]===null){this.deletedStates[r]={};for(const _ in this.state[r])_!==p&&(this.deletedStates[r][_]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][p]===null){this.deletedStates[r][p]={};for(const _ in this.state[r][p])h[_]||(this.deletedStates[r][p][_]=null)}else for(const _ in h)this.deletedStates[r]&&this.deletedStates[r][p]&&this.deletedStates[r][p][_]===null&&delete this.deletedStates[r][p][_]}removeFeatureState(r,s,h){if(this.deletedStates[r]===null)return;const p=String(s);if(this.deletedStates[r]=this.deletedStates[r]||{},h&&s!==void 0)this.deletedStates[r][p]!==null&&(this.deletedStates[r][p]=this.deletedStates[r][p]||{},this.deletedStates[r][p][h]=null);else if(s!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][p])for(h in this.deletedStates[r][p]={},this.stateChanges[r][p])this.deletedStates[r][p][h]=null;else this.deletedStates[r][p]=null;else this.deletedStates[r]=null}getState(r,s){const h=String(s),p=o.e({},(this.state[r]||{})[h],(this.stateChanges[r]||{})[h]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const _=this.deletedStates[r][s];if(_===null)return{};for(const x in _)delete p[x]}return p}initializeTileState(r,s){r.setFeatureState(this.state,s)}coalesceChanges(r,s){const h={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const _={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),o.e(this.state[p][x],this.stateChanges[p][x]),_[x]=this.state[p][x];h[p]=_}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const _={};if(this.deletedStates[p]===null)for(const x in this.state[p])_[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else if(this.state[p][x])for(const T of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][T];_[x]=this.state[p][x]}h[p]=h[p]||{},o.e(h[p],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(h).length!==0)for(const p in r)r[p].setFeatureState(h,s)}}function Ei(u){const{userImage:r}=u;return!!(r&&r.render&&r.render())&&(u.data.replace(new Uint8Array(r.data.buffer)),!0)}class Dr extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(r){this.images[r]={},this.loaded[r]=!1,this.updatedImages[r]={},this.patterns[r]={},this.callbackDispatchedThisFrame[r]={},this.atlasImage[r]=new o.h({width:1,height:1})}isLoaded(){for(const r in this.loaded)if(!this.loaded[r])return!1;return!0}setLoaded(r,s){if(this.loaded[s]!==r&&(this.loaded[s]=r,r)){for(const{ids:h,callback:p}of this.requestors)this._notify(h,s,p);this.requestors=[]}}hasImage(r,s){return!!this.getImage(r,s)}getImage(r,s){return this.images[s][r]}addImage(r,s,h){this._validate(r,h)&&(this.images[s][r]=h)}_validate(r,s){let h=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new o.a(new Error(`Image "${r}" has invalid "stretchX" value`))),h=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new o.a(new Error(`Image "${r}" has invalid "stretchY" value`))),h=!1),this._validateContent(s.content,s)||(this.fire(new o.a(new Error(`Image "${r}" has invalid "content" value`))),h=!1),h}_validateStretch(r,s){if(!r)return!0;let h=0;for(const p of r){if(p[0]<h||p[1]<p[0]||s<p[1])return!1;h=p[1]}return!0}_validateContent(r,s){return!(r&&(r.length!==4||r[0]<0||s.data.width<r[0]||r[1]<0||s.data.height<r[1]||r[2]<0||s.data.width<r[2]||r[3]<0||s.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,s,h){h.version=this.images[s][r].version+1,this.images[s][r]=h,this.updatedImages[s][r]=!0}removeImage(r,s){const h=this.images[s][r];delete this.images[s][r],delete this.patterns[s][r],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(r){return Object.keys(this.images[r])}getImages(r,s,h){let p=!0;const _=!!this.loaded[s];if(!_)for(const x of r)this.images[s][x]||(p=!1);_||p?this._notify(r,s,h):this.requestors.push({ids:r,scope:s,callback:h})}getUpdatedImages(r){return this.updatedImages[r]}_notify(r,s,h){const p={};for(const _ of r){this.images[s][_]||this.fire(new o.b("styleimagemissing",{id:_}));const x=this.images[s][_];x?p[_]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:o.w(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,p)}getPixelSize(r){const{width:s,height:h}=this.atlasImage[r];return{width:s,height:h}}getPattern(r,s){const h=this.patterns[s][r],p=this.getImage(r,s);if(!p)return null;if(h&&h.position.version===p.version)return h.position;if(h)h.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},x=new o.I(_,p);this.patterns[s][r]={bin:_,position:x}}return this._updatePatternAtlas(s),this.patterns[s][r].position}bind(r,s){const h=r.gl;let p=this.atlasTexture[s];p?this.dirty&&(p.update(this.atlasImage[s]),this.dirty=!1):(p=new o.T(r,this.atlasImage[s],h.RGBA),this.atlasTexture[s]=p),p.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(r){const s=[];for(const x in this.patterns[r])s.push(this.patterns[r][x].bin);const{w:h,h:p}=o.p(s),_=this.atlasImage[r];_.resize({width:h||1,height:p||1});for(const x in this.patterns[r]){const{bin:T}=this.patterns[r][x],S=T.x+1,I=T.y+1,C=this.images[r][x].data,L=C.width,k=C.height;o.h.copy(C,_,{x:0,y:0},{x:S,y:I},{width:L,height:k}),o.h.copy(C,_,{x:0,y:k-1},{x:S,y:I-1},{width:L,height:1}),o.h.copy(C,_,{x:0,y:0},{x:S,y:I+k},{width:L,height:1}),o.h.copy(C,_,{x:L-1,y:0},{x:S-1,y:I},{width:1,height:k}),o.h.copy(C,_,{x:0,y:0},{x:S+L,y:I},{width:1,height:k})}this.dirty=!0}beginFrame(){for(const r in this.images)this.callbackDispatchedThisFrame[r]={}}dispatchRenderCallbacks(r,s){for(const h of r){if(this.callbackDispatchedThisFrame[s][h])continue;this.callbackDispatchedThisFrame[s][h]=!0;const p=this.images[s][h];Ei(p)&&this.updateImage(h,s,p)}}}class tt{constructor(r,s,h,p){this.message=(r?`${r}: `:"")+h,p&&(this.identifier=p),s!=null&&s.__line__&&(this.line=s.__line__)}}class Ri extends tt{}function Zi(u){const r=u.key,s=u.value,h=u.valueSpec||{},p=u.objectElementValidators||{},_=u.style,x=u.styleSpec;let T=[];const S=o.i(s);if(S!=="object")return[new tt(r,s,`object expected, ${S} found`)];for(const I in s){const C=I.split(".")[0];let L;p[C]?L=p[C]:h[C]?L=wt:p["*"]?L=p["*"]:h["*"]&&(L=wt),L?T=T.concat(L({key:(r&&`${r}.`)+I,value:s[I],valueSpec:h[C]||h["*"],style:_,styleSpec:x,object:s,objectKey:I},s)):T.push(new Ri(r,s[I],`unknown property "${I}"`))}for(const I in h)p[I]||h[I].required&&h[I].default===void 0&&s[I]===void 0&&T.push(new tt(r,s,`missing required property "${I}"`));return T}function Nt(u){const r=u.value,s=u.valueSpec,h=u.style,p=u.styleSpec,_=u.key,x=u.arrayElementValidator||wt;if(o.i(r)!=="array")return[new tt(_,r,`array expected, ${o.i(r)} found`)];if(s.length&&r.length!==s.length)return[new tt(_,r,`array length ${s.length} expected, length ${r.length} found`)];if(s["min-length"]&&r.length<s["min-length"])return[new tt(_,r,`array length at least ${s["min-length"]} expected, length ${r.length} found`)];let T={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};p.$version<7&&(T.function=s.function),o.i(s.value)==="object"&&(T=s.value);let S=[];for(let I=0;I<r.length;I++)S=S.concat(x({array:r,arrayIndex:I,value:r[I],valueSpec:T,style:h,styleSpec:p,key:`${_}[${I}]`},!0));return S}function Dn(u){const r=u.key,s=u.value,h=u.valueSpec;let p=o.i(s);if(p==="number"&&s!=s&&(p="NaN"),p!=="number")return[new tt(r,s,`number expected, ${p} found`)];if("minimum"in h){let _=h.minimum;if(o.i(h.minimum)==="array"&&(_=h.minimum[u.arrayIndex]),s<_)return[new tt(r,s,`${s} is less than the minimum value ${_}`)]}if("maximum"in h){let _=h.maximum;if(o.i(h.maximum)==="array"&&(_=h.maximum[u.arrayIndex]),s>_)return[new tt(r,s,`${s} is greater than the maximum value ${_}`)]}return[]}function Cn(u){const r=u.valueSpec,s=o.u(u.value.type);let h,p,_,x={};const T=s!=="categorical"&&u.value.property===void 0,S=!T,I=o.i(u.value.stops)==="array"&&o.i(u.value.stops[0])==="array"&&o.i(u.value.stops[0][0])==="object",C=Zi({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(B){if(s==="identity")return[new tt(B.key,B.value,'identity function may not have a "stops" property')];let j=[];const U=B.value;return j=j.concat(Nt({key:B.key,value:U,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:L})),o.i(U)==="array"&&U.length===0&&j.push(new tt(B.key,U,"array must have at least one stop")),j},default:function(B){return wt({key:B.key,value:B.value,valueSpec:r,style:B.style,styleSpec:B.styleSpec})}}});return s==="identity"&&T&&C.push(new tt(u.key,u.value,'missing required property "property"')),s==="identity"||u.value.stops||C.push(new tt(u.key,u.value,'missing required property "stops"')),s==="exponential"&&u.valueSpec.expression&&!o.s(u.valueSpec)&&C.push(new tt(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(S&&!o.k(u.valueSpec)?C.push(new tt(u.key,u.value,"property functions not supported")):T&&!o.m(u.valueSpec)&&C.push(new tt(u.key,u.value,"zoom functions not supported"))),s!=="categorical"&&!I||u.value.property!==void 0||C.push(new tt(u.key,u.value,'"property" property is required')),C;function L(B){let j=[];const U=B.value,$=B.key;if(o.i(U)!=="array")return[new tt($,U,`array expected, ${o.i(U)} found`)];if(U.length!==2)return[new tt($,U,`array length 2 expected, length ${U.length} found`)];if(I){if(o.i(U[0])!=="object")return[new tt($,U,`object expected, ${o.i(U[0])} found`)];if(U[0].zoom===void 0)return[new tt($,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new tt($,U,"object stop key must have value")];const N=o.u(U[0].zoom);if(typeof N!="number")return[new tt($,U[0].zoom,"stop zoom values must be numbers")];if(_&&_>N)return[new tt($,U[0].zoom,"stop zoom values must appear in ascending order")];N!==_&&(_=N,p=void 0,x={}),j=j.concat(Zi({key:`${$}[0]`,value:U[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Dn,value:k}}))}else j=j.concat(k({key:`${$}[0]`,value:U[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},U));return o.n(o.o(U[1]))?j.concat([new tt(`${$}[1]`,U[1],"expressions are not allowed in function stops.")]):j.concat(wt({key:`${$}[1]`,value:U[1],valueSpec:r,style:B.style,styleSpec:B.styleSpec}))}function k(B,j){const U=o.i(B.value),$=o.u(B.value),N=B.value!==null?B.value:j;if(h){if(U!==h)return[new tt(B.key,N,`${U} stop domain type must match previous stop domain type ${h}`)]}else h=U;if(U!=="number"&&U!=="string"&&U!=="boolean"&&typeof $!="number"&&typeof $!="string"&&typeof $!="boolean")return[new tt(B.key,N,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&s!=="categorical"){let H=`number expected, ${U} found`;return o.k(r)&&s===void 0&&(H+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new tt(B.key,N,H)]}return s!=="categorical"||U!=="number"||typeof $=="number"&&isFinite($)&&Math.floor($)===$?s!=="categorical"&&U==="number"&&typeof $=="number"&&typeof p=="number"&&p!==void 0&&$<p?[new tt(B.key,N,"stop domain values must appear in ascending order")]:(p=$,s==="categorical"&&$ in x?[new tt(B.key,N,"stop domain values must be unique")]:(x[$]=!0,[])):[new tt(B.key,N,`integer expected, found ${String($)}`)]}}function tn(u){const r=(u.expressionContext==="property"?o.q:o.r)(o.o(u.value),u.valueSpec);if(r.result==="error")return r.value.map(h=>new tt(`${u.key}${h.key}`,u.value,h.message));const s=r.value.expression||r.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!s.outputDefined())return[new tt(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!o.t(s))return[new tt(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return gr(s,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!o.v(s,["zoom","feature-state"]))return[new tt(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!o.x(s))return[new tt(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function gr(u,r){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const p of r.valueSpec.expression.parameters)s.delete(p);if(s.size===0)return[];const h=[];return u instanceof o.C&&s.has(u.name)?[new tt(r.key,r.value,`["${u.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(u.eachChild(p=>{h.push(...gr(p,r))}),h)}function qn(u){const r=u.key,s=u.value,h=u.valueSpec,p=[];return Array.isArray(h.values)?h.values.indexOf(o.u(s))===-1&&p.push(new tt(r,s,`expected one of [${h.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(h.values).indexOf(o.u(s))===-1&&p.push(new tt(r,s,`expected one of [${Object.keys(h.values).join(", ")}], ${JSON.stringify(s)} found`)),p}function ns(u){return o.z(o.o(u.value))?tn(o.j({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):Us(u)}function Us(u){const r=u.value,s=u.key;if(o.i(r)!=="array")return[new tt(s,r,`array expected, ${o.i(r)} found`)];const h=u.styleSpec;let p,_=[];if(r.length<1)return[new tt(s,r,"filter array must have at least 1 element")];switch(_=_.concat(qn({key:`${s}[0]`,value:r[0],valueSpec:h.filter_operator,style:u.style,styleSpec:u.styleSpec})),o.u(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&o.u(r[1])==="$type"&&_.push(new tt(s,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&_.push(new tt(s,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(p=o.i(r[1]),p!=="string"&&_.push(new tt(`${s}[1]`,r[1],`string expected, ${p} found`)));for(let x=2;x<r.length;x++)p=o.i(r[x]),o.u(r[1])==="$type"?_=_.concat(qn({key:`${s}[${x}]`,value:r[x],valueSpec:h.geometry_type,style:u.style,styleSpec:u.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&_.push(new tt(`${s}[${x}]`,r[x],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let x=1;x<r.length;x++)_=_.concat(Us({key:`${s}[${x}]`,value:r[x],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":p=o.i(r[1]),r.length!==2?_.push(new tt(s,r,`filter array for "${r[0]}" operator must have 2 elements`)):p!=="string"&&_.push(new tt(`${s}[1]`,r[1],`string expected, ${p} found`))}return _}function wn(u,r){const s=u.key,h=u.style,p=u.layer,_=u.styleSpec,x=u.value,T=u.objectKey,S=_[`${r}_${u.layerType}`];if(!S)return[];const I=T.match(/^(.*)-transition$/);if(r==="paint"&&I&&S[I[1]]&&S[I[1]].transition)return wt({key:s,value:x,valueSpec:_.transition,style:h,styleSpec:_});const C=u.valueSpec||S[T];if(!C)return[new Ri(s,x,`unknown property "${T}"`)];let L;if(o.i(x)==="string"&&o.k(C)&&!C.tokens&&(L=/^{([^}]+)}$/.exec(x))){const B=`\`{ "type": "identity", "property": ${L?JSON.stringify(L[1]):'"_"'} }\``;return[new tt(s,x,`"${T}" does not support interpolation syntax
-Use an identity property function instead: ${B}.`)]}const k=[];if(u.layerType==="symbol")T!=="text-field"||!h||h.glyphs||h.imports||k.push(new tt(s,x,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&o.A(o.o(x))&&o.u(x.type)==="identity"&&k.push(new tt(s,x,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&r==="paint"&&p&&p.layout&&p.layout.hasOwnProperty("model-id")&&o.k(C)&&(o.B(C)||o.m(C))){const B=o.q(o.o(x),C),j=B.value.expression||B.value._styleExpression.expression;j&&!o.v(j,["measure-light"])&&(T==="model-emissive-strength"&&o.x(j)&&o.t(j)||k.push(new tt(s,x,`${T} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return k.concat(wt({key:u.key,value:x,valueSpec:C,style:h,styleSpec:_,expressionContext:"property",propertyType:r,propertyKey:T}))}function lt(u){return wn(u,"paint")}function Qt(u){return wn(u,"layout")}function Gt(u){let r=[];const s=u.value,h=u.key,p=u.style,_=u.styleSpec;s.type||s.ref||r.push(new tt(h,s,'either "type" or "ref" is required'));let x=o.u(s.type);const T=o.u(s.ref);if(s.id){const S=o.u(s.id);for(let I=0;I<u.arrayIndex;I++){const C=p.layers[I];o.u(C.id)===S&&r.push(new tt(h,s.id,`duplicate layer id "${s.id}", previously used at line ${C.id.__line__}`))}}if("ref"in s){let S;["type","source","source-layer","filter","layout"].forEach(I=>{I in s&&r.push(new tt(h,s[I],`"${I}" is prohibited for ref layers`))}),p.layers.forEach(I=>{o.u(I.id)===T&&(S=I)}),S?S.ref?r.push(new tt(h,s.ref,"ref cannot reference another ref layer")):x=o.u(S.type):typeof T=="string"&&r.push(new tt(h,s.ref,`ref layer "${T}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(s.source){const S=p.sources&&p.sources[s.source],I=S&&o.u(S.type);S?I==="vector"&&x==="raster"?r.push(new tt(h,s.source,`layer "${s.id}" requires a raster source`)):I==="raster"&&x!=="raster"?r.push(new tt(h,s.source,`layer "${s.id}" requires a vector source`)):I!=="vector"||s["source-layer"]?I==="raster-dem"&&x!=="hillshade"?r.push(new tt(h,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):I!=="raster-array"||["raster","raster-particle"].includes(x)?x!=="line"||!s.paint||!s.paint["line-gradient"]&&!s.paint["line-trim-offset"]||I==="geojson"&&S.lineMetrics?x==="raster-particle"&&I!=="raster-array"&&r.push(new tt(h,s.source,`layer "${s.id}" requires a 'raster-array' source.`)):r.push(new tt(h,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new tt(h,s.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new tt(h,s,`layer "${s.id}" must specify a "source-layer"`)):r.push(new tt(h,s.source,`source "${s.source}" not found`))}else r.push(new tt(h,s,'missing required property "source"'));return r=r.concat(Zi({key:h,value:s,valueSpec:_.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>wt({key:`${h}.type`,value:s.type,valueSpec:_.layer.type,style:u.style,styleSpec:u.styleSpec,object:s,objectKey:"type"}),filter:S=>ns(o.j({layerType:x},S)),layout:S=>Zi({layer:s,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":I=>Qt(o.j({layerType:x},I))}}),paint:S=>Zi({layer:s,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":I=>lt(o.j({layerType:x,layer:s},I))}})}})),r}function Kt(u){const r=u.value,s=u.key,h=o.i(r);return h!=="string"?[new tt(s,r,`string expected, ${h} found`)]:[]}const Xi={promoteId:function({key:u,value:r}){if(o.i(r)==="string")return Kt({key:u,value:r});{const s=[];for(const h in r)s.push(...Kt({key:`${u}.${h}`,value:r[h]}));return s}}};function sr(u){const r=u.value,s=u.key,h=u.styleSpec,p=u.style;if(!r.type)return[new tt(s,r,'"type" is required')];const _=o.u(r.type);let x=[];switch(["vector","raster","raster-dem","raster-array"].includes(_)&&(r.url||r.tiles||x.push(new Ri(s,r,'Either "url" or "tiles" is required.'))),_){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(Zi({key:s,value:r,valueSpec:h[`source_${_.replace("-","_")}`],style:u.style,styleSpec:h,objectElementValidators:Xi})),x;case"geojson":if(x=Zi({key:s,value:r,valueSpec:h.source_geojson,style:p,styleSpec:h,objectElementValidators:Xi}),r.cluster)for(const T in r.clusterProperties){const[S,I]=r.clusterProperties[T],C=typeof S=="string"?[S,["accumulated"],["get",T]]:S;x.push(...tn({key:`${s}.${T}.map`,value:I,expressionContext:"cluster-map"})),x.push(...tn({key:`${s}.${T}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return x;case"video":return Zi({key:s,value:r,valueSpec:h.source_video,style:p,styleSpec:h});case"image":return Zi({key:s,value:r,valueSpec:h.source_image,style:p,styleSpec:h});case"canvas":return[new tt(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return qn({key:`${s}.type`,value:r.type,valueSpec:{values:pe(h)},style:p,styleSpec:h})}}function pe(u){return u.source.reduce((r,s)=>{const h=u[s];return h.type.type==="enum"&&(r=r.concat(Object.keys(h.type.values))),r},[])}function _e(u){const r=u.value;let s=[];if(!r)return s;const h=o.i(r);return h!=="string"?(s=s.concat([new tt(u.key,r,`string expected, "${h}" found`)]),s):(function(p){const _=p.indexOf("://")===-1;try{return new URL(p,_?"http://example.com":void 0),!0}catch{return!1}}(r)||(s=s.concat([new tt(u.key,r,`invalid url "${r}"`)])),s)}function Fe(u){const r=u.value,s=u.styleSpec,h=s.light,p=u.style;let _=[];const x=o.i(r);if(r===void 0)return _;if(x!=="object")return _=_.concat([new tt("light",r,`object expected, ${x} found`)]),_;for(const T in r){const S=T.match(/^(.*)-transition$/);_=_.concat(S&&h[S[1]]&&h[S[1]].transition?wt({key:T,value:r[T],valueSpec:s.transition,style:p,styleSpec:s}):h[T]?wt({key:T,value:r[T],valueSpec:h[T],style:p,styleSpec:s}):[new tt(T,r[T],`unknown property "${T}"`)])}return _}function yt(u){const r=u.value;let s=[];if(!r)return s;const h=o.i(r);if(h!=="object")return s=s.concat([new tt("light-3d",r,`object expected, ${h} found`)]),s;const p=u.styleSpec,_=p["light-3d"],x=u.key,T=u.style,S=u.style.lights;for(const L of["type","id"])if(!(L in r))return s=s.concat([new tt("light-3d",r,`missing property ${L} on light`)]),s;if(r.type&&S)for(let L=0;L<u.arrayIndex;L++){const k=o.u(r.type),B=S[L];o.u(B.type)===k&&s.push(new tt(x,r.id,`duplicate light type "${r.type}", previously defined at line ${B.id.__line__}`))}const I=`properties_light_${r.type}`;if(!(I in p))return s=s.concat([new tt("light-3d",r,`Invalid light type ${r.type}`)]),s;const C=p[I];for(const L in r)if(L==="properties"){const k=r[L],B=o.i(k);if(B!=="object")return s=s.concat([new tt("properties",k,`object expected, ${B} found`)]),s;for(const j in k)s=s.concat(C[j]?wt({key:j,value:k[j],valueSpec:C[j],style:T,styleSpec:p}):[new Ri(u.key,k[j],`unknown property "${j}"`)])}else{const k=L.match(/^(.*)-transition$/);s=s.concat(k&&_[k[1]]&&_[k[1]].transition?wt({key:L,value:r[L],valueSpec:p.transition,style:T,styleSpec:p}):_[L]?wt({key:L,value:r[L],valueSpec:_[L],style:T,styleSpec:p}):[new Ri(L,r[L],`unknown property "${L}"`)])}return s}function rt(u){const r=u.value,s=u.key,h=u.style,p=u.styleSpec,_=p.terrain;let x=[];const T=o.i(r);if(r===void 0||T==="null")return x;if(T!=="object")return x=x.concat([new tt("terrain",r,`object expected, ${T} found`)]),x;for(const S in r){const I=S.match(/^(.*)-transition$/);x=x.concat(I&&_[I[1]]&&_[I[1]].transition?wt({key:S,value:r[S],valueSpec:p.transition,style:h,styleSpec:p}):_[S]?wt({key:S,value:r[S],valueSpec:_[S],style:h,styleSpec:p}):[new Ri(S,r[S],`unknown property "${S}"`)])}if(r.source){const S=h.sources&&h.sources[r.source],I=S&&o.u(S.type);S?I!=="raster-dem"&&x.push(new tt(s,r.source,`terrain cannot be used with a source of type ${String(I)}, it only be used with a "raster-dem" source type`)):x.push(new tt(s,r.source,`source "${r.source}" not found`))}else x.push(new tt(s,r,'terrain is missing required property "source"'));return x}function bt(u){const r=u.value,s=u.style,h=u.styleSpec,p=h.fog;let _=[];const x=o.i(r);if(r===void 0)return _;if(x!=="object")return _=_.concat([new tt("fog",r,`object expected, ${x} found`)]),_;for(const T in r){const S=T.match(/^(.*)-transition$/);_=_.concat(S&&p[S[1]]&&p[S[1]].transition?wt({key:T,value:r[T],valueSpec:h.transition,style:s,styleSpec:h}):p[T]?wt({key:T,value:r[T],valueSpec:p[T],style:s,styleSpec:h}):[new Ri(T,r[T],`unknown property "${T}"`)])}return _}const qt={"*":()=>[],array:Nt,boolean:function(u){const r=u.value,s=u.key,h=o.i(r);return h!=="boolean"?[new tt(s,r,`boolean expected, ${h} found`)]:[]},number:Dn,color:function(u){const r=u.key,s=u.value,h=o.i(s);return h!=="string"?[new tt(r,s,`color expected, ${h} found`)]:o.y(s)===null?[new tt(r,s,`color expected, "${s}" found`)]:[]},enum:qn,filter:ns,function:Cn,layer:Gt,object:Zi,source:sr,model:_e,light:Fe,"light-3d":yt,terrain:rt,fog:bt,string:Kt,formatted:function(u){return Kt(u).length===0?[]:tn(u)},resolvedImage:function(u){return Kt(u).length===0?[]:tn(u)},projection:function(u){const r=u.value,s=u.styleSpec,h=s.projection,p=u.style;let _=[];const x=o.i(r);if(x==="object")for(const T in r)_=_.concat(wt({key:T,value:r[T],valueSpec:h[T],style:p,styleSpec:s}));else x!=="string"&&(_=_.concat([new tt("projection",r,`object or string expected, ${x} found`)]));return _},import:function(u){const{value:r,styleSpec:s}=u,{data:h,...p}=r;Object.defineProperty(p,"__line__",{value:r.__line__,enumerable:!1});let _=Zi(o.j({},u,{value:p,valueSpec:s.import}));return o.u(p.id)===""&&_.push(new tt(`${u.key}.id`,p,"import id can't be an empty string")),h&&(_=_.concat(Tt(h,s,{key:`${u.key}.data`}))),_}};function wt(u,r=!1){const s=u.value,h=u.valueSpec,p=u.styleSpec;if(h.expression&&o.A(o.u(s)))return Cn(u);if(h.expression&&o.n(o.o(s)))return tn(u);if(h.type&&qt[h.type]){const _=qt[h.type](u);return r===!0&&_.length>0&&o.i(u.value)==="array"?tn(u):_}return Zi(o.j({},u,{valueSpec:h.type?p[h.type]:h}))}function Vt(u){const r=u.value,s=u.key,h=Kt(u);return h.length||(r.indexOf("{fontstack}")===-1&&h.push(new tt(s,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&h.push(new tt(s,r,'"glyphs" url must include a "{range}" token'))),h}function Tt(u,r=o.D,s={}){return wt({key:s.key||"",value:u,valueSpec:r.$root,styleSpec:r,style:u,objectElementValidators:{glyphs:Vt,"*":()=>[]}})}function Ht(u,r=o.D){return Be(Tt(u,r))}const oi=u=>Be(sr(u)),ni=u=>Be(Fe(u)),Se=u=>Be(yt(u)),Z=u=>Be(rt(u)),ne=u=>Be(bt(u)),le=u=>Be(Gt(u)),Re=u=>Be(ns(u)),Ne=u=>Be(lt(u)),Qe=u=>Be(Qt(u)),Pt=u=>Be(_e(u));function Be(u){return u.slice().sort((r,s)=>r.line&&s.line?r.line-s.line:0)}function Dt(u,r){let s=!1;if(r&&r.length)for(const h of r)h instanceof Ri?o.w(h.message):(u.fire(new o.a(new Error(h.message))),s=!0);return s}const mt=new o.F({anchor:new o.G(o.D.light.anchor),position:new o.H(o.D.light.position),color:new o.G(o.D.light.color),intensity:new o.G(o.D.light.intensity)});class It extends o.E{constructor(r,s="flat"){super(),this._transitionable=new o.J(mt),this.setLight(r,s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,s,h={}){this._validate(ni,r,h)||(this._transitionable.setTransitionOrValue(r),this.id=s)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,s,h){return(!h||h.validate!==!1)&&Dt(this,r.call(Ht,o.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.D})))}}const vi=new o.F({source:new o.G(o.D.terrain.source),exaggeration:new o.G(o.D.terrain.exaggeration)});let cr=class extends o.E{constructor(u,r,s,h){super(),this.scope=s,this._transitionable=new o.J(vi,s,h),this._transitionable.setTransitionOrValue(u,h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r}get(){return this._transitionable.serialize()}set(u,r){this._transitionable.setTransitionOrValue(u,r)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new o.K(u)).get("exaggeration")}isZoomDependent(){const u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof o.Z}};const Mr=45,ur=65,rr=.05;function Ji(u,r,s,h){const p=o.O(Mr,ur,s),[_,x]=or(u,h);let T=1-Math.min(1,Math.exp((r-_)/(x-_)*-6));return T*=T*T,T=Math.min(1,1.00747*T),T*p*u.alpha}function or(u,r){const s=.5/Math.tan(.5*r);return[u.range[0]+s,u.range[1]+s]}function yr(u,r,s,h,p){const _=o.N.transformMat4([],[r,s,h],p.mercatorFogMatrix);return Ji(u,o.N.length(_),p.pitch,p._fov)}function hn(u,r,s,h,p,_,x){const T=[[s,h,0],[p,h,0],[p,_,0],[s,_,0]];let S=Number.MAX_VALUE,I=-Number.MAX_VALUE;for(const C of T){const L=o.N.transformMat4([],C,r),k=o.N.length(L);S=Math.min(S,k),I=Math.max(I,k)}return[Ji(u,S,x.pitch,x._fov),Ji(u,I,x.pitch,x._fov)]}const Tr=new o.F({range:new o.G(o.D.fog.range),color:new o.G(o.D.fog.color),"high-color":new o.G(o.D.fog["high-color"]),"space-color":new o.G(o.D.fog["space-color"]),"horizon-blend":new o.G(o.D.fog["horizon-blend"]),"star-intensity":new o.G(o.D.fog["star-intensity"]),"vertical-range":new o.G(o.D.fog["vertical-range"])});class Vn extends o.E{constructor(r,s,h,p){super(),this._transitionable=new o.J(Tr,h,new Map(p)),this.set(r,p),this._transitioning=this._transitionable.untransitioned(),this._transform=s,this.properties=new o.Q(Tr)}get state(){const r=this._transform,s=r.projection.name==="globe",h=o.S(r.zoom),p=this.properties.get("range"),_=[.5,3];return{range:s?[o.U(_[0],p[0],h),o.U(_[1],p[1],h)]:p,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,s,h={}){if(this._validate(ne,r,h))return;const p=o.e({},r);for(const _ of Object.keys(o.D.fog))p[_]===void 0&&(p[_]=o.D.fog[_].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,s)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const s=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.O(Mr,ur,r))*s.a}getOpacityAtLatLng(r,s){return this._transform.projection.supportsFog?function(h,p,_){const x=o.L.fromLngLat(p),T=_.elevation?_.elevation.getAtPointOrZero(x):0;return yr(h,x.x,x.y,T,_)}(this.state,r,s):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const s=this._transform.calculateFogTileMatrix(r.toUnwrapped());return hn(this.state,s,0,0,o.V,o.V,this._transform)}getOpacityForBounds(r,s,h,p,_){return this._transform.projection.supportsFog?hn(this.state,r,s,h,p,_,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?or(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const s=[4,5,6,7];for(const h of s){const p=r.points[h];let _;if(p[2]>=0)_=p;else{const x=r.points[h-4];_=o.W(x,p,x[2]/(x[2]-p[2]))}if(yr(this.state,_[0],_[1],0,this._transform)>=rr)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,s,h){return(!h||h.validate!==!1)&&Dt(this,r.call(Ht,o.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:o.D})))}}class On extends o.E{constructor(r,s,h,p){super(),this.scope=h,this._options=r,this.properties=new o.Q(s),this._transitionable=new o.J(s,h,new Map(p)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,s){this._options=r,this._transitionable.setTransitionOrValue(r.properties,s)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const Zn=new o.F({color:new o.G(o.D.properties_light_ambient.color),intensity:new o.G(o.D.properties_light_ambient.intensity)}),rn=new o.F({direction:new o.X(o.D.properties_light_directional.direction),color:new o.G(o.D.properties_light_directional.color),intensity:new o.G(o.D.properties_light_directional.intensity),"cast-shadows":new o.G(o.D.properties_light_directional["cast-shadows"]),"shadow-intensity":new o.G(o.D.properties_light_directional["shadow-intensity"])});class Yr{constructor(r,s,h,p){this.screenBounds=r,this.cameraPoint=s,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=h,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(r,s){let h,p;if(r instanceof o.P||typeof r[0]=="number"){const _=o.P.convert(r);h=[_],p=s.isPointAboveHorizon(_)}else{const _=o.P.convert(r[0]),x=o.P.convert(r[1]);h=[_,x],p=o.Y(_,x).every(T=>s.isPointAboveHorizon(T))}return new Yr(h,s.getCameraPoint(),p,s)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.Y(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],p=o.Y(s,h,0,!1);return this.cameraPoint.y>h.y&&(this.cameraPoint.x>s.x&&this.cameraPoint.x<h.x?p.splice(3,0,this.cameraPoint):this.cameraPoint.x>=h.x?p[2]=this.cameraPoint:this.cameraPoint.x<=s.x&&(p[3]=this.cameraPoint)),o._(p,r)}bufferedCameraGeometryGlobe(r){const s=this.screenBounds[0],h=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],p=o.Y(s,h,r),_=this.cameraPoint.clone();switch(3*((_.y>s.y)+(_.y>h.y))+((_.x>s.x)+(_.x>h.x))){case 0:p[0]=_,p[4]=_.clone();break;case 1:p.splice(1,0,_);break;case 2:p[1]=_;break;case 3:p.splice(4,0,_);break;case 5:p.splice(2,0,_);break;case 6:p[3]=_;break;case 7:p.splice(3,0,_);break;case 8:p[2]=_}return p}containsTile(r,s,h,p=0){const _=r.queryPadding/s._pixelsPerMercatorPixel+1,x=h?this._bufferedCameraMercator(_,s):this._bufferedScreenMercator(_,s);let T=r.tileID.wrap+(x.unwrapped?p:0);const S=x.polygon.map($=>o.$(r.tileTransform,$,T));if(!o.a0(S,0,0,o.V,o.V))return;T=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?p:0);const I=this.screenGeometryMercator.polygon.map($=>o.a1(r.tileTransform,$,T)),C=I.map($=>new o.P($[0],$[1])),L=s.getFreeCameraOptions().position||new o.L(0,0,0),k=o.a1(r.tileTransform,L,T),B=I.map($=>{const N=o.N.sub($,$,k);return o.N.normalize(N,N),new o.a2(k,N)}),j=o.a3(r,1,s.zoom)*s._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:C,tilespaceRays:B,bufferedTilespaceGeometry:S,bufferedTilespaceBounds:(U=o.a4(S),U.min.x=o.aa(U.min.x,0,o.V),U.min.y=o.aa(U.min.y,0,o.V),U.max.x=o.aa(U.max.x,0,o.V),U.max.y=o.aa(U.max.y,0,o.V),U),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:j};var U}_bufferedScreenMercator(r,s){const h=it(r);if(this._screenRaycastCache[h])return this._screenRaycastCache[h];{let p;return p=s.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),s):{polygon:this.bufferedScreenGeometry(r).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._screenRaycastCache[h]=p,p}}_bufferedCameraMercator(r,s){const h=it(r);if(this._cameraRaycastCache[h])return this._cameraRaycastCache[h];{let p;return p=s.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),s):{polygon:this.bufferedCameraGeometry(r).map(_=>s.pointCoordinate3D(_)),unwrapped:!0},this._cameraRaycastCache[h]=p,p}}_projectAndResample(r,s){const h=function(_,x){const T=o.a6.multiply([],x.pixelMatrix,x.globeMatrix),S=[0,-o.ab,0,1],I=[0,o.ab,0,1],C=[0,0,0,1];o.a7.transformMat4(S,S,T),o.a7.transformMat4(I,I,T),o.a7.transformMat4(C,C,T);const L=new o.P(S[0]/S[3],S[1]/S[3]),k=new o.P(I[0]/I[3],I[1]/I[3]),B=o.a8(_,L)&&S[3]<C[3],j=o.a8(_,k)&&I[3]<C[3];if(!B&&!j)return null;const U=function(re,ae,ue){for(let me=1;me<re.length;me++){const Me=Ve(ae.pointCoordinate3D(re[me-1]).x),ye=Ve(ae.pointCoordinate3D(re[me]).x);if(ue<0){if(Me<ye)return{idx:me,t:-Me/(ye-1-Me)}}else if(ye<Me)return{idx:me,t:(1-Me)/(ye+1-Me)}}return null}(_,x,B?-1:1);if(!U)return null;const{idx:$,t:N}=U;let H=$>1?ke(_.slice(0,$),x):[],ee=$<_.length?ke(_.slice($),x):[];H=H.map(re=>new o.P(Ve(re.x),re.y)),ee=ee.map(re=>new o.P(Ve(re.x),re.y));const X=[...H];X.length===0&&X.push(ee[ee.length-1]);const te=o.U(X[X.length-1].y,(ee.length===0?H[0]:ee[0]).y,N);let q;return q=B?[new o.P(0,te),new o.P(0,0),new o.P(1,0),new o.P(1,te)]:[new o.P(1,te),new o.P(1,1),new o.P(0,1),new o.P(0,te)],X.push(...q),ee.length===0?X.push(H[0]):X.push(...ee),{polygon:X.map(re=>new o.L(re.x,re.y)),unwrapped:!1}}(r,s);if(h)return h;const p=function(_,x){let T=!1,S=-1/0,I=0;for(let L=0;L<_.length-1;L++)_[L].x>S&&(S=_[L].x,I=L);for(let L=0;L<_.length-1;L++){const k=(I+L)%(_.length-1),B=_[k],j=_[k+1];Math.abs(B.x-j.x)>.5&&(B.x<j.x?(B.x+=1,k===0&&(_[_.length-1].x+=1)):(j.x+=1,k+1===_.length-1&&(_[0].x+=1)),T=!0)}const C=o.a5(x.center.lng);return T&&C<Math.abs(C-1)&&_.forEach(L=>{L.x-=1}),{polygon:_,unwrapped:T}}(ke(r,s).map(_=>new o.P(Ve(_.x),_.y)),s);return{polygon:p.polygon.map(_=>new o.L(_.x,_.y)),unwrapped:p.unwrapped}}}function ke(u,r){return o.a9(u,s=>{const h=r.pointCoordinate3D(s);s.x=h.x,s.y=h.y},1/256)}function Ve(u){return u<0?1+u%1:u%1}function it(u){return 100*u|0}function ft(u,r,s,h,p){const _=function(x,T){if(x)return p(x);if(T){u.url&&T.tiles&&u.tiles&&delete u.tiles;const S=o.ac(o.e(T,u),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(S.vectorLayers=T.vector_layers,S.vectorLayerIds=S.vectorLayers.map(I=>I.id)),T.raster_layers&&(S.rasterLayers=T.raster_layers,S.rasterLayerIds=S.rasterLayers.map(I=>I.id)),S.tiles=r.canonicalizeTileset(S,u.url),p(null,S)}};return u.url?o.g(r.transformRequest(r.normalizeSourceURL(u.url,null,s,h),o.R.Source),_):o.f.frame(()=>_(null,u))}class ot{constructor(r,s,h){this.bounds=o.ad.convert(this.validateBounds(r)),this.minzoom=s||0,this.maxzoom=h||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const s=Math.pow(2,r.z),h=Math.floor(o.a5(this.bounds.getWest())*s),p=Math.floor(o.ae(this.bounds.getNorth())*s),_=Math.ceil(o.a5(this.bounds.getEast())*s),x=Math.ceil(o.ae(this.bounds.getSouth())*s);return r.x>=h&&r.x<_&&r.y>=p&&r.y<x}}class gt extends o.E{constructor(r,s,h,p){if(super(),this.id=r,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.ac(s,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},s),this._collectResourceTiming=!!s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new o.af}load(r){this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"}));const s=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=ft(this._options,this.map._requestManager,s,h,(p,_)=>{this._tileJSONRequest=null,this._loaded=!0,p?(s&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${s}`),h&&h.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new o.a(p))):_&&(o.e(this,_),_.bounds&&(this.tileBounds=new ot(_.bounds,this.minzoom,this.maxzoom)),o.aj(_.tiles,this.map._requestManager._customAccessToken),this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))),r&&r(p)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=o.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.e({},this._options)}loadTile(r,s){const h=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(h,o.R.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster};if(p.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=s:r.request=r.actor.send("reloadTile",p,_.bind(this));else if(r.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",p,_.bind(this),void 0,!0);else{const x=o.ah.call({deduped:this._deduped},p,(T,S)=>{T||!S?_.call(this,T):(p.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},r.actor&&r.actor.send("loadTile",p,_.bind(this),void 0,!0))},!0);r.request={cancel:x}}function _(x,T){return delete r.request,r.aborted?s(null):x&&x.status!==404?s(x):(T&&T.resourceTiming&&(r.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&r.setExpiryData(T),r.loadVectorData(T,this.map.painter),o.ai(this.dispatcher),s(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class vt extends o.E{constructor(r,s,h,p){super(),this.id=r,this.dispatcher=h,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},s),o.e(this,o.ac(s,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"})),this._tileJSONRequest=ft(this._options,this.map._requestManager,null,null,(s,h)=>{this._tileJSONRequest=null,this._loaded=!0,s?this.fire(new o.a(s)):h&&(o.e(this,h),h.bounds&&(this.tileBounds=new ot(h.bounds,this.minzoom,this.maxzoom)),o.aj(h.tiles),this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))),r&&r(s)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=o.ag(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return o.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,s){const h=o.f.devicePixelRatio>=2,p=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),h,this.tileSize);r.request=o.d(this.map._requestManager.transformRequest(p,o.R.Tile),(_,x,T,S)=>(delete r.request,r.aborted?(r.state="unloaded",s(null)):_?(r.state="errored",s(_)):x?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:T,expires:S}),r.setTexture(x,this.map.painter),r.state="loaded",o.ai(this.dispatcher),void s(null)):s(null)))}abortTile(r,s){r.request&&(r.request.cancel(),delete r.request),s()}unloadTile(r,s){r.texture&&r.texture instanceof o.T?(r.destroy(!0),r.texture&&r.texture instanceof o.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),s()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ct extends vt{constructor(r,s,h,p){super(r,s,h,p),this.type="raster-array",this.maxzoom=22,this._options=o.e({type:"raster-array"},s)}triggerRepaint(r){const s=this.map.painter._terrain,h=this.map.style.getSourceCache(this.id);s&&s.enabled&&h&&s._clearRenderCacheForTile(h.id,r.tileID),this.map.triggerRepaint()}loadTile(r,s){const h=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),p=this.map._requestManager.transformRequest(h,o.R.Tile);r.requestParams=p,r.actor||(r.actor=this.dispatcher.getActor()),r.request=r.fetchHeader(void 0,(_,x,T,S)=>{if(delete r.request,r.aborted)return r.state="unloaded",s(null);if(_)return _.code===20?void 0:(r.state="errored",s(_));this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:T,expires:S}),r.state="empty",s(null)})}unloadTile(r){const s=r.texture;s&&s instanceof o.T?(r.destroy(!0),this.map.painter.saveTileTexture(s)):(r.destroy(),r.flushQueues(),r._isHeaderLoaded=!1,delete r._mrt,delete r.textureDescriptor),r.fbo&&(r.fbo.destroy(),delete r.fbo),delete r.request,delete r.requestParams,delete r.neighboringTiles,r.state="unloaded"}prepareTile(r,s,h){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBand(s,h,(p,_)=>{if(p)return r.state="errored",this.fire(new o.a(p)),void this.triggerRepaint(r);_&&(r.setTexture(_,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;const s=this.rasterLayers.find(({id:_})=>_===r),h=s&&s.fields,p=h&&h.bands&&h.bands;return p?p[0]:0}getTextureDescriptor(r,s,h){if(!r)return;const p=s.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!p)return;let _=null;s instanceof o.an?_=s.paint.get("raster-array-band"):s instanceof o.ao&&(_=s.paint.get("raster-particle-array-band"));const x=_||this.getInitialBand(p);if(x!=null)if(r.textureDescriptor){if(!r.updateNeeded(p,x)||h)return Object.assign({},r.textureDescriptor,{texture:r.texture})}else this.prepareTile(r,p,x)}}const Et=32,pt=33,ii=new Uint16Array(8184);for(let u=0;u<2046;u++){let r=u+2,s=0,h=0,p=0,_=0,x=0,T=0;for(1&r?p=_=x=Et:s=h=T=Et;(r>>=1)>1;){const I=s+p>>1,C=h+_>>1;1&r?(p=s,_=h,s=x,h=T):(s=p,h=_,p=x,_=T),x=I,T=C}const S=4*u;ii[S+0]=s,ii[S+1]=h,ii[S+2]=p,ii[S+3]=_}const Li=new Uint16Array(2178),jt=new Uint8Array(1089),hr=new Uint16Array(1089);function Pr(u){return u===0?-.03125:u===32?.03125:0}class mr{constructor(r,s,h,p){this.id=mr.uniqueIdxCounter,mr.uniqueIdxCounter++,this.context=r;const _=r.gl;this.buffer=_.createBuffer(),this.dynamicDraw=!!h,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||p||s.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=mr.uniqueIdxCounter,mr.uniqueIdxCounter++;const s=this.context.gl;this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}mr.uniqueIdxCounter=0;const nn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Tn{constructor(r,s,h,p,_,x){this.length=s.length,this.attributes=h,this.itemSize=s.bytesPerElement,this.dynamicDraw=p,this.instanceCount=x,this.context=r;const T=r.gl;this.buffer=T.createBuffer(),r.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||_||s.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,s){for(let h=0;h<this.attributes.length;h++){const p=s.attributes[this.attributes[h].name];p!==void 0&&r.enableVertexAttribArray(p)}}setVertexAttribPointers(r,s,h){for(let p=0;p<this.attributes.length;p++){const _=this.attributes[p],x=s.attributes[_.name];x!==void 0&&r.vertexAttribPointer(x,_.components,r[nn[_.type]],!1,this.itemSize,_.offset+this.itemSize*(h||0))}}setVertexAttribDivisor(r,s,h){for(let p=0;p<this.attributes.length;p++){const _=s.attributes[this.attributes[p].name];_!==void 0&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(_,h)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ki{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ss extends Ki{getDefault(){return o.ax.transparent}set(r){const s=this.current;(r.r!==s.r||r.g!==s.g||r.b!==s.b||r.a!==s.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Es extends Ki{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class En extends Ki{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class zl extends Ki{getDefault(){return[!0,!0,!0,!0]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class wo extends Ki{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Sa extends Ki{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class yh extends Ki{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const s=this.current;(r.func!==s.func||r.ref!==s.ref||r.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Jo extends Ki{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class vh extends Ki{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=r,this.dirty=!1}}class Ma extends Ki{getDefault(){return[0,1]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Wf extends Ki{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=r,this.dirty=!1}}class Kc extends Ki{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class xh extends Ki{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.BLEND):s.disable(s.BLEND),this.current=r,this.dirty=!1}}class Yc extends Ki{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class bh extends Ki{getDefault(){return o.ax.transparent}set(r){const s=this.current;(r.r!==s.r||r.g!==s.g||r.b!==s.b||r.a!==s.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Hn extends Ki{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class Jr extends Ki{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;r?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=r,this.dirty=!1}}class Di extends Ki{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Xf extends Ki{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let Jc=class extends Ki{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class wh extends Ki{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class B_ extends Ki{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const s=this.current;(r[0]!==s[0]||r[1]!==s[1]||r[2]!==s[2]||r[3]!==s[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class js extends Ki{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Th extends Ki{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class F_ extends Ki{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class Aa extends Ki{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Mt extends Ki{getDefault(){return null}set(r){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Qi extends Ki{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class er extends Ki{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class hs extends Ki{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Ia extends Ki{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Vi extends Ki{constructor(r,s){super(r),this.context=r,this.parent=s}getDefault(){return null}}class Qc extends Vi{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Ca extends Vi{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,this.attachment(),s.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class kl extends Vi{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,this.attachment(),s.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Wn extends Ca{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Wr{constructor(r,s,h,p,_){this.context=r,this.width=s,this.height=h;const x=this.framebuffer=r.gl.createFramebuffer();p&&(this.colorAttachment=new Qc(r,x)),_&&(this.depthAttachmentType=_,this.depthAttachment=_==="renderbuffer"?new Ca(r,x):new kl(r,x))}destroy(){const r=this.context.gl;if(this.colorAttachment){const s=this.colorAttachment.get();s&&r.deleteTexture(s)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const s=this.depthAttachment.get();s&&r.deleteRenderbuffer(s)}else{const s=this.depthAttachment.get();s&&r.deleteTexture(s)}r.deleteFramebuffer(this.framebuffer)}}class Yt{constructor(r,s,h){this.func=r,this.mask=s,this.range=h}}Yt.ReadOnly=!1,Yt.ReadWrite=!0,Yt.disabled=new Yt(519,Yt.ReadOnly,[0,1]);const Qo=7680;class li{constructor(r,s,h,p,_,x){this.test=r,this.ref=s,this.mask=h,this.fail=p,this.depthFail=_,this.pass=x}}li.disabled=new li({func:519,mask:0},0,0,Qo,Qo,Qo);const To=771;class Si{constructor(r,s,h,p){this.blendFunction=r,this.blendColor=s,this.mask=h,this.blendEquation=p}}Si.Replace=[1,0,1,0],Si.disabled=new Si(Si.Replace,o.ax.transparent,[!1,!1,!1,!1]),Si.unblended=new Si(Si.Replace,o.ax.transparent,[!0,!0,!0,!0]),Si.alphaBlended=new Si([1,To,1,To],o.ax.transparent,[!0,!0,!0,!0]),Si.multiply=new Si([774,0,774,0],o.ax.transparent,[!0,!0,!0,!0]);const Pa=1029,Sn=2305;class Jt{constructor(r,s,h){this.enable=r,this.mode=s,this.frontFace=h}}Jt.disabled=new Jt(!1,Pa,Sn),Jt.backCCW=new Jt(!0,Pa,Sn),Jt.backCW=new Jt(!0,Pa,2304),Jt.frontCW=new Jt(!0,1028,2304),Jt.frontCCW=new Jt(!0,1028,Sn);class Kf{constructor(r,s){this.gl=r,this.clearColor=new ss(this),this.clearDepth=new Es(this),this.clearStencil=new En(this),this.colorMask=new zl(this),this.depthMask=new wo(this),this.stencilMask=new Sa(this),this.stencilFunc=new yh(this),this.stencilOp=new Jo(this),this.stencilTest=new vh(this),this.depthRange=new Ma(this),this.depthTest=new Wf(this),this.depthFunc=new Kc(this),this.blend=new xh(this),this.blendFunc=new Yc(this),this.blendColor=new bh(this),this.blendEquation=new Hn(this),this.cullFace=new Jr(this),this.cullFaceSide=new Di(this),this.frontFace=new Xf(this),this.program=new Jc(this),this.activeTexture=new wh(this),this.viewport=new B_(this),this.bindFramebuffer=new js(this),this.bindRenderbuffer=new Th(this),this.bindTexture=new F_(this),this.bindVertexBuffer=new Aa(this),this.bindElementBuffer=new Mt(this),this.bindVertexArrayOES=new Qi(this),this.pixelStoreUnpack=new er(this),this.pixelStoreUnpackPremultiplyAlpha=new hs(this),this.pixelStoreUnpackFlipY=new Ia(this),this.options=s?{...s}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,s,h){return new mr(this,r,s,h)}createVertexBuffer(r,s,h,p,_){return new Tn(this,r,s,h,p,_)}createRenderbuffer(r,s,h){const p=this.gl,_=p.createRenderbuffer();return this.bindRenderbuffer.set(_),p.renderbufferStorage(p.RENDERBUFFER,r,s,h),this.bindRenderbuffer.set(null),_}createFramebuffer(r,s,h,p){return new Wr(this,r,s,h,p)}clear({color:r,depth:s,stencil:h,colorMask:p}){const _=this.gl;let x=0;r&&(x|=_.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set(p||[!0,!0,!0,!0])),s!==void 0&&(x|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),h!==void 0&&(x|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(h),this.stencilMask.set(255)),_.clear(x)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){Y(r.blendFunction,Si.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}var ea=o.ay([{name:"a_pos",type:"Float32",components:3}]);class sn{constructor(r,s,h,p){const _={width:h[0],height:h[1],data:null},x=r.gl;this.targetColorTexture=new o.T(r,_,x.RGBA,{useMipmap:!1}),this.backgroundColorTexture=new o.T(r,_,x.RGBA,{useMipmap:!1}),this.context=r,this.setNumParticles(s,p),this.lastInvalidatedAt=0}setNumParticles(r,s){if(this.numParticles===s)return;(this.particleVertices0||this.particleVertices1||this.particleSegment)&&(this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy());const h=new o.az;h.reserve(Math.round(s));const p=o.aA(r.key);for(let _=0;_<s;_++)h.emplaceBack(p(),p(),p());this.particleVertices0=this.context.createVertexBuffer(h,ea.members,!0),this.particleVertices1=this.context.createVertexBuffer(h,ea.members,!0),this.particleSegment=o.aB.simpleSegment(0,0,this.particleVertices0.length,0),this.numParticles=s}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=o.f.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleVertices0.destroy(),this.particleVertices1.destroy(),this.particleSegment.destroy()}}const ds={type:2,extent:o.V,loadGeometry:()=>[[new o.P(0,0),new o.P(o.V+1,0),new o.P(o.V+1,o.V+1),new o.P(0,o.V+1),new o.P(0,0)]]};class Eo{constructor(r,s,h,p,_){this.tileID=r,this.uid=o.aC(),this.uses=0,this.tileSize=s,this.tileZoom=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=_,p&&p.style&&(this._lastUpdatedBrightness=p.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(r){const s=r+this.timeAdded;s<o.f.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.as(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,s,h){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(p,_){const x={};if(!_)return x;for(const T of p){const S=T.layerIds.map(I=>_.getLayer(I)).filter(Boolean);if(S.length!==0){T.layers=S,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(I=>S.filter(C=>C.id===I)[0]));for(const I of S)x[I.fqid]=T}}return x}(r.buckets,s.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof o.aE){if(this.hasSymbolBuckets=!0,!h)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const _=this.buckets[p];if(_ instanceof o.aE&&_.hasRTLText){this.hasRTLText=!0,o.aF();break}}this.queryPadding=0;for(const p in this.buckets){const _=this.buckets[p],x=s.style.getOwnLayer(p);if(!x)continue;const T=x.queryRadius(_);this.queryPadding=Math.max(this.queryPadding,T)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new o.aD}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.fqid]}upload(r){for(const p in this.buckets){const _=this.buckets[p];_.uploadPending()&&_.upload(r)}const s=r.gl,h=this.imageAtlas;if(h&&!h.uploaded){const p=!!Object.keys(h.patternPositions).length;this.imageAtlasTexture=new o.T(r,h.image,s.RGBA,{useMipmap:p}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(r,this.glyphAtlasImage,s.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(r,this.lineAtlas.image,s.R8),this.lineAtlas.uploaded=!0)}prepare(r,s,h){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,h),!s||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const p=s.style.getBrightness();(this._lastUpdatedBrightness||p)&&(this._lastUpdatedBrightness&&p&&Math.abs(this._lastUpdatedBrightness-p)<.001||(this._lastUpdatedBrightness=p,this.updateBuckets(void 0,s)))}queryRenderedFeatures(r,s,h,p,_,x,T,S){return this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:T,transform:x,params:_,tileTransform:this.tileTransform},r,s,h):{}}querySourceFeatures(r,s){const h=this.latestFeatureIndex;if(!h||!h.rawTileData)return;const p=h.loadVTLayers(),_=s?s.sourceLayer:"",x=p._geojsonTileLayer||p[_];if(!x)return;const T=o.aG(s&&s.filter),{z:S,x:I,y:C}=this.tileID.canonical,L={z:S,x:I,y:C};for(let k=0;k<x.length;k++){const B=x.feature(k);if(T.needGeometry){const $=o.aH(B,!0);if(!T.filter(new o.K(this.tileID.overscaledZ),$,this.tileID.canonical))continue}else if(!T.filter(new o.K(this.tileID.overscaledZ),B))continue;const j=h.getId(B,_),U=new o.aI(B,S,I,C,j);U.tile=L,r.push(U)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const r in this.buckets)if(this.buckets[r].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const s=this.expirationTime;if(r.cacheControl){const h=o.aJ(r.cacheControl);h["max-age"]&&(this.expirationTime=Date.now()+1e3*h["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const h=Date.now();let p=!1;if(this.expirationTime>h)p=!1;else if(s)if(this.expirationTime<s)p=!0;else{const _=this.expirationTime-s;_?this.expirationTime=h+Math.max(_,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,s){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(r).length!==0&&s&&this.updateBuckets(r,s)}updateBuckets(r,s){if(!this.latestFeatureIndex)return;const h=this.latestFeatureIndex.loadVTLayers(),p=s.style.listImages(),_=s.style.getBrightness();for(const x in this.buckets){if(!s.style.hasLayer(x))continue;const T=this.buckets[x],S=T.layers[0].sourceLayer||"_geojsonTileLayer",I=h[S];let C={};if(r&&(C=r[S],!I||!C||Object.keys(C).length===0))continue;if(T.update(C,I,p,this.imageAtlas&&this.imageAtlas.patternPositions||{},_),T instanceof o.aK||T instanceof o.aL){const k=s.style.getOwnSourceCache(T.layers[0].source);s._terrain&&s._terrain.enabled&&k&&T.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(k.id,this.tileID)}const L=s&&s.style&&s.style.getOwnLayer(x);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(T)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.f.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=o.f.now()+r}setTexture(r,s){const h=s.context,p=h.gl;this.texture=this.texture||s.getTileTexture(r.width),this.texture&&this.texture instanceof o.T?this.texture.update(r,{useMipmap:!0}):(this.texture=new o.T(h,r,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE))}setDependencies(r,s){const h={};for(const p of s)h[p]=!0;this.dependencies[r]=h}hasDependency(r,s){for(const h of r){const p=this.dependencies[h];if(p){for(const _ of s)if(p[_])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const h=o.aM(ds,this.tileID.canonical,this.tileTransform)[0],p=new o.aN,_=new o.aO;for(let x=0;x<h.length;x++){const{x:T,y:S}=h[x];p.emplaceBack(T,S),_.emplaceBack(x)}_.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(_),this._tileDebugBuffer=r.createVertexBuffer(p,o.aP.members),this._tileDebugSegments=o.aB.simpleSegment(0,0,p.length,_.length)}_makeTileBoundsBuffers(r,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const h=o.aM(ds,this.tileID.canonical,this.tileTransform)[0];let p,_;if(this.isRaster){const x=function(T,S){const I=o.as(T,S),C=Math.pow(2,T.z);for(let $=0;$<pt;$++)for(let N=0;N<pt;N++){const H=o.at((T.x+(N+Pr(N))/Et)/C),ee=o.au((T.y+($+Pr($))/Et)/C),X=S.project(H,ee),te=$*pt+N;Li[2*te+0]=Math.round((X.x*I.scale-I.x)*o.V),Li[2*te+1]=Math.round((X.y*I.scale-I.y)*o.V)}jt.fill(0),hr.fill(0);for(let $=2045;$>=0;$--){const N=4*$,H=ii[N+0],ee=ii[N+1],X=ii[N+2],te=ii[N+3],q=H+X>>1,re=ee+te>>1,ae=q+re-ee,ue=re+H-q,me=ee*pt+H,Me=te*pt+X,ye=re*pt+q,Oe=Math.hypot((Li[2*me+0]+Li[2*Me+0])/2-Li[2*ye+0],(Li[2*me+1]+Li[2*Me+1])/2-Li[2*ye+1])>=16;jt[ye]=jt[ye]||(Oe?1:0),$<1022&&(jt[ye]=jt[ye]||jt[(ee+ue>>1)*pt+(H+ae>>1)]||jt[(te+ue>>1)*pt+(X+ae>>1)])}const L=new o.av,k=new o.aw;let B=0;function j($,N){const H=N*pt+$;return hr[H]===0&&(L.emplaceBack(Li[2*H+0],Li[2*H+1],$*o.V/Et,N*o.V/Et),hr[H]=++B),hr[H]-1}function U($,N,H,ee,X,te){const q=$+H>>1,re=N+ee>>1;if(Math.abs($-X)+Math.abs(N-te)>1&&jt[re*pt+q])U(X,te,$,N,q,re),U(H,ee,X,te,q,re);else{const ae=j($,N),ue=j(H,ee),me=j(X,te);k.emplaceBack(ae,ue,me)}}return U(0,0,Et,Et,Et,0),U(Et,Et,0,0,0,Et),{vertices:L,indices:k}}(this.tileID.canonical,s);p=x.vertices,_=x.indices}else{p=new o.av,_=new o.aw;for(const{x:T,y:S}of h)p.emplaceBack(T,S,0,0);const x=o.aQ(p.int16,void 0,4);for(let T=0;T<x.length;T+=3)_.emplaceBack(x[T],x[T+1],x[T+2])}this._tileBoundsBuffer=r.createVertexBuffer(p,o.aR.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(_),this._tileBoundsSegments=o.aB.simpleSegment(0,0,p.length,_.length)}_makeGlobeTileDebugBuffers(r,s){const h=s.projection;if(!h||h.name!=="globe"||s.freezeTileCoverage)return;const p=this.tileID.canonical,_=o.aS(p,s),x=o.aT(_),T=o.S(s.zoom);let S;T>0&&(S=o.a6.invert(new Float64Array(16),s.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,p,s,x,S,T),this._makeGlobeTileDebugTextBuffer(r,p,s,x,S,T)}_globePoint(r,s,h,p,_,x,T){let S=o.aU(r,s,h);if(x){const I=1<<h.z,C=o.a5(p.center.lng),L=o.ae(p.center.lat),k=(h.x+.5)/I-C;let B=0;k>.5?B=-1:k<-.5&&(B=1);let j=(r/o.V+h.x)/I+B,U=(s/o.V+h.y)/I;j=(j-C)*p._pixelsPerMercatorPixel+C,U=(U-L)*p._pixelsPerMercatorPixel+L;const $=[j*p.worldSize,U*p.worldSize,0];o.N.transformMat4($,$,x),S=o.aV(S,$,T)}return o.N.transformMat4(S,S,_)}_makeGlobeTileDebugBorderBuffer(r,s,h,p,_,x){const T=new o.aN,S=new o.aO,I=new o.aW,C=(k,B,j,U,$)=>{const N=(j-k)/($-1),H=(U-B)/($-1),ee=T.length;for(let X=0;X<$;X++){const te=k+X*N,q=B+X*H;T.emplaceBack(te,q);const re=this._globePoint(te,q,s,h,p,_,x);I.emplaceBack(re[0],re[1],re[2]),S.emplaceBack(ee+X)}},L=o.V;C(0,0,L,0,16),C(L,0,L,L,16),C(L,L,0,L,16),C(0,L,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(S),this._tileDebugBuffer=r.createVertexBuffer(T,o.aP.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(I,o.aX.members),this._tileDebugSegments=o.aB.simpleSegment(0,0,T.length,S.length)}_makeGlobeTileDebugTextBuffer(r,s,h,p,_,x){const T=o.V/4,S=new o.aN,I=new o.aw,C=new o.aW,L=25;I.reserve(32),S.reserve(L),C.reserve(L);const k=(B,j)=>L*B+j;for(let B=0;B<L;B++){const j=B*T;for(let U=0;U<L;U++){const $=U*T;S.emplaceBack($,j);const N=this._globePoint($,j,s,h,p,_,x);C.emplaceBack(N[0],N[1],N[2])}}for(let B=0;B<4;B++)for(let j=0;j<4;j++){const U=k(B,j),$=k(B,j+1),N=k(B+1,j),H=k(B+1,j+1);I.emplaceBack(U,$,N),I.emplaceBack(N,$,H)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(I),this._tileDebugTextBuffer=r.createVertexBuffer(S,o.aP.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(C,o.aX.members),this._tileDebugTextSegments=o.aB.simpleSegment(0,0,L,32)}destroy(r=!1){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}const Ys={vector:gt,raster:vt,"raster-dem":class extends vt{constructor(u,r,s,h){super(u,r,s,h),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(u,r){const s=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function h(p,_){p&&(u.state="errored",r(p)),_&&(u.dem=_,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",r(null))}u.request=o.d(this.map._requestManager.transformRequest(s,o.R.Tile),(function(p,_,x,T){if(delete u.request,u.aborted)u.state="unloaded",r(null);else if(p)u.state="errored",r(p);else if(_){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:x,expires:T});const S=ImageBitmap&&_ instanceof ImageBitmap&&o.ak(),I=1-(_.width-o.al(_.width))/2;I<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const C=S?_:o.f.getImageData(_,I),L={uid:u.uid,coord:u.tileID,source:this.id,scope:this.scope,rawImageData:C,encoding:this.encoding,padding:I};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadDEMTile",L,h.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){const r=u.canonical,s=Math.pow(2,r.z),h=(r.x-1+s)%s,p=r.x===0?u.wrap-1:u.wrap,_=(r.x+1+s)%s,x=r.x+1===s?u.wrap+1:u.wrap,T={};return T[new o.am(u.overscaledZ,p,r.z,h,r.y).key]={backfilled:!1},T[new o.am(u.overscaledZ,x,r.z,_,r.y).key]={backfilled:!1},r.y>0&&(T[new o.am(u.overscaledZ,p,r.z,h,r.y-1).key]={backfilled:!1},T[new o.am(u.overscaledZ,u.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},T[new o.am(u.overscaledZ,x,r.z,_,r.y-1).key]={backfilled:!1}),r.y+1<s&&(T[new o.am(u.overscaledZ,p,r.z,h,r.y+1).key]={backfilled:!1},T[new o.am(u.overscaledZ,u.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},T[new o.am(u.overscaledZ,x,r.z,_,r.y+1).key]={backfilled:!1}),T}},"raster-array":ct,geojson:class extends o.E{constructor(u,r,s,h){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=s.getActor(),this.setEventedParent(h),this._data=r.data,this._options=o.e({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const p=o.V/this.tileSize;this.workerOptions=o.e({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*p,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*p,extent:o.V,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.V,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*p,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}getClusterExpansionZoom(u,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},r),this}getClusterChildren(u,r){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},r),this}getClusterLeaves(u,r,s,h){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:r,offset:s},h),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.b("dataloading",{dataType:"source"})),this._loaded=!1;const u=o.e({},this.workerOptions);u.scope=this.scope;const r=this._data;typeof r=="string"?(u.request=this.map._requestManager.transformRequest(o.f.resolveURL(r),o.R.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,u,(s,h)=>{if(this._loaded=!0,this._pendingLoad=null,s)this.fire(new o.a(s));else{const p={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&h&&h.resourceTiming&&h.resourceTiming[this.id]&&(p.resourceTiming=h.resourceTiming[this.id]),this.fire(new o.b("data",p)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(u,r){const s=u.actor?"reloadTile":"loadTile";u.actor=this.actor;const h={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:o.f.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};u.request=this.actor.send(s,h,(p,_)=>(delete u.request,u.destroy(),u.aborted?r(null):p?r(p):(u.loadVectorData(_,this.map.painter,s==="reloadTile"),r(null))),void 0,s==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.ap{constructor(u,r,s,h){super(u,r,s,h),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const r of u.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.R.Source).url);o.aq(this.urls,(r,s)=>{this._loaded=!0,r?this.fire(new o.a(r)):s&&(this.video=s,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const r=this.video.seekable;u<r.start(0)||u>r.end(0)?this.fire(new o.a(new tt(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,r=u.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(u,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.ap,model:class extends o.E{constructor(u,r,s,h){super(),this.id=u,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){const u=[];for(const r in this._options.models){const s=this._options.models[r],h=o.l(this.map._requestManager.transformRequest(s.uri,o.R.Model).url).then(p=>{if(!p)return;const _=o.c(p),x=new o.M(r,s.position,s.orientation,_);x.computeBoundsAndApplyParent(),this.models.push(x)}).catch(p=>{this.fire(new o.a(new Error(`Could not load model ${r} from ${s.uri}: ${p.message}`)))});u.push(h)}return Promise.allSettled(u).then(()=>{this._loaded=!0,this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this.fire(new o.a(new Error(`Could not load models: ${r.message}`)))})}onAdd(u){this.map=u,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(u,r){}serialize(){return{type:"model"}}},"batched-model":class extends o.E{constructor(u,r,s,h){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=s,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(h)}onAdd(u){this.map=u,this.load()}load(u){this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,s=this.map._worldview;this._tileJSONRequest=ft(this._options,this.map._requestManager,r,s,(h,p)=>{this._tileJSONRequest=null,this._loaded=!0,h?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),s&&s.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${s}`),this.fire(new o.a(h))):p&&(o.e(this,p),p.bounds&&(this.tileBounds=new ot(p.bounds,this.minzoom,this.maxzoom)),o.aj(p.tiles,this.map._requestManager._customAccessToken),this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))),u&&u(h)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,r){const s=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),h={request:this.map._requestManager.transformRequest(s,o.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=r;else{if(u.buckets){const _=Object.values(u.buckets);for(const x of _)x.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",h,p.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",h,p.bind(this),void 0,!0);function p(_,x){return u.aborted?r(null):_&&_.status!==404?r(_):(x&&(x.resourceTiming&&(u.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&u.setExpiryData(x),u.buckets={...u.buckets,...x.buckets},x.featureIndex&&(u.latestFeatureIndex=x.featureIndex)),u.state="loaded",void r(null))}}serialize(){return o.e({},this._options)}},canvas:class extends o.ap{constructor(u,r,s,h){super(u,r,s,h),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(p=>!Array.isArray(p)||p.length!==2||p.some(_=>typeof _!="number"))||this.fire(new o.a(new tt(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.a(new tt(`sources.${u}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.a(new tt(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.a(new tt(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.a(new tt(`sources.${u}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.a(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof o.ar||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends o.E{constructor(u,r,s,h){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=s,this._implementation=r,this.setEventedParent(h),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.a(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.a(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ot(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),o.e(this,o.ac(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.ac(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.b("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this._map=u,this._loaded=!1,this.fire(new o.b("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:r,y:s,z:h}=u.canonical;return this._implementation.hasTile({x:r,y:s,z:h})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,r){const{x:s,y:h,z:p}=u.tileID.canonical,_=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:s,y:h,z:p},{signal:_.signal})).then((function(x){return delete u.request,u.aborted?(u.state="unloaded",r(null)):x===void 0?(u.state="errored",r(null)):x===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",r(null)):function(T){return T instanceof ImageData||T instanceof HTMLCanvasElement||T instanceof ImageBitmap||T instanceof HTMLImageElement}(x)?(this.loadTileData(u,x),u.state="loaded",void r(null)):(u.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.code!==20&&(u.state="errored",r(x))}),u.request.cancel=()=>_.abort()}loadTileData(u,r){u.setTexture(r,this._map.painter)}unloadTile(u,r){if(u.texture&&u.texture instanceof o.T?(u.destroy(!0),u.texture&&u.texture instanceof o.T&&this._map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){const{x:s,y:h,z:p}=u.tileID.canonical;this._implementation.unloadTile({x:s,y:h,z:p})}r()}abortTile(u,r){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){const u=o.ag(this.id,this.scope);this._map.style.clearSource(u)}_update(){this.fire(new o.b("data",{dataType:"source",sourceDataType:"content"}))}}},on=function(u,r,s,h){const p=new Ys[r.type](u,r,s,h);if(p.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${p.id}`);return o.aY(["load","abort","unload","serialize","prepare"],p),p};function Eh(u,r){const s=o.a6.identity([]);return o.a6.scale(s,s,[.5*u.width,.5*-u.height,1]),o.a6.translate(s,s,[1,-1,0]),o.a6.multiply(s,s,u.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(s)}function Sh(u,r,s,h,p,_,x,T=!1){const S=u.tilesIn(h,x,T);S.sort(Ra);const I=[];for(const L of S)I.push({wrappedTileID:L.tile.tileID.wrapped().key,queryResults:L.tile.queryRenderedFeatures(r,s,u._state,L,p,_,Eh(u.transform,L.tile.tileID),T)});const C=function(L){const k={},B={};for(const j of L){const U=j.queryResults,$=j.wrappedTileID,N=B[$]=B[$]||{};for(const H in U){const ee=U[H],X=N[H]=N[H]||{},te=k[H]=k[H]||[];for(const q of ee)X[q.featureIndex]||(X[q.featureIndex]=!0,te.push(q))}}return k}(I);for(const L in C)C[L].forEach(k=>{const B=k.feature,j=B.layer;j&&j.type!=="background"&&j.type!=="sky"&&j.type!=="slot"&&(B.source=j.source,j["source-layer"]&&(B.sourceLayer=j["source-layer"]),B.state=B.id!==void 0?u.getFeatureState(j["source-layer"],B.id):{})});return C}function Js(u,r){const s=u.getRenderableIds().map(_=>u.getTileByID(_)),h=[],p={};for(let _=0;_<s.length;_++){const x=s[_],T=x.tileID.canonical.key;p[T]||(p[T]=!0,x.querySourceFeatures(h,r))}return h}function Ra(u,r){const s=u.tileID,h=r.tileID;return s.overscaledZ-h.overscaledZ||s.canonical.y-h.canonical.y||s.wrap-h.wrap||s.canonical.x-h.canonical.x}class ta extends Eo{constructor(r,s,h,p,_){super(r,s,h,p,_),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(r,s){const h=s.context,p=h.gl;this.texture=this.texture||s.getTileTexture(r.width),this.texture&&this.texture instanceof o.T?this.texture.update(r,{useMipmap:!1,premultiply:!1}):this.texture=new o.T(h,r,p.RGBA,{useMipmap:!1,premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(r=16384,s){const h=this._mrt=new o.aZ(30),p=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=o.a_(p,(_,x,T,S)=>{if(_)s(_);else try{const I=h.getHeaderLength(x);if(I>r)return void(this.request=this.fetchHeader(I,s));h.parseHeader(x),this._isHeaderLoaded=!0;let C=0;for(const L of Object.values(h.layers))C=Math.max(C,L.dataIndex[L.dataIndex.length-1].last_byte);x.byteLength>=C&&(this.entireBuffer=x),s(null,this.entireBuffer||x,T,S)}catch(I){s(I)}}),this.request}fetchBand(r,s,h){const p=this._mrt;if(!this._isHeaderLoaded||!p)return void h(new Error("Tile header is not ready"));const _=this.actor;if(!_)return void h(new Error("Can't fetch tile band without an actor"));let x;const T=(L,k)=>{x.complete(L,k),L?h(L):(this.updateTextureDescriptor(r,s),h(null,this.textureDescriptor&&this.textureDescriptor.img))},S=(L,k)=>{if(L)return h(L);const B=_.send("decodeRasterArray",{buffer:k,task:x},T,void 0,!0);this._workQueue.push(()=>{B&&B.cancel(),x.cancel()})},I=p.getLayer(r);if(!I)return void h(new Error(`Unknown sourceLayer "${r}"`));if(I.hasDataForBand(s))return this.updateTextureDescriptor(r,s),void h(null,this.textureDescriptor?this.textureDescriptor.img:null);const C=I.getDataRange([s]);if(x=p.createDecodingTask(C),!x||x.tasks.length)if(this.flushQueues(),this.entireBuffer)S(null,this.entireBuffer.slice(C.firstByte,C.lastByte+1));else{const L=Object.assign({},this.requestParams,{headers:{Range:`bytes=${C.firstByte}-${C.lastByte}`}}),k=o.a_(L,S);this._fetchQueue.push(()=>{k.cancel(),x.cancel()})}else h(null)}updateNeeded(r,s){return(!this.textureDescriptor||this.textureDescriptor.band!==s||this.textureDescriptor.layer!==r)&&this.state!=="errored"}updateTextureDescriptor(r,s){if(!this._mrt)return;const h=this._mrt.getLayer(r);if(!h||!h.hasBand(s)||!h.hasDataForBand(s))return;const{bytes:p,tileSize:_,buffer:x,offset:T,scale:S}=h.getBandView(s),I=_+2*x,C={data:p,width:I,height:I},L=this.texture;L&&L instanceof o.T&&L.update(C,{useMipmap:!1,premultiply:!1}),this.textureDescriptor={layer:r,band:s,img:C,buffer:x,offset:T,tileSize:_,format:h.pixelFormat,mix:[S,256*S,65536*S,16777216*S]}}}class La{constructor(r,s){this.max=r,this.onRemove=s,this.reset()}reset(){for(const r in this.data)for(const s of this.data[r])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(r,s,h){const p=r.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const _={value:s,timeout:void 0};if(h!==void 0&&(_.timeout=setTimeout(()=>{this.remove(r,_)},h)),this.data[p].push(_),this.order.push(p),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const s=this.data[r].shift();return s.timeout&&clearTimeout(s.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),s.value}getByKey(r){const s=this.data[r];return s?s[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,s){if(!this.has(r))return this;const h=r.wrapped().key,p=s===void 0?0:this.data[h].indexOf(s),_=this.data[h][p];return this.data[h].splice(p,1),_.timeout&&clearTimeout(_.timeout),this.data[h].length===0&&delete this.data[h],this.onRemove(_.value),this.order.splice(this.order.indexOf(h),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(r){const s=[];for(const h in this.data)for(const p of this.data[h])r(p.value)||s.push(p);for(const h of s)this.remove(h.value.tileID,h)}}class Ss extends o.E{constructor(r,s,h){super(),this.id=r,this._onlySymbols=h,s.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new La(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new dt,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const s=this._tiles[r];if(s.state!=="errored"&&(s.state!=="loaded"||!s.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,s){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,s)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const h=this._tiles[s];h.upload(r),h.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return o.a$(this._tiles).map(r=>r.tileID).sort(eu).map(r=>r.key)}getRenderableIds(r,s){const h=[];for(const p in this._tiles)this._isIdRenderable(+p,r,s)&&h.push(this._tiles[p]);return r?h.sort((p,_)=>{const x=p.tileID,T=_.tileID,S=new o.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),I=new o.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-T.overscaledZ||I.y-S.y||I.x-S.x}).map(p=>p.tileID.key):h.map(p=>p.tileID).sort(eu).map(p=>p.key)}hasRenderableParent(r){const s=this.findLoadedParent(r,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(r,s,h){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(s||!this._tiles[r].holdingForFade())&&(h||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,s){const h=this._tiles[r];h&&(h.state!=="loading"&&(h.state=s),this._loadTile(h,this._tileLoaded.bind(this,h,r,s)))}_tileLoaded(r,s,h,p){if(p)if(r.state="errored",p.status!==404)this._source.fire(new o.a(p,{tile:r}));else{if(!(r.tileID.key in this._loadedParentTiles))return void this._source.fire(new o.b("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const _=this.map.painter.terrain;this.update(this.transform,_.getScaledDemTileSize(),!0),_.resetTileLookupCache(this.id)}else this.update(this.transform)}else r.timeAdded=o.f.now(),h==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(s,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new o.b("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const s=this.getRenderableIds();for(let p=0;p<s.length;p++){const _=s[p];if(r.neighboringTiles&&r.neighboringTiles[_]){const x=this.getTileByID(_);h(r,x),h(x,r)}}function h(p,_){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let x=_.tileID.canonical.x-p.tileID.canonical.x;const T=_.tileID.canonical.y-p.tileID.canonical.y,S=Math.pow(2,p.tileID.canonical.z),I=_.tileID.key;x===0&&T===0||Math.abs(T)>1||(Math.abs(x)>1&&(Math.abs(x+S)===1?x+=S:Math.abs(x-S)===1&&(x-=S)),_.dem&&p.dem&&(p.dem.backfillBorder(_.dem,x,T),p.neighboringTiles&&p.neighboringTiles[I]&&(p.neighboringTiles[I].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,s,h,p){for(const _ in this._tiles){let x=this._tiles[_];if(p[_]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>h)continue;let T=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const I=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[I.key],x&&x.hasData()&&(T=I)}let S=T;for(;S.overscaledZ>s;)if(S=S.scaledTo(S.overscaledZ-1),r[S.key]){p[T.key]=T;break}}}findLoadedParent(r,s){if(r.key in this._loadedParentTiles){const h=this._loadedParentTiles[r.key];return h&&h.tileID.overscaledZ>=s?h:null}for(let h=r.overscaledZ-1;h>=s;h--){const p=r.scaledTo(h),_=this._getLoadedTile(p);if(_)return _}}_getLoadedTile(r){const s=this._tiles[r.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,s){s=s||this._source.tileSize;const h=Math.ceil(r.width/s)+1,p=Math.ceil(r.height/s)+1,_=Math.floor(h*p*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,_):_,T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(T)}handleWrapJump(r){const s=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,s){const h={};for(const p in this._tiles){const _=this._tiles[p];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+s),h[_.tileID.key]=_}this._tiles=h;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(r,s,h,p){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!h)return;let _;if(this.updateCacheSize(r,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain)if(this._source.tileID)_=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(S=>new o.am(S.canonical.z,S.wrap,S.canonical.z,S.canonical.x,S.canonical.y));else if(this.tileCoverLift!==0){const S=r.clone();S.tileCoverLift=this.tileCoverLift,_=S.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.minzoom<=1&&r.projection.name==="globe"&&(_.push(new o.am(1,0,1,0,0)),_.push(new o.am(1,0,1,1,0)),_.push(new o.am(1,0,1,0,1)),_.push(new o.am(1,0,1,1,1)))}else _=r.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!h,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(_=_.filter(S=>this._source.hasTile(S)));else _=[];if(_.length>0&&this.castsShadows&&p&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Qs(this._source.type)){const S=r.coveringZoomLevel({tileSize:s||this._source.tileSize,roundZoom:this._source.roundZoom&&!h}),I=Math.min(S,this._source.maxzoom),C=r.extendTileCoverForShadows(_,p,I);for(const L of C)this._shadowCasterTiles[L.key]=!0,_.push(L)}const x=this._updateRetainedTiles(_);if(Qs(this._source.type)&&_.length!==0){const S={},I={},C=Object.keys(x);for(const k of C){const B=x[k],j=this._tiles[k];if(!j||j.fadeEndTime&&j.fadeEndTime<=o.f.now())continue;const U=this.findLoadedParent(B,Math.max(B.overscaledZ-Ss.maxOverzooming,this._source.minzoom));U&&(this._addTile(U.tileID),S[U.tileID.key]=U.tileID),I[k]=B}const L=_[_.length-1].overscaledZ;for(const k in this._tiles){const B=this._tiles[k];if(x[k]||!B.hasData())continue;let j=B.tileID;for(;j.overscaledZ>L;){j=j.scaledTo(j.overscaledZ-1);const U=this._tiles[j.key];if(U&&U.hasData()&&I[j.key]){x[k]=B.tileID;break}}}for(const k in S)x[k]||(this._coveredTiles[k]=!0,x[k]=S[k])}for(const S in x)this._tiles[S].clearFadeHold();const T=o.b0(this._tiles,x);for(const S of T){const I=this._tiles[S];I.hasSymbolBuckets&&!I.holdingForFade()?I.setHoldDuration(this.map._fadeDuration):I.hasSymbolBuckets&&!I.symbolFadeFinished()||this._removeTile(+S)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const s={};if(r.length===0)return s;const h={},p=r.reduce((I,C)=>Math.min(I,C.overscaledZ),1/0),_=r[0].overscaledZ,x=Math.max(_-Ss.maxOverzooming,this._source.minzoom),T=Math.max(_+Ss.maxUnderzooming,this._source.minzoom),S={};for(const I of r){const C=this._addTile(I);s[I.key]=I,C.hasData()||p<this._source.maxzoom&&(S[I.key]=I)}this._retainLoadedChildren(S,p,T,s);for(const I of r){let C=this._tiles[I.key];if(C.hasData())continue;if(I.canonical.z>=this._source.maxzoom){const k=I.children(this._source.maxzoom)[0],B=this.getTile(k);if(B&&B.hasData()){s[k.key]=k;continue}}else{const k=I.children(this._source.maxzoom);if(s[k[0].key]&&s[k[1].key]&&s[k[2].key]&&s[k[3].key])continue}let L=C.wasRequested();for(let k=I.overscaledZ-1;k>=x;--k){const B=I.scaledTo(k);if(h[B.key]||(h[B.key]=!0,C=this.getTile(B),!C&&L&&(C=this._addTile(B)),C&&(s[B.key]=B,L=C.wasRequested(),C.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const s=[];let h,p=this._tiles[r].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){h=this._loadedParentTiles[p.key];break}s.push(p.key);const _=p.scaledTo(p.overscaledZ-1);if(h=this._getLoadedTile(_),h)break;p=_}for(const _ of s)this._loadedParentTiles[_]=h}}_addTile(r){let s=this._tiles[r.key];if(s)return s.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),s;s=this._cache.getAndRemove(r),s&&(this._setTileReloadTimer(r.key,s),s.tileID=r,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,s)));const h=!!s;if(!h){const p=this.map?this.map.painter:null,_=this._source.tileSize*r.overscaleFactor();s=this._source.type==="raster-array"?new ta(r,_,this.transform.tileZoom,p,this._isRaster):new Eo(r,_,this.transform.tileZoom,p,this._isRaster),this._loadTile(s,this._tileLoaded.bind(this,s,r.key,s.state))}return s?(s.uses++,this._tiles[r.key]=s,h||this._source.fire(new o.b("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(r,s){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const h=s.getExpiryTimeout();h&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},h))}_removeTile(r){const s=this._tiles[r];s&&(s.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),s.uses>0||(s.hasData()&&s.state!=="reloading"||s.state==="empty"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,s,h){const p=[],_=this.transform;if(!_)return p;const x=_.projection.name==="globe",T=o.a5(_.center.lng);for(const S in this._tiles){const I=this._tiles[S];if(h&&I.clearQueryDebugViz(),I.holdingForFade())continue;let C;if(x){const L=I.tileID.canonical;if(L.z===0){const k=[Math.abs(o.aa(T,...Bl(L,-1))-T),Math.abs(o.aa(T,...Bl(L,1))-T)];C=[0,2*k.indexOf(Math.min(...k))-1]}else{const k=[Math.abs(o.aa(T,...Bl(L,-1))-T),Math.abs(o.aa(T,...Bl(L,0))-T),Math.abs(o.aa(T,...Bl(L,1))-T)];C=[k.indexOf(Math.min(...k))-1]}}else C=[0];for(const L of C){const k=r.containsTile(I,_,s,L);k&&p.push(k)}}return p}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,s){const h=this.getRenderableIds(r,s).map(_=>this._tiles[_].tileID),p=this.transform.projection.name==="globe";for(const _ of h)_.projMatrix=this.transform.calculateProjMatrix(_.toUnwrapped()),_.expandedProjMatrix=p?this.transform.calculateProjMatrix(_.toUnwrapped(),!1,!0):_.projMatrix;return h}sortCoordinatesByDistance(r){const s=r.slice(),h=this.transform._camera.position,p=this.transform._camera.forward(),_={};for(const x of s){const T=1/(1<<x.canonical.z);_[x.key]=((x.canonical.x+.5)*T+x.wrap-h[0])*p[0]+((x.canonical.y+.5)*T-h[1])*p[1]-h[2]*p[2]}return s.sort((x,T)=>_[x.key]-_[T.key]),s}hasTransition(){if(this._source.hasTransition())return!0;if(Qs(this._source.type))for(const r in this._tiles){const s=this._tiles[r];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=o.f.now())return!0}return!1}setFeatureState(r,s,h){this._state.updateState(r=r||"_geojsonTileLayer",s,h)}removeFeatureState(r,s,h){this._state.removeFeatureState(r=r||"_geojsonTileLayer",s,h)}getFeatureState(r,s){return this._state.getState(r=r||"_geojsonTileLayer",s)}setDependencies(r,s,h){const p=this._tiles[r];p&&p.setDependencies(s,h)}reloadTilesForDependencies(r,s){for(const h in this._tiles)this._tiles[h].hasDependency(r,s)&&this._reloadTile(+h,"reloading");this._cache.filter(h=>!h.hasDependency(r,s))}_preloadTiles(r,s){if(!this._sourceLoaded){const S=()=>{this._sourceLoaded&&(this._source.off("data",S),this._preloadTiles(r,s))};return void this._source.on("data",S)}const h=new Map,p=Array.isArray(r)?r:[r],_=this.map.painter.terrain,x=this.usedForTerrain&&_?_.getScaledDemTileSize():this._source.tileSize;for(const S of p){const I=S.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const C of I)h.set(C.key,C);this.usedForTerrain&&S.updateElevation(!1)}const T=Array.from(h.values());o.b1(T,(S,I)=>{const C=new Eo(S,this._source.tileSize*S.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(C,L=>{this._source.type==="raster-dem"&&C.dem&&this._backfillDEM(C),I(L,C)})},s)}}function eu(u,r){const s=Math.abs(2*u.wrap)-+(u.wrap<0),h=Math.abs(2*r.wrap)-+(r.wrap<0);return u.overscaledZ-r.overscaledZ||h-s||r.canonical.y-u.canonical.y||r.canonical.x-u.canonical.x}function Qs(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function Bl(u,r){const s=1<<u.z;return[u.x/s+r,(u.x+1)/s+r]}Ss.maxOverzooming=10,Ss.maxUnderzooming=3;class Yf{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const r=!1,s=!1;for(const h in this.style._mergedLayers){const p=this.style._mergedLayers[h];if(p.type==="fill-extrusion")this.layers.push({layer:p,visible:r,visibilityChanged:s});else if(p.type==="model"){const _=this.style.getLayerSource(p);_&&_.type==="batched-model"&&this.layers.push({layer:p,visible:r,visibilityChanged:s})}}}onNewFrame(r){this.layersGotHidden=!1;for(const s of this.layers){const h=s.layer;let p=!1;h.type==="fill-extrusion"?p=!h.isHidden(r)&&h.paint.get("fill-extrusion-opacity")>0:h.type==="model"&&(p=!h.isHidden(r)&&h.paint.get("model-opacity")>0),this.layersGotHidden=this.layersGotHidden||!p&&s.visible,s.visible=p}}updateZOffset(r,s){this.currentBuildingBuckets=[];for(const p of this.layers){const _=p.layer,x=this.style.getLayerSourceCache(_);let T=1;_.type==="fill-extrusion"&&(T=p.visible?_.paint.get("fill-extrusion-vertical-scale"):0);let S=x?x.getTile(s):null;if(!S&&x&&s.canonical.z>x.getSource().minzoom){let I=s.scaledTo(Math.min(x.getSource().maxzoom,s.overscaledZ-1));for(;I.overscaledZ>=x.getSource().minzoom&&(S=x.getTile(I),!S&&I.overscaledZ!==0);)I=I.scaledTo(I.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:S?S.getBucket(_):null,tileID:S?S.tileID:s,verticalScale:T})}r.hasAnyZOffset=!1;let h=!1;for(let p=0;p<r.symbolInstances.length;p++){const _=r.symbolInstances.get(p),x=_.zOffset,T=this._getHeightAtTileOffset(s,_.tileAnchorX,_.tileAnchorY);_.zOffset=T!==Number.NEGATIVE_INFINITY?T:x,h||x===_.zOffset||(h=!0),r.hasAnyZOffset||_.zOffset===0||(r.hasAnyZOffset=!0)}h&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,s,h,p){let _=s,x=h;if(r.canonical.z!==p.canonical.z){const T=p.canonical,S=1/(1<<r.canonical.z-T.z);_=(s+r.canonical.x*o.V)*S-T.x*o.V|0,x=(h+r.canonical.y*o.V)*S-T.y*o.V|0}return{tileX:_,tileY:x}}_getHeightAtTileOffset(r,s,h){let p,_;for(let x=0;x<this.layers.length;++x){if(this.layers[x].layer.type!=="fill-extrusion")continue;const{bucket:T,tileID:S,verticalScale:I}=this.currentBuildingBuckets[x];if(!T)continue;const{tileX:C,tileY:L}=this._mapCoordToOverlappingTile(r,s,h,S),k=T.getHeightAtTileCoord(C,L);k&&k.height!==void 0&&(k.hidden?p=k.height:_=Math.max(k.height*I,_||0))}if(_!==void 0)return _;for(let x=0;x<this.layers.length;++x){const T=this.layers[x];if(T.layer.type!=="model"||!T.visible)continue;const{bucket:S,tileID:I}=this.currentBuildingBuckets[x];if(!S)continue;const{tileX:C,tileY:L}=this._mapCoordToOverlappingTile(r,s,h,I),k=S.getHeightAtTileCoord(C,L);if(k&&!k.hidden)return k.height===void 0&&p!==void 0?Math.min(k.maxHeight,p)*k.verticalScale:(k.height||0)*k.verticalScale}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ia(u,r){const s={};for(const h in u)h!=="ref"&&(s[h]=u[h]);return o.b2.forEach(h=>{h in r&&(s[h]=r[h])}),s}function Jf(u){u=u.slice();const r=Object.create(null);for(let s=0;s<u.length;s++)r[u[s].id]=u[s];for(let s=0;s<u.length;s++)"ref"in u[s]&&(u[s]=ia(u[s],r[u[s].ref]));return u}const zi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Fl(u,r,s){s.push({command:zi.addSource,args:[u,r[u]]})}function Mh(u,r,s){r.push({command:zi.removeSource,args:[u]}),s[u]=!0}function N_(u,r,s,h){Mh(u,s,h),Fl(u,r,s)}function V_(u,r,s){let h;for(h in u[s])if(u[s].hasOwnProperty(h)&&h!=="data"&&!Y(u[s][h],r[s][h]))return!1;for(h in r[s])if(r[s].hasOwnProperty(h)&&h!=="data"&&!Y(u[s][h],r[s][h]))return!1;return!0}function So(u,r,s,h,p,_){let x;for(x in r=r||{},u=u||{})u.hasOwnProperty(x)&&(Y(u[x],r[x])||s.push({command:_,args:[h,x,r[x],p]}));for(x in r)r.hasOwnProperty(x)&&!u.hasOwnProperty(x)&&(Y(u[x],r[x])||s.push({command:_,args:[h,x,r[x],p]}))}function Mo(u){return u.id}function tu(u,r){return u[r.id]=r,u}class Da{constructor(r,s){this.reset(r,s)}reset(r,s){this.points=r||[],this._distances=[0];for(let h=1;h<this.points.length;h++)this._distances[h]=this._distances[h-1]+this.points[h].dist(this.points[h-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.aa(r,0,1);let s=1,h=this._distances[s];const p=r*this.paddedLength+this.padding;for(;h<p&&s<this._distances.length;)h=this._distances[++s];const _=s-1,x=this._distances[_],T=h-x,S=T>0?(p-x)/T:0;return this.points[_].mult(1-S).add(this.points[s].mult(S))}}class Ah{constructor(r,s,h){const p=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(r/h),this.yCellCount=Math.ceil(s/h);for(let x=0;x<this.xCellCount*this.yCellCount;x++)p.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=s,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,s,h,p,_){this._forEachCell(s,h,p,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(s),this.bboxes.push(h),this.bboxes.push(p),this.bboxes.push(_)}insertCircle(r,s,h,p){this._forEachCell(s-p,h-p,s+p,h+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(s),this.circles.push(h),this.circles.push(p)}_insertBoxCell(r,s,h,p,_,x){this.boxCells[_].push(x)}_insertCircleCell(r,s,h,p,_,x){this.circleCells[_].push(x)}_query(r,s,h,p,_,x){if(h<0||r>this.width||p<0||s>this.height)return!_&&[];const T=[];if(r<=0&&s<=0&&this.width<=h&&this.height<=p){if(_)return!0;for(let S=0;S<this.boxKeys.length;S++)T.push({key:this.boxKeys[S],x1:this.bboxes[4*S],y1:this.bboxes[4*S+1],x2:this.bboxes[4*S+2],y2:this.bboxes[4*S+3]});for(let S=0;S<this.circleKeys.length;S++){const I=this.circles[3*S],C=this.circles[3*S+1],L=this.circles[3*S+2];T.push({key:this.circleKeys[S],x1:I-L,y1:C-L,x2:I+L,y2:C+L})}return x?T.filter(x):T}return this._forEachCell(r,s,h,p,this._queryCell,T,{hitTest:_,seenUids:{box:{},circle:{}}},x),_?T.length>0:T}_queryCircle(r,s,h,p,_){const x=r-h,T=r+h,S=s-h,I=s+h;if(T<0||x>this.width||I<0||S>this.height)return!p&&[];const C=[];return this._forEachCell(x,S,T,I,this._queryCellCircle,C,{hitTest:p,circle:{x:r,y:s,radius:h},seenUids:{box:{},circle:{}}},_),p?C.length>0:C}query(r,s,h,p,_){return this._query(r,s,h,p,!1,_)}hitTest(r,s,h,p,_){return this._query(r,s,h,p,!0,_)}hitTestCircle(r,s,h,p){return this._queryCircle(r,s,h,!0,p)}_queryCell(r,s,h,p,_,x,T,S){const I=T.seenUids,C=this.boxCells[_];if(C!==null){const k=this.bboxes;for(const B of C)if(!I.box[B]){I.box[B]=!0;const j=4*B;if(r<=k[j+2]&&s<=k[j+3]&&h>=k[j+0]&&p>=k[j+1]&&(!S||S(this.boxKeys[B]))){if(T.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[B],x1:k[j],y1:k[j+1],x2:k[j+2],y2:k[j+3]})}}}const L=this.circleCells[_];if(L!==null){const k=this.circles;for(const B of L)if(!I.circle[B]){I.circle[B]=!0;const j=3*B;if(this._circleAndRectCollide(k[j],k[j+1],k[j+2],r,s,h,p)&&(!S||S(this.circleKeys[B]))){if(T.hitTest)return x.push(!0),!0;{const U=k[j],$=k[j+1],N=k[j+2];x.push({key:this.circleKeys[B],x1:U-N,y1:$-N,x2:U+N,y2:$+N})}}}}}_queryCellCircle(r,s,h,p,_,x,T,S){const I=T.circle,C=T.seenUids,L=this.boxCells[_];if(L!==null){const B=this.bboxes;for(const j of L)if(!C.box[j]){C.box[j]=!0;const U=4*j;if(this._circleAndRectCollide(I.x,I.y,I.radius,B[U+0],B[U+1],B[U+2],B[U+3])&&(!S||S(this.boxKeys[j])))return x.push(!0),!0}}const k=this.circleCells[_];if(k!==null){const B=this.circles;for(const j of k)if(!C.circle[j]){C.circle[j]=!0;const U=3*j;if(this._circlesCollide(B[U],B[U+1],B[U+2],I.x,I.y,I.radius)&&(!S||S(this.circleKeys[j])))return x.push(!0),!0}}}_forEachCell(r,s,h,p,_,x,T,S){const I=this._convertToXCellCoord(r),C=this._convertToYCellCoord(s),L=this._convertToXCellCoord(h),k=this._convertToYCellCoord(p);for(let B=I;B<=L;B++)for(let j=C;j<=k;j++)if(_.call(this,r,s,h,p,this.xCellCount*j+B,x,T,S))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,s,h,p,_,x){const T=p-r,S=_-s,I=h+x;return I*I>T*T+S*S}_circleAndRectCollide(r,s,h,p,_,x,T){const S=(x-p)/2,I=Math.abs(r-(p+S));if(I>S+h)return!1;const C=(T-_)/2,L=Math.abs(s-(_+C));if(L>C+h)return!1;if(I<=S||L<=C)return!0;const k=I-S,B=L-C;return k*k+B*B<=h*h}}const eo={unknown:0,flipRequired:1,flipNotRequired:2},Ao=Math.tan(85*Math.PI/180);function Nl(u,r,s,h,p,_,x){const T=o.a6.create();if(s)if(_.name==="globe"){const S=o.b3(p,r);o.a6.multiply(T,T,S)}else{const S=o.b4.invert([],x);T[0]=S[0],T[1]=S[1],T[4]=S[2],T[5]=S[3],h||o.a6.rotateZ(T,T,p.angle)}else o.a6.multiply(T,p.labelPlaneMatrix,u);return T}function Ih(u,r,s,h,p,_,x){const T=Nl(u,r,s,h,p,_,x);return _.name==="globe"&&s||(T[2]=T[6]=T[10]=T[14]=0),T}function Ch(u,r,s,h,p,_,x){if(s){if(_.name==="globe"){const T=Nl(u,r,s,h,p,_,x);return o.a6.invert(T,T),o.a6.multiply(T,u,T),T}{const T=o.a6.clone(u),S=o.a6.identity([]);return S[0]=x[0],S[1]=x[1],S[4]=x[2],S[5]=x[3],o.a6.multiply(T,T,S),h||o.a6.rotateZ(T,T,-p.angle),T}}return p.glCoordMatrix}function fs(u,r,s,h){const p=[u,r,s,1];s?o.a7.transformMat4(p,p,h):zh(p,p,h);const _=p[3];return p[0]/=_,p[1]/=_,p[2]/=_,p}function Qf(u,r){return Math.min(.5+u/r*.5,1.5)}function Ph(u,r){const s=u[0]/u[3],h=u[1]/u[3];return s>=-r[0]&&s<=r[0]&&h>=-r[1]&&h<=r[1]}function Rh(u,r,s,h,p,_,x,T,S,I){const C=s.transform,L=h?u.textSizeData:u.iconSizeData,k=o.b5(L,s.transform.zoom),B=C.projection.name==="globe",j=[256/s.width*2+1,256/s.height*2+1],U=h?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;U.clear();let $=null;B&&($=h?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const N=u.lineVertexArray,H=h?u.text.placedSymbolArray:u.icon.placedSymbolArray,ee=s.transform.width/s.transform.height;let X,te=!1;for(let q=0;q<H.length;q++){const re=H.get(q),{numGlyphs:ae,writingMode:ue}=re;if(ue!==o.b6.vertical||te||X===o.b6.horizontal||(te=!0),X=ue,(re.hidden||ue===o.b6.vertical)&&!te){Io(ae,U);continue}te=!1;const me=new o.P(re.tileAnchorX,re.tileAnchorY);let{x:Me,y:ye,z:Oe}=C.projection.projectTilePoint(me.x,me.y,I.canonical);if(S){const[_t,Ot,Zt]=S(me);Me+=_t,ye+=Ot,Oe+=Zt}const Le=[Me,ye,Oe,1];if(o.a7.transformMat4(Le,Le,r),!Ph(Le,j)){Io(ae,U);continue}const We=Le[3],ve=Qf(s.transform.getCameraToCenterDistance(C.projection),We),Ce=o.b7(L,k,re),fe=x?Ce/ve:Ce*ve,we=fs(Me,ye,Oe,p);if(we[3]<=0){Io(ae,U);continue}let Ke={};const st=x?null:S,nt=Oh(re,fe,!1,T,r,p,_,u.glyphOffsetArray,N,U,$,we,me,Ke,ee,st,C.projection,I,x);te=nt.useVertical,st&&nt.needsFlipping&&(Ke={}),(nt.notEnoughRoom||te||nt.needsFlipping&&Oh(re,fe,!0,T,r,p,_,u.glyphOffsetArray,N,U,$,we,me,Ke,ee,st,C.projection,I,x).notEnoughRoom)&&Io(ae,U)}h?(u.text.dynamicLayoutVertexBuffer.updateData(U),$&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData($)):(u.icon.dynamicLayoutVertexBuffer.updateData(U),$&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData($))}function Lh(u,r,s,h,p,_,x,T,S,I,C,L,k,B,j,U){const{lineStartIndex:$,glyphStartIndex:N,segment:H}=T,ee=N+T.numGlyphs,X=$+T.lineLength,te=r.getoffsetX(N),q=r.getoffsetX(ee-1),re=Vl(u*te,s,h,p,_,x,H,$,X,S,I,C,L,k,!0,B,j,U);if(!re)return null;const ae=Vl(u*q,s,h,p,_,x,H,$,X,S,I,C,L,k,!0,B,j,U);return ae?{first:re,last:ae}:null}function Dh(u,r,s,h){return u===o.b6.horizontal&&Math.abs(h)>Math.abs(s)?{useVertical:!0}:u===o.b6.vertical?h>0?{needsFlipping:!0}:null:r!==eo.unknown&&function(p,_){return p===0||Math.abs(_/p)>Ao}(s,h)?r===eo.flipRequired?{needsFlipping:!0}:null:s<0?{needsFlipping:!0}:null}function Oh(u,r,s,h,p,_,x,T,S,I,C,L,k,B,j,U,$,N,H){const ee=r/24,X=u.lineOffsetX*ee,te=u.lineOffsetY*ee,{lineStartIndex:q,glyphStartIndex:re,numGlyphs:ae,segment:ue,writingMode:me,flipState:Me}=u,ye=q+u.lineLength,Oe=Le=>{if(C){const[fe,we,Ke]=Le.up,st=I.length;o.b8(C,st+0,fe,we,Ke),o.b8(C,st+1,fe,we,Ke),o.b8(C,st+2,fe,we,Ke),o.b8(C,st+3,fe,we,Ke)}const[We,ve,Ce]=Le.point;o.b9(I,We,ve,Ce,Le.angle)};if(ae>1){const Le=Lh(ee,T,X,te,s,L,k,u,S,_,B,U,!1,$,N,H);if(!Le)return{notEnoughRoom:!0};if(h&&!s){let[We,ve,Ce]=Le.first.point,[fe,we,Ke]=Le.last.point;[We,ve]=fs(We,ve,Ce,x),[fe,we]=fs(fe,we,Ke,x);const st=Dh(me,Me,(fe-We)*j,we-ve);if(u.flipState=st&&st.needsFlipping?eo.flipRequired:eo.flipNotRequired,st)return st}Oe(Le.first);for(let We=re+1;We<re+ae-1;We++){const ve=Vl(ee*T.getoffsetX(We),X,te,s,L,k,ue,q,ye,S,_,B,U,!1,!1,$,N,H);if(!ve)return I.length-=4*(We-re),{notEnoughRoom:!0};Oe(ve)}Oe(Le.last)}else{if(h&&!s){const We=fs(k.x,k.y,0,p),ve=q+ue+1,Ce=new o.P(S.getx(ve),S.gety(ve)),fe=fs(Ce.x,Ce.y,0,p),we=fe[3]>0?fe:iu(k,Ce,We,1,p,void 0,$,N.canonical),Ke=Dh(me,Me,(we[0]-We[0])*j,we[1]-We[1]);if(u.flipState=Ke&&Ke.needsFlipping?eo.flipRequired:eo.flipNotRequired,Ke)return Ke}const Le=Vl(ee*T.getoffsetX(re),X,te,s,L,k,ue,q,ye,S,_,B,U,!1,!1,$,N,H);if(!Le)return{notEnoughRoom:!0};Oe(Le)}return{}}function Oa(u,r,s,h,p){const{x:_,y:x,z:T}=h.projectTilePoint(u.x,u.y,r);if(!p)return fs(_,x,T,s);const[S,I,C]=p(u);return fs(_+S,x+I,T+C,s)}function iu(u,r,s,h,p,_,x,T){const S=Oa(u.sub(r)._unit()._add(u),T,p,x,_);return o.N.sub(S,s,S),o.N.normalize(S,S),o.N.scaleAndAdd(S,s,S,h)}function Vl(u,r,s,h,p,_,x,T,S,I,C,L,k,B,j,U,$,N){const H=h?u-r:u+r;let ee=H>0?1:-1,X=0;h&&(ee*=-1,X=Math.PI),ee<0&&(X+=Math.PI);let te=T+x+(ee>0?0:1)|0,q=p,re=p,ae=0,ue=0;const me=Math.abs(H),Me=[],ye=[];let Oe=_,Le=Oe;const We=()=>iu(Le,Oe,re,me-ae+1,C,k,U,$.canonical);for(;ae+ue<=me;){if(te+=ee,te<T||te>=S)return null;if(re=q,Le=Oe,Me.push(re),B&&ye.push(Le),Oe=new o.P(I.getx(te),I.gety(te)),q=L[te],!q){const Ot=Oa(Oe,$.canonical,C,U,k);q=Ot[3]>0?L[te]=Ot:We()}ae+=ue,ue=o.N.distance(re,q)}j&&k&&(L[te]&&(q=We(),ue=o.N.distance(re,q)),L[te]=q);const ve=(me-ae)/ue,Ce=Oe.sub(Le)._mult(ve)._add(Le),fe=o.N.sub([],q,re),we=o.N.scaleAndAdd([],re,fe,ve);let Ke=[0,0,1],st=fe[0],nt=fe[1];if(N&&(Ke=U.upVector($.canonical,Ce.x,Ce.y),Ke[0]!==0||Ke[1]!==0||Ke[2]!==1)){const Ot=[Ke[2],0,-Ke[0]],Zt=o.N.cross([],Ke,Ot);o.N.normalize(Ot,Ot),o.N.normalize(Zt,Zt),st=o.N.dot(fe,Ot),nt=o.N.dot(fe,Zt)}if(s){const Ot=o.N.cross([],Ke,fe);o.N.normalize(Ot,Ot),o.N.scaleAndAdd(we,we,Ot,s*ee)}const _t=X+Math.atan2(nt,st);return Me.push(we),B&&ye.push(Ce),{point:we,angle:_t,path:Me,tilePath:ye,up:Ke}}function Io(u,r){const s=r.length,h=s+4*u;r.resize(h),r.float32.fill(-1/0,4*s,4*h)}function zh(u,r,s){const h=r[0],p=r[1];return u[0]=s[0]*h+s[4]*p+s[12],u[1]=s[1]*h+s[5]*p+s[13],u[3]=s[3]*h+s[7]*p+s[15],u}const ps=100;class xt{constructor(r,s,h=new Ah(r.width+200,r.height+200,25),p=new Ah(r.width+200,r.height+200,25)){this.transform=r,this.grid=h,this.ignoredGrid=p,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+ps,this.screenBottomBoundary=r.height+ps,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=s}placeCollisionBox(r,s,h,p,_,x,T,S){let I=h.projectedAnchorX,C=h.projectedAnchorY,L=h.projectedAnchorZ;const k=h.elevation,B=h.tileID,j=r.getProjection();if(k&&B){const[q,re,ae]=j.upVector(B.canonical,h.tileAnchorX,h.tileAnchorY),ue=j.upVectorScale(B.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;I+=q*k*ue,C+=re*k*ue,L+=ae*k*ue}const U=this.projectAndGetPerspectiveRatio(T,I,C,L,h.tileID,j.name==="globe"||!!k||this.transform.pitch>0,j),$=x*U.perspectiveRatio,N=(h.x1*s+p.x-h.padding)*$+U.point.x,H=(h.y1*s+p.y-h.padding)*$+U.point.y,ee=(h.x2*s+p.x+h.padding)*$+U.point.x,X=(h.y2*s+p.y+h.padding)*$+U.point.y,te=U.perspectiveRatio<=.55||U.occluded;return!this.isInsideGrid(N,H,ee,X)||!_&&this.grid.hitTest(N,H,ee,X,S)||te?{box:[],offscreen:!1,occluded:U.occluded}:{box:[N,H,ee,X],offscreen:this.isOffscreen(N,H,ee,X),occluded:!1}}placeCollisionCircles(r,s,h,p,_,x,T,S,I,C,L,k,B,j,U){const $=[],N=this.transform.elevation,H=r.getProjection(),ee=N?N.getAtTileOffsetFunc(U,this.transform.center.lat,this.transform.worldSize,H):null,X=new o.P(h.tileAnchorX,h.tileAnchorY);let{x:te,y:q,z:re}=H.projectTilePoint(X.x,X.y,U.canonical);if(ee){const[Ce,fe,we]=ee(X);te+=Ce,q+=fe,re+=we}const ae=H.name==="globe",ue=this.projectAndGetPerspectiveRatio(T,te,q,re,U,ae||!!N||this.transform.pitch>0,H),{perspectiveRatio:me}=ue,Me=(L?x/me:x*me)/o.bc,ye=fs(te,q,re,S),Oe=ue.signedDistanceFromCamera>0?Lh(Me,_,h.lineOffsetX*Me,h.lineOffsetY*Me,!1,ye,X,h,p,S,{},N&&!L?ee:null,L&&!!N,H,U,L):null;let Le=!1,We=!1,ve=!0;if(Oe&&!ue.occluded){const Ce=.5*B*me+j,fe=new o.P(-100,-100),we=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Ke=new Da,{first:st,last:nt}=Oe,_t=st.path.length;let Ot=[];for(let Ut=_t-1;Ut>=1;Ut--)Ot.push(st.path[Ut]);for(let Ut=1;Ut<nt.path.length;Ut++)Ot.push(nt.path[Ut]);const Zt=2.5*Ce;I&&(Ot=Ot.map(([Ut,gi,si],di)=>(ee&&!ae&&(si=ee(di<_t-1?st.tilePath[_t-1-di]:nt.tilePath[di-_t+2])[2]),fs(Ut,gi,si,I))),Ot.some(Ut=>Ut[3]<=0)&&(Ot=[]));let Bt=[];if(Ot.length>0){let Ut=1/0,gi=-1/0,si=1/0,di=-1/0;for(const ui of Ot)Ut=Math.min(Ut,ui[0]),si=Math.min(si,ui[1]),gi=Math.max(gi,ui[0]),di=Math.max(di,ui[1]);gi>=fe.x&&Ut<=we.x&&di>=fe.y&&si<=we.y&&(Bt=[Ot.map(ui=>new o.P(ui[0],ui[1]))],(Ut<fe.x||gi>we.x||si<fe.y||di>we.y)&&(Bt=o.ba(Bt,fe.x,fe.y,we.x,we.y)))}for(const Ut of Bt){Ke.reset(Ut,.25*Ce);let gi=0;gi=Ke.length<=.5*Ce?1:Math.ceil(Ke.paddedLength/Zt)+1;for(let si=0;si<gi;si++){const di=si/Math.max(gi-1,1),ui=Ke.lerp(di),ki=ui.x+ps,pr=ui.y+ps;$.push(ki,pr,Ce,0);const Ai=ki-Ce,kr=pr-Ce,Ii=ki+Ce,Gi=pr+Ce;if(ve=ve&&this.isOffscreen(Ai,kr,Ii,Gi),We=We||this.isInsideGrid(Ai,kr,Ii,Gi),!s&&this.grid.hitTestCircle(ki,pr,Ce,k)&&(Le=!0,!C))return{circles:[],offscreen:!1,collisionDetected:Le,occluded:!1}}}}return{circles:!C&&Le||!We?[]:$,offscreen:ve,collisionDetected:Le,occluded:ue.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let h=1/0,p=1/0,_=-1/0,x=-1/0;for(const C of r){const L=new o.P(C.x+ps,C.y+ps);h=Math.min(h,L.x),p=Math.min(p,L.y),_=Math.max(_,L.x),x=Math.max(x,L.y),s.push(L)}const T=this.grid.query(h,p,_,x).concat(this.ignoredGrid.query(h,p,_,x)),S={},I={};for(const C of T){const L=C.key;if(S[L.bucketInstanceId]===void 0&&(S[L.bucketInstanceId]={}),S[L.bucketInstanceId][L.featureIndex])continue;const k=[new o.P(C.x1,C.y1),new o.P(C.x2,C.y1),new o.P(C.x2,C.y2),new o.P(C.x1,C.y2)];o.bb(s,k)&&(S[L.bucketInstanceId][L.featureIndex]=!0,I[L.bucketInstanceId]===void 0&&(I[L.bucketInstanceId]=[]),I[L.bucketInstanceId].push(L.featureIndex))}return I}insertCollisionBox(r,s,h,p,_){(s?this.ignoredGrid:this.grid).insert({bucketInstanceId:h,featureIndex:p,collisionGroupID:_},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,s,h,p,_){const x=s?this.ignoredGrid:this.grid,T={bucketInstanceId:h,featureIndex:p,collisionGroupID:_};for(let S=0;S<r.length;S+=4)x.insertCircle(T,r[S],r[S+1],r[S+2])}projectAndGetPerspectiveRatio(r,s,h,p,_,x,T){const S=[s,h,p,1];let I=!1;p||this.transform.pitch>0?(o.a7.transformMat4(S,S,r),this.fogState&&_&&T.name!=="globe"&&(I=function(k,B,j,U,$,N){const H=N.calculateFogTileMatrix($),ee=[B,j,U];return o.N.transformMat4(ee,ee,H),Ji(k,o.N.length(ee),N.pitch,N._fov)}(this.fogState,s,h,p,_.toUnwrapped(),this.transform)>.9)):zh(S,S,r);const C=S[3];return{point:new o.P((S[0]/C+1)/2*this.transform.width+ps,(-S[1]/C+1)/2*this.transform.height+ps),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(T)/C*.5,1.5),signedDistanceFromCamera:C,occluded:x&&S[2]>C||I}}isOffscreen(r,s,h,p){return h<ps||r>=this.screenRightBoundary||p<ps||s>this.screenBottomBoundary}isInsideGrid(r,s,h,p){return h>=0&&r<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const r=o.a6.identity([]);return o.a6.translate(r,r,[-100,-100,0]),r}}function ru(u,r,s){const h=r.createTileMatrix(u,u.worldSize,s.toUnwrapped());return o.a6.multiply(new Float32Array(16),u.projMatrix,h)}function kh(u,r,s){if(r.projection.name===s.projection.name)return u.projMatrix;const h=s.clone();return h.setProjection(r.projection),ru(h,r.getProjection(),u)}function Ul(u,r,s){return r.name===s.projection.name?u.projMatrix:ru(s,r,u)}class Bh{constructor(r,s,h,p){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?s:-s))):p&&h?1:0,this.placed=h}isHidden(){return this.opacity===0&&!this.placed}}class Co{constructor(r,s,h,p,_,x=!1){this.text=new Bh(r?r.text:null,s,h,_),this.icon=new Bh(r?r.icon:null,s,p,_),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ms{constructor(r,s,h,p=!1){this.text=r,this.icon=s,this.skipFade=h,this.clipped=p}}class Fh{constructor(){this.invProjMatrix=o.a6.create(),this.viewportMatrix=o.a6.create(),this.circles=[]}}class ra{constructor(r,s,h,p,_){this.bucketInstanceId=r,this.featureIndex=s,this.sourceLayerIndex=h,this.bucketIndex=p,this.tileID=_}}class nu{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const s=++this.maxGroupID;this.collisionGroups[r]={ID:s,predicate:h=>h.collisionGroupID===s}}return this.collisionGroups[r]}}function na(u,r,s,h,p){const{horizontalAlign:_,verticalAlign:x}=o.bf(u),T=-(_-.5)*r,S=-(x-.5)*s,I=o.bd(u,h);return new o.P(T+I[0]*p,S+I[1]*p)}function Nh(u,r,s,h,p){const _=new o.P(u,r);return s&&_._rotate(h?p:-p),_}class U_{constructor(r,s,h,p,_,x){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new xt(this.transform,_),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=s,this.retainedQueryData={},this.collisionGroups=new nu(h),this.collisionCircleArrays={},this.prevPlacement=p,p&&(p.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,s,h,p){const _=h.getBucket(s),x=h.latestFeatureIndex;if(!_||!x||s.fqid!==_.layerIds[0])return;const T=_.layers[0].layout,S=h.collisionBoxArray,I=Math.pow(2,this.transform.zoom-h.tileID.overscaledZ),C=h.tileSize/o.V,L=h.tileID.toUnwrapped();this.transform.setProjection(_.projection);const k=(B=h.tileID,j=_.getProjection(),U=this.transform,j.name===this.projection?U.calculateProjMatrix(B.toUnwrapped()):ru(U,j,B));var B,j,U;const $=T.get("text-pitch-alignment")==="map",N=T.get("text-rotation-alignment")==="map";s.compileFilter();const H=s.dynamicFilter(),ee=s.dynamicFilterNeedsFeature(),X=this.transform.calculatePixelsToTileUnitsMatrix(h),te=Ih(k,h.tileID.canonical,$,N,this.transform,_.getProjection(),X);let q=null;if($){const ue=Ch(k,h.tileID.canonical,$,N,this.transform,_.getProjection(),X);q=o.a6.multiply([],this.transform.labelPlaneMatrix,ue)}let re=null;H&&h.latestFeatureIndex&&(re={unwrappedTileID:L,dynamicFilter:H,dynamicFilterNeedsFeature:ee,featureIndex:h.latestFeatureIndex}),this.retainedQueryData[_.bucketInstanceId]=new ra(_.bucketInstanceId,x,_.sourceLayerIndex,_.index,h.tileID);const ae={bucket:_,layout:T,posMatrix:k,textLabelPlaneMatrix:te,labelToScreenMatrix:q,clippingData:re,scale:I,textPixelRatio:C,holdingForFade:h.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:o.b5(_.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:o.b5(_.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(p)for(const ue of _.sortKeyRanges){const{sortKey:me,symbolInstanceStart:Me,symbolInstanceEnd:ye}=ue;r.push({sortKey:me,symbolInstanceStart:Me,symbolInstanceEnd:ye,parameters:ae})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ae})}attemptAnchorPlacement(r,s,h,p,_,x,T,S,I,C,L,k,B,j,U,$,N,H){const{textOffset0:ee,textOffset1:X,crossTileID:te}=k,q=[ee,X],re=na(r,h,p,q,_),ae=this.collisionIndex.placeCollisionBox(j,_,s,Nh(re.x,re.y,x,T,this.transform.angle),L,S,I,C.predicate);if($){const ue=j.getSymbolInstanceIconSize(H,this.transform.zoom,k.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(j,ue,$,Nh(re.x,re.y,x,T,this.transform.angle),L,S,I,C.predicate).box.length===0)return}if(ae.box.length>0){let ue;return this.prevPlacement&&this.prevPlacement.variableOffsets[te]&&this.prevPlacement.placements[te]&&this.prevPlacement.placements[te].text&&(ue=this.prevPlacement.variableOffsets[te].anchor),this.variableOffsets[te]={textOffset:q,width:h,height:p,anchor:r,textScale:_,prevAnchor:ue},this.markUsedJustification(j,r,k,U),j.allowVerticalPlacement&&(this.markUsedOrientation(j,U,k),this.placedOrientations[te]=U),{shift:re,placedGlyphBoxes:ae}}}placeLayerBucketPart(r,s,h,p){const{bucket:_,layout:x,posMatrix:T,textLabelPlaneMatrix:S,labelToScreenMatrix:I,clippingData:C,textPixelRatio:L,holdingForFade:k,collisionBoxArray:B,partiallyEvaluatedTextSize:j,partiallyEvaluatedIconSize:U,collisionGroup:$}=r.parameters,N=x.get("text-optional"),H=x.get("icon-optional"),ee=x.get("text-allow-overlap"),X=x.get("icon-allow-overlap"),te=x.get("text-rotation-alignment")==="map",q=x.get("text-pitch-alignment")==="map",re=x.get("symbol-z-order")==="viewport-y",ae=x.get("symbol-z-elevate");this.transform.setProjection(_.projection);let ue=ee&&(X||!_.hasIconData()||H),me=X&&(ee||!_.hasTextData()||N);!_.collisionArrays&&B&&_.deserializeCollisionBoxes(B),h&&p&&_.updateCollisionDebugBuffers(this.transform.zoom,B);const Me=(ye,Oe,Le)=>{const{crossTileID:We,numVerticalGlyphVertices:ve}=ye;if(C){const Ii={zoom:this.transform.zoom,pitch:this.transform.pitch};let Gi=null;if(C.dynamicFilterNeedsFeature){const Ci=this.retainedQueryData[_.bucketInstanceId];Gi=C.featureIndex.loadFeature({featureIndex:ye.featureIndex,bucketIndex:Ci.bucketIndex,sourceLayerIndex:Ci.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,C.dynamicFilter)(Ii,Gi,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new o.P(ye.tileAnchorX,ye.tileAnchorY),this.transform.calculateDistanceTileData(C.unwrappedTileID)))return this.placements[We]=new Ms(!1,!1,!1,!0),void s.add(We)}if(s.has(We))return;if(k)return void(this.placements[We]=new Ms(!1,!1,!1));let Ce=!1,fe=!1,we=!0,Ke=!1,st=!1,nt=null,_t={box:null,offscreen:null,occluded:null},Ot={box:null,offscreen:null,occluded:null},Zt=null,Bt=null,Ut=null,gi=0,si=0,di=0;Le.textFeatureIndex?gi=Le.textFeatureIndex:ye.useRuntimeCollisionCircles&&(gi=ye.featureIndex),Le.verticalTextFeatureIndex&&(si=Le.verticalTextFeatureIndex);const ui=Ii=>{Ii.tileID=this.retainedQueryData[_.bucketInstanceId].tileID;const Gi=this.transform.elevation;Ii.elevation=ye.zOffset+(Gi?Gi.getAtTileOffset(Ii.tileID,Ii.tileAnchorX,Ii.tileAnchorY):0)},ki=Le.textBox;if(ki){ui(ki);const Ii=Ci=>{let ji=o.b6.horizontal;if(_.allowVerticalPlacement&&!Ci&&this.prevPlacement){const vr=this.prevPlacement.placedOrientations[We];vr&&(this.placedOrientations[We]=vr,ji=vr,this.markUsedOrientation(_,ji,ye))}return ji},Gi=(Ci,ji)=>{if(_.allowVerticalPlacement&&ve>0&&Le.verticalTextBox){for(const vr of _.writingModes)if(vr===o.b6.vertical?(_t=ji(),Ot=_t):_t=Ci(),_t&&_t.box&&_t.box.length)break}else _t=Ci()};if(x.get("text-variable-anchor")){let Ci=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[We]){const Yi=this.prevPlacement.variableOffsets[We];Ci.indexOf(Yi.anchor)>0&&(Ci=Ci.filter(fn=>fn!==Yi.anchor),Ci.unshift(Yi.anchor))}const ji=(Yi,fn,An)=>{const Yn=_.getSymbolInstanceTextSize(j,ye,this.transform.zoom,Oe),$s=(Yi.x2-Yi.x1)*Yn+2*Yi.padding,Jn=(Yi.y2-Yi.y1)*Yn+2*Yi.padding,pn=ye.hasIconTextFit&&!X?fn:null;pn&&ui(pn);let an={box:[],offscreen:!1,occluded:!1};const kn=ee?2*Ci.length:Ci.length;for(let Gn=0;Gn<kn;++Gn){const Qn=this.attemptAnchorPlacement(Ci[Gn%Ci.length],Yi,$s,Jn,Yn,te,q,L,T,$,Gn>=Ci.length,ye,Oe,_,An,pn,j,U);if(Qn&&(an=Qn.placedGlyphBoxes,an&&an.box&&an.box.length)){Ce=!0,nt=Qn.shift;break}}return an};Gi(()=>ji(ki,Le.iconBox,o.b6.horizontal),()=>{const Yi=Le.verticalTextBox;return Yi&&ui(Yi),_.allowVerticalPlacement&&!(_t&&_t.box&&_t.box.length)&&ve>0&&Yi?ji(Yi,Le.verticalIconBox,o.b6.vertical):{box:null,offscreen:null,occluded:null}}),_t&&(Ce=_t.box,we=_t.offscreen,Ke=_t.occluded);const vr=Ii(!(!_t||!_t.box));if(!Ce&&this.prevPlacement){const Yi=this.prevPlacement.variableOffsets[We];Yi&&(this.variableOffsets[We]=Yi,this.markUsedJustification(_,Yi.anchor,ye,vr))}}else{const Ci=(ji,vr)=>{const Yi=_.getSymbolInstanceTextSize(j,ye,this.transform.zoom,Oe),fn=this.collisionIndex.placeCollisionBox(_,Yi,ji,new o.P(0,0),ee,L,T,$.predicate);return fn&&fn.box&&fn.box.length&&(this.markUsedOrientation(_,vr,ye),this.placedOrientations[We]=vr),fn};Gi(()=>Ci(ki,o.b6.horizontal),()=>{const ji=Le.verticalTextBox;return _.allowVerticalPlacement&&ve>0&&ji?(ui(ji),Ci(ji,o.b6.vertical)):{box:null,offscreen:null,occluded:null}}),Ii(!!(_t&&_t.box&&_t.box.length))}}if(Zt=_t,Ce=Zt&&Zt.box&&Zt.box.length>0,we=Zt&&Zt.offscreen,Ke=Zt&&Zt.occluded,ye.useRuntimeCollisionCircles){const Ii=_.text.placedSymbolArray.get(ye.centerJustifiedTextSymbolIndex>=0?ye.centerJustifiedTextSymbolIndex:ye.verticalPlacedTextSymbolIndex),Gi=o.b7(_.textSizeData,j,Ii),Ci=x.get("text-padding");Bt=this.collisionIndex.placeCollisionCircles(_,ee,Ii,_.lineVertexArray,_.glyphOffsetArray,Gi,T,S,I,h,q,$.predicate,ye.collisionCircleDiameter*Gi/o.bc,Ci,this.retainedQueryData[_.bucketInstanceId].tileID),Ce=ee||Bt.circles.length>0&&!Bt.collisionDetected,we=we&&Bt.offscreen,Ke=Bt.occluded}if(Le.iconFeatureIndex&&(di=Le.iconFeatureIndex),Le.iconBox){const Ii=Gi=>{ui(Gi);const Ci=ye.hasIconTextFit&&nt?Nh(nt.x,nt.y,te,q,this.transform.angle):new o.P(0,0),ji=_.getSymbolInstanceIconSize(U,this.transform.zoom,ye.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(_,ji,Gi,Ci,X,L,T,$.predicate)};Ot&&Ot.box&&Ot.box.length&&Le.verticalIconBox?(Ut=Ii(Le.verticalIconBox),fe=Ut.box.length>0):(Ut=Ii(Le.iconBox),fe=Ut.box.length>0),we=we&&Ut.offscreen,st=Ut.occluded}const pr=N||ye.numHorizontalGlyphVertices===0&&ve===0,Ai=H||ye.numIconVertices===0;if(pr||Ai?Ai?pr||(fe=fe&&Ce):Ce=fe&&Ce:fe=Ce=fe&&Ce,Ce&&Zt&&Zt.box&&this.collisionIndex.insertCollisionBox(Zt.box,x.get("text-ignore-placement"),_.bucketInstanceId,Ot&&Ot.box&&si?si:gi,$.ID),fe&&Ut&&this.collisionIndex.insertCollisionBox(Ut.box,x.get("icon-ignore-placement"),_.bucketInstanceId,di,$.ID),Bt&&(Ce&&this.collisionIndex.insertCollisionCircles(Bt.circles,x.get("text-ignore-placement"),_.bucketInstanceId,gi,$.ID),h)){const Ii=_.bucketInstanceId;let Gi=this.collisionCircleArrays[Ii];Gi===void 0&&(Gi=this.collisionCircleArrays[Ii]=new Fh);for(let Ci=0;Ci<Bt.circles.length;Ci+=4)Gi.circles.push(Bt.circles[Ci+0]),Gi.circles.push(Bt.circles[Ci+1]),Gi.circles.push(Bt.circles[Ci+2]),Gi.circles.push(Bt.collisionDetected?1:0)}const kr=_.projection.name!=="globe";ue=ue&&(kr||!Ke),me=me&&(kr||!st),this.placements[We]=new Ms(Ce||ue,fe||me,we||_.justReloaded),s.add(We)};if(ae&&this.buildingIndex&&(this.buildingIndex.updateZOffset(_,this.retainedQueryData[_.bucketInstanceId].tileID),_.updateZOffset()),re){const ye=_.getSortedSymbolIndexes(this.transform.angle);for(let Oe=ye.length-1;Oe>=0;--Oe){const Le=ye[Oe];Me(_.symbolInstances.get(Le),Le,_.collisionArrays[Le])}_.hasAnyZOffset&&o.w(`${_.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(_.hasAnyZOffset){const ye=_.getSortedIndexesByZOffset();for(let Oe=0;Oe<ye.length;++Oe){const Le=ye[Oe];Me(_.symbolInstances.get(Le),Le,_.collisionArrays[Le])}}else for(let ye=r.symbolInstanceStart;ye<r.symbolInstanceEnd;ye++)Me(_.symbolInstances.get(ye),ye,_.collisionArrays[ye]);if(h&&_.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[_.bucketInstanceId];o.a6.invert(ye.invProjMatrix,T),ye.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(r,s,h,p){const{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:S,crossTileID:I}=h,C=o.be(s),L=p===o.b6.vertical?S:C==="left"?_:C==="center"?x:C==="right"?T:-1;_>=0&&(r.text.placedSymbolArray.get(_).crossTileID=L>=0&&_!==L?0:I),x>=0&&(r.text.placedSymbolArray.get(x).crossTileID=L>=0&&x!==L?0:I),T>=0&&(r.text.placedSymbolArray.get(T).crossTileID=L>=0&&T!==L?0:I),S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=L>=0&&S!==L?0:I)}markUsedOrientation(r,s,h){const p=s===o.b6.horizontal||s===o.b6.horizontalOnly?s:0,_=s===o.b6.vertical?s:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:I}=h,C=r.text.placedSymbolArray;x>=0&&(C.get(x).placedOrientation=p),T>=0&&(C.get(T).placedOrientation=p),S>=0&&(C.get(S).placedOrientation=p),I>=0&&(C.get(I).placedOrientation=_)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let h=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const p=s?s.symbolFadeChange(r):1,_=s?s.opacities:{},x=s?s.variableOffsets:{},T=s?s.placedOrientations:{};for(const S in this.placements){const I=this.placements[S],C=_[S];C?(this.opacities[S]=new Co(C,p,I.text,I.icon,null,I.clipped),h=h||I.text!==C.text.placed||I.icon!==C.icon.placed):(this.opacities[S]=new Co(null,p,I.text,I.icon,I.skipFade,I.clipped),h=h||I.text||I.icon)}for(const S in _){const I=_[S];if(!this.opacities[S]){const C=new Co(I,p,!1,!1);C.isHidden()||(this.opacities[S]=C,h=h||I.text.placed||I.icon.placed)}}for(const S in x)this.variableOffsets[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.variableOffsets[S]=x[S]);for(const S in T)this.placedOrientations[S]||!this.opacities[S]||this.opacities[S].isHidden()||(this.placedOrientations[S]=T[S]);h?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:r)}updateLayerOpacities(r,s){const h=new Set;for(const p of s){const _=p.getBucket(r);_&&p.latestFeatureIndex&&r.fqid===_.layerIds[0]&&(this.updateBucketOpacities(_,h,p.collisionBoxArray),_.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(_,p.tileID),_.updateZOffset()))}}updateBucketOpacities(r,s,h){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const p=r.layers[0].layout,_=!!r.layers[0].dynamicFilter(),x=new Co(null,0,!1,!1,!0),T=p.get("text-allow-overlap"),S=p.get("icon-allow-overlap"),I=p.get("text-variable-anchor"),C=p.get("text-rotation-alignment")==="map",L=p.get("text-pitch-alignment")==="map",k=new Co(null,0,T&&(S||!r.hasIconData()||p.get("icon-optional")),S&&(T||!r.hasTextData()||p.get("text-optional")),!0);!r.collisionArrays&&h&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(h);const B=(U,$,N)=>{for(let H=0;H<$/4;H++)U.opacityVertexArray.emplaceBack(N)};let j=0;for(let U=0;U<r.symbolInstances.length;U++){const $=r.symbolInstances.get(U),{numHorizontalGlyphVertices:N,numVerticalGlyphVertices:H,crossTileID:ee,numIconVertices:X}=$,te=s.has(ee);let q=this.opacities[ee];te?q=x:q||(q=k,this.opacities[ee]=q),s.add(ee);const re=N>0||H>0,ae=X>0,ue=this.placedOrientations[ee],me=ue===o.b6.vertical,Me=ue===o.b6.horizontal||ue===o.b6.horizontalOnly;if(!re&&!ae||q.isHidden()||j++,re){const ye=ip(q.text);B(r.text,N,me?jl:ye),B(r.text,H,Me?jl:ye);const Oe=q.text.isHidden(),{leftJustifiedTextSymbolIndex:Le,centerJustifiedTextSymbolIndex:We,rightJustifiedTextSymbolIndex:ve,verticalPlacedTextSymbolIndex:Ce}=$,fe=r.text.placedSymbolArray,we=Oe||me?1:0;Le>=0&&(fe.get(Le).hidden=we),We>=0&&(fe.get(We).hidden=we),ve>=0&&(fe.get(ve).hidden=we),Ce>=0&&(fe.get(Ce).hidden=Oe||Me?1:0);const Ke=this.variableOffsets[ee];Ke&&this.markUsedJustification(r,Ke.anchor,$,ue);const st=this.placedOrientations[ee];st&&(this.markUsedJustification(r,"left",$,st),this.markUsedOrientation(r,st,$))}if(ae){const ye=ip(q.icon),{placedIconSymbolIndex:Oe,verticalPlacedIconSymbolIndex:Le}=$,We=r.icon.placedSymbolArray,ve=q.icon.isHidden()?1:0;Oe>=0&&(B(r.icon,X,me?jl:ye),We.get(Oe).hidden=ve),Le>=0&&(B(r.icon,$.numVerticalIconVertices,Me?jl:ye),We.get(Le).hidden=ve)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const ye=r.collisionArrays[U];if(ye){let Oe=new o.P(0,0),Le=!0;if(ye.textBox||ye.verticalTextBox){if(I){const ve=this.variableOffsets[ee];ve?(Oe=na(ve.anchor,ve.width,ve.height,ve.textOffset,ve.textScale),C&&Oe._rotate(L?this.transform.angle:-this.transform.angle)):Le=!1}_&&(Le=!q.clipped),ye.textBox&&za(r.textCollisionBox.collisionVertexArray,q.text.placed,!Le||me,Oe.x,Oe.y),ye.verticalTextBox&&za(r.textCollisionBox.collisionVertexArray,q.text.placed,!Le||Me,Oe.x,Oe.y)}const We=Le&&!!(!Me&&ye.verticalIconBox);ye.iconBox&&za(r.iconCollisionBox.collisionVertexArray,q.icon.placed,We,$.hasIconTextFit?Oe.x:0,$.hasIconTextFit?Oe.y:0),ye.verticalIconBox&&za(r.iconCollisionBox.collisionVertexArray,q.icon.placed,!We,$.hasIconTextFit?Oe.x:0,$.hasIconTextFit?Oe.y:0)}}}if(r.fullyClipped=j===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const U=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=U.invProjMatrix,r.placementViewportMatrix=U.viewportMatrix,r.collisionCircleArray=U.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,s){const h=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*h>r}setStale(){this.stale=!0}}function za(u,r,s,h,p){u.emplaceBack(r?1:0,s?1:0,h||0,p||0),u.emplaceBack(r?1:0,s?1:0,h||0,p||0),u.emplaceBack(r?1:0,s?1:0,h||0,p||0),u.emplaceBack(r?1:0,s?1:0,h||0,p||0)}const j_=Math.pow(2,25),ep=Math.pow(2,24),tp=Math.pow(2,17),Vh=Math.pow(2,16),G_=Math.pow(2,9),$_=Math.pow(2,8),q_=Math.pow(2,1);function ip(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const r=u.placed?1:0,s=Math.floor(127*u.opacity);return s*j_+r*ep+s*tp+r*Vh+s*G_+r*$_+s*q_+r}const jl=0;class Z_{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,s,h,p,_){const x=this._bucketParts;for(;this._currentTileIndex<r.length;)if(s.getBucketParts(x,p,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((T,S)=>T.sortKey-S.sortKey));this._currentPartIndex<x.length;){const T=x[this._currentPartIndex];if(s.placeLayerBucketPart(T,this._seenCrossTileIDs,h,T.symbolInstanceStart===0),this._currentPartIndex++,_())return!0}return!1}}class su{constructor(r,s,h,p,_,x,T,S,I){this.placement=new U_(r,_,x,T,S,I),this._currentPlacementIndex=s.length-1,this._forceFullPlacement=h,this._showCollisionBoxes=p,this._done=!1}isDone(){return this._done}continuePlacement(r,s,h,p){const _=o.f.now(),x=()=>{const T=o.f.now()-_;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=s[r[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=S)&&(!T.maxzoom||T.maxzoom>S)){const I=T,C=I.layout.get("symbol-z-elevate"),L=this._inProgressLayer=this._inProgressLayer||new Z_(I),k=o.ag(T.source,T.scope);if(L.continuePlacement(C?p[k]:h[k],this.placement,this._showCollisionBoxes,T,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Uh=512/o.V/2;class rp{constructor(r,s,h){this.tileID=r,this.bucketInstanceId=h,this.index=new o.bg(s.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const p=r.canonical.x*o.V,_=r.canonical.y*o.V;for(let x=0;x<s.length;x++){const{key:T,crossTileID:S,tileAnchorX:I,tileAnchorY:C}=s.get(x),L=Math.floor((p+I)*Uh),k=Math.floor((_+C)*Uh);this.index.add(L,k),this.keys.push(T),this.crossTileIDs.push(S)}this.index.finish()}findMatches(r,s,h){const p=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z),_=Uh/Math.pow(2,s.canonical.z-this.tileID.canonical.z),x=s.canonical.x*o.V,T=s.canonical.y*o.V;for(let S=0;S<r.length;S++){const I=r.get(S);if(I.crossTileID)continue;const{key:C,tileAnchorX:L,tileAnchorY:k}=I,B=Math.floor((x+L)*_),j=Math.floor((T+k)*_),U=this.index.range(B-p,j-p,B+p,j+p);for(const $ of U){const N=this.crossTileIDs[$];if(this.keys[$]===C&&!h.has(N)){h.add(N),I.crossTileID=N;break}}}}}class jh{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ou{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const s=Math.round((r-this.lng)/360);if(s!==0)for(const h in this.indexes){const p=this.indexes[h],_={};for(const x in p){const T=p[x];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+s),_[T.tileID.key]=T}this.indexes[h]=_}this.lng=r}addBucket(r,s,h){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let _=0;_<s.symbolInstances.length;_++)s.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const p=this.usedCrossTileIDs[r.overscaledZ];for(const _ in this.indexes){const x=this.indexes[_];if(Number(_)>r.overscaledZ)for(const T in x){const S=x[T];S.tileID.isChildOf(r)&&S.findMatches(s.symbolInstances,r,p)}else{const T=x[r.scaledTo(Number(_)).key];T&&T.findMatches(s.symbolInstances,r,p)}}for(let _=0;_<s.symbolInstances.length;_++){const x=s.symbolInstances.get(_);x.crossTileID||(x.crossTileID=h.generate(),p.add(x.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new rp(r,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(r,s){for(const h of s.crossTileIDs)this.usedCrossTileIDs[r].delete(h)}removeStaleBuckets(r){let s=!1;for(const h in this.indexes){const p=this.indexes[h];for(const _ in p)r[p[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(h,p[_]),delete p[_],s=!0)}return s}}class Gh{constructor(){this.layerIndexes={},this.crossTileIDs=new jh,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,s,h,p){let _=this.layerIndexes[r.fqid];_===void 0&&(_=this.layerIndexes[r.fqid]=new ou);let x=!1;const T={};p.name!=="globe"&&_.handleWrapJump(h);for(const S of s){const I=S.getBucket(r);I&&r.fqid===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),_.addBucket(S.tileID,I,this.crossTileIDs)&&(x=!0),T[I.bucketInstanceId]=!0)}return _.removeStaleBuckets(T)&&(x=!0),x}pruneUnusedLayers(r){const s={};r.forEach(h=>{s[h]=!0});for(const h in this.layerIndexes)s[h]||delete this.layerIndexes[h]}}class sa{constructor(r=0,s=0,h=0,p=0){if(isNaN(r)||r<0||isNaN(s)||s<0||isNaN(h)||h<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=s,this.left=h,this.right=p}interpolate(r,s,h){return s.top!=null&&r.top!=null&&(this.top=o.U(r.top,s.top,h)),s.bottom!=null&&r.bottom!=null&&(this.bottom=o.U(r.bottom,s.bottom,h)),s.left!=null&&r.left!=null&&(this.left=o.U(r.left,s.left,h)),s.right!=null&&r.right!=null&&(this.right=o.U(r.right,s.right,h)),this}getCenter(r,s){const h=o.aa((this.left+r-this.right)/2,0,r),p=o.aa((this.top+s-this.bottom)/2,0,s);return new o.P(h,p)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new sa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function au(u,r){const s=o.bk(u,3);o.a6.fromQuat(u,r),o.bm(u,3,s)}function Gl(u,r){const s=o.bi.identity([]);return o.bi.rotateZ(s,s,-r),o.bi.rotateX(s,s,-u),s}function $h(u,r){const s=[u[0],u[1],0],h=[r[0],r[1],0];if(o.N.length(s)>=1e-15){const x=o.N.normalize([],s);o.N.scale(h,x,o.N.dot(h,x)),r[0]=h[0],r[1]=h[1]}const p=o.N.cross([],r,u);if(o.N.len(p)<1e-15)return null;const _=Math.atan2(-p[1],p[0]);return Gl(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),_)}class $l{constructor(r,s){this.position=r,this.orientation=s}get position(){return this._position}set position(r){if(r){const s=r instanceof o.L?r:new o.L(r[0],r[1],r[2]);this._renderWorldCopies&&(s.x=o.bh(s.x,0,1)),this._position=s}else this._position=null}lookAtPoint(r,s){if(this.orientation=null,!this.position)return;const h=this.position,p=this._elevation?this._elevation.getAtPointOrZero(o.L.fromLngLat(r)):0,_=o.L.fromLngLat(r,p),x=[_.x-h.x,_.y-h.y,_.z-h.z];s||(s=[0,0,1]),s[2]=Math.abs(s[2]),this.orientation=$h(x,s)}setPitchBearing(r,s){this.orientation=Gl(o.bj(r),o.bj(-s))}}class ka{constructor(r,s){this._transform=o.a6.identity([]),this.orientation=s,this.position=r}get mercatorPosition(){const r=this.position;return new o.L(r[0],r[1],r[2])}get position(){const r=o.bk(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var s;r&&o.bm(this._transform,3,[(s=r)[0],s[1],s[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.bi.identity([]),r&&au(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),s=this.right();return{bearing:Math.atan2(-s[1],s[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,s){this._orientation=Gl(r,s),au(this._transform,this._orientation)}forward(){const r=o.bk(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.bk(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.bk(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,s){const h=new Float64Array(16);return o.a6.invert(h,this.getWorldToCamera(r,s)),h}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,s,h){const p=this.position;o.N.scale(p,p,-r);const _=new Float64Array(16);return o.a6.fromScaling(_,[h,h,h]),o.a6.translate(_,_,p),_[10]*=s,_}getWorldToCamera(r,s){const h=new Float64Array(16),p=new Float64Array(4),_=this.position;return o.bi.conjugate(p,this._orientation),o.N.scale(_,_,-r),o.a6.fromQuat(h,p),o.a6.translate(h,h,_),h[1]*=-1,h[5]*=-1,h[9]*=-1,h[13]*=-1,h[8]*=s,h[9]*=s,h[10]*=s,h[11]*=s,h}getCameraToClipPerspective(r,s,h,p){const _=new Float64Array(16);return o.a6.perspective(_,r,s,h,p),_}getCameraToClipOrthographic(r,s,h,p,_,x){const T=new Float64Array(16);return o.a6.ortho(T,r,s,h,p,_,x),T}getDistanceToElevation(r,s=!1){const h=r===0?0:o.bl(r,s?o.au(this.position[1]):this.position[1]),p=this.forward();return(h-this.position[2])/p[2]}clone(){return new ka([...this.position],[...this.orientation])}}const Ba=(u,r,s)=>(1-s)*u+s*r,ql=u=>u*u*u*u*u;class Zl{constructor(r,s,h,p,_,x,T){this.tileSize=512,this._renderWorldCopies=_===void 0||_,this._minZoom=r||0,this._maxZoom=s||22,this._minPitch=h??0,this._maxPitch=p??60,this.setProjection(x),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new o.bn(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new sa,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new ka,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const r=new Zl(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,s=!1){const h=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||h)&&this._updateCameraOnTerrain(),(r||h)&&this._constrainCamera(s),this._calcMatrices()}getProjection(){return o.ac(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const s=this.projection?this.getProjection():void 0;this.projection=o.bo(this.projectionOptions);const h=!Y(s,this.getProjection());return h&&this._calcMatrices(),this.mercatorFromTransition=!1,h}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.bo({name:"mercator"});const s=r!==this.projection.name;return s&&this._calcMatrices(),s}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.bl(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bh(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const s=-r*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=o.b4.create(),o.b4.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const s=o.aa(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=o.bj(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const s=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._setZoom(s),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,s=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!s||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const h=this._elevation;s||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&h.exaggeration()&&this._centerAltitudeValidForExaggeration!==h.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*h.exaggeration(),this._centerAltitudeValidForExaggeration=h.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=h.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,s=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],h=this.horizonLineFromTop();let p=0,_=0;for(let x=0;x<s.length;x++){const T=new o.P(s[x][0]*this.width,h+s[x][1]*(this.height-h)),S=r.pointCoordinate(T);if(!S)continue;const I=1/Math.hypot(S[0]-this._camera.position[0],S[1]-this._camera.position[1]);p+=S[3]*I,_+=I}return _===0?NaN:p/_}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,s=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),h=this.pixelsPerMeter/this.worldSize*s,p=this._mercatorZfromZoom(r),_=this._mercatorZfromZoom(this._maxZoom),x=Math.max(p-h,_);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const s=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let h;h=r.z<this._camera.position[2]?[s.x,s.y,s.z]:[r.x,r.y,r.z];const p=o.N.length(o.N.sub([],this._camera.position,h));return o.aa(this._zoomFromMercatorZ(p),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let s=!1;if(r.orientation&&!o.bi.exactEquals(r.orientation,this._camera.orientation)&&(s=this._setCameraOrientation(r.orientation)),r.position){const h=[r.position.x,r.position.y,r.position.z];o.N.exactEquals(h,this._camera.position)||(this._setCameraPosition(h),s=!0)}s&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,s=new $l;return s.position=new o.L(r[0],r[1],r[2]),s.orientation=this._camera.orientation,s._elevation=this.elevation,s._renderWorldCopies=this.renderWorldCopies,s}_setCameraOrientation(r){if(!o.bi.length(r))return!1;o.bi.normalize(r,r);const s=o.N.transformQuat([],[0,0,-1],r),h=o.N.transformQuat([],[0,-1,0],r);if(h[2]<0)return!1;const p=$h(s,h);return!!p&&(this._camera.orientation=p,!0)}_setCameraPosition(r){const s=this.zoomScale(this.minZoom)*this.tileSize,h=this.zoomScale(this.maxZoom)*this.tileSize,p=this.cameraToCenterDistance;r[2]=o.aa(r[2],p/h,p/s),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,s,h){this._unmodified=!1,this._edgeInsets.interpolate(r,s,h),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const s=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(r){const s=[new o.bp(0,r)];if(this.renderWorldCopies){const h=this.pointCoordinate(new o.P(0,0)),p=this.pointCoordinate(new o.P(this.width,0)),_=this.pointCoordinate(new o.P(this.width,this.height)),x=this.pointCoordinate(new o.P(0,this.height)),T=Math.floor(Math.min(h.x,p.x,_.x,x.x)),S=Math.floor(Math.max(h.x,p.x,_.x,x.x)),I=1;for(let C=T-I;C<=S+I;C++)C!==0&&s.push(new o.bp(C,r))}return s}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(r,s,h){let p=[];if(s[0]===0&&s[1]===0)return p;for(const x of r){const T=x.canonical,S=x.overscaledZ,I=x.wrap,C=1<<T.z,L=T.x+1<C,k=T.x>0,B=T.y+1<C,j=T.y>0,U=x.wrap-(k?0:1),$=x.wrap+(L?0:1),N=k?T.x-1:C-1,H=L?T.x+1:0;s[0]<0?(p.push(new o.am(S,$,T.z,H,T.y)),s[1]<0&&B&&(p.push(new o.am(S,I,T.z,T.x,T.y+1)),p.push(new o.am(S,$,T.z,H,T.y+1))),s[1]>0&&j&&(p.push(new o.am(S,I,T.z,T.x,T.y-1)),p.push(new o.am(S,$,T.z,H,T.y-1)))):s[0]>0?(p.push(new o.am(S,U,T.z,N,T.y)),s[1]<0&&B&&(p.push(new o.am(S,I,T.z,T.x,T.y+1)),p.push(new o.am(S,U,T.z,N,T.y+1))),s[1]>0&&j&&(p.push(new o.am(S,I,T.z,T.x,T.y-1)),p.push(new o.am(S,U,T.z,N,T.y-1)))):s[1]<0&&B?p.push(new o.am(S,I,T.z,T.x,T.y+1)):j&&p.push(new o.am(S,I,T.z,T.x,T.y-1))}if(p.length>1){p.sort((S,I)=>S.overscaledZ-I.overscaledZ||S.wrap-I.wrap||S.canonical.z-I.canonical.z||S.canonical.x-I.canonical.x||S.canonical.y-I.canonical.y);let x=0,T=0;for(;T<p.length;)p[T].equals(p[x])?++T:p[++x]=p[T++];p.length=x+1}const _=[];for(const x of p)p.some(T=>x.isChildOf(T))||_.push(x);return p=_.filter(x=>!r.some(T=>!!(x.overscaledZ<h&&T.isChildOf(x))||x.equals(T)||x.isChildOf(T))),p}coveringTiles(r){let s=this.coveringZoomLevel(r);const h=s,p=this.elevation&&this.elevation.exaggeration(),_=p&&!r.isTerrainDEM,x=this.projection.name==="mercator";if(r.minzoom!==void 0&&s<r.minzoom)return[];r.maxzoom!==void 0&&s>r.maxzoom&&(s=r.maxzoom);const T=this.locationCoordinate(this.center),S=this.center.lat,I=1<<s,C=[I*T.x,I*T.y,0],L=this.projection.name==="globe",k=!L,B=o.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,s,k),j=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),U=I*o.bl(1,this.center.lat),$=this._camera.position[2]/o.bl(1,this.center.lat),N=[I*j.x,I*j.y,$*(k?1:U)],H=L||p,ee=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),X=this.isLODDisabled(!0)?s:0;let te;if(this._elevation&&r.isTerrainDEM)te=1e4*this._elevation.exaggeration();else if(this._elevation){const fe=this._elevation.getMinMaxForVisibleTiles();te=fe?fe.max:this._centerAltitude}else te=this._centerAltitude;const q=r.isTerrainDEM?-te:this._elevation?this._elevation.getMinElevationBelowMSL():0,re=this.projection.isReprojectedInTileSpace?o.br(this):1,ae=fe=>{const Ke=new o.L(fe.x+25e-6,fe.y,fe.z),st=new o.L(fe.x,fe.y+25e-6,fe.z),nt=fe.toLngLat(),_t=Ke.toLngLat(),Ot=st.toLngLat(),Zt=this.locationCoordinate(nt),Bt=this.locationCoordinate(_t),Ut=this.locationCoordinate(Ot),gi=Math.hypot(Bt.x-Zt.x,Bt.y-Zt.y),si=Math.hypot(Ut.x-Zt.x,Ut.y-Zt.y);return Math.sqrt(gi*si)*re/25e-6},ue=fe=>{const we=te,Ke=q;return{aabb:o.bu(this,I,0,0,0,fe,Ke,we,this.projection),zoom:0,x:0,y:0,minZ:Ke,maxZ:we,wrap:fe,fullyVisible:!1}},me=[];let Me=[];const ye=s,Oe=r.reparseOverscaled?h:s,Le=fe=>fe*fe,We=Le(($-this._centerAltitude)*U),ve=fe=>{if(!this._elevation||!fe.tileID||!x)return;const we=this._elevation.getMinMaxForTile(fe.tileID),Ke=fe.aabb;we?(Ke.min[2]=we.min,Ke.max[2]=we.max,Ke.center[2]=(Ke.min[2]+Ke.max[2])/2):(fe.shouldSplit=Ce(fe),fe.shouldSplit||(Ke.min[2]=Ke.max[2]=Ke.center[2]=this._centerAltitude))},Ce=fe=>{if(fe.zoom<X)return!0;if(fe.zoom===ye)return!1;if(fe.shouldSplit!=null)return fe.shouldSplit;const we=fe.aabb.distanceX(N),Ke=fe.aabb.distanceY(N);let st=We,nt=1;if(L){st=Le(fe.aabb.distanceZ(N));const Zt=Math.pow(2,fe.zoom),Bt=o.au((fe.y+1)/Zt),Ut=o.au(fe.y/Zt),gi=Math.min(Math.max(S,Bt),Ut),si=o.bJ(gi)/o.bJ(S);if(nt=gi===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,si/this._mercatorScaleRatio),this.zoom<=o.bG&&fe.zoom===ye-1&&si>=.9)return!0}else if(_&&(st=Le(fe.aabb.distanceZ(N)*U)),this.projection.isReprojectedInTileSpace&&h<=5){const Zt=Math.pow(2,fe.zoom),Bt=ae(new o.L((fe.x+.5)/Zt,(fe.y+.5)/Zt));nt=Bt>.85?1:Bt}const _t=we*we+Ke*Ke+st,Ot=Le((1<<ye-fe.zoom)*ee*nt*((Zt,Bt)=>{if(Bt*Le(.707)<Zt)return 1;const Ut=Math.sqrt(Bt/Zt);return Ut/(1.4144271570014144+(Math.pow(1.1,Ut-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(st,We),_t));return _t<Ot};if(this.renderWorldCopies)for(let fe=1;fe<=3;fe++)me.push(ue(-fe)),me.push(ue(fe));for(me.push(ue(0));me.length>0;){const fe=me.pop(),we=fe.x,Ke=fe.y;let st=fe.fullyVisible;const nt=()=>this.projection.name==="globe"&&(fe.y===0||fe.y===(1<<fe.zoom)-1);if(!st){let _t=H?fe.aabb.intersects(B):fe.aabb.intersectsFlat(B);if(_t===0&&nt()){const Ot=new o.bs(fe.zoom,we,Ke);_t=o.bt(this,I,Ot,!0).intersects(B)}if(_t===0)continue;st=_t===2}if(fe.zoom!==ye&&Ce(fe))for(let _t=0;_t<4;_t++){const Ot=(we<<1)+_t%2,Zt=(Ke<<1)+(_t>>1),Bt={aabb:x?fe.aabb.quadrant(_t):o.bu(this,I,fe.zoom+1,Ot,Zt,fe.wrap,fe.minZ,fe.maxZ,this.projection),zoom:fe.zoom+1,x:Ot,y:Zt,wrap:fe.wrap,fullyVisible:st,tileID:void 0,shouldSplit:void 0,minZ:fe.minZ,maxZ:fe.maxZ};_&&!L&&(Bt.tileID=new o.am(fe.zoom+1===ye?Oe:fe.zoom+1,fe.wrap,fe.zoom+1,Ot,Zt),ve(Bt)),me.push(Bt)}else{const _t=fe.zoom===ye?Oe:fe.zoom;if(r.minzoom&&r.minzoom>_t)continue;if(!st){let Ut=H?fe.aabb.intersectsPrecise(B):fe.aabb.intersectsPreciseFlat(B);if(Ut===0&&nt()){const gi=new o.bs(fe.zoom,we,Ke);Ut=o.bt(this,I,gi,!0).intersectsPrecise(B)}if(Ut===0)continue}const Ot=C[0]-(.5+we+(fe.wrap<<fe.zoom))*(1<<s-fe.zoom),Zt=C[1]-.5-Ke,Bt=fe.tileID?fe.tileID:new o.am(_t,fe.wrap,fe.zoom,we,Ke);Me.push({tileID:Bt,distanceSq:Ot*Ot+Zt*Zt})}}if(this.fogCullDistSq){const fe=this.fogCullDistSq,we=this.horizonLineFromTop();Me=Me.filter(Ke=>{const st=[0,0,0,1],nt=[o.V,o.V,0,1],_t=this.calculateFogTileMatrix(Ke.tileID.toUnwrapped());o.a7.transformMat4(st,st,_t),o.a7.transformMat4(nt,nt,_t);const Ot=o.a7.min([],st,nt),Zt=o.a7.max([],st,nt),Bt=o.bv(Ot,Zt);if(Bt===0)return!0;let Ut=!1;const gi=this._elevation;if(gi&&Bt>fe&&we!==0){const si=this.calculateProjMatrix(Ke.tileID.toUnwrapped());let di;r.isTerrainDEM||(di=gi.getMinMaxForTile(Ke.tileID)),di||(di={min:q,max:te});const ui=o.bH(this.rotation),ki=[ui[0]*o.V,ui[1]*o.V,di.max];o.N.transformMat4(ki,ki,si),Ut=(1-ki[1])*this.height*.5<we}return Bt<fe||Ut})}return Me.sort((fe,we)=>fe.distanceSq-we.distanceSq).map(fe=>fe.tileID)}resize(r,s){this.width=r,this.height=s,this.pixelsToGLUnits=[2/r,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const s=o.aa(r.lat,-o.bw,o.bw),h=this.projection.project(r.lng,s);return new o.P(h.x*this.worldSize,h.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.bl(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,s){let h,p;const _=this.centerPoint;if(this.projection.name==="globe"){const T=this.worldSize;h=(s.x-_.x)/T,p=(s.y-_.y)/T}else{const T=this.pointCoordinate(s),S=this.pointCoordinate(_);h=T.x-S.x,p=T.y-S.y}const x=this.locationCoordinate(r);this.setLocation(new o.L(x.x-h,x.y-p))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,s){const h=s?o.bl(s,r.lat):void 0,p=this.projection.project(r.lng,r.lat);return new o.L(p.x,p.y,h)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,s){const h=s??this._centerAltitude,p=[r.x,r.y,0,1],_=[r.x,r.y,1,1];o.a7.transformMat4(p,p,this.pixelMatrixInverse),o.a7.transformMat4(_,_,this.pixelMatrixInverse);const x=_[3];o.a7.scale(p,p,1/p[3]),o.a7.scale(_,_,1/x);const T=p[2],S=_[2];return{p0:p,p1:_,t:T===S?0:(h-T)/(S-T)}}screenPointToMercatorRay(r){const s=[r.x,r.y,0,1],h=[r.x,r.y,1,1];return o.a7.transformMat4(s,s,this.pixelMatrixInverse),o.a7.transformMat4(h,h,this.pixelMatrixInverse),o.a7.scale(s,s,1/s[3]),o.a7.scale(h,h,1/h[3]),s[2]=o.bl(s[2],this._center.lat)*this.worldSize,h[2]=o.bl(h[2],this._center.lat)*this.worldSize,o.a7.scale(s,s,1/this.worldSize),o.a7.scale(h,h,1/this.worldSize),new o.a2([s[0],s[1],s[2]],o.N.normalize([],o.N.sub([],h,s)))}rayIntersectionCoordinate(r){const{p0:s,p1:h,t:p}=r,_=o.bl(s[2],this._center.lat),x=o.bl(h[2],this._center.lat);return new o.L(o.U(s[0],h[0],p)/this.worldSize,o.U(s[1],h[1],p)/this.worldSize,o.U(_,x,p))}pointCoordinate(r,s=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,s)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let s=this.projection.pointCoordinate3D(this,r.x,r.y);if(s)return new o.L(s[0],s[1],s[2]);let h=0,p=this.horizonLineFromTop();if(r.y>p)return this.pointCoordinate(r);const _=.02*p,x=r.clone();for(let T=0;T<10&&p-h>_;T++){x.y=o.U(h,p,.66);const S=this.projection.pointCoordinate3D(this,x.x,x.y);S?(p=x.y,s=S):h=x.y}return s?new o.L(s[0],s[1],s[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=o.bx)return!this.isPointAboveHorizon(r);const s=this.pointCoordinate(r);return s.y>=0&&s.y<=1}_coordinatePoint(r,s){const h=s&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,p=[r.x*this.worldSize,r.y*this.worldSize,h+r.toAltitude(),1];return o.a7.transformMat4(p,p,this.pixelMatrix),p[3]>0?new o.P(p[0]/p[3],p[1]/p[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:s}=this._edgeInsets,h=this.height-this._edgeInsets.bottom,p=this.width-this._edgeInsets.right,_=this.pointLocation3D(new o.P(s,r)),x=this.pointLocation3D(new o.P(p,r)),T=this.pointLocation3D(new o.P(p,h)),S=this.pointLocation3D(new o.P(s,h));let I=Math.min(_.lng,x.lng,T.lng,S.lng),C=Math.max(_.lng,x.lng,T.lng,S.lng),L=Math.min(_.lat,x.lat,T.lat,S.lat),k=Math.max(_.lat,x.lat,T.lat,S.lat);const B=Math.pow(2,-this.zoom)/16*270,j=this.projection.name==="globe"?1:4,U=($,N,H,ee,X)=>{const te=($+H)/2,q=(N+ee)/2,re=new o.P(te,q),{lng:ae,lat:ue}=this.pointLocation3D(re),me=Math.max(0,I-ae,L-ue,ae-C,ue-k);I=Math.min(I,ae),C=Math.max(C,ae),L=Math.min(L,ue),k=Math.max(k,ue),(X<j||me>B)&&(U($,N,te,q,X+1),U(te,q,H,ee,X+1))};if(U(s,r,p,r,1),U(p,r,p,h,1),U(p,h,s,h,1),U(s,h,s,r,1),this.projection.name==="globe"){const[$,N]=o.by(this);$?(k=90,C=180,I=-180):N&&(L=-90,C=180,I=-180)}return new o.ad(new o.bn(I,L),new o.bn(C,k))}_getBoundsRectangular(r,s){const{top:h,left:p}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,T=new o.P(p,h),S=new o.P(x,h),I=new o.P(x,_),C=new o.P(p,_);let L=this.pointCoordinate(T,r),k=this.pointCoordinate(S,r);const B=this.pointCoordinate(I,s),j=this.pointCoordinate(C,s),U=($,N)=>(N.y-$.y)/(N.x-$.x);return L.y>1&&k.y>=0?L=new o.L((1-j.y)/U(j,L)+j.x,1):L.y<0&&k.y<=1&&(L=new o.L(-j.y/U(j,L)+j.x,0)),k.y>1&&L.y>=0?k=new o.L((1-B.y)/U(B,k)+B.x,1):k.y<0&&L.y<=1&&(k=new o.L(-B.y/U(B,k)+B.x,0)),new o.ad().extend(this.coordinateLocation(L)).extend(this.coordinateLocation(k)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(B))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const s=r.visibleDemTiles.reduce((h,p)=>{if(p.dem){const _=p.dem.tree;h.min=Math.min(h.min,_.minimums[0]),h.max=Math.max(h.max,_.maximums[0])}return h},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(s.min*r.exaggeration(),s.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const s=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,h=this.height/2-s*(1-this._horizonShift);return r?Math.max(0,h):h}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.bw,this.maxLat=o.bw,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.a5(this.minLng)*this.tileSize,this.worldMaxX=o.a5(this.maxLng)*this.tileSize,this.worldMinY=o.ae(this.maxLat)*this.tileSize,this.worldMaxY=o.ae(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,s){return this.projection.createTileMatrix(this,s,r)}calculateDistanceTileData(r){const s=r.key,h=this._distanceTileDataCache;if(h[s])return h[s];const p=r.canonical,_=1/this.height,x=this.cameraWorldSize,T=x/this.zoomScale(p.z),S=(p.x+Math.pow(2,p.z)*r.wrap)*T,I=p.y*T,C=this.point;C.x*=x/this.worldSize,C.y*=x/this.worldSize;const L=this.angle,k=Math.sin(-L),B=-Math.cos(-L);return h[s]={bearing:[k,B],center:[(C.x-S)*_,(C.y-I)*_],scale:T/o.V*_},h[s]}calculateFogTileMatrix(r){const s=r.key,h=this._fogTileMatrixCache;if(h[s])return h[s];const p=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return o.a6.multiply(p,this.worldToFogMatrix,p),h[s]=new Float32Array(p),h[s]}calculateProjMatrix(r,s=!1,h=!1){const p=r.key;let _;if(_=h?this._expandedProjMatrixCache:s?this._alignedProjMatrixCache:this._projMatrixCache,_[p])return _[p];const x=this.calculatePosMatrix(r,this.worldSize);let T;return T=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.expandedFarZProjMatrix:s?this.alignedProjMatrix:this.projMatrix,o.a6.multiply(x,T,x),_[p]=new Float32Array(x),_[p]}calculatePixelsToTileUnitsMatrix(r){const s=r.tileID.key,h=this._pixelsToTileUnitsCache;if(h[s])return h[s];const p=o.bz(r,this);return h[s]=p,h[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,s=o.a6.fromScaling([],[r,r,r]);return o.a6.multiply(s,s,this.globeMatrix),s}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const s=o.bl(1,this._center.lat)*this.worldSize,h=this._computeCameraPosition(s),p=this._camera.forward(),_=o.bl(1,this._center.lat);h[2]/=_,p[2]/=_,o.N.normalize(p,p);const x=r.raycast(h,p,r.exaggeration());if(x){const T=o.N.scaleAndAdd([],h,p,x),S=new o.L(T[0],T[1],o.bl(T[2],o.au(T[1]))),I=(S.z+o.N.length([S.x-h[0],S.y-h[1],S.z-h[2]*_]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(I),this._centerAltitude=S.toAltitude(),this._center=this.coordinateLocation(S),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const s=this._elevation,h=o.bl(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(h),_=s.getAtPointOrZero(new o.L(...p)),x=this.pixelsPerMeter/this.worldSize*_,T=this._minimumHeightOverTerrain(),S=p[2]-x;if(S<=T)if(S<0||r){const I=this.locationCoordinate(this._center,this._centerAltitude),C=[p[0],p[1],I.z-p[2]],L=o.N.length(C);C[2]-=(T-S)/this._pixelsPerMercatorPixel;const k=o.N.length(C);if(k===0)return;o.N.scale(C,C,L/k*this._pixelsPerMercatorPixel),this._camera.position=[p[0],p[1],I.z*this._pixelsPerMercatorPixel-C[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const k=this.center;return k.lat=o.aa(k.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(k.lng=o.aa(k.lng,this.minLng,this.maxLng)),this.center=k,void(this._constraining=!1)}const s=this._unmodified,{x:h,y:p}=this.point;let _=0,x=h,T=p;const S=this.width/2,I=this.height/2,C=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(p-I<C&&(T=C+I),p+I>L&&(T=L-I),L-C<this.height&&(_=Math.max(_,this.height/(L-C)),T=(L+C)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const k=this.worldMinX*this.scale,B=this.worldMaxX*this.scale,j=this.worldSize/2-(k+B)/2;x=(h+j+this.worldSize)%this.worldSize-j,x-S<k&&(x=k+S),x+S>B&&(x=B-S),B-k<this.width&&(_=Math.max(_,this.width/(B-k)),x=(B+k)/2)}x===h&&T===p||(this.center=this.unproject(new o.P(x,T))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCamera(),this._unmodified=s,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,s=this.projection.name==="globe",h=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.bl(1,this.center.lat)/o.bl(1,o.bI));const p=o.bA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this.projection.zAxisUnit==="meters"?h:1,x=this._camera.getWorldToCamera(this.worldSize,_);let T;const S=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(S[8]=2*-r.x/this.width,S[9]=2*r.y/this.height,this.isOrthographic){let ue=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),me=ue*this.aspect,Me=-me,ye=-ue;me-=r.x,Me-=r.x,ue+=r.y,ye+=r.y,T=this._camera.getCameraToClipOrthographic(Me,me,ye,ue,this._nearZ,this._farZ),((Oe,Le,We,ve)=>{for(let Ce=0;Ce<16;Ce++)Oe[Ce]=Ba(Le[Ce],We[Ce],ve)})(T,T,S,ql(this.pitch>=15?1:this.pitch/15))}else T=S;const I=o.a6.mul([],S,x);let C=o.a6.mul([],T,x);if(this.projection.isReprojectedInTileSpace){const ue=this.locationCoordinate(this.center),me=o.a6.identity([]);o.a6.translate(me,me,[ue.x*this.worldSize,ue.y*this.worldSize,0]),o.a6.multiply(me,me,o.bB(this)),o.a6.translate(me,me,[-ue.x*this.worldSize,-ue.y*this.worldSize,0]),o.a6.multiply(C,C,me),o.a6.multiply(I,I,me),this.inverseAdjustmentMatrix=o.bC(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.a6.scale([],C,[this.worldSize,this.worldSize,this.worldSize/_,1]),this.projMatrix=C,this.invProjMatrix=o.a6.invert(new Float64Array(16),this.projMatrix),s){const ue=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ue[8]=2*-r.x/this.width,ue[9]=2*r.y/this.height,this.expandedFarZProjMatrix=o.a6.mul([],ue,x)}else this.expandedFarZProjMatrix=this.projMatrix;const L=o.a6.invert([],T);this.frustumCorners=o.bD.fromInvProjectionMatrix(L,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!s);const k=new Float32Array(16);o.a6.identity(k),o.a6.scale(k,k,[1,-1,1]),o.a6.rotateX(k,k,this._pitch),o.a6.rotateZ(k,k,this.angle);const B=o.a6.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.a6.clone(B);const j=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;B[8]=2*-r.x/this.width,B[9]=2*(r.y+j)/this.height,this.skyboxMatrix=o.a6.multiply(k,B,k);const U=this.point,$=U.x,N=U.y,H=this.width%2/2,ee=this.height%2/2,X=Math.cos(this.angle),te=Math.sin(this.angle),q=$-Math.round($)+X*H+te*ee,re=N-Math.round(N)+X*ee+te*H,ae=new Float64Array(C);if(o.a6.translate(ae,ae,[q>.5?q-1:q,re>.5?re-1:re,0]),this.alignedProjMatrix=ae,C=o.a6.create(),o.a6.scale(C,C,[this.width/2,-this.height/2,1]),o.a6.translate(C,C,[1,-1,0]),this.labelPlaneMatrix=C,C=o.a6.create(),o.a6.scale(C,C,[1,-1,1]),o.a6.translate(C,C,[-1,-1,0]),o.a6.scale(C,C,[2/this.width,2/this.height,1]),this.glCoordMatrix=C,this.pixelMatrix=o.a6.multiply(new Float64Array(16),this.labelPlaneMatrix,I),this._calcFogMatrices(),this._distanceTileDataCache={},C=o.a6.invert(new Float64Array(16),this.pixelMatrix),!C)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=C,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.bE(this);const ue=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.N.transformMat4(ue,ue,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=C;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,s=this.cameraPixelsPerMeter,h=this._camera.position,p=1/this.height/this._pixelsPerMercatorPixel,_=[r,r,s];o.N.scale(_,_,p),o.N.scale(h,h,-1),o.N.multiply(h,h,_);const x=o.a6.create();o.a6.translate(x,x,h),o.a6.scale(x,x,_),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,s,p)}_computeCameraPosition(r){const s=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,h=this._camera.forward(),p=this.point,_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*s-r/this.worldSize*this._centerAltitude;return[p.x/this.worldSize-h[0]*_,p.y/this.worldSize-h[1]*_,r/this.worldSize*this._centerAltitude-h[2]*_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const s=this._maxCameraBoundsDistance()*Math.cos(this._pitch),h=this._camera.position[2],p=r[2];let _=1;this.projection.wrap&&(this.center=this.center.wrap()),p>0&&(_=Math.min((s-h)/p,1)),this._camera.position=o.N.scaleAndAdd([],this._camera.position,r,_),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,s=this._camera.forward(),{pitch:h,bearing:p}=this._camera.getPitchBearing(),_=o.bl(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.bj(this._maxPitch)),T=Math.max((r[2]-_)/Math.cos(h),x),S=this._zoomFromMercatorZ(T);o.N.scaleAndAdd(r,r,s,T),this._pitch=o.aa(h,o.bj(this.minPitch),o.bj(this.maxPitch)),this.angle=o.bh(p,-Math.PI,Math.PI),this._setZoom(o.aa(S,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.L(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let s=0,h=o.bx,p=0,_=1/0;for(;h-s>1e-6&&h>s;){const x=s+.5*(h-s),T=this.tileSize*Math.pow(2,x),S=this.getCameraToCenterDistance(this.projection,x,T),I=this.scaleZoom(S/(r*this.tileSize)),C=Math.abs(x-I);C<_&&(_=C,p=x),x<I?s=x:h=x}return p}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,s){const h=Math.min(r.x,s.x),p=Math.max(r.x,s.x),_=Math.min(r.y,s.y),x=Math.max(r.y,s.y);if(_<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const T=[new o.P(h,_),new o.P(p,x),new o.P(h,x),new o.P(p,_)],S=this.renderWorldCopies?-3:0,I=this.renderWorldCopies?4:1;for(const C of T){const L=this.pointRayIntersection(C);if(L.t<0)return!0;const k=this.rayIntersectionCoordinate(L);if(k.x<S||k.y<0||k.x>I||k.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.bF(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(r,s){const h=o.N.length(o.N.sub([],this._camera.position,r)),p=this._zoomFromMercatorZ(h)+s;return h-this._mercatorZfromZoom(p)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([s,h,p],_){const x=[s,h,p,1];o.a7.transformMat4(x,x,_);const T=x[3]=Math.max(x[3],1e-6);return x[0]/=T,x[1]/=T,x[2]/=T,x}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,r))}}getCameraToCenterDistance(r,s=this.zoom,h=this.worldSize){const p=o.bA(r,s,this.width,this.height,1024),_=r.pixelSpaceConversion(this.center.lat,h,p);let x=.5/Math.tan(.5*this._fov)*this.height*_;return this.isOrthographic&&(x=Ba(1,x,ql(this.pitch>=15?1:this.pitch/15))),x}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.a6.multiply(r,r,this.globeMatrix),r}getFrustum(r){return o.bq.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}const Mn={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},Po=(u,r)=>{if(r>0&&u.terrain&&o.w("Cutoff is currently disabled on terrain"),r<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const s=u.transform,h=Math.max(Math.abs(s._zoom-(u.minCutoffZoom-1)),1),p=s.isLODDisabled(!1)?o.O(60,45,s.pitch):o.O(30,15,s.pitch),_=s._farZ-s._nearZ,x=r*s.height,T=((1-(S=p))*s.cameraToCenterDistance+S*(s._farZ+x))*h;var S;return{shouldRenderCutoff:p<1,uniformValues:{u_cutoff_params:[s._nearZ,s._farZ,(T-s._nearZ)/_,(T-x-s._nearZ)/_]}}},Un={cascadeCount:2,shadowMapResolution:2048};class qh{constructor(r,s){this.aabb=r,this.lastCascade=s}}class np{add(r,s){const h=this.receivers[r.key];h!==void 0?(h.aabb.min[0]=Math.min(h.aabb.min[0],s.min[0]),h.aabb.min[1]=Math.min(h.aabb.min[1],s.min[1]),h.aabb.min[2]=Math.min(h.aabb.min[2],s.min[2]),h.aabb.max[0]=Math.max(h.aabb.max[0],s.max[0]),h.aabb.max[1]=Math.max(h.aabb.max[1],s.max[1]),h.aabb.max[2]=Math.max(h.aabb.max[2],s.max[2])):this.receivers[r.key]=new qh(s,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,s,h){const p=o.bS.fromPoints(r.points);let _=0;for(const x in this.receivers){const T=this.receivers[x];if(!T||!p.intersectsAabb(T.aabb))continue;T.aabb.min=p.closestPoint(T.aabb.min),T.aabb.max=p.closestPoint(T.aabb.max);const S=T.aabb.getCorners();for(let I=0;I<h.length;I++){let C=!0;for(const L of S){const k=[L[0]*s,L[1]*s,L[2]];if(o.N.transformMat4(k,k,h[I].matrix),k[0]<-1||k[0]>1||k[1]<-1||k[1]>1){C=!1;break}}if(T.lastCascade=I,_=Math.max(_,I),C)break}}return _+1}}class Zh{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new np,this._depthMode=new Yt(r.context.gl.LEQUAL,Yt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,r.tp.registerParameter(Un,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(Un,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,s){const h=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!s||!s.properties)return;const p=s.properties.get("shadow-intensity");if(!s.shadowsEnabled()||p<=0||(this._shadowLayerCount=h.style.order.reduce((j,U)=>{const $=h.style._mergedLayers[U];return j+($.hasShadowPass()&&!$.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const _=h.context,x=Un.shadowMapResolution,T=Un.shadowMapResolution;if(this._cascades.length===0||Un.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let j=0;j<Un.cascadeCount;++j){const U=h._shadowMapDebug,$=_.gl,N=_.createFramebuffer(x,T,U,"texture"),H=new o.T(_,{width:x,height:T,data:null},$.DEPTH_COMPONENT);if(N.depthAttachment.set(H.texture),U){const ee=new o.T(_,{width:x,height:T,data:null},$.RGBA);N.colorAttachment.set(ee.texture)}this._cascades.push({framebuffer:N,texture:H,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.bq,scale:0})}}this.shadowDirection=lu(s);let S=0;if(r.elevation){const j=r.elevation,U=[1e4,-1e4];j.visibleDemTiles.filter($=>$.dem).forEach($=>{const N=$.dem.tree;U[0]=Math.min(U[0],N.minimums[0]),U[1]=Math.max(U[1],N.maximums[0])}),U[0]!==1e4&&(S=(U[1]-U[0])*j.exaggeration())}const I=1.5*r.cameraToCenterDistance,C=3*I,L=new Float64Array(16);for(let j=0;j<this._cascades.length;++j){const U=this._cascades[j];let $=r.height/50,N=1;Un.cascadeCount===1?N=C:j===0?N=I:($=I,N=C);const[H,ee]=sp(r,this.shadowDirection,$,N,Un.shadowMapResolution,S);U.scale=r.scale,U.matrix=H,U.boundingSphereRadius=ee,o.a6.invert(L,U.matrix),U.frustum=o.bq.fromInvProjectionMatrix(L,1,0,!0),U.far=N}const k=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[k].far,this._cascades[k].far],this._uniformValues.u_shadow_intensity=p,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Un.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Un.shadowMapResolution,this._uniformValues.u_shadowmap_0=Mn.ShadowMap0,this._uniformValues.u_shadowmap_1=Mn.ShadowMap0+1,this._groundShadowTiles=h.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const B=h.transform.elevation;for(const j of this._groundShadowTiles){let U={min:0,max:0};if(B){const $=B.getMinMaxForTile(j);$&&(U=$)}this.addShadowReceiver(j.toUnwrapped(),U.min,U.max)}}get enabled(){return this._enabled}set enabled(r){this._enabled=r}drawShadowPass(r,s){if(!this._enabled)return;const h=this.painter,p=h.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(h.transform.getFrustum(0),h.transform.worldSize,this._cascades),p.viewport.set([0,0,Un.shadowMapResolution,Un.shadowMapResolution]);for(let _=0;_<this._numCascadesToRender;++_){h.currentShadowCascade=_,p.bindFramebuffer.set(this._cascades[_].framebuffer.framebuffer),p.clear({color:o.ax.white,depth:1});for(const x of r.order){const T=r._mergedLayers[x];if(!T.hasShadowPass()||T.isHidden(h.transform.zoom))continue;const S=r.getLayerSourceCache(T),I=S?s[S.id]:void 0;(T.type==="model"||I&&I.length)&&h.renderLayer(h,S,T,I)}}h.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const r=this.painter,s=r.style,h=r.context,p=s.directionalLight,_=s.ambientLight;if(!p||!_)return;const x=[],T=Po(r,r.longestCutoffRange);T.shouldRenderCutoff&&x.push("RENDER_CUTOFF");const S=Hl(p,_),I=new Yt(h.gl.LEQUAL,Yt.ReadOnly,r.depthRangeFor3D);for(const C of this._groundShadowTiles){const L=C.toUnwrapped(),k=r.isTileAffectedByFog(C),B=r.getOrCreateProgram("groundShadow",{defines:x,overrideFog:k});this.setupShadows(L,B),r.uploadCommonUniforms(h,B,L,null,T);const j={u_matrix:r.transform.calculateProjMatrix(L),u_ground_shadow_factor:S};B.draw(r,h.gl.TRIANGLES,I,li.disabled,Si.multiply,Jt.disabled,j,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,{},r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Si.unblended:Si.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const s=this.painter.transform,h=s.calculatePosMatrix(r,s.worldSize);return o.a6.multiply(h,this._cascades[this.painter.currentShadowCascade].matrix,h),Float32Array.from(h)}calculateShadowPassMatrixFromMatrix(r){return o.a6.multiply(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,s,h,p=0){if(!this._enabled)return;const _=this.painter.transform,x=this.painter.context,T=x.gl,S=this._uniformValues,I=new Float64Array(16),C=_.calculatePosMatrix(r,_.worldSize);for(let L=0;L<this._cascades.length;L++)o.a6.multiply(I,this._cascades[L].matrix,C),S[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),x.activeTexture.set(T.TEXTURE0+Mn.ShadowMap0+L),this._cascades[L].texture.bind(T.NEAREST,T.CLAMP_TO_EDGE);if(this.useNormalOffset=!!h,this.useNormalOffset){const L=o.bR(r.canonical),k=2/_.tileSize*o.V/Un.shadowMapResolution,B=k*this._cascades[0].boundingSphereRadius,j=k*this._cascades[this._cascades.length-1].boundingSphereRadius,U=(h==="vector-tile"?1:3)/Math.pow(2,p-r.canonical.z-(1-_.zoom+Math.floor(_.zoom)));S.u_shadow_normal_offset=[L,B*U,j*U],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];s.setShadowUniformValues(x,S)}setupShadowsFromMatrix(r,s,h=!1){if(!this._enabled)return;const p=this.painter.context,_=p.gl,x=this._uniformValues,T=new Float64Array(16);for(let S=0;S<Un.cascadeCount;S++)o.a6.multiply(T,this._cascades[S].matrix,r),x[S===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(T),p.activeTexture.set(_.TEXTURE0+Mn.ShadowMap0+S),this._cascades[S].texture.bind(_.NEAREST,_.CLAMP_TO_EDGE);this.useNormalOffset=h,h?(x.u_shadow_normal_offset=[1,5,5],x.u_shadow_bias=[6e-5,.0012,.012]):x.u_shadow_bias=[36e-5,.0012,.012],s.setShadowUniformValues(p,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,s,h,p){if(p[2]>=0)return{};const _=function(S,I,C){const L=C/(1<<S.canonical.z);return new o.bS([S.canonical.x*L+S.wrap*C,S.canonical.y*L+S.wrap*C,0],[(S.canonical.x+1)*L+S.wrap*C,(S.canonical.y+1)*L+S.wrap*C,I])}(r,s,h).getCorners(),x=s/-p[2];p[0]<0?(o.N.add(_[0],_[0],[p[0]*x,0,0]),o.N.add(_[3],_[3],[p[0]*x,0,0])):p[0]>0&&(o.N.add(_[1],_[1],[p[0]*x,0,0]),o.N.add(_[2],_[2],[p[0]*x,0,0])),p[1]<0?(o.N.add(_[0],_[0],[0,p[1]*x,0]),o.N.add(_[1],_[1],[0,p[1]*x,0])):p[1]>0&&(o.N.add(_[2],_[2],[0,p[1]*x,0]),o.N.add(_[3],_[3],[0,p[1]*x,0]));const T={};return T.vertices=_,T.planes=[oa(_[1],_[0],_[4]),oa(_[2],_[1],_[5]),oa(_[3],_[2],_[6]),oa(_[0],_[3],_[7])],T}addShadowReceiver(r,s,h){this._receivers.add(r,o.bS.fromTileIdAndHeight(r,s,h))}getMaxCascadeForTile(r){const s=this._receivers.get(r);return s&&s.lastCascade?s.lastCascade:0}}function oa(u,r,s){const h=o.N.sub([],s,r),p=o.N.sub([],u,r),_=o.N.cross([],h,p),x=o.N.length(_);return x===0?[0,0,1,0]:(o.N.scale(_,_,1/x),[_[0],_[1],_[2],-o.N.dot(_,r)])}function lu(u){const r=u.properties.get("direction"),s=o.bQ(r.x,r.y,r.z);s[2]=o.aa(s[2],0,75);const h=o.bT([s[0],s[1],s[2]]);return o.N.fromValues(h.x,h.y,h.z)}function Hl(u,r){const s=u.properties.get("color"),h=u.properties.get("intensity"),p=u.properties.get("direction"),_=[p.x,p.y,p.z],x=r.properties.get("color"),T=r.properties.get("intensity"),S=Math.max(o.N.dot([0,0,1],_),0),I=[0,0,0];o.N.scale(I,x.toArray01Linear().slice(0,3),T);const C=[0,0,0];return o.N.scale(C,s.toArray01Linear().slice(0,3),S*h),o.bU([I[0]>0?I[0]/(I[0]+C[0]):0,I[1]>0?I[1]/(I[1]+C[1]):0,I[2]>0?I[2]/(I[2]+C[2]):0])}function sp(u,r,s,h,p,_){const x=u.zoom,T=u.scale,S=u.worldSize,I=1/S,C=u.aspect,L=Math.sqrt(1+C*C)*Math.tan(.5*u.fovX),k=L*L,B=h-s,j=h+s;let U,$;k>B/j?(U=h,$=h*L):(U=.5*j*(1+k),$=.5*Math.sqrt(B*B+2*(h*h+s*s)*k+j*j*k*k));const N=u.projection.pixelsPerMeter(u.center.lat,S),H=u._camera.getCameraToWorldMercator(),ee=[0,0,-U*I];o.N.transformMat4(ee,ee,H);let X=$*I;const te=u._edgeInsets;if(!(te.left===0&&te.top===0&&te.right===0&&te.bottom===0||te.left===te.right&&te.top===te.bottom)){const st=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?N:1),nt=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,s,h);nt[8]=2*-u.centerOffset.x/u.width,nt[9]=2*u.centerOffset.y/u.height;const _t=new Float64Array(16);o.a6.mul(_t,nt,st);const Ot=new Float64Array(16);o.a6.invert(Ot,_t);const Zt=o.bq.fromInvProjectionMatrix(Ot,S,x,!0);for(const Bt of Zt.points){const Ut=((q=Bt)[0]/=T,q[1]/=T,q[2]=o.bl(q[2],u._center.lat),q);X=Math.max(X,o.N.len(o.N.subtract([],ee,Ut)))}}var q;X*=p/(p-1);const re=Math.acos(r[2]),ae=Math.atan2(-r[0],-r[1]),ue=new ka;ue.position=ee,ue.setPitchBearing(re,ae);const me=ue.getWorldToCamera(S,N),Me=X*S,ye=Math.min(u._mercatorZfromZoom(17)*S*-2,-2*Me),Oe=ue.getCameraToClipOrthographic(-Me,Me,-Me,Me,ye,(Me+_*N)/r[2]),Le=new Float64Array(16);o.a6.multiply(Le,Oe,me);const We=o.N.fromValues(Math.floor(1e6*ee[0])/1e6*S,Math.floor(1e6*ee[1])/1e6*S,0),ve=.5*p,Ce=[0,0,0];o.N.transformMat4(Ce,We,Le),o.N.scale(Ce,Ce,ve);const fe=[Math.floor(Ce[0]),Math.floor(Ce[1]),Math.floor(Ce[2])],we=[0,0,0];o.N.sub(we,Ce,fe),o.N.scale(we,we,-1/ve);const Ke=new Float64Array(16);return o.a6.identity(Ke),o.a6.translate(Ke,Ke,we),o.a6.multiply(Le,Ke,Le),[Le,Me]}const Ro=(u,r)=>Dt(u,r&&r.filter(s=>s.identifier!=="source.canvas")),op=o.ac(zi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","updateImport"]),Fa=o.ac(zi,["setCenter","setZoom","setBearing","setPitch"]),Hh={version:8,layers:[],sources:{}},ap={duration:300,delay:0},H_=new Set(["fill","line","background","hillshade","raster"]);class As extends o.E{constructor(r,s={}){super(),this.map=r,this.scope=s.scope||"",this.fragments=[],this.importDepth=s.importDepth||0,this.importsCache=s.importsCache||new Map,this.resolvedImports=s.resolvedImports||new Set,this.transition=o.e({},ap),this._buildingIndex=new Yf(this),this.crossTileSymbolIndex=new Gh,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=s.styleChanges||new Ti,this.dispatcher=s.dispatcher?s.dispatcher:new o.bW(o.bX(),this),s.imageManager?this.imageManager=s.imageManager:(this.imageManager=new Dr,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=s.glyphManager?s.glyphManager:new o.bY(r._requestManager,s.localFontFamily?o.bZ.all:s.localIdeographFontFamily?o.bZ.ideographs:o.bZ.none,s.localFontFamily||s.localIdeographFontFamily),s.modelManager?this.modelManager=s.modelManager:(this.modelManager=new Wi(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=s.configOptions?s.configOptions:new Map,this._configDependentLayers=s.configDependentLayers?s.configDependentLayers:new Set,this._config=s.config,this.dispatcher.broadcast("setReferrer",o.b_());const h=this;this._rtlTextPluginCallback=As.registerForPluginStateChange(p=>{h.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(_,x)=>{if(o.b$(_),x&&x.every(T=>T))for(const T in h._sourceCaches){const S=h._sourceCaches[T],I=S.getSource().type;I!=="vector"&&I!=="geojson"||S.reload()}})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const _=this.getOwnSource(p.sourceId);if(_&&_.vectorLayerIds)for(const x in this._layers){const T=this._layers[x];T.source===_.id&&this._validateLayer(T)}})}loadURL(r,s={}){this.fire(new o.b("dataloading",{dataType:"style"}));const h=typeof s.validate=="boolean"?s.validate:!o.c0(r);r=this.map._requestManager.normalizeStyleURL(r,s.accessToken),this.resolvedImports.add(r);const p=this.importsCache.get(r);if(p)return this._load(p,h);const _=this.map._requestManager.transformRequest(r,o.R.Style);this._request=o.g(_,(x,T)=>{if(this._request=null,x)this.fire(new o.a(x));else if(T)return this.importsCache.set(r,T),this._load(T,h)})}loadJSON(r,s={}){this.fire(new o.b("dataloading",{dataType:"style"})),this._request=o.f.frame(()=>{this._request=null,this._load(r,s.validate!==!1)})}loadEmpty(){this.fire(new o.b("dataloading",{dataType:"style"})),this._load(Hh,!1)}_loadImports(r,s,h){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const p=[];for(const _ of r){const x=this._createFragmentStyle(_),T=new Promise(C=>{x.once("style.import.load",C),x.once("error",C)}).then(()=>this.mergeAll());if(p.push(T),this.resolvedImports.has(_.url)){x.loadEmpty();continue}const S=_.data||this.importsCache.get(_.url);S?x.loadJSON(S,{validate:s}):_.url?x.loadURL(_.url,{validate:s}):x.loadEmpty();const I={style:x,id:_.id,config:_.config};if(h){const C=this.fragments.findIndex(({id:L})=>L===h);this.fragments=this.fragments.slice(0,C).concat(I).concat(this.fragments.slice(C))}else this.fragments.push(I)}return Promise.allSettled(p)}_createFragmentStyle(r){const s=this.scope?o.ag(r.id,this.scope):r.id,h=new As(this.map,{scope:s,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:r.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return h.setEventedParent(this.map,{style:h}),h}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const r=this.isRootStyle();this._shouldPrecompile=r,this.fire(new o.b(r?"style.load":"style.import.load"))}_load(r,s){const h=r.schema;if(this.isRootStyle()&&(r.fragment||h&&r.fragment!==!1)){const x=o.e({},Hh,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(x,s)}if(this.setConfig(this._config,h),s&&Ro(this,Ht(r)))return;this._loaded=!0,this.stylesheet=o.c1(r);for(const x in r.sources)this.addSource(x,r.sources[x],{validate:!1,isInitialLoad:!0});r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(r.glyphs,this.scope);const p=Jf(this.stylesheet.layers);if(this._order=p.map(x=>x.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const x=this.stylesheet.lights[0];this.light=new It(x.properties,x.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new It(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const x of p){const T=o.c2(x,this.scope,this.options);T.isConfigDependent&&this._configDependentLayers.add(T.fqid),T.setEventedParent(this,{layer:{id:T.id}}),this._layers[T.id]=T,this._serializedLayers[T.id]=T.serialize();const S=this.getOwnLayerSourceCache(T),I=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&T.canCastShadows()&&I&&(S.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const _=this.stylesheet.terrain;_&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.f.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(_,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.b("data",{dataType:"style"})),r.imports?this._loadImports(r.imports,s).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let r,s,h,p,_,x,T,S;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(I=>{if(I.stylesheet){if(I.light!=null&&(r=I.light),I.stylesheet.lights)for(const C of I.stylesheet.lights)C.type==="ambient"&&I.ambientLight!=null&&(s=I.ambientLight),C.type==="directional"&&I.directionalLight!=null&&(h=I.directionalLight);p=this._prioritizeTerrain(p,I.terrain,I.stylesheet.terrain),I.stylesheet.fog&&I.fog!=null&&(_=I.fog),I.stylesheet.camera!=null&&(S=I.stylesheet.camera),I.stylesheet.projection!=null&&(x=I.stylesheet.projection),I.stylesheet.transition!=null&&(T=I.stylesheet.transition)}}),this.light=r,this.ambientLight=s,this.directionalLight=h,this.fog=_,p===null?delete this.terrain:this.terrain=p,this.camera=S||{"camera-projection":"perspective"},this.projection=x||{name:"mercator"},this.transition=o.e({},ap,T),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){const s=h=>{for(const p of h.fragments)s(p.style);r(h)};s(this)}_prioritizeTerrain(r,s,h){const p=r&&r.drapeRenderMode===0;return h===null?s&&s.drapeRenderMode===0?s:p?r:null:s!=null&&(!r||p||s&&s.drapeRenderMode===1)?s:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(s=>{r=this._prioritizeTerrain(r,s.terrain,s.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(s=>{s.stylesheet.projection!=null&&(r=s.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){const r={},s={},h={};this.forEachFragmentStyle(p=>{for(const _ in p._sourceCaches){const x=o.ag(_,p.scope);r[x]=p._sourceCaches[_]}for(const _ in p._otherSourceCaches){const x=o.ag(_,p.scope);s[x]=p._otherSourceCaches[_]}for(const _ in p._symbolSourceCaches){const x=o.ag(_,p.scope);h[x]=p._symbolSourceCaches[_]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=s,this._mergedSymbolSourceCaches=h}mergeLayers(){const r={},s=[],h={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(_=>{for(const x of _._order){const T=_._layers[x];if(T.type==="slot"){const S=o.c3(x);if(r[S])continue;r[S]=[]}T.slot&&r[T.slot]?r[T.slot].push(T):s.push(T)}}),this._mergedOrder=[];const p=(_=[])=>{for(const x of _)if(x.type==="slot"){const T=o.c3(x.id);r[T]&&p(r[T])}else{const T=o.ag(x.id,x.scope);this._mergedOrder.push(T),h[T]=x,x.is3D()&&(this._has3DLayers=!0),x.type==="circle"&&(this._hasCircleLayers=!0),x.type==="symbol"&&(this._hasSymbolLayers=!0)}};p(s),this._mergedLayers=h,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=o.e({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(s,h,p){let _,x,T;const S=o.f.devicePixelRatio>1?"@2x":"";let I=o.g(h.transformRequest(h.normalizeSpriteURL(s,S,".json"),o.R.SpriteJSON),(k,B)=>{I=null,T||(T=k,_=B,L())}),C=o.d(h.transformRequest(h.normalizeSpriteURL(s,S,".png"),o.R.SpriteImage),(k,B)=>{C=null,T||(T=k,x=B,L())});function L(){if(T)p(T);else if(_&&x){const k=o.f.getImageData(x),B={};for(const j in _){const{width:U,height:$,x:N,y:H,sdf:ee,pixelRatio:X,stretchX:te,stretchY:q,content:re}=_[j],ae=new o.h({width:U,height:$});o.h.copy(k,ae,{x:N,y:H},{x:0,y:0},{width:U,height:$}),B[j]={data:ae,pixelRatio:X,sdf:ee,stretchX:te,stretchY:q,content:re}}p(null,B)}}return{cancel(){I&&(I.cancel(),I=null),C&&(C.cancel(),C=null)}}}(r,this.map._requestManager,(s,h)=>{if(this._spriteRequest=null,s)this.fire(new o.a(s));else if(h)for(const p in h)this.imageManager.addImage(p,this.scope,h[p]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.b("data",{dataType:"style"}))})}_validateLayer(r){const s=this.getOwnSource(r.source);if(!s)return;const h=r.sourceLayer;h&&(s.type==="geojson"||s.vectorLayerIds&&s.vectorLayerIds.indexOf(h)===-1)&&this.fire(new o.a(new Error(`Source layer "${h}" does not exist on source "${s.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,s)=>{const h=this.fragments[s];return h&&h.style&&(r.data=h.style.serialize()),r})}_serializeSources(){const r={};for(const s in this._sourceCaches){const h=this._sourceCaches[s].getSource();r[h.id]||(r[h.id]=h.serialize())}return r}_serializeLayers(r){const s=[];for(const h of r){const p=this._layers[h];p&&p.type!=="custom"&&s.push(p.serialize())}return s}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&(typeof r.isLayerDraped=="function"?r.isLayerDraped(this.getLayerSourceCache(r)):H_.has(r.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const s=this.getOwnLayer(r);if(s)return s;this.fire(new o.a(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const s=this.getOwnSource(r);if(s)return s;this.fire(new o.a(new Error(`The source '${r}' does not exist in the map's style.`)))}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const s=this.calculateLightsBrightness();r.brightness=s||0,s!==this._brightness&&(this._brightness=s,this.dispatcher.broadcast("setBrightness",s));const h=this._changes.isDirty();if(this._changes.isDirty()){const _=this._changes.getLayerUpdatesByScope();for(const x in _){const{updatedIds:T,removedIds:S}=_[x];(T||S)&&this._updateWorkerLayers(x,T,S)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._changes.reset()}const p={};for(const _ in this._mergedSourceCaches){const x=this._mergedSourceCaches[_];p[_]=x.used,x.used=!1,x.tileCoverLift=0}for(const _ of this._mergedOrder){const x=this._mergedLayers[_];if(x.recalculate(r,this._availableImages),!x.isHidden(r.zoom)){const T=this.getLayerSourceCache(x);T&&(T.used=!0,T.tileCoverLift=Math.max(T.tileCoverLift,x.tileCoverLift()))}if(!this._precompileDone&&this._shouldPrecompile)for(let T=x.minzoom||0;T<(x.maxzoom||25.5);T++){const S=this.map.painter;if(S){const I=x.getProgramIds();if(!I)continue;for(const C of I){const L=x.getDefaultProgramParams(C,r.zoom);L&&(S.style=this,this.fog&&(S._fogVisible=!0,L.overrideFog=!0,S.getOrCreateProgram(C,L)),S._fogVisible=!1,L.overrideFog=!1,S.getOrCreateProgram(C,L),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(L.overrideRtt=!0,S.getOrCreateProgram(C,L)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const _ in p){const x=this._mergedSourceCaches[_];p[_]!==x.used&&x.getSource().fire(new o.b("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new o.b("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=this._changes.getUpdatedImages();if(r.length){for(const s in this._sourceCaches)this._sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],r);this._changes.resetUpdatedImages()}}_updateWorkerLayers(r,s,h){const p=this.getFragmentStyle(r);p&&this.dispatcher.broadcast("updateLayers",{layers:s?p._serializeLayers(s):[],scope:r,removedIds:h||[],options:p.options})}setState(r){if(this._checkLoaded(),Ro(this,Ht(r)))return!1;(r=o.c1(r)).layers=Jf(r.layers);const s=function(p,_){if(!p)return[{command:zi.setStyle,args:[_]}];let x=[];try{if(!Y(p.version,_.version))return[{command:zi.setStyle,args:[_]}];Y(p.center,_.center)||x.push({command:zi.setCenter,args:[_.center]}),Y(p.zoom,_.zoom)||x.push({command:zi.setZoom,args:[_.zoom]}),Y(p.bearing,_.bearing)||x.push({command:zi.setBearing,args:[_.bearing]}),Y(p.pitch,_.pitch)||x.push({command:zi.setPitch,args:[_.pitch]}),Y(p.sprite,_.sprite)||x.push({command:zi.setSprite,args:[_.sprite]}),Y(p.glyphs,_.glyphs)||x.push({command:zi.setGlyphs,args:[_.glyphs]}),Y(p.imports,_.imports)||function(L=[],k=[],B){k=k||[];const j=(L=L||[]).map(Mo),U=k.map(Mo),$=L.reduce(tu,{}),N=k.reduce(tu,{}),H=j.slice();let ee,X,te,q;for(ee=0,X=0;ee<j.length;ee++)te=j[ee],N.hasOwnProperty(te)?X++:(B.push({command:zi.removeImport,args:[te]}),H.splice(H.indexOf(te,X),1));for(ee=0,X=0;ee<U.length;ee++)te=U[U.length-1-ee],H[H.length-1-ee]!==te&&($.hasOwnProperty(te)?(B.push({command:zi.removeImport,args:[te]}),H.splice(H.lastIndexOf(te,H.length-X),1)):X++,q=H[H.length-ee],B.push({command:zi.addImport,args:[N[te],q]}),H.splice(H.length-ee,0,te));for(const re of k){const ae=$[re.id];ae&&!Y(ae,re)&&B.push({command:zi.updateImport,args:[re.id,re]})}}(p.imports,_.imports,x),Y(p.transition,_.transition)||x.push({command:zi.setTransition,args:[_.transition]}),Y(p.light,_.light)||x.push({command:zi.setLight,args:[_.light]}),Y(p.fog,_.fog)||x.push({command:zi.setFog,args:[_.fog]}),Y(p.projection,_.projection)||x.push({command:zi.setProjection,args:[_.projection]}),Y(p.lights,_.lights)||x.push({command:zi.setLights,args:[_.lights]}),Y(p.camera,_.camera)||x.push({command:zi.setCamera,args:[_.camera]});const T={},S=[];(function(L,k,B,j){let U;for(U in k=k||{},L=L||{})L.hasOwnProperty(U)&&(k.hasOwnProperty(U)||Mh(U,B,j));for(U in k){if(!k.hasOwnProperty(U))continue;const $=k[U];L.hasOwnProperty(U)?Y(L[U],$)||(L[U].type==="geojson"&&$.type==="geojson"&&V_(L,k,U)?B.push({command:zi.setGeoJSONSourceData,args:[U,$.data]}):N_(U,k,B,j)):Fl(U,k,B)}})(p.sources,_.sources,S,T);const I=[];p.layers&&p.layers.forEach(L=>{L.source&&T[L.source]?x.push({command:zi.removeLayer,args:[L.id]}):I.push(L)});let C=p.terrain;C&&T[C.source]&&(x.push({command:zi.setTerrain,args:[void 0]}),C=void 0),x=x.concat(S),Y(C,_.terrain)||x.push({command:zi.setTerrain,args:[_.terrain]}),function(L,k,B){k=k||[];const j=(L=L||[]).map(Mo),U=k.map(Mo),$=L.reduce(tu,{}),N=k.reduce(tu,{}),H=j.slice(),ee=Object.create(null);let X,te,q,re,ae,ue,me;for(X=0,te=0;X<j.length;X++)q=j[X],N.hasOwnProperty(q)?te++:(B.push({command:zi.removeLayer,args:[q]}),H.splice(H.indexOf(q,te),1));for(X=0,te=0;X<U.length;X++)q=U[U.length-1-X],H[H.length-1-X]!==q&&($.hasOwnProperty(q)?(B.push({command:zi.removeLayer,args:[q]}),H.splice(H.lastIndexOf(q,H.length-te),1)):te++,ue=H[H.length-X],B.push({command:zi.addLayer,args:[N[q],ue]}),H.splice(H.length-X,0,q),ee[q]=!0);for(X=0;X<U.length;X++)if(q=U[X],re=$[q],ae=N[q],!ee[q]&&!Y(re,ae))if(Y(re.source,ae.source)&&Y(re["source-layer"],ae["source-layer"])&&Y(re.type,ae.type)){for(me in So(re.layout,ae.layout,B,q,null,zi.setLayoutProperty),So(re.paint,ae.paint,B,q,null,zi.setPaintProperty),Y(re.slot,ae.slot)||B.push({command:zi.setSlot,args:[q,ae.slot]}),Y(re.filter,ae.filter)||B.push({command:zi.setFilter,args:[q,ae.filter]}),Y(re.minzoom,ae.minzoom)&&Y(re.maxzoom,ae.maxzoom)||B.push({command:zi.setLayerZoomRange,args:[q,ae.minzoom,ae.maxzoom]}),re)re.hasOwnProperty(me)&&me!=="layout"&&me!=="paint"&&me!=="filter"&&me!=="metadata"&&me!=="minzoom"&&me!=="maxzoom"&&me!=="slot"&&(me.indexOf("paint.")===0?So(re[me],ae[me],B,q,me.slice(6),zi.setPaintProperty):Y(re[me],ae[me])||B.push({command:zi.setLayerProperty,args:[q,me,ae[me]]}));for(me in ae)ae.hasOwnProperty(me)&&!re.hasOwnProperty(me)&&me!=="layout"&&me!=="paint"&&me!=="filter"&&me!=="metadata"&&me!=="minzoom"&&me!=="maxzoom"&&me!=="slot"&&(me.indexOf("paint.")===0?So(re[me],ae[me],B,q,me.slice(6),zi.setPaintProperty):Y(re[me],ae[me])||B.push({command:zi.setLayerProperty,args:[q,me,ae[me]]}))}else B.push({command:zi.removeLayer,args:[q]}),ue=H[H.lastIndexOf(q)+1],B.push({command:zi.addLayer,args:[ae,ue]})}(I,_.layers,x)}catch(T){console.warn("Unable to compute style diff:",T),x=[{command:zi.setStyle,args:[_]}]}return x}(this.serialize(),r).filter(p=>!(p.command in Fa));if(s.length===0)return!1;const h=s.filter(p=>!(p.command in op));if(h.length>0)throw new Error(`Unimplemented: ${h.map(p=>p.command).join(", ")}.`);return s.forEach(p=>{this[p.command].apply(this,p.args)}),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(r,s){return this.getImage(r)?this.fire(new o.a(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,this.scope,s),this._afterImageUpdated(r),this)}updateImage(r,s){this.imageManager.updateImage(r,this.scope,s)}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._afterImageUpdated(r),this):this.fire(new o.a(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(r),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new o.b("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(r,s,h={}){return this._checkLoaded(),this._validate(Pt,`models.${r}`,s,null,h)||(this.modelManager.addModel(r,s,this.scope),this._changes.setDirty()),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope),this):this.fire(new o.a(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,s,h={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(oi,`sources.${r}`,s,null,h))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const p=on(r,s,this.dispatcher,this);p.scope=this.scope,p.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(p.id),source:p.serialize(),sourceId:p.id}));const _=x=>{const T=(x?"symbol:":"other:")+p.id,S=o.ag(T,this.scope),I=this._sourceCaches[T]=new Ss(S,p,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[p.id]=I,I.onAdd(this.map)};_(!1),s.type!=="vector"&&s.type!=="geojson"||_(!0),p.onAdd&&p.onAdd(this.map),h.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const s=this.getOwnSource(r);if(!s)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===r)return this.fire(new o.a(new Error(`Source "${r}" cannot be removed while layer "${p}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new o.a(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const h=this.getOwnSourceCaches(r);for(const p of h){const _=o.c3(p.id);delete this._sourceCaches[_],this._changes.discardSourceCacheUpdate(p.id),p.fire(new o.b("data",{sourceDataType:"metadata",dataType:"source",sourceId:p.getSource().id})),p.setEventedParent(null),p.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),s.setEventedParent(null),s.onRemove&&s.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,s){this._checkLoaded(),this.getOwnSource(r).setData(s),this._changes.setDirty()}getOwnSource(r){const s=this.getOwnSourceCache(r);return s&&s.getSource()}getOwnSources(){const r=[];for(const s in this._otherSourceCaches){const h=this.getOwnSourceCache(s);h&&r.push(h.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const s in r){const h=r[s]._tiles;for(const p in h){const _=h[p];if(_.state!=="loaded"&&_.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const s=this._getTransitionParameters();for(const p of r){if(this._validate(Se,"lights",p))return;switch(p.type){case"ambient":if(this.ambientLight){const _=this.ambientLight;_.set(p),_.updateTransitions(s)}else this.ambientLight=new On(p,Zn,this.scope,this.options);break;case"directional":if(this.directionalLight){const _=this.directionalLight;_.set(p),_.updateTransitions(s)}else this.directionalLight=new On(p,rn,this.scope,this.options)}}const h=new o.K(this.z||0,s);this.ambientLight&&this.ambientLight.recalculate(h),this.directionalLight&&this.directionalLight.recalculate(h),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,s=this.ambientLight;if(!r||!s)return;const h=L=>.2126*(L[0]<=.03928?L[0]/12.92:Math.pow((L[0]+.055)/1.055,2.4))+.7152*(L[1]<=.03928?L[1]/12.92:Math.pow((L[1]+.055)/1.055,2.4))+.0722*(L[2]<=.03928?L[2]/12.92:Math.pow((L[2]+.055)/1.055,2.4)),p=r.properties.get("color").toArray01(),_=r.properties.get("intensity"),x=r.properties.get("direction"),T=1-o.bQ(x.x,x.y,x.z)[2]/90,S=h(p)*_*T,I=s.properties.get("color").toArray01(),C=s.properties.get("intensity");return(S+h(I)*C)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(!r)return this;if(o.c4(r)){const s=o.c5(r),h=this.fragments.find(({id:_})=>_===s);if(!h)throw new Error(`Style import not found: ${r}`);const p=o.c3(r);return h.style.getFragmentStyle(p)}{const s=this.fragments.find(({id:h})=>h===r);if(!s)throw new Error(`Style import not found: ${r}`);return s.style}}getConfigProperty(r,s){const h=this.getFragmentStyle(r);if(!h)return null;const p=o.ag(s,h.scope),_=h.options.get(p),x=_?_.value||_.default:null;return x?x.serialize():null}setConfigProperty(r,s,h){const p=o.r(h);if(p.result!=="success")return void Ro(this,p.value);const _=p.value.expression,x=this.getFragmentStyle(r);if(!x)return;const T=o.ag(s,x.scope),S=x.options.get(T);S&&(this.options.set(T,{...S,value:_}),this.updateConfigDependencies())}setConfig(r,s){if(this._config=r,r||s)if(s)for(const h in s){let p,_;const x=o.r(s[h].default);if(x.result==="success"&&(p=x.value.expression),r&&r[h]!==void 0){const k=o.r(r[h]);k.result==="success"&&(_=k.value.expression)}const{minValue:T,maxValue:S,stepValue:I,type:C,values:L}=s[h];if(p){const k=o.ag(h,this.scope);this.options.set(k,{default:p,value:_,minValue:T,maxValue:S,stepValue:I,type:C,values:L})}else this.fire(new o.a(new Error(`No schema defined for config option "${h}".`)))}else this.fire(new o.a(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const r of this._configDependentLayers){const s=this.getLayer(r);s&&(s.possiblyEvaluateVisibility(),this._updateLayer(s))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this._changes.setDirty()}addLayer(r,s,h={}){this._checkLoaded();const p=r.id;if(this._layers[p])return void this.fire(new o.a(new Error(`Layer with id "${p}" already exists on this map`)));let _;if(r.type==="custom"){if(Ro(this,o.c6(r)))return;_=o.c2(r,this.scope,this.options)}else{if(typeof r.source=="object"&&(this.addSource(p,r.source),r=o.c1(r),r=o.e(r,{source:p})),this._validate(le,`layers.${p}`,r,{arrayIndex:-1},h))return;_=o.c2(r,this.scope,this.options),this._validateLayer(_),_.setEventedParent(this,{layer:{id:p}}),this._serializedLayers[_.id]=_.serialize()}_.isConfigDependent&&this._configDependentLayers.add(_.fqid);let x=this._order.length;if(s){const C=this._order.indexOf(s);if(C===-1)return void this.fire(new o.a(new Error(`Layer with id "${s}" does not exist on this map.`)));_.slot===this._layers[s].slot?x=C:o.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,p),this._layerOrderChanged=!0,this._layers[p]=_;const T=this.getOwnLayerSourceCache(_),S=!!this.directionalLight&&this.directionalLight.shadowsEnabled();T&&_.canCastShadows()&&S&&(T.castsShadows=!0);const I=this._changes.getRemovedLayer(_);if(I&&_.source&&T&&_.type!=="custom"){this._changes.discardLayerRemoval(_);const C=o.ag(_.source,_.scope);I.type!==_.type?this._changes.updateSourceCache(C,"clear"):(this._changes.updateSourceCache(C,"reload"),T.pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map),_.scope=this.scope,this.mergeLayers()}moveLayer(r,s){this._checkLoaded();const h=this._checkLayer(r);if(!h||r===s)return;const p=this._order.indexOf(r);this._order.splice(p,1);let _=this._order.length;if(s){const x=this._order.indexOf(s);if(x===-1)return void this.fire(new o.a(new Error(`Layer with id "${s}" does not exist on this map.`)));h.slot===this._layers[s].slot?_=x:o.w(`Layer with id "${s}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(_,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const s=this._checkLayer(r);if(!s)return;s.setEventedParent(null);const h=this._order.indexOf(r);this._order.splice(h,1),delete this._layers[r],delete this._serializedLayers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(s.fqid),this._changes.removeLayer(s);const p=this.getOwnLayerSourceCache(s);if(p&&p.castsShadows){let _=!1;for(const x in this._layers)if(this._layers[x].source===s.source&&this._layers[x].canCastShadows()){_=!0;break}p.castsShadows=_}s.onRemove&&s.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const s in this._layers)if(this._layers[s].type===r)return!0;return!1}setLayerZoomRange(r,s,h){this._checkLoaded();const p=this._checkLayer(r);p&&(p.minzoom===s&&p.maxzoom===h||(s!=null&&(p.minzoom=s),h!=null&&(p.maxzoom=h),this._updateLayer(p)))}setSlot(r,s){this._checkLoaded();const h=this._checkLayer(r);h&&h.slot!==s&&(h.slot=s,this._updateLayer(h))}setFilter(r,s,h={}){this._checkLoaded();const p=this._checkLayer(r);if(p&&!Y(p.filter,s))return s==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(Re,`layers.${p.id}.filter`,s,{layerType:p.type},h)||(p.filter=o.c1(s),this._updateLayer(p)))}getFilter(r){const s=this._checkLayer(r);if(s)return o.c1(s.filter)}setLayoutProperty(r,s,h,p={}){this._checkLoaded();const _=this._checkLayer(r);if(_&&!Y(_.getLayoutProperty(s),h)){if(h!=null&&(!p||p.validate!==!1)&&Ro(_,Qe.call(Ht,{key:`layers.${r}.layout.${s}`,layerType:_.type,objectKey:s,value:h,styleSpec:o.D,style:{glyphs:!0,sprite:!0}})))return;_.setLayoutProperty(s,h),_.isConfigDependent&&this._configDependentLayers.add(_.fqid),this._updateLayer(_)}}getLayoutProperty(r,s){const h=this._checkLayer(r);if(h)return h.getLayoutProperty(s)}setPaintProperty(r,s,h,p={}){this._checkLoaded();const _=this._checkLayer(r);if(!_||Y(_.getPaintProperty(s),h)||h!=null&&(!p||p.validate!==!1)&&Ro(_,Ne.call(Ht,{key:`layers.${r}.paint.${s}`,layerType:_.type,objectKey:s,value:h,styleSpec:o.D})))return;const x=_.setPaintProperty(s,h);_.isConfigDependent&&this._configDependentLayers.add(_.fqid),x&&this._updateLayer(_),this._changes.updatePaintProperties(_)}getPaintProperty(r,s){const h=this._checkLayer(r);if(h)return h.getPaintProperty(s)}setFeatureState(r,s){this._checkLoaded();const h=r.source,p=r.sourceLayer,_=this._checkSource(h);if(!_)return;const x=_.type;if(x==="geojson"&&p)return void this.fire(new o.a(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!p)return void this.fire(new o.a(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.a(new Error("The feature id parameter must be provided.")));const T=this.getOwnSourceCaches(h);for(const S of T)S.setFeatureState(p,r.id,s)}removeFeatureState(r,s){this._checkLoaded();const h=r.source,p=this._checkSource(h);if(!p)return;const _=p.type,x=_==="vector"?r.sourceLayer:void 0;if(_==="vector"&&!x)return void this.fire(new o.a(new Error("The sourceLayer parameter must be provided for vector source types.")));if(s&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.a(new Error("A feature id is required to remove its specific state property.")));const T=this.getOwnSourceCaches(h);for(const S of T)S.removeFeatureState(x,r.id,s)}getFeatureState(r){this._checkLoaded();const s=r.source,h=r.sourceLayer,p=this._checkSource(s);if(p){if(p.type!=="vector"||h)return r.id===void 0&&this.fire(new o.a(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(s)[0].getFeatureState(h,r.id);this.fire(new o.a(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=o.e({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return o.e({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),s=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return o.c7({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:s,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},h=>h!==void 0)}_updateLayer(r){this._changes.updateLayer(r);const s=this.getLayerSourceCache(r),h=o.ag(r.source,r.scope),p=this._changes.getUpdatedSourceCaches();r.source&&!p[h]&&s&&s.getSource().type!=="raster"&&(this._changes.updateSourceCache(h,"reload"),s.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const s=T=>this._mergedLayers[T].type==="fill-extrusion"||this._mergedLayers[T].type==="model",h=this.order,p={},_=[];for(let T=h.length-1;T>=0;T--){const S=h[T];if(s(S)){p[S]=T;for(const I of r){const C=I[S];if(C)for(const L of C)_.push(L)}}}_.sort((T,S)=>S.intersectionZ-T.intersectionZ);const x=[];for(let T=h.length-1;T>=0;T--){const S=h[T];if(s(S))for(let I=_.length-1;I>=0;I--){const C=_[I].feature;if(p[C.layer.id]<T)break;x.push(C),_.pop()}else for(const I of r){const C=I[S];if(C)for(const L of C)x.push(L.feature)}}return x}queryRenderedFeatures(r,s,h){s&&s.filter&&this._validate(Re,"queryRenderedFeatures.filter",s.filter,null,s),s.scope=this.scope,s.availableImages=this._availableImages,s.serializedLayers=this._serializedLayers;const p={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new o.a(new Error("parameters.layers must be an Array."))),[];for(const I of s.layers){const C=this._mergedLayers[I];if(!C)return this.fire(new o.a(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];p[C.source]=!0}}const _=[],x=s.serializedLayers||{},T=s&&s.layers?s.layers.some(I=>{const C=this.getLayer(I);return C&&C.is3D()}):this.has3DLayers(),S=Yr.createFromScreenPoints(r,h);for(const I in this._mergedSourceCaches){const C=this._mergedSourceCaches[I].getSource();if(!C||C.scope!==s.scope)continue;const L=this._mergedSourceCaches[I].getSource().id;s.layers&&!p[L]||_.push(Sh(this._mergedSourceCaches[I],this._mergedLayers,x,S,s,h,T,!!this.map._showQueryGeometry))}return this.placement&&_.push(function(I,C,L,k,B,j,U){const $={},N=j.queryRenderedSymbols(k),H=[];for(const ee of Object.keys(N).map(Number))H.push(U[ee]);H.sort(Ra);for(const ee of H){const X=ee.featureIndex.lookupSymbolFeatures(N[ee.bucketInstanceId],C,ee.bucketIndex,ee.sourceLayerIndex,B.filter,B.layers,B.availableImages,I);for(const te in X){const q=$[te]=$[te]||[],re=X[te];re.sort((ae,ue)=>{const me=ee.featureSortOrder;if(me){const Me=me.indexOf(ae.featureIndex);return me.indexOf(ue.featureIndex)-Me}return ue.featureIndex-ae.featureIndex});for(const ae of re)q.push(ae)}}for(const ee in $)$[ee].forEach(X=>{const te=X.feature,q=L(I[ee]);if(!q)return;const re=q.getFeatureState(te.layer["source-layer"],te.id);te.source=te.layer.source,te.layer["source-layer"]&&(te.sourceLayer=te.layer["source-layer"]),te.state=re});return $}(this._mergedLayers,x,this.getLayerSourceCache.bind(this),S.screenGeometry,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(r,s){s&&s.filter&&this._validate(Re,"querySourceFeatures.filter",s.filter,null,s);const h=this.getOwnSourceCaches(r);let p=[];for(const _ of h)p=p.concat(Js(_,s));return p}addSourceType(r,s,h){return As.getSourceType(r)?h(new Error(`A source type called "${r}" already exists.`)):(As.setSourceType(r,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:s.workerSourceURL},h):h(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,s,h={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const T in r)if(!Y(r[T],p[T])){_=!0;break}if(!_)return;const x=this._getTransitionParameters();this.light.setLight(r,s,h),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,s=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()&&s!==0||delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let h=r;const p=r.source==null;if(s===1){if(typeof h.source=="object"){const T="terrain-dem-src";this.addSource(T,h.source),h=o.c1(h),h=o.e(h,{source:T})}const _=o.e({},h),x={};if(this.terrain&&p){_.source=this.terrain.get().source;const T=this.terrain?this.getFragmentStyle(this.terrain.scope):null;T&&(x.style=T.serialize())}if(this._validate(Z,"terrain",_,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!p||this.terrain&&s!==this.terrain.drapeRenderMode){if(!h)return;this._createTerrain(h,s),this.fire(new o.b("data",{dataType:"style"}))}else{const _=this.terrain,x=_.get();for(const T of Object.keys(o.D.terrain))!h.hasOwnProperty(T)&&o.D.terrain[T].default&&(h[T]=o.D.terrain[T].default);for(const T in r)if(!Y(r[T],x[T])){_.set(r,this.options),this.stylesheet.terrain=r;const S=this._getTransitionParameters({duration:0});_.updateTransitions(S),this.fire(new o.b("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const s=this.fog=new Vn(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const s=this.fog;if(!Y(s.get(),r)){s.set(r,this.options),this.stylesheet.fog=s.get();const h=this._getTransitionParameters({duration:0});s.updateTransitions(h)}}else this._createFog(r);this._markersNeedUpdate=!0}_getTransitionParameters(r){return{now:o.f.now(),transition:o.e(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],s=[];for(const h in this._mergedLayers)this.isLayerDraped(this._mergedLayers[h])?r.push(h):s.push(h);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...s)}_createTerrain(r,s){const h=this.terrain=new cr(r,s,this.scope,this.options);s===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const p=this._getTransitionParameters({duration:0});h.updateTransitions(p)}_force3DLayerUpdate(){for(const r in this._layers){const s=this._layers[r];s.type==="fill-extrusion"&&this._updateLayer(s)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const s=this._layers[r];s.type==="symbol"&&this._updateLayer(s)}}_validate(r,s,h,p,_={}){if(_&&_.validate===!1)return!1;const x=o.e({},this.serialize());return Ro(this,r.call(Ht,o.e({key:s,style:x,value:h,styleSpec:o.D},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.c8.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(r){const s=this.getSourceCaches(r);for(const h of s)h.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}reloadSource(r){const s=this.getSourceCaches(r);for(const h of s)h.resume(),h.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}updateSources(r){let s;this.directionalLight&&(s=lu(this.directionalLight));for(const h in this._mergedSourceCaches)this._mergedSourceCaches[h].update(r,void 0,void 0,s)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const s=this._sourceCaches[r];s.resume(),s.reload()}}_updatePlacement(r,s,h,p,_=!1){let x=!1,T=!1;const S={},I={};for(const C of this._mergedOrder){const L=this._mergedLayers[C];if(L.type!=="symbol")continue;const k=o.ag(L.source,L.scope);let B=S[k];if(!B){const U=this.getLayerSourceCache(L);if(!U)continue;const $=U.getRenderableIds(!0).map(N=>U.getTileByID(N));I[k]=$.slice(),B=S[k]=$.sort((N,H)=>H.tileID.overscaledZ-N.tileID.overscaledZ||(N.tileID.isLessThan(H.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(L,B,r.center.lng,r.projection);x=x||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),_=_||this._layerOrderChanged||h===0,this._layerOrderChanged&&this.fire(new o.b("neworder")),(_||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.f.now(),r.zoom))&&(this.pauseablePlacement=new su(r,this._mergedOrder,_,s,h,p,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,S,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.f.now()),T=!0),x&&this.pauseablePlacement.placement.setStale()),T||x){this._buildingIndex.onNewFrame(r.zoom);for(const C of this._mergedOrder){const L=this._mergedLayers[C];L.type==="symbol"&&this.placement.updateLayerOpacities(L,S[o.ag(L.source,L.scope)])}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.f.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,s){this._checkLoaded();const h=this.stylesheet.imports=this.stylesheet.imports||[];if(h.findIndex(({id:_})=>_===r.id)!==-1)return this.fire(new o.a(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!s)return h.push(r),this._loadImports([r],!0),this;const p=h.findIndex(({id:_})=>_===s);return p===-1?this.fire(new o.a(new Error(`Import with id "${s}" does not exist on this map.`))):(this.stylesheet.imports=h.slice(0,p).concat(r).concat(h.slice(p)),this._loadImports([r],!0,s),this)}updateImport(r,s){this._checkLoaded();const h=this.stylesheet.imports||[],p=this.getImportIndex(r);return p===-1?this:typeof s=="string"?(this.setImportUrl(r,s),this):(s.url&&s.url!==h[p].url&&this.setImportUrl(r,s.url),Y(s.config,h[p].config)||this.setImportConfig(r,s.config),Y(s.data,h[p].data)||this.setImportData(r,s.data),this)}moveImport(r,s){this._checkLoaded();let h=this.stylesheet.imports||[];const p=this.getImportIndex(r);if(p===-1)return this;const _=this.getImportIndex(s);if(_===-1)return this;const x=h[p],T=this.fragments[p];return h=h.filter(({id:S})=>S!==r),this.fragments=this.fragments.filter(({id:S})=>S!==r),this.stylesheet.imports=h.slice(0,_).concat(x).concat(h.slice(_)),this.fragments=this.fragments.slice(0,_).concat(T).concat(this.fragments.slice(_)),this.mergeLayers(),this}setImportUrl(r,s){this._checkLoaded();const h=this.stylesheet.imports||[],p=this.getImportIndex(r);if(p===-1)return this;h[p].url=s;const _=this.fragments[p];return _.style=this._createFragmentStyle(h[p]),_.style.on("style.import.load",()=>this.mergeAll()),_.style.loadURL(s),this}setImportData(r,s){this._checkLoaded();const h=this.getImportIndex(r),p=this.stylesheet.imports||[];return h===-1?this:s?(this.fragments[h].style.setState(s),this._reloadImports(),this):(delete p[h].data,this.setImportUrl(r,p[h].url))}setImportConfig(r,s){this._checkLoaded();const h=this.getImportIndex(r),p=this.stylesheet.imports||[];if(h===-1)return this;s?p[h].config=s:delete p[h].config;const _=this.fragments[h],x=_.style.stylesheet&&_.style.stylesheet.schema;return _.config=s,_.style.setConfig(s,x),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const s=this.stylesheet.imports||[],h=this.getImportIndex(r);return h===-1||(s.splice(h,1),this.fragments[h].style._remove(),this.fragments.splice(h,1),this._reloadImports()),this}getImportIndex(r){const s=(this.stylesheet.imports||[]).findIndex(h=>h.id===r);return s===-1&&this.fire(new o.a(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),s}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const s in this._mergedOtherSourceCaches){const h=this._mergedOtherSourceCaches[s];h&&r.push(h.getSource())}return r}getSource(r,s){const h=this.getSourceCache(r,s);return h&&h.getSource()}getLayerSource(r){const s=this.getLayerSourceCache(r);return s&&s.getSource()}getSourceCache(r,s){const h=o.ag(r,s);return this._mergedOtherSourceCaches[h]}getLayerSourceCache(r){const s=o.ag(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[s]:this._mergedOtherSourceCaches[s]}getSourceCaches(r){const s=[];return this._mergedOtherSourceCaches[r]&&s.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&s.push(this._mergedSymbolSourceCaches[r]),s}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const s in r){const h=r[s];h==="reload"?this.reloadSource(s):h==="clear"&&this.clearSource(s)}}updateLayers(r){const s=this._changes.getUpdatedPaintProperties();for(const h of s){const p=this.getLayer(h);p&&p.updateTransitions(r)}}getImages(r,s,h){this.imageManager.getImages(s.icons,s.scope,h),this._updateTilesForChangedImages();const p=_=>{_&&_.setDependencies(s.tileID.key,s.type,s.icons)};p(this._otherSourceCaches[s.source]),p(this._symbolSourceCaches[s.source])}getGlyphs(r,s,h){this.glyphManager.getGlyphs(s.stacks,s.scope,h)}getResource(r,s,h){return o.c9(s,h)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const s=[];return this._otherSourceCaches[r]&&s.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&s.push(this._symbolSourceCaches[r]),s}_isSourceCacheLoaded(r){const s=this.getOwnSourceCaches(r);return s.length===0?(this.fire(new o.a(new Error(`There is no source with ID '${r}'`))),!1):s.every(h=>h.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}As.getSourceType=function(u){return Ys[u]},As.setSourceType=function(u,r){Ys[u]=r},As.registerForPluginStateChange=o.bV;var cu=`
-#define EPSILON 0.0000001
-#define PI 3.141592653589793
-#ifdef RENDER_CUTOFF
-float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
-#endif`,uu=`
-out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
-{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
-#ifdef INDICATOR_CUTOUT
-uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
-#endif
-vec4 applyCutout(vec4 color) {
-#ifdef INDICATOR_CUTOUT
-float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
-#else
-return color;
-#endif
-}
-#ifdef DEBUG_WIREFRAME
-#define HANDLE_WIREFRAME_DEBUG \\
-glFragColor=vec4(0.7,0.0,0.0,0.7); \\
-gl_FragDepth=gl_FragCoord.z-0.0001;
-#else
-#define HANDLE_WIREFRAME_DEBUG
-#endif
-#ifdef RENDER_CUTOFF
-uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
-#endif
-vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,hu=`
-#define EXTENT 8192.0
-#define RAD_TO_DEG 180.0/PI
-#define DEG_TO_RAD PI/180.0
-#define GLOBE_RADIUS EXTENT/PI/2.0
-float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
-#ifdef PROJECTION_GLOBE_VIEW
-vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
-#ifndef PROJECTED_POS_ON_VIEWPORT
-float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
-#else
-return vec3(0.0);
-#endif
-}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
-#endif
-vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
-unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
-);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
-#ifdef RENDER_CUTOFF
-uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
-#endif
-const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
-{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,du="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Wh=`
-#define ELEVATION_SCALE 7.0
-#define ELEVATION_OFFSET 450.0
-#ifdef PROJECTION_GLOBE_VIEW
-uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
-mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
-#else
-vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
-#endif
-#ifdef TERRAIN
-uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
-#ifdef TERRAIN_DEM_FLOAT_FORMAT
-vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
-#else
-float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
-#endif
-}float prevElevation(vec2 apos) {
-#ifdef TERRAIN_DEM_FLOAT_FORMAT
-vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
-#else
-float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
-#endif
-}
-#ifdef TERRAIN_VERTEX_MORPHING
-float elevation(vec2 apos) {
-#ifdef ZERO_EXAGGERATION
-return 0.0;
-#endif
-float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
-#else
-float elevation(vec2 apos) {
-#ifdef ZERO_EXAGGERATION
-return 0.0;
-#endif
-return currentElevation(apos);}
-#endif
-highp float unpack_depth(highp vec4 rgba_depth)
-{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
-unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
-);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
-#else
-float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
-#endif`,Xh=`#ifdef FOG
-uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
-#endif`,lp=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
-#ifdef FOG
-uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
-mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
-#ifdef FOG_DITHERING
-vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
-#else
-return color;
-#endif
-}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
-#endif`,Na=`#ifdef RASTER_ARRAY
-uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
-);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
-);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
-#endif`,Va=`#ifdef RASTER_ARRAY
-uniform sampler2D u_velocity;uniform vec2 u_velocity_res;uniform float u_max_speed;const vec2 INVALID_VELOCITY=vec2(-1);uniform vec2 u_texture_offset;uniform float u_data_offset;uniform vec4 u_data_scale;vec2 lookup_velocity(vec2 uv) {uv=u_texture_offset.x+u_texture_offset.y*uv;vec2 fxy;ivec4 c=_raTexLinearCoord(uv,u_velocity_res,fxy);vec4 tl=texelFetch(u_velocity,c.yz,0);vec4 tr=texelFetch(u_velocity,c.xz,0);vec4 bl=texelFetch(u_velocity,c.yw,0);vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NODATA) {return INVALID_VELOCITY;}if (tr==NODATA) {return INVALID_VELOCITY;}if (bl==NODATA) {return INVALID_VELOCITY;}if (br==NODATA) {return INVALID_VELOCITY;}vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);
-#ifdef DATA_FORMAT_UINT32
-vec2 velocity=vec2(u_data_offset+dot(t,u_data_scale),0);return velocity;
-#else
-vec2 velocity=vec2(u_data_offset+dot(t.rg,u_data_scale.yx),-(u_data_offset+dot(t.ba,u_data_scale.yx)));
-#endif
-return velocity/max(u_max_speed,length(velocity));}
-#endif`,Kh=`#ifdef RENDER_SHADOWS
-uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
-#endif//RENDER_SHADOWS`,Wl=`#ifdef RENDER_SHADOWS
-#ifdef DEPTH_TEXTURE
-uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
-#else
-uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
-#endif
-uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
-#ifdef DEPTH_TEXTURE
-shadow_depth=texture(u_shadowmap_1,uv).r;
-#else
-shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
-#endif
-return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
-#ifdef DEPTH_TEXTURE
-shadow_depth=texture(u_shadowmap_0,uv).r;
-#else
-shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
-#endif
-return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
-#ifdef NATIVE
-highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
-#else
-highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
-shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
-);
-#endif
-vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
-#ifdef SHADOWS_SINGLE_CASCADE
-light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
-#else
-light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
-#endif
-}highp float calculate_shadow_bias(float NDotL) {
-#ifdef NORMAL_OFFSET
-return 0.5*u_shadow_bias.x;
-#else
-return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
-#endif
-}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
-#endif`;const Ua=[];Lo(cu,Ua),Lo(hu,Ua),Lo(uu,Ua);const os={"_prelude_fog.vertex.glsl":Xh,"_prelude_terrain.vertex.glsl":Wh,"_prelude_shadow.vertex.glsl":Kh,"_prelude_fog.fragment.glsl":lp,"_prelude_shadow.fragment.glsl":Wl,"_prelude_lighting.glsl":`
-#ifdef LIGHTING_3D_MODE
-uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
-#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Na,"_prelude_raster_particle.glsl":Va},ja={};Ui("",Wh),Ui(lp,Xh),Ui(Wl,Kh),Ui(Na,""),Ui(Va,"");const Yh=Ui(uu,hu),fu=cu;var Jh={background:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_lighting.glsl"
-uniform vec4 u_color;uniform float u_opacity;
-#ifdef LIGHTING_3D_MODE
-in vec4 v_color;
-#endif
-void main() {vec4 out_color;
-#ifdef LIGHTING_3D_MODE
-out_color=v_color;
-#else
-out_color=u_color;
-#endif
-#ifdef FOG
-out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
-#endif
-glFragColor=out_color*u_opacity;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-#include "_prelude_lighting.glsl"
-in vec2 a_pos;uniform mat4 u_matrix;
-#ifdef LIGHTING_3D_MODE
-uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
-#endif
-void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
-#ifdef LIGHTING_3D_MODE
-v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
-#endif
-#ifdef FOG
-v_fog_pos=fog_position(a_pos);
-#endif
-}`),backgroundPattern:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_lighting.glsl"
-uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
-#ifdef LIGHTING_3D_MODE
-out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
-#endif
-#ifdef FOG
-out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
-#endif
-glFragColor=out_color*u_opacity;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
-#ifdef FOG
-v_fog_pos=fog_position(a_pos);
-#endif
-}`),circle:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_lighting.glsl"
-in vec3 v_data;in float v_visibility;
-#pragma mapbox: define highp vec4 color
-#pragma mapbox: define mediump float radius
-#pragma mapbox: define lowp float blur
-#pragma mapbox: define lowp float opacity
-#pragma mapbox: define highp vec4 stroke_color
-#pragma mapbox: define mediump float stroke_width
-#pragma mapbox: define lowp float stroke_opacity
-uniform float u_emissive_strength;void main() {
-#pragma mapbox: initialize highp vec4 color
-#pragma mapbox: initialize mediump float radius
-#pragma mapbox: initialize lowp float blur
-#pragma mapbox: initialize lowp float opacity
-#pragma mapbox: initialize highp vec4 stroke_color
-#pragma mapbox: initialize mediump float stroke_width
-#pragma mapbox: initialize lowp float stroke_opacity
-vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
-antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
-);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
-#ifdef LIGHTING_3D_MODE
-out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
-#endif
-#ifdef FOG
-out_color=fog_apply_premultiplied(out_color,v_fog_pos);
-#endif
-glFragColor=out_color*(v_visibility*opacity_t);
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-}`,`#include "_prelude_fog.vertex.glsl"
-#include "_prelude_terrain.vertex.glsl"
-#define NUM_VISIBILITY_RINGS 2
-#define INV_SQRT2 0.70710678
-#define ELEVATION_BIAS 0.0001
-#define NUM_SAMPLES_PER_RING 16
-uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
-#ifdef PROJECTION_GLOBE_VIEW
-in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
-#endif
-out vec3 v_data;out float v_visibility;
-#pragma mapbox: define highp vec4 color
-#pragma mapbox: define mediump float radius
-#pragma mapbox: define lowp float blur
-#pragma mapbox: define lowp float opacity
-#pragma mapbox: define highp vec4 stroke_color
-#pragma mapbox: define mediump float stroke_width
-#pragma mapbox: define lowp float stroke_opacity
-vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
-#if defined(TERRAIN)
-return elevation(pos)+ELEVATION_BIAS;
-#else
-return 0.0;
-#endif
-}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
-#ifdef PITCH_WITH_MAP
-#ifdef PROJECTION_GLOBE_VIEW
-return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
-#else
-return u_matrix*( world_center+vec4(sample_offset,0,0) );
-#endif
-#else
-return projected_center+vec4(sample_offset,0,0);
-#endif
-}float get_sample_step() {
-#ifdef PITCH_WITH_MAP
-return 2.0*PI/float(NUM_SAMPLES_PER_RING);
-#else
-return PI/float(NUM_SAMPLES_PER_RING);
-#endif
-}void main(void) {
-#pragma mapbox: initialize highp vec4 color
-#pragma mapbox: initialize mediump float radius
-#pragma mapbox: initialize lowp float blur
-#pragma mapbox: initialize lowp float opacity
-#pragma mapbox: initialize highp vec4 stroke_color
-#pragma mapbox: initialize mediump float stroke_width
-#pragma mapbox: initialize lowp float stroke_opacity
-vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
-#ifdef PROJECTION_GLOBE_VIEW
-vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
-#else 
-surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
-#endif
-vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
-#ifdef PITCH_WITH_MAP
-#ifdef SCALE_WITH_MAP
-view_scale=1.0;
-#else
-view_scale=projected_center.w/u_camera_to_center_distance;
-#endif
-#else
-#ifdef SCALE_WITH_MAP
-view_scale=u_camera_to_center_distance;
-#else
-view_scale=projected_center.w;
-#endif
-#endif
-gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
-#ifdef TERRAIN
-float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
-#ifdef PITCH_WITH_MAP
-float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
-#else
-occlusion_world_center=world_center;occlusion_projected_center=projected_center;
-#endif
-for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
-#else
-visibility=1.0;
-#endif
-#ifdef PROJECTION_GLOBE_VIEW
-visibility=1.0;
-#endif
-v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
-#ifdef FOG
-v_fog_pos=fog_position(world_center.xyz);
-#endif
-}`),clippingMask:Ui("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ui(`#include "_prelude_fog.fragment.glsl"
-uniform highp float u_intensity;in vec2 v_extrude;
-#pragma mapbox: define highp float weight
-#define GAUSS_COEF 0.3989422804014327
-void main() {
-#pragma mapbox: initialize highp float weight
-float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
-#ifdef FOG
-if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
-#endif
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
-#include "_prelude_fog.vertex.glsl"
-uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
-#ifdef PROJECTION_GLOBE_VIEW
-in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
-#endif
-out vec2 v_extrude;
-#pragma mapbox: define highp float weight
-#pragma mapbox: define mediump float radius
-const highp float ZERO=1.0/255.0/16.0;
-#define GAUSS_COEF 0.3989422804014327
-void main(void) {
-#pragma mapbox: initialize highp float weight
-#pragma mapbox: initialize mediump float radius
-vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
-#ifdef PROJECTION_GLOBE_VIEW
-vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
-#else
-pos=vec3(tilePos+extrude,elevation(tilePos));
-#endif
-gl_Position=u_matrix*vec4(pos,1);
-#ifdef FOG
-v_fog_pos=fog_position(pos);
-#endif
-}`),heatmapTexture:Ui(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(0.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ui("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
-in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
-0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ui("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
-mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
-0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ui("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
-in vec2 a_pos;
-#ifdef PROJECTION_GLOBE_VIEW
-in vec3 a_pos_3;
-#endif
-out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
-#ifdef PROJECTION_GLOBE_VIEW
-gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
-#else
-gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
-#endif
-}`),fill:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_lighting.glsl"
-#pragma mapbox: define highp vec4 color
-#pragma mapbox: define lowp float opacity
-uniform float u_emissive_strength;void main() {
-#pragma mapbox: initialize highp vec4 color
-#pragma mapbox: initialize lowp float opacity
-vec4 out_color=color;
-#ifdef LIGHTING_3D_MODE
-out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
-#endif
-#ifdef FOG
-out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
-#endif
-glFragColor=out_color*opacity;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-in vec2 a_pos;uniform mat4 u_matrix;
-#pragma mapbox: define highp vec4 color
-#pragma mapbox: define lowp float opacity
-void main() {
-#pragma mapbox: initialize highp vec4 color
-#pragma mapbox: initialize lowp float opacity
-gl_Position=u_matrix*vec4(a_pos,0,1);
-#ifdef FOG
-v_fog_pos=fog_position(a_pos);
-#endif
-}`),fillOutline:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_lighting.glsl"
-in highp vec2 v_pos;uniform float u_emissive_strength;
-#pragma mapbox: define highp vec4 outline_color
-#pragma mapbox: define lowp float opacity
-void main() {
-#pragma mapbox: initialize highp vec4 outline_color
-#pragma mapbox: initialize lowp float opacity
-float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
-#ifdef LIGHTING_3D_MODE
-out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
-#endif
-#ifdef FOG
-out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
-#endif
-glFragColor=out_color*(alpha*opacity);
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
-#pragma mapbox: define highp vec4 outline_color
-#pragma mapbox: define lowp float opacity
-void main() {
-#pragma mapbox: initialize highp vec4 outline_color
-#pragma mapbox: initialize lowp float opacity
-gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
-#ifdef FOG
-v_fog_pos=fog_position(a_pos);
-#endif
-}`),fillOutlinePattern:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_lighting.glsl"
-uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
-#pragma mapbox: define lowp float opacity
-#pragma mapbox: define lowp vec4 pattern
-void main() {
-#pragma mapbox: initialize lowp float opacity
-#pragma mapbox: initialize mediump vec4 pattern
-vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
-#ifdef LIGHTING_3D_MODE
-out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
-#endif
-#ifdef FOG
-out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
-#endif
-glFragColor=out_color*(alpha*opacity);
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
-#pragma mapbox: define lowp float opacity
-#pragma mapbox: define lowp vec4 pattern
-#pragma mapbox: define lowp float pixel_ratio
-void main() {
-#pragma mapbox: initialize lowp float opacity
-#pragma mapbox: initialize mediump vec4 pattern
-#pragma mapbox: initialize lowp float pixel_ratio
-vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
-#ifdef FOG
-v_fog_pos=fog_position(a_pos);
-#endif
-}`),fillPattern:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_lighting.glsl"
-uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
-#pragma mapbox: define lowp float opacity
-#pragma mapbox: define lowp vec4 pattern
-void main() {
-#pragma mapbox: initialize lowp float opacity
-#pragma mapbox: initialize mediump vec4 pattern
-vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
-#ifdef LIGHTING_3D_MODE
-out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
-#endif
-#ifdef FOG
-out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
-#endif
-glFragColor=out_color*opacity;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
-#pragma mapbox: define lowp float opacity
-#pragma mapbox: define lowp vec4 pattern
-#pragma mapbox: define lowp float pixel_ratio
-void main() {
-#pragma mapbox: initialize lowp float opacity
-#pragma mapbox: initialize mediump vec4 pattern
-#pragma mapbox: initialize lowp float pixel_ratio
-vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
-#ifdef FOG
-v_fog_pos=fog_position(a_pos);
-#endif
-}`),fillExtrusion:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_shadow.fragment.glsl"
-#include "_prelude_lighting.glsl"
-in vec4 v_color;in vec4 v_flat;
-#ifdef RENDER_SHADOWS
-in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
-#endif
-uniform lowp float u_opacity;
-#ifdef FAUX_AO
-uniform lowp vec2 u_ao;in vec2 v_ao;
-#endif
-#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
-in vec4 v_roof_color;
-#endif
-#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
-in highp vec3 v_normal;
-#endif
-uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
-#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
-in float v_flood_radius;in float v_has_floodlight;
-#endif
-uniform float u_emissive_strength;in float v_height;void main() {
-#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
-vec3 normal=normalize(v_normal);
-#endif
-float z;vec4 color=v_color;
-#ifdef ZERO_ROOF_RADIUS
-z=float(normal.z > 0.00001);
-#ifdef LIGHTING_3D_MODE
-normal=mix(normal,vec3(0.0,0.0,1.0),z);
-#else
-color=mix(v_color,v_roof_color,z);
-#endif
-#endif
-float h=max(0.0,v_height);float ao_shade=1.0;
-#ifdef FAUX_AO
-float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
-#ifdef ZERO_ROOF_RADIUS
-concave*=(1.0-z);
-#endif
-float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
-#ifdef LIGHTING_3D_MODE
-#ifdef FLOOD_LIGHT
-color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
-#else
-color.rgb*=ao_shade;
-#endif
-#else
-color.rgb*=ao_shade;
-#endif
-#endif
-#ifdef LIGHTING_3D_MODE
-float flood_radiance=0.0;
-#ifdef FLOOD_LIGHT
-flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
-#endif
-#ifdef RENDER_SHADOWS
-#ifdef FLOOD_LIGHT
-float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
-#else
-float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
-#endif
-#else
-color.rgb=apply_lighting(color.rgb,normal);
-#ifdef FLOOD_LIGHT
-color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
-#endif
-#endif
-color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
-#endif
-#ifdef FOG
-color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
-#endif
-#ifdef INDICATOR_CUTOUT
-color=applyCutout(color);
-#endif
-glFragColor=color;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-#include "_prelude_terrain.vertex.glsl"
-#include "_prelude_shadow.vertex.glsl"
-#include "_prelude_lighting.glsl"
-uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
-#ifdef PROJECTION_GLOBE_VIEW
-in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
-#endif
-uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
-#ifdef RENDER_SHADOWS
-uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
-#endif
-#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
-out vec4 v_roof_color;
-#endif
-#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
-out highp vec3 v_normal;
-#endif
-#ifdef FAUX_AO
-uniform lowp vec2 u_ao;out vec2 v_ao;
-#endif
-#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
-out float v_flood_radius;out float v_has_floodlight;
-#endif
-out float v_height;
-#pragma mapbox: define highp float base
-#pragma mapbox: define highp float height
-#pragma mapbox: define highp vec4 color
-#pragma mapbox: define highp float flood_light_wall_radius
-void main() {
-#pragma mapbox: initialize highp float base
-#pragma mapbox: initialize highp float height
-#pragma mapbox: initialize highp vec4 color
-#pragma mapbox: initialize highp float flood_light_wall_radius
-base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
-#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
-v_normal=normal;
-#endif
-base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
-#if defined(HAS_CENTROID) || defined(TERRAIN)
-centroid_pos=a_centroid_pos;
-#endif
-float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
-#ifdef TERRAIN
-bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
-#else
-h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
-#endif
-#ifdef PROJECTION_GLOBE_VIEW
-float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
-#endif
-float cutoff=1.0;vec3 scaled_pos=pos;
-#ifdef RENDER_CUTOFF
-vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
-#endif
-float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
-#ifdef RENDER_SHADOWS
-vec3 shd_pos0=pos;vec3 shd_pos1=pos;
-#ifdef NORMAL_OFFSET
-vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
-#endif
-v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
-#endif
-float NdotL=0.0;float colorvalue=0.0;
-#ifndef LIGHTING_3D_MODE
-colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
-(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
-#endif
-#ifdef FAUX_AO
-float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
-#ifdef TERRAIN
-top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
-#endif
-v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
-#ifdef PROJECTION_GLOBE_VIEW
-top_height+=u_height_lift;
-#endif
-gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
-#endif
-#ifdef LIGHTING_3D_MODE
-#ifdef FLOOD_LIGHT
-float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
-#endif
-v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
-#else
-v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
-#endif
-#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
-float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
-#endif
-#ifdef FOG
-v_fog_pos=fog_position(pos);
-#endif
-}`),fillExtrusionDepth:Ui(`in highp float v_depth;void main() {
-#ifndef DEPTH_TEXTURE
-glFragColor=pack_depth(v_depth);
-#endif
-}`,`#include "_prelude_terrain.vertex.glsl"
-uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
-#pragma mapbox: define highp float base
-#pragma mapbox: define highp float height
-out highp float v_depth;void main() {
-#pragma mapbox: initialize highp float base
-#pragma mapbox: initialize highp float height
-base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
-#if defined(HAS_CENTROID) || defined(TERRAIN)
-centroid_pos=a_centroid_pos;
-#endif
-vec3 pos;
-#ifdef TERRAIN
-bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
-#else
-pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
-#endif
-float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_lighting.glsl"
-uniform vec2 u_texsize;uniform sampler2D u_image;
-#ifdef FAUX_AO
-uniform lowp vec2 u_ao;in vec3 v_ao;
-#endif
-#ifdef LIGHTING_3D_MODE
-in vec3 v_normal;
-#endif
-in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
-#pragma mapbox: define highp float base
-#pragma mapbox: define highp float height
-#pragma mapbox: define mediump vec4 pattern
-#pragma mapbox: define highp float pixel_ratio
-void main() {
-#pragma mapbox: initialize highp float base
-#pragma mapbox: initialize highp float height
-#pragma mapbox: initialize mediump vec4 pattern
-#pragma mapbox: initialize highp float pixel_ratio
-vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
-#ifdef LIGHTING_3D_MODE
-out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
-#else
-out_color=out_color*v_lighting;
-#endif
-#ifdef FAUX_AO
-float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
-#endif
-#ifdef FOG
-out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
-#endif
-#ifdef INDICATOR_CUTOUT
-out_color=applyCutout(out_color);
-#endif
-glFragColor=out_color;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-#include "_prelude_terrain.vertex.glsl"
-#include "_prelude_lighting.glsl"
-uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
-#ifdef PROJECTION_GLOBE_VIEW
-in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
-#endif
-out vec2 v_pos;out vec4 v_lighting;
-#ifdef FAUX_AO
-uniform lowp vec2 u_ao;out vec3 v_ao;
-#endif
-#ifdef LIGHTING_3D_MODE
-out vec3 v_normal;
-#endif
-#pragma mapbox: define highp float base
-#pragma mapbox: define highp float height
-#pragma mapbox: define mediump vec4 pattern
-#pragma mapbox: define highp float pixel_ratio
-void main() {
-#pragma mapbox: initialize highp float base
-#pragma mapbox: initialize highp float height
-#pragma mapbox: initialize mediump vec4 pattern
-#pragma mapbox: initialize highp float pixel_ratio
-vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
-#if defined(HAS_CENTROID) || defined(TERRAIN)
-centroid_pos=a_centroid_pos;
-#endif
-float ele=0.0;float h=z;vec3 p;float c_ele;
-#ifdef TERRAIN
-bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
-#else
-p=vec3(pos_nx.xy,z);
-#endif
-#ifdef PROJECTION_GLOBE_VIEW
-float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
-#endif
-float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
-? pos_nx.xy
-: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
-#ifdef LIGHTING_3D_MODE
-NdotL=calculate_NdotL(normal);
-#else
-NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
-#endif
-if (normal.y !=0.0) {float r=0.84;
-#ifndef LIGHTING_3D_MODE
-r=mix(0.7,0.98,1.0-u_lightintensity);
-#endif
-NdotL*=(
-(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
-#ifdef FAUX_AO
-float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
-#ifdef TERRAIN
-top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
-#endif
-v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
-#ifdef PROJECTION_GLOBE_VIEW
-top_height+=u_height_lift;
-#endif
-gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
-#endif
-#ifdef LIGHTING_3D_MODE
-v_normal=normal;
-#else
-v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
-#endif 
-#ifdef FOG
-v_fog_pos=fog_position(p);
-#endif
-}`),groundShadow:Ui(`#include "_prelude_shadow.fragment.glsl"
-precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
-#ifdef FOG
-in float v_fog_opacity;
-#endif
-void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
-#ifdef RENDER_CUTOFF
-shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
-#endif
-#ifdef FOG
-shadow=mix(shadow,vec3(1.0),v_fog_opacity);
-#endif
-#ifdef INDICATOR_CUTOUT
-shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
-#endif
-glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
-uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
-#ifdef FOG
-out float v_fog_opacity;
-#endif
-void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
-#ifdef FOG
-v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
-#endif
-}`),fillExtrusionGroundEffect:Ui(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
-#ifdef SDF_SUBPASS
-in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
-#ifdef FOG
-in highp float v_fog;
-#endif
-#endif
-void main() {
-#ifdef CLEAR_SUBPASS
-vec4 color=vec4(1.0);
-#ifdef CLEAR_FROM_TEXTURE
-color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
-#endif
-glFragColor=color;
-#else
-#ifdef SDF_SUBPASS
-highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
-#ifdef FOG
-fog=v_fog;
-#endif
-#ifdef RENDER_CUTOFF
-fog*=v_cutoff_opacity;
-#endif
-glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
-#else
-vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
-#ifdef OVERDRAW_INSPECTOR
-color=vec4(1.0);
-#endif
-glFragColor=color;
-#endif
-HANDLE_WIREFRAME_DEBUG;
-#endif
-}`,`#include "_prelude_fog.vertex.glsl"
-in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
-#ifdef SDF_SUBPASS
-out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
-#ifdef FOG
-out highp float v_fog;
-#endif
-#endif
-uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
-#pragma mapbox: define highp float flood_light_ground_radius
-const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
-#pragma mapbox: initialize highp float flood_light_ground_radius
-vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
-#ifdef SDF_SUBPASS
-v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
-#ifdef FOG
-v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
-#endif
-#endif
-float hidden_by_landmark=0.0;
-#ifdef HAS_CENTROID
-hidden_by_landmark=a_hidden_by_landmark;
-#endif
-float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
-#ifdef RENDER_CUTOFF
-v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
-#endif
-}`),hillshadePrepare:Ui(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
-(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
-)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
-deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_lighting.glsl"
-uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
-#ifdef LIGHTING_3D_MODE
-glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
-#endif
-#ifdef FOG
-glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
-#endif
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
-#ifdef FOG
-v_fog_pos=fog_position(a_pos);
-#endif
-}`),line:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_lighting.glsl"
-uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
-#ifdef RENDER_LINE_DASH
-uniform sampler2D u_dash_image;in vec2 v_tex;
-#endif
-#ifdef RENDER_LINE_GRADIENT
-uniform sampler2D u_gradient_image;
-#endif
-float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
-#pragma mapbox: define highp vec4 color
-#pragma mapbox: define lowp float floorwidth
-#pragma mapbox: define lowp vec4 dash
-#pragma mapbox: define lowp float blur
-#pragma mapbox: define lowp float opacity
-#pragma mapbox: define lowp float border_width
-#pragma mapbox: define lowp vec4 border_color
-float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
-#pragma mapbox: initialize highp vec4 color
-#pragma mapbox: initialize lowp float floorwidth
-#pragma mapbox: initialize lowp vec4 dash
-#pragma mapbox: initialize lowp float blur
-#pragma mapbox: initialize lowp float opacity
-#pragma mapbox: initialize lowp float border_width
-#pragma mapbox: initialize lowp vec4 border_color
-float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
-#ifdef RENDER_LINE_DASH
-float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
-#endif
-highp vec4 out_color;
-#ifdef RENDER_LINE_GRADIENT
-out_color=texture(u_gradient_image,v_uv.xy);
-#else
-out_color=color;
-#endif
-float trimmed=1.0;
-#ifdef RENDER_LINE_TRIM_OFFSET
-highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
-#endif
-if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
-#ifdef RENDER_LINE_BORDER
-float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
-float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
-#endif
-#ifdef LIGHTING_3D_MODE
-out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
-#endif
-#ifdef FOG
-out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
-#endif
-out_color*=(alpha*opacity);
-#ifdef INDICATOR_CUTOUT
-out_color=applyCutout(out_color);
-#endif
-glFragColor=out_color;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-#define EXTRUDE_SCALE 0.015873016
-in vec2 a_pos_normal;in vec4 a_data;
-#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
-in highp vec4 a_packed;
-#endif
-#ifdef RENDER_LINE_DASH
-in float a_linesofar;
-#endif
-uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
-#ifdef RENDER_LINE_DASH
-uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
-#endif
-#ifdef RENDER_LINE_GRADIENT
-uniform float u_image_height;
-#endif
-#pragma mapbox: define highp vec4 color
-#pragma mapbox: define lowp float floorwidth
-#pragma mapbox: define lowp vec4 dash
-#pragma mapbox: define lowp float blur
-#pragma mapbox: define lowp float opacity
-#pragma mapbox: define mediump float gapwidth
-#pragma mapbox: define lowp float offset
-#pragma mapbox: define mediump float width
-#pragma mapbox: define lowp float border_width
-#pragma mapbox: define lowp vec4 border_color
-void main() {
-#pragma mapbox: initialize highp vec4 color
-#pragma mapbox: initialize lowp float floorwidth
-#pragma mapbox: initialize lowp vec4 dash
-#pragma mapbox: initialize lowp float blur
-#pragma mapbox: initialize lowp float opacity
-#pragma mapbox: initialize mediump float gapwidth
-#pragma mapbox: initialize lowp float offset
-#pragma mapbox: initialize mediump float width
-#pragma mapbox: initialize lowp float border_width
-#pragma mapbox: initialize lowp vec4 border_color
-float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
-#ifndef RENDER_TO_TEXTURE
-float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
-#else
-v_gamma_scale=1.0;
-#endif
-#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
-float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
-#ifdef RENDER_LINE_GRADIENT
-highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
-#else
-v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
-#endif
-#endif
-#ifdef RENDER_LINE_DASH
-float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
-#endif
-v_width2=vec2(outset,inset);
-#ifdef FOG
-v_fog_pos=fog_position(pos);
-#endif
-}`),linePattern:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_lighting.glsl"
-uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
-#ifdef RENDER_LINE_TRIM_OFFSET
-in highp vec4 v_uv;
-#endif
-#pragma mapbox: define lowp vec4 pattern
-#pragma mapbox: define lowp float pixel_ratio
-#pragma mapbox: define lowp float blur
-#pragma mapbox: define lowp float opacity
-void main() {
-#pragma mapbox: initialize mediump vec4 pattern
-#pragma mapbox: initialize lowp float pixel_ratio
-#pragma mapbox: initialize lowp float blur
-#pragma mapbox: initialize lowp float opacity
-vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
-#ifdef RENDER_LINE_TRIM_OFFSET
-highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {color=vec4(0,0,0,0);}}
-#endif
-#ifdef LIGHTING_3D_MODE
-color=apply_lighting_ground(color);
-#endif
-#ifdef FOG
-color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
-#endif
-color*=(alpha*opacity);
-#ifdef INDICATOR_CUTOUT
-color=applyCutout(color);
-#endif
-glFragColor=color;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-#define scale 0.015873016
-in vec2 a_pos_normal;in vec4 a_data;
-#ifdef RENDER_LINE_TRIM_OFFSET
-in highp vec4 a_packed;
-#endif
-in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
-#ifdef RENDER_LINE_TRIM_OFFSET
-out highp vec4 v_uv;
-#endif
-#pragma mapbox: define lowp float blur
-#pragma mapbox: define lowp float opacity
-#pragma mapbox: define lowp float offset
-#pragma mapbox: define mediump float gapwidth
-#pragma mapbox: define mediump float width
-#pragma mapbox: define lowp float floorwidth
-#pragma mapbox: define lowp vec4 pattern
-#pragma mapbox: define lowp float pixel_ratio
-void main() {
-#pragma mapbox: initialize lowp float blur
-#pragma mapbox: initialize lowp float opacity
-#pragma mapbox: initialize lowp float offset
-#pragma mapbox: initialize mediump float gapwidth
-#pragma mapbox: initialize mediump float width
-#pragma mapbox: initialize lowp float floorwidth
-#pragma mapbox: initialize mediump vec4 pattern
-#pragma mapbox: initialize lowp float pixel_ratio
-float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
-#ifndef RENDER_TO_TEXTURE
-float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
-#else
-v_gamma_scale=1.0;
-#endif
-#ifdef RENDER_LINE_TRIM_OFFSET
-float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
-#endif
-v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
-#ifdef FOG
-v_fog_pos=fog_position(pos);
-#endif
-}`),raster:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_lighting.glsl"
-#include "_prelude_raster_array.glsl"
-uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
-#ifdef PROJECTION_GLOBE_VIEW
-in float v_split_fade;
-#endif
-uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
-#ifndef RASTER_ARRAY
-uniform sampler2D u_image0;uniform sampler2D u_image1;
-#endif
-#ifdef RASTER_COLOR
-uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
-#endif
-void main() {vec4 color0,color1,color;vec2 value;
-#ifdef RASTER_COLOR
-#ifdef RASTER_ARRAY
-#ifdef RASTER_ARRAY_LINEAR
-value=mix(
-raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
-);
-#else
-value=mix(
-raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
-);
-#endif
-if (value.y > 0.0) value.x/=value.y;
-#else
-color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
-#endif
-color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
-#else
-color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
-#endif
-color.a*=u_opacity;
-#ifdef GLOBE_POLES
-color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
-#endif
-vec3 rgb=color.rgb;rgb=vec3(
-dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
-#ifdef LIGHTING_3D_MODE
-out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
-#endif
-#ifdef FOG
-highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
-#endif
-glFragColor=vec4(out_color*color.a,color.a);
-#ifdef PROJECTION_GLOBE_VIEW
-glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
-#endif
-#ifdef RENDER_CUTOFF
-glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
-#endif
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
-#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
-#ifdef GLOBE_POLES
-in vec3 a_globe_pos;in vec2 a_uv;
-#else
-in vec2 a_pos;in vec2 a_texture_pos;
-#endif
-out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
-#ifdef PROJECTION_GLOBE_VIEW
-out float v_split_fade;
-#endif
-void main() {vec2 uv;
-#ifdef GLOBE_POLES
-vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
-#ifdef FOG
-v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
-#endif
-#else
-float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
-#ifdef PROJECTION_GLOBE_VIEW
-vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
-v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
-#ifdef FOG
-v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
-#endif
-#else
-gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
-#ifdef FOG
-v_fog_pos=fog_position(a_pos);
-#endif
-#endif
-#endif
-v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
-#ifdef RENDER_CUTOFF
-v_depth=gl_Position.z;
-#endif
-}`),rasterParticle:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_lighting.glsl"
-uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
-#ifdef LIGHTING_3D_MODE
-out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
-#endif
-#ifdef FOG
-highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
-#endif
-glFragColor=vec4(out_color*color.a,color.a);
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
-#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
-in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;
-#ifdef PROJECTION_GLOBE_VIEW
-vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;vec2 uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
-#ifdef FOG
-v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
-#endif
-#else
-vec2 uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
-#ifdef FOG
-v_fog_pos=fog_position(a_pos);
-#endif
-#endif
-v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ui("precision highp float;uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`precision highp float;
-#include "_prelude_raster_array.glsl"
-#include "_prelude_raster_particle.glsl"
-in vec3 a_pos;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {vec2 pos=a_pos.xy+u_tile_offset;vec2 tex_coords=fract(pos);gl_PointSize=1.0;vec2 velocity=lookup_velocity(tex_coords);if (velocity==INVALID_VELOCITY) {v_particle_speed=0.0;gl_Position=vec4(2.0,2.0,2.0,1.0);} else {v_particle_speed=length(velocity);gl_Position=vec4(2.0*pos-vec2(1.0),0.0,1.0);}}`),rasterParticleTexture:Ui("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {v_tex_pos=0.5*a_pos+vec2(0.5);gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ui("void main() {}",`#include "_prelude_raster_array.glsl"
-#include "_prelude_raster_particle.glsl"
-in vec3 a_pos;uniform float u_speed_factor;uniform float u_lifetime_delta;uniform float u_rand_seed;out vec3 v_new_particle;const vec3 rand_constants=vec3(12.9898,78.233,4375.85453);float rand(const vec2 co) {float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {float lifetime=a_pos.z;vec2 pos=a_pos.xy;vec2 uv=clamp(pos,vec2(0.0),vec2(1.0));vec2 velocity=lookup_velocity(uv);float next_lifetime=lifetime-u_lifetime_delta;float t=step(0.0,next_lifetime);
-#ifdef DATA_FORMAT_UINT32
-vec2 dp=vec2(0);
-#else
-vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;
-#endif
-vec2 seed=pos*u_rand_seed;vec2 next_pos=pos+dp;vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));v_new_particle=vec3(
-vec2(mix(random_pos,next_pos,t)),mix(1.0,next_lifetime,t)
-);}`),symbolIcon:Ui(`#include "_prelude_lighting.glsl"
-uniform sampler2D u_texture;
-#ifdef ICON_TRANSITION
-uniform float u_icon_transition;
-#endif
-in float v_fade_opacity;in vec2 v_tex_a;
-#ifdef ICON_TRANSITION
-in vec2 v_tex_b;
-#endif
-uniform mediump float u_icon_saturation;
-#pragma mapbox: define lowp float opacity
-#pragma mapbox: define lowp float emissive_strength
-void main() {
-#pragma mapbox: initialize lowp float opacity
-#pragma mapbox: initialize lowp float emissive_strength
-lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
-#ifdef ICON_TRANSITION
-vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
-#else
-out_color=texture(u_texture,v_tex_a)*alpha;
-#endif
-#ifdef SATURATION
-vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
-#endif
-#ifdef LIGHTING_3D_MODE
-out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
-#endif
-glFragColor=out_color;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
-in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
-#ifdef Z_OFFSET
-in float a_z_offset;
-#endif
-#ifdef PROJECTION_GLOBE_VIEW
-in vec3 a_globe_anchor;in vec3 a_globe_normal;
-#endif
-#ifdef ICON_TRANSITION
-in vec2 a_texb;
-#endif
-uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
-#ifdef PROJECTION_GLOBE_VIEW
-uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
-#endif
-out vec2 v_tex_a;
-#ifdef ICON_TRANSITION
-out vec2 v_tex_b;
-#endif
-out float v_fade_opacity;
-#pragma mapbox: define lowp float opacity
-#pragma mapbox: define lowp float emissive_strength
-void main() {
-#pragma mapbox: initialize lowp float opacity
-#pragma mapbox: initialize lowp float emissive_strength
-vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
-#ifdef Z_OFFSET
-e+=a_z_offset;
-#endif
-vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
-#ifdef PROJECTION_GLOBE_VIEW
-mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
-#else
-world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
-#endif
-vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
-camera_to_anchor_distance/u_camera_to_center_distance :
-u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
-0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
-#ifdef PROJECTION_GLOBE_VIEW
-vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
-#else
-offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
-#endif
-vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
-#ifdef PROJECTION_GLOBE_VIEW
-vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
-#else
-projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
-#endif
-highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
-#ifdef TERRAIN
-#ifdef PITCH_WITH_MAP_TERRAIN
-vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
-#endif
-#endif
-float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
-#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
-projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
-#endif
-vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
-#ifdef PROJECTION_GLOBE_VIEW
-vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
-#else
-gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
-#endif
-v_tex_a=a_tex/u_texsize;
-#ifdef ICON_TRANSITION
-v_tex_b=a_texb/u_texsize;
-#endif
-v_fade_opacity=out_fade_opacity;}`),symbolSDF:Ui(`#include "_prelude_lighting.glsl"
-#define SDF_PX 8.0
-uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
-#pragma mapbox: define highp vec4 fill_color
-#pragma mapbox: define highp vec4 halo_color
-#pragma mapbox: define lowp float opacity
-#pragma mapbox: define lowp float halo_width
-#pragma mapbox: define lowp float halo_blur
-#pragma mapbox: define lowp float emissive_strength
-void main() {
-#pragma mapbox: initialize highp vec4 fill_color
-#pragma mapbox: initialize highp vec4 halo_color
-#pragma mapbox: initialize lowp float opacity
-#pragma mapbox: initialize lowp float halo_width
-#pragma mapbox: initialize lowp float halo_blur
-#pragma mapbox: initialize lowp float emissive_strength
-float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
-#ifdef LIGHTING_3D_MODE
-out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
-#endif
-glFragColor=out_color;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
-in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
-#ifdef Z_OFFSET
-in float a_z_offset;
-#endif
-#ifdef PROJECTION_GLOBE_VIEW
-in vec3 a_globe_anchor;in vec3 a_globe_normal;
-#endif
-uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
-#ifdef PROJECTION_GLOBE_VIEW
-uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
-#endif
-out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
-#pragma mapbox: define highp vec4 fill_color
-#pragma mapbox: define highp vec4 halo_color
-#pragma mapbox: define lowp float opacity
-#pragma mapbox: define lowp float halo_width
-#pragma mapbox: define lowp float halo_blur
-#pragma mapbox: define lowp float emissive_strength
-void main() {
-#pragma mapbox: initialize highp vec4 fill_color
-#pragma mapbox: initialize highp vec4 halo_color
-#pragma mapbox: initialize lowp float opacity
-#pragma mapbox: initialize lowp float halo_width
-#pragma mapbox: initialize lowp float halo_blur
-#pragma mapbox: initialize lowp float emissive_strength
-vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
-#ifdef Z_OFFSET
-e+=a_z_offset;
-#endif
-vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
-#ifdef PROJECTION_GLOBE_VIEW
-mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
-#else
-world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
-#endif
-vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
-camera_to_anchor_distance/u_camera_to_center_distance :
-u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
-0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
-#ifdef PROJECTION_GLOBE_VIEW
-vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
-#else
-offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
-#endif
-vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
-#ifdef PROJECTION_GLOBE_VIEW
-vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
-#else
-projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
-#endif
-highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
-#ifdef TERRAIN
-#ifdef PITCH_WITH_MAP_TERRAIN
-vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
-#endif
-#endif
-float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
-#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
-projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
-#endif
-vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
-#ifdef PROJECTION_GLOBE_VIEW
-vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
-#else
-gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
-#endif
-float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Ui(`#include "_prelude_lighting.glsl"
-#define SDF_PX 8.0
-#define SDF 1.0
-#define ICON 0.0
-uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
-#pragma mapbox: define highp vec4 fill_color
-#pragma mapbox: define highp vec4 halo_color
-#pragma mapbox: define lowp float opacity
-#pragma mapbox: define lowp float halo_width
-#pragma mapbox: define lowp float halo_blur
-#pragma mapbox: define lowp float emissive_strength
-void main() {
-#pragma mapbox: initialize highp vec4 fill_color
-#pragma mapbox: initialize highp vec4 halo_color
-#pragma mapbox: initialize lowp float opacity
-#pragma mapbox: initialize lowp float halo_width
-#pragma mapbox: initialize lowp float halo_blur
-#pragma mapbox: initialize lowp float emissive_strength
-float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
-#ifdef LIGHTING_3D_MODE
-out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
-#endif
-glFragColor=out_color;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
-in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
-#ifdef Z_OFFSET
-in float a_z_offset;
-#endif
-#ifdef PROJECTION_GLOBE_VIEW
-in vec3 a_globe_anchor;in vec3 a_globe_normal;
-#endif
-uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
-#ifdef PROJECTION_GLOBE_VIEW
-uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
-#endif
-out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
-#pragma mapbox: define highp vec4 fill_color
-#pragma mapbox: define highp vec4 halo_color
-#pragma mapbox: define lowp float opacity
-#pragma mapbox: define lowp float halo_width
-#pragma mapbox: define lowp float halo_blur
-#pragma mapbox: define lowp float emissive_strength
-void main() {
-#pragma mapbox: initialize highp vec4 fill_color
-#pragma mapbox: initialize highp vec4 halo_color
-#pragma mapbox: initialize lowp float opacity
-#pragma mapbox: initialize lowp float halo_width
-#pragma mapbox: initialize lowp float halo_blur
-#pragma mapbox: initialize lowp float emissive_strength
-vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
-#ifdef Z_OFFSET
-e+=a_z_offset;
-#endif
-vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
-#ifdef PROJECTION_GLOBE_VIEW
-mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
-#else
-world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
-#endif
-vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
-camera_to_anchor_distance/u_camera_to_center_distance :
-u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
-0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
-#ifdef PROJECTION_GLOBE_VIEW
-vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
-#else
-projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
-#endif
-highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
-#ifdef TERRAIN
-#ifdef PITCH_WITH_MAP_TERRAIN
-vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
-#endif
-#endif
-float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
-#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
-projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
-#endif
-float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
-#ifdef PROJECTION_GLOBE_VIEW
-vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
-#else
-gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
-#endif
-float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_shadow.fragment.glsl"
-#include "_prelude_lighting.glsl"
-uniform sampler2D u_image0;in vec2 v_pos0;
-#ifdef FOG
-in float v_fog_opacity;
-#endif
-#ifdef RENDER_SHADOWS
-in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
-#endif
-uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
-#ifdef LIGHTING_3D_MODE
-const vec3 normal=vec3(0.0,0.0,1.0);
-#ifdef RENDER_SHADOWS
-float cutoffOpacity=1.0;
-#ifdef RENDER_CUTOFF
-cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
-#endif
-#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
-vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
-#else
-float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
-#endif
-#else
-float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
-#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
-color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
-#endif
-#endif
-#else
-color=image_color;
-#endif
-#ifdef FOG
-#ifdef ZERO_EXAGGERATION
-color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
-#else
-color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
-#endif
-#endif
-glFragColor=color;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-#include "_prelude_terrain.vertex.glsl"
-uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
-#ifdef FOG
-out float v_fog_opacity;
-#endif
-#ifdef RENDER_SHADOWS
-uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
-#endif
-void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
-#ifdef FOG
-#ifdef ZERO_EXAGGERATION
-v_fog_pos=fog_position(decodedPos);
-#else
-v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
-#endif
-#endif
-#ifdef RENDER_SHADOWS
-vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
-#endif
-}`),terrainDepth:Ui("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
-uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ui(`#include "_prelude_fog.fragment.glsl"
-in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
-cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
-#ifdef FOG
-sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
-#endif
-sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-}`,du),skyboxGradient:Ui(`#include "_prelude_fog.fragment.glsl"
-in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
-#ifdef FOG
-color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
-#endif
-color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-}`,du),skyboxCapture:Ui(`
-in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
-#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
-#define BETA_M                  vec3(21e-6,21e-6,21e-6)
-#define MIE_G                   0.76
-#define DENSITY_HEIGHT_SCALE_R  8000.0
-#define DENSITY_HEIGHT_SCALE_M  1200.0
-#define PLANET_RADIUS           6360e3
-#define ATMOSPHERE_RADIUS       6420e3
-#define SAMPLE_STEPS            10
-#define DENSITY_STEPS           4
-float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_lighting.glsl"
-uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
-#ifndef FOG
-uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
-#endif
-void main() {vec4 color;
-#ifdef CUSTOM_ANTIALIASING
-vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
-mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
-#ifdef LIGHTING_3D_MODE
-#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
-raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
-#else
-raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
-#endif
-#else
-color=vec4(raster.rgb*antialias,raster.a*antialias);
-#endif
-#else
-color=texture(u_image0,v_pos0);
-#ifdef LIGHTING_3D_MODE
-#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
-color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
-#else
-color=apply_lighting_ground(color);
-#endif
-#endif
-#endif
-#ifdef FOG
-color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
-#endif
-color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-#include "_prelude_terrain.vertex.glsl"
-uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
-#ifdef GLOBE_POLES
-in vec3 a_globe_pos;in vec2 a_uv;
-#else
-in vec2 a_pos;
-#endif
-out vec2 v_pos0;void main() {
-#ifdef GLOBE_POLES
-vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
-#else
-float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
-#endif
-v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
-#ifdef GLOBE_POLES
-vec3 up_vector=globe_derived_up_vector;
-#else
-vec3 up_vector=elevationVector(tile_pos);
-#endif
-float height=elevation(tile_pos);globe_pos+=up_vector*height;
-#ifndef GLOBE_POLES
-globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
-#endif
-#ifdef GLOBE_POLES
-vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
-#else
-vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
-#endif
-gl_Position=u_proj_matrix*interpolated_pos;
-#ifdef FOG
-v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
-#endif
-}`),globeAtmosphere:Ui(`#include "_prelude_fog.fragment.glsl"
-uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
-#ifdef PROJECTION_GLOBE_VIEW
-globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
-#ifdef ALPHA_PASS
-glFragColor=vec4(0,0,0,0);return;
-#else
-#ifdef NATIVE
-glFragColor=vec4(1,1,1,1);
-#else
-glFragColor=vec4(0,0,0,1);
-#endif
-return;
-#endif
-}
-#endif
-highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
-0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
-#ifdef PROJECTION_GLOBE_VIEW
-highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
-PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
-#else
-horizon_angle=horizon_angle_mercator;
-#endif
-horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
-#ifdef ALPHA_PASS
-float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
-#else
-vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
-#ifndef NATIVE
-c=dither(c,gl_FragCoord.xy+u_temporal_offset);
-#endif
-glFragColor=vec4(c*t,t);
-#endif
-}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
-mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
-mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ui(`#include "_prelude_fog.fragment.glsl"
-#include "_prelude_shadow.fragment.glsl"
-#include "_prelude_lighting.glsl"
-uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
-#ifdef RENDER_SHADOWS
-in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
-#endif
-#ifdef OCCLUSION_TEXTURE_TRANSFORM
-uniform vec4 u_occlusionTextureTransform;
-#endif
-#pragma mapbox: define-attribute highp vec3 normal_3f
-#pragma mapbox: define-attribute highp vec3 color_3f
-#pragma mapbox: define-attribute highp vec4 color_4f
-#pragma mapbox: define-attribute highp vec2 uv_2f
-#pragma mapbox: initialize-attribute highp vec3 normal_3f
-#pragma mapbox: initialize-attribute highp vec3 color_3f
-#pragma mapbox: initialize-attribute highp vec4 color_4f
-#pragma mapbox: initialize-attribute highp vec2 uv_2f
-#ifdef HAS_ATTRIBUTE_a_pbr
-in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
-#endif
-#ifdef HAS_TEXTURE_u_baseColorTexture
-uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
-#endif
-#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
-uniform sampler2D u_metallicRoughnessTexture;
-#endif
-#ifdef HAS_TEXTURE_u_occlusionTexture
-uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
-#endif
-#ifdef HAS_TEXTURE_u_normalTexture
-uniform sampler2D u_normalTexture;
-#endif
-#ifdef HAS_TEXTURE_u_emissionTexture
-uniform sampler2D u_emissionTexture;
-#endif
-#ifdef TERRAIN_FRAGMENT_OCCLUSION
-in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
-#endif
-#define saturate(_x) clamp(_x,0.,1.)
-vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
-{
-#ifdef LIGHTING_3D_MODE
-vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
-#ifdef RENDER_SHADOWS
-lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
-#else
-lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
-#endif
-return apply_lighting(albedo,transformed_normal,lighting_factor);
-#else
-vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
-#endif
-}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
-#ifdef HAS_ATTRIBUTE_a_color_3f
-albedo*=vec4(color_3f,1.0);
-#endif
-#ifdef HAS_ATTRIBUTE_a_pbr
-#else
-#ifdef HAS_ATTRIBUTE_a_color_4f
-albedo*=color_4f;
-#endif
-#endif
-#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
-vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
-#ifdef UNPREMULT_TEXTURE_IN_SHADER
-if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
-#endif
-if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
-#endif
-return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
-#ifdef HAS_TEXTURE_u_normalTexture
-highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
-#else
-return mat3(1.0);
-#endif
-}highp vec3 getNormal(){highp vec3 n;
-#ifdef HAS_ATTRIBUTE_a_normal_3f
-n=normalize(normal_3f);
-#else
-highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
-#endif
-#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
-vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
-#endif
-return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
-#ifdef HAS_ATTRIBUTE_a_pbr
-mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
-#endif
-#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
-vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
-#endif
-const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
-{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
-{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
-{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
-{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
-{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
-{
-#ifdef LIGHTING_3D_MODE
-return mat.diffuseColor;
-#else
-return mat.diffuseColor/PI;
-#endif
-}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
-{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
-{vec3 env_light=vec3(0.65,0.65,0.65);
-#ifdef LIGHTING_3D_MODE
-float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
-#endif
-vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
-{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
-#ifdef RENDER_SHADOWS
-lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
-#else
-lighting_factor=NdotL;
-#endif
-vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
-#if !defined(LIGHTING_3D_MODE)
-const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
-#endif
-color*=intensityFactor;return color;}void main() {
-#ifdef TERRAIN_FRAGMENT_OCCLUSION
-if (isOccluded()) {discard;}
-#endif
-vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
-#ifdef LIGHTING_3D_MODE
-lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
-#endif
-vec4 finalColor;
-#ifdef DIFFUSE_SHADED
-vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
-#ifdef HAS_TEXTURE_u_occlusionTexture
-float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
-#endif
-finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
-#else
-Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
-#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
-#ifdef OCCLUSION_TEXTURE_TRANSFORM
-vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
-#else
-vec2 uv=uv_2f;
-#endif
-ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
-#endif
-vec4 emissive=u_emissiveFactor;
-#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
-emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
-#endif
-color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
-#ifdef HAS_ATTRIBUTE_a_pbr
-float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
-#ifdef HAS_ATTRIBUTE_a_color_4f
-float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
-#endif
-#endif
-vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
-#endif
-#ifdef FOG
-finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
-#endif
-#ifdef RENDER_CUTOFF
-finalColor*=v_cutoff_opacity;
-#endif
-#ifdef INDICATOR_CUTOUT
-finalColor=applyCutout(finalColor);
-#endif
-glFragColor=finalColor;
-#ifdef OVERDRAW_INSPECTOR
-glFragColor=vec4(1.0);
-#endif
-HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
-#include "_prelude_shadow.vertex.glsl"
-in vec3 a_pos_3f;
-#pragma mapbox: define-attribute highp vec3 normal_3f
-#pragma mapbox: define-attribute highp vec2 uv_2f
-#pragma mapbox: define-attribute highp vec3 color_3f
-#pragma mapbox: define-attribute highp vec4 color_4f
-#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
-#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
-uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
-#ifdef INSTANCED_ARRAYS
-in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
-#else
-uniform highp mat4 u_normal_matrix;
-#endif
-#ifdef RENDER_SHADOWS
-uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
-#endif
-out vec4 v_position_height;out lowp vec4 v_color_mix;
-#ifdef TERRAIN_FRAGMENT_OCCLUSION
-out highp float v_depth;
-#endif
-#ifdef HAS_ATTRIBUTE_a_pbr
-out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
-#endif
-vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
-#pragma mapbox: initialize-attribute highp vec3 normal_3f
-#pragma mapbox: initialize-attribute highp vec2 uv_2f
-#pragma mapbox: initialize-attribute highp vec3 color_3f
-#pragma mapbox: initialize-attribute highp vec4 color_4f
-#pragma mapbox: initialize-attribute-custom highp vec4 pbr
-#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
-highp mat4 normal_matrix;
-#ifdef INSTANCED_ARRAYS
-normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
-#else
-normal_matrix=u_normal_matrix;
-#endif
-vec3 local_pos;mat3 rs;
-#ifdef MODEL_POSITION_ON_GPU
-vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
-#else
-local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
-#endif
-v_position_height.w=a_pos_3f.z;
-#ifdef HAS_ATTRIBUTE_a_pbr
-vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
-#endif
-#ifdef FOG
-v_fog_pos=fog_position(local_pos);
-#endif
-#ifdef RENDER_CUTOFF
-v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
-#endif
-#ifdef TERRAIN_FRAGMENT_OCCLUSION
-v_depth=gl_Position.z/gl_Position.w;
-#endif
-#ifdef HAS_ATTRIBUTE_a_normal_3f
-#ifdef MODEL_POSITION_ON_GPU
-float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
-#else
-normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
-#endif
-#endif
-#ifdef HAS_ATTRIBUTE_a_pbr
-#ifdef HAS_ATTRIBUTE_a_color_4f
-v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
-#endif
-#endif
-#ifdef RENDER_SHADOWS
-vec3 shadow_pos=local_pos;
-#ifdef NORMAL_OFFSET
-#ifdef HAS_ATTRIBUTE_a_normal_3f
-#ifdef MODEL_POSITION_ON_GPU
-vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
-#else
-vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
-#endif
-#endif
-#endif
-v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
-#endif
-}`),modelDepth:Ui(`in highp float v_depth;void main() {
-#ifndef DEPTH_TEXTURE
-glFragColor=pack_depth(v_depth);
-#endif
-}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
-#ifdef MODEL_POSITION_ON_GPU
-#ifdef INSTANCED_ARRAYS
-in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
-#else
-uniform highp mat4 u_instance;
-#endif
-uniform highp mat4 u_node_matrix;
-#endif
-void main() {
-#ifdef MODEL_POSITION_ON_GPU
-highp mat4 instance;
-#ifdef INSTANCED_ARRAYS
-instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
-#else
-instance=u_instance;
-#endif
-vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
-#else
-gl_Position=u_matrix*vec4(a_pos_3f,1);
-#endif
-v_depth=gl_Position.z/gl_Position.w;}`),stars:Ui(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
-{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
-in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Lo(u,r){const s=u.replace(/\s*\/\/[^\n]*\n/g,`
-`).split(`
-`);for(let h of s)if(h=h.trim(),h[0]==="#"&&h.includes("if")&&!h.includes("endif")){h=h.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const p=h.split(" ");for(const _ of p)r.includes(_)||r.push(_)}}function Ui(u,r){const s=/#include\s+"([^"]+)"/g,h=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let p=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);p&&(p=p.map(I=>{const C=I.split(" ");return C[C.length-1]}),p=[...new Set(p)]);const _={},x=[],T=[];if(u=u.replace(s,(I,C)=>(T.push(C),"")),(r=r.replace(s,(I,C)=>(x.push(C),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let S=[...Ua];Lo(u,S),Lo(r,S);for(const I of[...x,...T])os[I]||console.error(`Undefined include: ${I}`),ja[I]||(ja[I]=[],Lo(os[I],ja[I])),S=[...S,...ja[I]];return{fragmentSource:u=u.replace(h,(I,C,L,k,B)=>(_[B]=!0,C==="define"?`
-#ifndef HAS_UNIFORM_u_${B}
-in ${L} ${k} ${B};
-#else
-uniform ${L} ${k} u_${B};
-#endif
-`:C==="initialize"?`
-#ifdef HAS_UNIFORM_u_${B}
-    ${L} ${k} ${B} = u_${B};
-#endif
-`:C==="define-attribute"?`
-#ifdef HAS_ATTRIBUTE_a_${B}
-    in ${L} ${k} ${B};
-#endif
-`:C==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(h,(I,C,L,k,B)=>{const j=k==="float"?"vec2":k,U=B.match(/color/)?"color":j;return C==="define-attribute-vertex-shader-only"?`
-#ifdef HAS_ATTRIBUTE_a_${B}
-in ${L} ${k} a_${B};
-#endif
-`:_[B]?C==="define"?`
-#ifndef HAS_UNIFORM_u_${B}
-uniform lowp float u_${B}_t;
-in ${L} ${j} a_${B};
-out ${L} ${k} ${B};
-#else
-uniform ${L} ${k} u_${B};
-#endif
-`:C==="initialize"?U==="vec4"?`
-#ifndef HAS_UNIFORM_u_${B}
-    ${B} = a_${B};
-#else
-    ${L} ${k} ${B} = u_${B};
-#endif
-`:`
-#ifndef HAS_UNIFORM_u_${B}
-    ${B} = unpack_mix_${U}(a_${B}, u_${B}_t);
-#else
-    ${L} ${k} ${B} = u_${B};
-#endif
-`:C==="define-attribute"?`
-#ifdef HAS_ATTRIBUTE_a_${B}
-    in ${L} ${k} a_${B};
-    out ${L} ${k} ${B};
-#endif
-`:C==="initialize-attribute"?`
-#ifdef HAS_ATTRIBUTE_a_${B}
-    ${B} = a_${B};
-#endif
-`:void 0:C==="define"?`
-#ifndef HAS_UNIFORM_u_${B}
-uniform lowp float u_${B}_t;
-in ${L} ${j} a_${B};
-#else
-uniform ${L} ${k} u_${B};
-#endif
-`:C==="define-instanced"?U==="mat4"?`
-#ifdef INSTANCED_ARRAYS
-in vec4 a_${B}0;
-in vec4 a_${B}1;
-in vec4 a_${B}2;
-in vec4 a_${B}3;
-#else
-uniform ${L} ${k} u_${B};
-#endif
-`:`
-#ifdef INSTANCED_ARRAYS
-in ${L} ${j} a_${B};
-#else
-uniform ${L} ${k} u_${B};
-#endif
-`:C==="initialize-attribute-custom"?`
-#ifdef HAS_ATTRIBUTE_a_${B}
-    ${L} ${k} ${B} = a_${B};
-#endif
-`:U==="vec4"?`
-#ifndef HAS_UNIFORM_u_${B}
-    ${L} ${k} ${B} = a_${B};
-#else
-    ${L} ${k} ${B} = u_${B};
-#endif
-`:`
-#ifndef HAS_UNIFORM_u_${B}
-    ${L} ${k} ${B} = unpack_mix_${U}(a_${B}, u_${B}_t);
-#else
-    ${L} ${k} ${B} = u_${B};
-#endif
-`}),staticAttributes:p,usedDefines:S,vertexIncludes:x,fragmentIncludes:T}}class Qh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,s,h,p,_,x,T,S){this.context=r;let I=this.boundPaintVertexBuffers.length!==p.length;for(let L=0;!I&&L<p.length;L++)this.boundPaintVertexBuffers[L]!==p[L]&&(I=!0);let C=this.boundDynamicVertexBuffers.length!==T.length;for(let L=0;!C&&L<T.length;L++)this.boundDynamicVertexBuffers[L]!==T[L]&&(C=!0);if(!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==h||I||C||this.boundIndexBuffer!==_||this.boundVertexOffset!==x)this.freshBind(s,h,p,_,x,T,S);else{r.bindVertexArrayOES.set(this.vao);for(const L of T)L&&(L.bind(),S&&L.instanceCount&&L.setVertexAttribDivisor(r.gl,s,S));_&&_.dynamicDraw&&_.bind()}}freshBind(r,s,h,p,_,x,T){const S=r.numAttributes,I=this.context,C=I.gl;this.vao&&this.destroy(),this.vao=I.gl.createVertexArray(),I.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=h,this.boundIndexBuffer=p,this.boundVertexOffset=_,this.boundDynamicVertexBuffers=x,s.enableAttributes(C,r),s.bind(),s.setVertexAttribPointers(C,r,_);for(const L of h)L.enableAttributes(C,r),L.bind(),L.setVertexAttribPointers(C,r,_);for(const L of x)L&&(L.enableAttributes(C,r),L.bind(),L.setVertexAttribPointers(C,r,_),T&&L.instanceCount&&L.setVertexAttribDivisor(C,r,T));p&&p.bind(),I.currentNumAttributes=S}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function W_(u,r){const s=Math.pow(2,r.canonical.z),h=r.canonical.y;return[new o.L(0,h/s).toLngLat().lat,new o.L(0,(h+1)/s).toLngLat().lat]}function pu(u,r,s,h,p,_,x){const T=u.context,S=T.gl,I=s.hillshadeFBO;if(!I)return;u.prepareDrawTile();const C=u.isTileAffectedByFog(r),L=u.getOrCreateProgram("hillshade",{overrideFog:C});T.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,I.colorAttachment.get());const k=(($,N,H,ee)=>{const X=H.paint.get("hillshade-shadow-color"),te=H.paint.get("hillshade-highlight-color"),q=H.paint.get("hillshade-accent-color"),re=H.paint.get("hillshade-emissive-strength");let ae=o.bj(H.paint.get("hillshade-illumination-direction"));if(H.paint.get("hillshade-illumination-anchor")==="viewport")ae-=$.transform.angle;else if($.style&&$.style.enable3dLights()&&$.style.directionalLight){const me=$.style.directionalLight.properties.get("direction"),Me=o.bQ(me.x,me.y,me.z);ae=o.bj(Me[1])}const ue=!$.options.moving;return{u_matrix:ee||$.transform.calculateProjMatrix(N.tileID.toUnwrapped(),ue),u_image:0,u_latrange:W_(0,N.tileID),u_light:[H.paint.get("hillshade-exaggeration"),ae],u_shadow:X,u_highlight:te,u_emissive_strength:re,u_accent:q}})(u,s,h,u.terrain?r.projMatrix:null);u.uploadCommonUniforms(T,L,r.toUnwrapped());const{tileBoundsBuffer:B,tileBoundsIndexBuffer:j,tileBoundsSegments:U}=u.getTileBoundsBuffers(s);L.draw(u,S.TRIANGLES,p,_,x,Jt.disabled,k,h.id,B,j,U)}function cp(u,r,s){if(!r.needsDEMTextureUpload)return;const h=u.context,p=h.gl;h.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||u.getTileTexture(s.stride);const _=s.getPixels();r.demTexture?r.demTexture.update(_,{premultiply:!1}):r.demTexture=new o.T(h,_,p.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function ed(u,r,s){const h=u.context,p=h.gl;if(!r.dem)return;const _=r.dem;if(h.activeTexture.set(p.TEXTURE1),cp(u,r,_),!r.demTexture)return;r.demTexture.bind(p.NEAREST,p.CLAMP_TO_EDGE);const x=_.dim;h.activeTexture.set(p.TEXTURE0);let T=r.hillshadeFBO;if(!T){const k=new o.T(h,{width:x,height:x,data:null},p.RGBA);k.bind(p.LINEAR,p.CLAMP_TO_EDGE),T=r.hillshadeFBO=h.createFramebuffer(x,x,!0,"renderbuffer"),T.colorAttachment.set(k.texture)}h.bindFramebuffer.set(T.framebuffer),h.viewport.set([0,0,x,x]);const{tileBoundsBuffer:S,tileBoundsIndexBuffer:I,tileBoundsSegments:C}=u.getMercatorTileBoundsBuffers(),L=[];u.linearFloatFilteringSupported()&&L.push("TERRAIN_DEM_FLOAT_FORMAT"),u.getOrCreateProgram("hillshadePrepare",{defines:L}).draw(u,p.TRIANGLES,Yt.disabled,li.disabled,Si.unblended,Jt.disabled,((k,B)=>{const j=B.stride,U=o.a6.create();return o.a6.ortho(U,0,o.V,-o.V,0,0,1),o.a6.translate(U,U,[0,-o.V,0]),{u_matrix:U,u_image:1,u_dimension:[j,j],u_zoom:k.overscaledZ}})(r.tileID,_),s.id,S,I,C),r.needsHillshadePrepare=!1}const up=u=>({u_matrix:new o.bK(u),u_image0:new o.bO(u),u_skirt_height:new o.bN(u),u_ground_shadow_factor:new o.bM(u)}),mu=(u,r,s)=>({u_matrix:u,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:s}),hp=(u,r,s,h,p,_,x,T,S,I,C,L,k,B,j,U)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(h),u_merc_matrix:s,u_zoom_transition:p,u_merc_center:_,u_image0:0,u_frustum_tl:x,u_frustum_tr:T,u_frustum_br:S,u_frustum_bl:I,u_globe_pos:C,u_globe_radius:L,u_viewport:k,u_grid_matrix:U?Float32Array.from(U):new Float32Array(9),u_skirt_height:B,u_far_z_cutoff:j});function Xl(u,r){return u!=null&&r!=null&&!(!u.hasData()||!r.hasData())&&u.demTexture!=null&&r.demTexture!=null&&u.tileID.key!==r.tileID.key}const Ga=new class{constructor(){this.operations={}}newMorphing(u,r,s,h,p){if(u in this.operations){const _=this.operations[u];_.to.tileID.key!==s.tileID.key&&(_.queued=s)}else this.operations[u]={startTime:h,phase:0,duration:p,from:r,to:s,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const r=this.operations[u];return{from:r.from,to:r.to,phase:r.phase}}update(u){for(const r in this.operations){const s=this.operations[r];for(s.phase=(u-s.startTime)/s.duration;s.phase>=1||!this._validOp(s);)if(!this._nextOp(s,u)){delete this.operations[r];break}}}_nextOp(u,r){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=r,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},td={0:null,1:"TERRAIN_VERTEX_MORPHING"};function id(u,r,s){if(r===0)return 0;const h=r<1&&s===514?.25/r:1;return 6*Math.pow(1.5,22-u)*Math.max(r,1)*h}function $a(u,r){const s=1<<u.z;return!r&&(u.x===0||u.x===s-1)||u.y===0||u.y===s-1}const rd=u=>({u_matrix:u});function nd(u,r,s,h,p){if(p>0){const _=o.f.now(),x=(_-u.timeAdded)/p,T=r?(_-r.timeAdded)/p:-1,S=s.getSource(),I=h.coveringZoomLevel({tileSize:S.tileSize,roundZoom:S.roundZoom}),C=!r||Math.abs(r.tileID.overscaledZ-I)>Math.abs(u.tileID.overscaledZ-I),L=C&&u.refreshedUponExpiration?1:o.aa(C?x:1-T,0,1);return u.refreshedUponExpiration&&x>=1&&(u.refreshedUponExpiration=!1),r?{opacity:1,mix:1-L}:{opacity:L,mix:0}}return{opacity:1,mix:0}}class X_ extends Ss{constructor(r){const s={type:"raster-dem",maxzoom:r.transform.maxZoom},h=new o.bW(o.bX(),null),p=on("mock-dem",s,h,r.style);super("mock-dem",p,!1),p.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,s){r.state="loaded",s(null)}}class K_ extends Ss{constructor(r){const s=on("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new o.bW(o.bX(),null),r.style);super("proxy",s,!1),s.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,s,h){if(r.freezeTileCoverage)return;this.transform=r;const p=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((_,x)=>{if(_[x.key]="",!this._tiles[x.key]){const T=new Eo(x,this._source.tileSize*x.overscaleFactor(),r.tileZoom);T.state="loaded",this._tiles[x.key]=T}return _},{});for(const _ in this._tiles)_ in p||(this.freeFBO(_),this._tiles[_].unloadVectorData(),delete this._tiles[_])}freeFBO(r){const s=this.proxyCachedFBO[r];if(s!==void 0){const h=Object.values(s);this.renderCachePool.push(...h),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class dp extends o.am{constructor(r,s,h){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=s,this.projMatrix=h}}class Y_ extends o.ck{constructor(r,s){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[h,p,_]=function(S){const I=new o.aN,C=new o.aw,L=131;I.reserve(17161),C.reserve(33800);const k=o.V/128,B=o.V+k/2,j=B+k;for(let $=-k;$<j;$+=k)for(let N=-k;N<j;N+=k){const H=N<0||N>B||$<0||$>B?24575:0,ee=o.aa(Math.round(N),0,o.V),X=o.aa(Math.round($),0,o.V);I.emplaceBack(ee+H,X)}const U=($,N)=>{const H=N*L+$;C.emplaceBack(H+1,H,H+L),C.emplaceBack(H+L,H+L+1,H+1)};for(let $=1;$<129;$++)for(let N=1;N<129;N++)U(N,$);return[0,129].forEach($=>{for(let N=0;N<130;N++)U(N,$),U($,N)}),[I,C,32768]}(),x=r.context;this.gridBuffer=x.createVertexBuffer(h,o.aP.members),this.gridIndexBuffer=x.createIndexBuffer(p),this.gridSegments=o.aB.simpleSegment(0,0,h.length,p.length),this.gridNoSkirtSegments=o.aB.simpleSegment(0,0,h.length,_),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new K_(s.map),this.orthoMatrix=o.a6.create(),o.a6.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.V,0,o.V,0,1);const T=x.gl;this._overlapStencilMode=new li({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=s,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new X_(s.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,s,h){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const p=r.terrain.properties,_=r.terrain.drapeRenderMode===0,x=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.f.now();const T=r.terrain&&r.terrain.scope,S=p.get("source"),I=_?this._mockSourceCache:r.getSourceCache(S,T);if(!I)return void o.w(`Couldn't find terrain source "${S}".`);if(this.sourceCache=I,this._exaggeration=x?this.calculateExaggeration(s):p.get("exaggeration"),!s.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;const C=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
-This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const L=this.getScaledDemTileSize();this.sourceCache.update(s,L,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,C(),this._initializing=!0),C(),s.updateElevation(!0,h),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(s),this._emptyDEMTextureDirty=!0,this._previousZoom=s.zoom}else this._disable()}calculateExaggeration(r){const s=this._previousCameraAltitude,h=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=h;const p=s!=null?h-s:Number.MAX_VALUE;if(Math.abs(p)<2)return this._exaggeration;const _=r.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(_);let T=_-this._previousZoom;const S=this._previousUpdateTimestamp;let I=_;this._evaluationZoom!=null&&(I=this._evaluationZoom,Math.abs(_-I)>.5&&(T=.5*(_-I+T)),T*p<0&&(I+=T)),this._evaluationZoom=I;const C=x.getExaggeration(I),L=C===x.getExaggeration(Math.max(0,I-.1));if(L&&Math.abs(C-this._exaggeration)<.01)return C;let k=Math.min(.1,.00375*(this._updateTimestamp-S));return(L||C<.1||Math.abs(T)<1e-4)&&(k=Math.min(.2,4*k)),o.U(this._exaggeration,C,k)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const s=this.proxySourceCache,h=this.painter.transform;this._initializing&&(this._initializing=h._centerAltitude===0&&this.getAtPointOrZero(o.L.fromLngLat(h.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const p=this.proxyCoords=s.getIds().map(S=>{const I=s.getTileByID(S).tileID;return I.projMatrix=h.calculateProjMatrix(I.toUnwrapped()),I});(function(S,I){const C=I.transform.pointCoordinate(I.transform.getCameraPoint()),L=new o.P(C.x,C.y);S.sort((k,B)=>{if(B.overscaledZ-k.overscaledZ)return B.overscaledZ-k.overscaledZ;const j=new o.P(k.canonical.x+(1<<k.canonical.z)*k.wrap,k.canonical.y),U=new o.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),$=L.mult(1<<k.canonical.z);return $.x-=.5,$.y-=.5,$.distSqr(j)-$.distSqr(U)})})(p,this.painter);const _=this.proxyToSource||{};this.proxyToSource={},p.forEach(S=>{this.proxyToSource[S.key]={}}),this.terrainTileForTile={};const x=this._style._mergedSourceCaches;for(const S in x){const I=x[S];if(!I.used||(I!==this.sourceCache&&this.resetTileLookupCache(I.id),this._setupProxiedCoordsForOrtho(I,r[S],_),I.usedForTerrain))continue;const C=r[S];I.getSource().reparseOverscaled&&this._assignTerrainTiles(C)}this.proxiedCoords[s.id]=p.map(S=>new dp(S,S.key,this.orthoMatrix)),this._assignTerrainTiles(p),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(_),this.renderingToTexture=!1;const T={};this._visibleDemTiles=[];for(const S of this.proxyCoords){const I=this.terrainTileForTile[S.key];if(!I)continue;const C=I.tileID.key;C in T||(this._visibleDemTiles.push(I),T[C]=C)}}_assignTerrainTiles(r){this._initializing||r.forEach(s=>{if(this.terrainTileForTile[s.key])return;const h=this._findTileCoveringTileID(s,this.sourceCache);h&&(this.terrainTileForTile[s.key]=h)})}_prepareDEMTextures(){const r=this.painter.context,s=r.gl;for(const h in this.terrainTileForTile){const p=this.terrainTileForTile[h],_=p.dem;!_||p.demTexture&&!p.needsDEMTextureUpload||(r.activeTexture.set(s.TEXTURE1),cp(this.painter,p,_))}}_prepareDemTileUniforms(r,s,h,p){if(!s||s.demTexture==null)return!1;const _=r.tileID.canonical,x=Math.pow(2,s.tileID.canonical.z-_.z),T=p||"";return h[`u_dem_tl${T}`]=[_.x*x%1,_.y*x%1],h[`u_dem_scale${T}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,s=r.gl;if(!this._emptyDepthBufferTexture){const h=new o.h({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new o.T(r,h,s.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const s=this._visibleDemTiles.reduce((h,p)=>{if(!p.dem)return h;const _=p.dem.tree.minimums[0];return _>0&&r++,h+_},0);return r?s/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,s=r.gl;r.activeTexture.set(s.TEXTURE2);const h=this._getLoadedAreaMinimum(),[p,_]=(()=>{const T=new o.cm({width:1,height:1},new Float32Array([h]));return[s.R32F,T]})();this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(_,{premultiply:!1}):x=this._emptyDEMTexture=new o.T(r,_,p,{premultiply:!1}),x}setupElevationDraw(r,s,h){const p=this.painter.context,_=p.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};x.u_exaggeration=this.exaggeration();let T=null,S=null,I=1;if(h&&h.morphing&&this._useVertexMorphing){const k=h.morphing.srcDemTile,B=h.morphing.dstDemTile;I=h.morphing.phase,k&&B&&(this._prepareDemTileUniforms(r,k,x,"_prev")&&(S=k),this._prepareDemTileUniforms(r,B,x)&&(T=B))}const C=k=>k&&k.demTexture&&this.painter.linearFloatFilteringSupported()?_.LINEAR:_.NEAREST,L=k=>{x.u_dem_size=k.size[0]===1?1:k.size[0]-2};if(S&&T)p.activeTexture.set(_.TEXTURE2),T.demTexture.bind(C(T),_.CLAMP_TO_EDGE),p.activeTexture.set(_.TEXTURE4),S.demTexture.bind(C(S),_.CLAMP_TO_EDGE),T.demTexture&&L(T.demTexture),x.u_dem_lerp=I;else{T=this.terrainTileForTile[r.tileID.key],p.activeTexture.set(_.TEXTURE2);const k=this._prepareDemTileUniforms(r,T,x)?T.demTexture:this.emptyDEMTexture;k.bind(C(T),_.CLAMP_TO_EDGE),L(k)}if(p.activeTexture.set(_.TEXTURE3),h&&h.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),this._depthFBO&&(x.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE),x.u_depth_size_inv=[1,1]),h&&h.useMeterToDem&&T){const k=(1<<T.tileID.canonical.z)*o.bl(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=k}if(h&&h.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=h.labelPlaneMatrixInv),s.setTerrainUniformValues(p,x),this.painter.transform.projection.name==="globe"){const k=this.globeUniformValues(this.painter.transform,r.tileID.canonical,h&&h.useDenormalizedUpVectorScale);s.setGlobeUniformValues(p,k)}}globeUniformValues(r,s,h){const p=r.projection;return{u_tile_tl_up:p.upVector(s,0,0),u_tile_tr_up:p.upVector(s,o.V,0),u_tile_br_up:p.upVector(s,o.V,o.V),u_tile_bl_up:p.upVector(s,0,o.V),u_tile_up_scale:h?o.cl(1):p.upVectorScale(s,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const s=this.painter,h=this.painter.context;r.length!==0&&(h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),s.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(p,_,x,T,S){if(p.transform.projection.name==="globe")(function(I,C,L,k,B){const j=I.context,U=j.gl;let $,N;const H=I.transform,ee=o.cd(I,j,H),X=(Oe,Le)=>{if(N===Le)return;const We=[td[Le],"PROJECTION_GLOBE_VIEW"];ee&&We.push("CUSTOM_ANTIALIASING");const ve=I.isTileAffectedByFog(Oe);$=I.getOrCreateProgram("globeRaster",{defines:We,overrideFog:ve}),N=Le},te=I.colorModeForRenderPass(),q=new Yt(U.LEQUAL,Yt.ReadWrite,I.depthRangeFor3D);Ga.update(B);const re=o.ce(H),ae=[o.a5(H.center.lng),o.ae(H.center.lat)],ue=I.globeSharedBuffers,me=[H.width*o.f.devicePixelRatio,H.height*o.f.devicePixelRatio],Me=Float32Array.from(H.globeMatrix),ye={useDenormalizedUpVectorScale:!0};{const Oe=I.transform,Le=id(Oe.zoom,C.exaggeration(),C.sourceCache._source.tileSize);N=-1;const We=U.TRIANGLES;for(const ve of k){const Ce=L.getTile(ve),fe=li.disabled,we=C.prevTerrainTileForTile[ve.key],Ke=C.terrainTileForTile[ve.key];Xl(we,Ke)&&Ga.newMorphing(ve.key,we,Ke,B,250),j.activeTexture.set(U.TEXTURE0),Ce.texture&&Ce.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const st=Ga.getMorphValuesForProxy(ve.key),nt=st?1:0;st&&o.j(ye,{morphing:{srcDemTile:st.from,dstDemTile:st.to,phase:o.cc(st.phase)}});const _t=o.cf(ve.canonical),Ot=o.cg(_t.getCenter().lat),Zt=o.ch(ve.canonical,_t,Ot,Oe.worldSize/Oe._pixelsPerMercatorPixel),Bt=o.aT(o.ci(ve.canonical)),Ut=hp(Oe.expandedFarZProjMatrix,Me,re,Bt,o.S(Oe.zoom),ae,Oe.frustumCorners.TL,Oe.frustumCorners.TR,Oe.frustumCorners.BR,Oe.frustumCorners.BL,Oe.globeCenterInViewSpace,Oe.globeRadius,me,Le,Oe._farZ,Zt);if(X(ve,nt),$&&(C.setupElevationDraw(Ce,$,ye),I.uploadCommonUniforms(j,$,ve.toUnwrapped()),ue)){const[gi,si,di]=ue.getGridBuffers(Ot,Le!==0);$.draw(I,We,q,fe,te,Jt.backCCW,Ut,"globe_raster",gi,si,di)}}}if(ue&&(I.renderDefaultNorthPole||I.renderDefaultSouthPole)){const Oe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ee&&Oe.push("CUSTOM_ANTIALIASING"),$=I.getOrCreateProgram("globeRaster",{defines:Oe});for(const Le of k){const{x:We,y:ve,z:Ce}=Le.canonical,fe=ve===0,we=ve===(1<<Ce)-1,[Ke,st,nt,_t]=ue.getPoleBuffers(Ce,!1);if(_t&&(fe||we)){const Ot=L.getTile(Le);j.activeTexture.set(U.TEXTURE0),Ot.texture&&Ot.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);let Zt=o.cj(Ce,We,H);const Bt=o.aT(o.ci(Le.canonical)),Ut=(gi,si)=>gi.draw(I,U.TRIANGLES,q,li.disabled,te,Jt.disabled,hp(H.expandedFarZProjMatrix,Zt,Zt,Bt,0,ae,H.frustumCorners.TL,H.frustumCorners.TR,H.frustumCorners.BR,H.frustumCorners.BL,H.globeCenterInViewSpace,H.globeRadius,me,0,H._farZ),"globe_pole_raster",si,nt,_t);C.setupElevationDraw(Ot,$,ye),I.uploadCommonUniforms(j,$,Le.toUnwrapped()),fe&&I.renderDefaultNorthPole&&Ut($,Ke),we&&I.renderDefaultSouthPole&&(Zt=o.a6.scale(o.a6.create(),Zt,[1,-1,1]),Ut($,st))}}}})(p,_,x,T,S);else{const I=p.context,C=I.gl;let L,k;const B=p.shadowRenderer,j=Po(p,p.longestCutoffRange),U=te=>{if(k===te)return;const q=[];q.push(td[te]),j.shouldRenderCutoff&&q.push("RENDER_CUTOFF"),L=p.getOrCreateProgram("terrainRaster",{defines:q}),k=te},$=p.colorModeForRenderPass(),N=new Yt(C.LEQUAL,Yt.ReadWrite,p.depthRangeFor3D);Ga.update(S);const H=p.transform,ee=id(H.zoom,_.exaggeration(),_.sourceCache._source.tileSize);let X=[0,0,0];if(B){const te=p.style.directionalLight,q=p.style.ambientLight;te&&q&&(X=Hl(te,q))}{k=-1;const te=C.TRIANGLES,[q,re]=[_.gridIndexBuffer,_.gridSegments];for(const ae of T){const ue=x.getTile(ae),me=li.disabled,Me=_.prevTerrainTileForTile[ae.key],ye=_.terrainTileForTile[ae.key];Xl(Me,ye)&&Ga.newMorphing(ae.key,Me,ye,S,250),I.activeTexture.set(C.TEXTURE0),ue.texture&&ue.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE);const Oe=Ga.getMorphValuesForProxy(ae.key),Le=Oe?1:0;let We;Oe&&(We={morphing:{srcDemTile:Oe.from,dstDemTile:Oe.to,phase:o.cc(Oe.phase)}});const ve=mu(ae.projMatrix,$a(ae.canonical,H.renderWorldCopies)?ee/10:ee,X);if(U(Le),!L)continue;_.setupElevationDraw(ue,L,We);const Ce=ae.toUnwrapped();B&&B.setupShadows(Ce,L),p.uploadCommonUniforms(I,L,Ce,null,j),L.draw(p,te,N,me,$,Jt.backCCW,ve,"terrain_raster",_.gridBuffer,q,re)}}}}(s,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,s.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const s=this.painter,h=this.painter.context,p=this.proxySourceCache,_=this.proxiedCoords[p.id],x=this._drapedRenderBatches.shift(),T=s.style.order,S=[];let I=0;for(const C of _){const L=p.getTileByID(C.proxyTileKey),k=p.proxyCachedFBO[C.key]?p.proxyCachedFBO[C.key][r]:void 0,B=k!==void 0?p.renderCache[k]:this.pool[I++],j=k!==void 0;if(L.texture=B.tex,j&&!B.dirty){S.push(L.tileID);continue}let U;h.bindFramebuffer.set(B.fb.framebuffer),this.renderedToTile=!1,B.dirty&&(h.clear({color:o.ax.transparent,stencil:0}),B.dirty=!1);for(let $=x.start;$<=x.end;++$){const N=s.style._mergedLayers[T[$]];if(N.isHidden(s.transform.zoom))continue;const H=s.style.getLayerSourceCache(N),ee=H?this.proxyToSource[C.key][H.id]:[C];if(!ee)continue;const X=ee;h.viewport.set([0,0,B.fb.width,B.fb.height]),U!==(H?H.id:null)&&(this._setupStencil(B,ee,N,H),U=H?H.id:null),s.renderLayer(s,H,N,X)}if(this._drapedRenderBatches.length===0)for(const $ of this._pendingGroundEffectLayers){const N=s.style._mergedLayers[T[$]];if(N.isHidden(s.transform.zoom))continue;const H=s.style.getLayerSourceCache(N),ee=H?this.proxyToSource[C.key][H.id]:[C];if(!ee)continue;const X=ee;h.viewport.set([0,0,B.fb.width,B.fb.height]),U!==(H?H.id:null)&&(this._setupStencil(B,ee,N,H),U=H?H.id:null),s.renderLayer(s,H,N,X)}this.renderedToTile?(B.dirty=!0,S.push(L.tileID)):j||--I,I===5&&(I=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,h.bindFramebuffer.set(null),h.viewport.set([0,0,s.width,s.height]),x.end+1}postRender(){}isLayerOrderingCorrect(r){const s=r.order.length;let h=-1,p=s;for(let _=0;_<s;++_)this._style.isLayerDraped(r._mergedLayers[r.order[_]])?h=Math.max(h,_):p=Math.min(p,_);return p>h}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(s=>s.dem).forEach(s=>{r=Math.min(r,s.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,s,h){if(!this._visibleDemTiles)return null;const p=this._visibleDemTiles.filter(_=>_.dem).map(_=>{const x=_.tileID,T=1<<x.overscaledZ,{x:S,y:I}=x.canonical,C=S/T,L=(S+1)/T,k=I/T,B=(I+1)/T;return{minx:C,miny:k,maxx:L,maxy:B,t:_.dem.tree.raycastRoot(C,k,L,B,r,s,h),tile:_}});p.sort((_,x)=>(_.t!==null?_.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(const _ of p){if(_.t==null)return null;const x=_.tile.dem.tree.raycast(_.minx,_.miny,_.maxx,_.maxy,r,s,h);if(x!=null)return x}return null}_createFBO(){const r=this.painter.context,s=r.gl,h=this.drapeBufferSize;r.activeTexture.set(s.TEXTURE0);const p=new o.T(r,{width:h[0],height:h[1],data:null},s.RGBA);p.bind(s.LINEAR,s.CLAMP_TO_EDGE);const _=r.createFramebuffer(h[0],h[1],!0,null);return _.colorAttachment.set(p.texture),_.depthAttachment=new Wn(r,_.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,h[0],h[1]),this._stencilRef=0,_.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):_.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:_,tex:p,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const s=this._style._mergedLayers[r],h=s.isHidden(this.painter.transform.zoom);return s.type==="custom"?!h&&s.shouldRedrape():!h&&s.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const h of this._style.getSources())if(h instanceof gt){r=!0;break}if(!r)return;const s={};for(let h=0;h<this._style.order.length;++h){const p=this._style._mergedLayers[this._style.order[h]],_=this._style.getLayerSourceCache(p);if(_&&!s[_.id]&&!p.isHidden(this.painter.transform.zoom)&&p.type==="line"&&p.widthExpression()instanceof o.Z){s[_.id]=!0;for(const x of this.proxyCoords){const T=this.proxyToSource[x.key][_.id];if(T)for(const S of T)this._clearRenderCacheForTile(_.id,S)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const h in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[h]._source instanceof vt){r=!0;break}if(!r)return;const s={};for(let h=0;h<this._style.order.length;++h){const p=this._style._mergedLayers[this._style.order[h]],_=this._style.getLayerSourceCache(p);if(!_||s[_.id]||p.isHidden(this.painter.transform.zoom)||p.type!=="raster")continue;const x=p.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const S=this.proxyToSource[T.key][_.id];if(S)for(const I of S){const C=nd(_.getTile(I),_.findLoadedParent(I,0),_,this.painter.transform,x);(C.opacity!==1||C.mix!==0)&&this._clearRenderCacheForTile(_.id,I)}}}}_setupDrapedRenderBatches(){const r=this._style.order,s=r.length;if(s===0)return;const h=[];this._pendingGroundEffectLayers=[];let p,_=0,x=this._style._mergedLayers[r[_]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++_<s;)x=this._style._mergedLayers[r[_]];for(;_<s;++_){const T=this._style._mergedLayers[r[_]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?p===void 0&&(p=_):(T.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(_),p!==void 0&&(h.push({start:p,end:_-1}),p=void 0)))}if(p!==void 0&&h.push({start:p,end:_-1}),h.length!==0){const T=h[h.length-1];this._pendingGroundEffectLayers.every(S=>S>T.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=h}_setupRenderCache(r){const s=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,s.renderCache.length>s.renderCachePool.length){const x=Object.values(s.proxyCachedFBO);s.proxyCachedFBO={};for(let T=0;T<x.length;++T){const S=Object.values(x[T]);s.renderCachePool.push(...S)}}return}this._clearRasterLayersFromRenderCache();const h=this.proxyCoords,p=this._tilesDirty;for(let x=h.length-1;x>=0;x--){const T=h[x];if(s.getTileByID(T.key),s.proxyCachedFBO[T.key]!==void 0){const S=r[T.key],I=this.proxyToSource[T.key];let C=0;for(const L in I){const k=I[L],B=S[L];if(!B||B.length!==k.length||k.some((j,U)=>j!==B[U]||p[L]&&p[L].hasOwnProperty(j.key))){C=-1;break}++C}for(const L in s.proxyCachedFBO[T.key])s.renderCache[s.proxyCachedFBO[T.key][L]].dirty=C<0||C!==Object.values(S).length}}const _=[...this._drapedRenderBatches];_.sort((x,T)=>T.end-T.start-(x.end-x.start));for(const x of _)for(const T of h){if(s.proxyCachedFBO[T.key])continue;let S=s.renderCachePool.pop();S===void 0&&s.renderCache.length<50&&(S=s.renderCache.length,s.renderCache.push(this._createFBO())),S!==void 0&&(s.proxyCachedFBO[T.key]={},s.proxyCachedFBO[T.key][x.start]=S,s.renderCache[S].dirty=!0)}this._tilesDirty={}}_setupStencil(r,s,h,p){if(!p||!this._sourceTilesOverlap[p.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const _=this.painter.context,x=_.gl;if(s.length<=1)return void(this._overlapStencilType=!1);let T;if(h.isTileClipped())T=s.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(s[0].overscaledZ>s[s.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(_.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,h.isTileClipped()&&this._renderTileClippingMasks(s,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):li.disabled}_renderTileClippingMasks(r,s){const h=this.painter,p=this.painter.context,_=p.gl;h._tileClippingMaskIDs={},p.setColorMode(Si.disabled),p.setDepthMode(Yt.disabled);const x=h.getOrCreateProgram("clippingMask");for(const T of r){const S=h._tileClippingMaskIDs[T.key]=--s;x.draw(h,_.TRIANGLES,Yt.disabled,new li({func:_.ALWAYS,mask:0},S,255,_.KEEP,_.KEEP,_.REPLACE),Si.disabled,Jt.disabled,rd(T.projMatrix),"$clipping",h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}pointCoordinate(r){const s=this.painter.transform;if(r.x<0||r.x>s.width||r.y<0||r.y>s.height)return null;const h=[r.x,r.y,1,1];o.a7.transformMat4(h,h,s.pixelMatrixInverse),o.a7.scale(h,h,1/h[3]),h[0]/=s.worldSize,h[1]/=s.worldSize;const p=s._camera.position,_=o.bl(1,s.center.lat),x=[p[0],p[1],p[2]/_,0],T=o.N.subtract([],h.slice(0,3),x);o.N.normalize(T,T);const S=this.raycast(x,T,this._exaggeration);return S!==null&&S?(o.N.scaleAndAdd(x,x,T,S),x[3]=x[2],x[2]*=_,x):null}drawDepth(){const r=this.painter,s=r.context,h=this.proxySourceCache,p=Math.ceil(r.width),_=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===p&&this._depthFBO.height===_||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const x=s.gl,T=s.createFramebuffer(p,_,!0,"renderbuffer");s.activeTexture.set(x.TEXTURE0);const S=new o.T(s,{width:p,height:_,data:null},x.RGBA);S.bind(x.NEAREST,x.CLAMP_TO_EDGE),T.colorAttachment.set(S.texture);const I=s.createRenderbuffer(s.gl.DEPTH_COMPONENT16,p,_);T.depthAttachment.set(I),this._depthFBO=T,this._depthTexture=S}s.bindFramebuffer.set(this._depthFBO.framebuffer),s.viewport.set([0,0,p,_]),function(x,T,S,I){if(x.transform.projection.name==="globe")return;const C=x.context,L=C.gl;C.clear({depth:1});const k=x.getOrCreateProgram("terrainDepth"),B=new Yt(L.LESS,Yt.ReadWrite,x.depthRangeFor3D);for(const j of I){const U=S.getTile(j),$=mu(j.projMatrix,0,[0,0,0]);T.setupElevationDraw(U,k),k.draw(x,L.TRIANGLES,B,li.disabled,Si.unblended,Jt.backCCW,$,"terrain_depth",T.gridBuffer,T.gridIndexBuffer,T.gridNoSkirtSegments)}}(r,this,h,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,s,h){if(r.getSource()instanceof o.ap)return this._setupProxiedCoordsForImageSource(r,s,h);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const p=this.proxiedCoords[r.id]=[],_=this.proxyCoords;for(let S=0;S<_.length;S++){const I=_[S],C=this._findTileCoveringTileID(I,r);if(C){const L=this._createProxiedId(I,C,h[I.key]&&h[I.key][r.id]);p.push(L),this.proxyToSource[I.key][r.id]=[L]}}let x=!1;const T=new Set;for(let S=0;S<s.length;S++){const I=r.getTile(s[S]);if(!I||!I.hasData())continue;const C=this._findTileCoveringTileID(I.tileID,this.proxySourceCache);if(C&&C.tileID.canonical.z!==I.tileID.canonical.z){const L=this.proxyToSource[C.tileID.key][r.id],k=this._createProxiedId(C.tileID,I,h[C.tileID.key]&&h[C.tileID.key][r.id]);L?L.splice(L.length-1,0,k):this.proxyToSource[C.tileID.key][r.id]=[k];const B=this.proxyToSource[C.tileID.key][r.id];T.has(B)||T.add(B),p.push(k),x=!0}}if(this._sourceTilesOverlap[r.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(const S of T)S.sort((I,C)=>C.overscaledZ-I.overscaledZ)}_setupProxiedCoordsForImageSource(r,s,h){if(!r.getSource().loaded())return;const p=this.proxiedCoords[r.id]=[],_=this.proxyCoords,x=r.getSource(),T=x.tileID;if(!T)return;const S=new o.P(T.x,T.y)._div(1<<T.z),I=x.coordinates.map(o.L.fromLngLat).reduce((L,k)=>(L.min.x=Math.min(L.min.x,k.x-S.x),L.min.y=Math.min(L.min.y,k.y-S.y),L.max.x=Math.max(L.max.x,k.x-S.x),L.max.y=Math.max(L.max.y,k.y-S.y),L),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),C=(L,k)=>{const B=L.wrap+L.canonical.x/(1<<L.canonical.z),j=L.canonical.y/(1<<L.canonical.z),U=o.V/(1<<L.canonical.z),$=k.wrap+k.canonical.x/(1<<k.canonical.z),N=k.canonical.y/(1<<k.canonical.z);return B+U<$+I.min.x||B>$+I.max.x||j+U<N+I.min.y||j>N+I.max.y};for(let L=0;L<_.length;L++){const k=_[L];for(let B=0;B<s.length;B++){const j=r.getTile(s[B]);if(!j||!j.hasData()||C(k,j.tileID))continue;const U=this._createProxiedId(k,j,h[k.key]&&h[k.key][r.id]),$=this.proxyToSource[k.key][r.id];$?$.push(U):this.proxyToSource[k.key][r.id]=[U],p.push(U)}}}_createProxiedId(r,s,h){let p=this.orthoMatrix;if(h){const _=h.find(x=>x.key===s.tileID.key);if(_)return _}if(s.tileID.key!==r.key){const _=r.canonical.z-s.tileID.canonical.z;let x,T,S;p=o.a6.create();const I=s.tileID.wrap-r.wrap<<r.overscaledZ;_>0?(x=o.V>>_,T=x*((s.tileID.canonical.x<<_)-r.canonical.x+I),S=x*((s.tileID.canonical.y<<_)-r.canonical.y)):(x=o.V<<-_,T=o.V*(s.tileID.canonical.x-(r.canonical.x+I<<-_)),S=o.V*(s.tileID.canonical.y-(r.canonical.y<<-_))),o.a6.ortho(p,0,x,0,x,0,1),o.a6.translate(p,p,[T,S,0])}return new dp(s.tileID,r.key,p)}_findTileCoveringTileID(r,s){let h=s.getTile(r);if(h&&h.hasData())return h;const p=this._findCoveringTileCache[s.id],_=p[r.key];if(h=_?s.getTileByID(_):null,h&&h.hasData()||_===null)return h;let x=h?h.tileID:r,T=x.overscaledZ;const S=s.getSource().minzoom,I=[];if(!_){const L=s.getSource().maxzoom;if(r.canonical.z>=L){const k=r.canonical.z-L;s.getSource().reparseOverscaled?(T=Math.max(r.canonical.z+2,s.transform.tileZoom),x=new o.am(T,r.wrap,L,r.canonical.x>>k,r.canonical.y>>k)):k!==0&&(T=L,x=new o.am(T,r.wrap,L,r.canonical.x>>k,r.canonical.y>>k))}x.key!==r.key&&(I.push(x.key),h=s.getTile(x))}const C=L=>{I.forEach(k=>{p[k]=L}),I.length=0};for(T-=1;T>=S&&(!h||!h.hasData());T--){h&&C(h.tileID.key);const L=x.calculateScaledKey(T);if(h=s.getTileByID(L),h&&h.hasData())break;const k=p[L];if(k===null)break;k===void 0?I.push(L):h=s.getTileByID(k)}return C(h?h.tileID.key:null),h&&h.hasData()?h:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,s){let h=this._tilesDirty[r];h||(h=this._tilesDirty[r]={}),h[s.key]=!0}}function sd(u,r,s){const h=function(T,S,I){const C=o.N.dot(S,T),L=o.N.dot(I,[.2126,.7152,.0722]),k=(j,U,$)=>(1-$)*j+$*U,B=k(1-.3*Math.min(L,1),1,Math.min(C+1,1));return k(.92,1,Math.asin(o.aa(S[2],-1,1))/Math.PI+.5)*B}(u,[0,0,1],r),p=[0,0,0];o.N.scale(p,s.slice(0,3),h);const _=[0,0,0];o.N.scale(_,r.slice(0,3),u[2]);const x=[0,0,0];return o.N.add(x,p,_),o.bU(x)}const od=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],fp=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class ad{static cacheKey(r,s,h,p){let _=`${s}${p?p.cacheKey:""}`;for(const x of h)r.usedDefines.includes(x)&&(_+=`/${x}`);return _}constructor(r,s,h,p,_,x,T){const S=r.gl;this.program=S.createProgram(),this.configuration=p,this.name=s,this.fixedDefines=[...x];const I=p?p.getBinderAttributes():[],C=(h.staticAttributes||[]).concat(I);let L=p?p.defines():[];L=L.concat(x.map(N=>`#define ${N}`));const k=`#version 300 es
-`;let B=k+L.concat("precision mediump float;",fu,Yh.fragmentSource).join(`
-`);for(const N of h.fragmentIncludes)B+=`
-${os[N]}`;B+=`
-${h.fragmentSource}`;let j=k+L.concat("precision highp float;",fu,Yh.vertexSource).join(`
-`);for(const N of h.vertexIncludes)j+=`
-${os[N]}`;j+=`
-${h.vertexSource}`;const U=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(U,B),S.compileShader(U),S.attachShader(this.program,U);const $=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource($,j),S.compileShader($),S.attachShader(this.program,$),this.attributes={},this.numAttributes=C.length;for(let N=0;N<this.numAttributes;N++)if(C[N]){const H=C[N].startsWith("a_")?C[N]:`a_${C[N]}`;S.bindAttribLocation(this.program,N,H),this.attributes[H]=N}T&&T.shaderVaryings.length>0&&S.transformFeedbackVaryings(this.program,T.shaderVaryings,T.bufferMode),S.linkProgram(this.program),S.deleteShader($),S.deleteShader(U),this.fixedUniforms=_(r),this.binderUniforms=p?p.getUniforms(r):[],x.includes("TERRAIN")&&(this.terrainUniforms=(N=>({u_dem:new o.bO(N),u_dem_prev:new o.bO(N),u_dem_tl:new o.bL(N),u_dem_scale:new o.bN(N),u_dem_tl_prev:new o.bL(N),u_dem_scale_prev:new o.bN(N),u_dem_size:new o.bN(N),u_dem_lerp:new o.bN(N),u_exaggeration:new o.bN(N),u_depth:new o.bO(N),u_depth_size_inv:new o.bL(N),u_meter_to_dem:new o.bN(N),u_label_plane_matrix_inv:new o.bK(N)}))(r)),x.includes("GLOBE")&&(this.globeUniforms=(N=>({u_tile_tl_up:new o.bM(N),u_tile_tr_up:new o.bM(N),u_tile_br_up:new o.bM(N),u_tile_bl_up:new o.bM(N),u_tile_up_scale:new o.bN(N)}))(r)),x.includes("FOG")&&(this.fogUniforms=(N=>({u_fog_matrix:new o.bK(N),u_fog_range:new o.bL(N),u_fog_color:new o.bP(N),u_fog_horizon_blend:new o.bN(N),u_fog_vertical_limit:new o.bL(N),u_fog_temporal_offset:new o.bN(N),u_frustum_tl:new o.bM(N),u_frustum_tr:new o.bM(N),u_frustum_br:new o.bM(N),u_frustum_bl:new o.bM(N),u_globe_pos:new o.bM(N),u_globe_radius:new o.bN(N),u_globe_transition:new o.bN(N),u_is_globe:new o.bO(N),u_viewport:new o.bL(N)}))(r)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(N=>({u_cutoff_params:new o.bP(N)}))(r)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(N=>({u_lighting_ambient_color:new o.bM(N),u_lighting_directional_dir:new o.bM(N),u_lighting_directional_color:new o.bM(N),u_ground_radiance:new o.bM(N)}))(r)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(N=>({u_light_matrix_0:new o.bK(N),u_light_matrix_1:new o.bK(N),u_fade_range:new o.bL(N),u_shadow_normal_offset:new o.bM(N),u_shadow_intensity:new o.bN(N),u_shadow_texel_size:new o.bN(N),u_shadow_map_resolution:new o.bN(N),u_shadow_direction:new o.bM(N),u_shadow_bias:new o.bM(N),u_shadowmap_0:new o.bO(N),u_shadowmap_1:new o.bO(N)}))(r))}}setTerrainUniformValues(r,s){if(!this.terrainUniforms)return;const h=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const p in s)h[p]&&h[p].set(this.program,p,s[p])}}setGlobeUniformValues(r,s){if(!this.globeUniforms)return;const h=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const p in s)h[p]&&h[p].set(this.program,p,s[p])}}setFogUniformValues(r,s){if(!this.fogUniforms)return;const h=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const p in s)h[p].set(this.program,p,s[p])}}setCutoffUniformValues(r,s){if(!this.cutoffUniforms)return;const h=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const p in s)h[p].set(this.program,p,s[p])}}setLightsUniformValues(r,s){if(!this.lightsUniforms)return;const h=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const p in s)h[p].set(this.program,p,s[p])}}setShadowUniformValues(r,s){if(this.failedToCreate||!this.shadowUniforms)return;const h=this.shadowUniforms;r.program.set(this.program);for(const p in s)h[p].set(this.program,p,s[p])}_drawDebugWireframe(r,s,h,p,_,x,T,S,I,C){const L=r.options.wireframe;if(L.terrain===!1&&L.layers2D===!1&&L.layers3D===!1)return;const k=r.context;if(!(!(!L.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!L.layers2D||r._terrain&&r._terrain.renderingToTexture||!od.includes(this.name))||!(!L.layers3D||!fp.includes(this.name))))return;const B=k.gl,j=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,_,k);if(!j)return;const U=[...this.fixedDefines];U.push("DEBUG_WIREFRAME");const $=r.getOrCreateProgram(this.name,{config:this.configuration,defines:U});k.program.set($.program);const N=(X,te,q)=>{if(te[X]&&q[X])for(const re in te[X])q[X][re]&&q[X][re].set(q.program,re,te[X][re].current)};I&&I.setUniforms($.program,k,$.binderUniforms,T,{zoom:S}),N("fixedUniforms",this,$),N("terrainUniforms",this,$),N("globeUniforms",this,$),N("fogUniforms",this,$),N("lightsUniforms",this,$),N("shadowUniforms",this,$),j.bind(),k.setColorMode(new Si([B.ONE,B.ONE_MINUS_SRC_ALPHA,B.ZERO,B.ONE],o.ax.transparent,[!0,!0,!0,!1])),k.setDepthMode(new Yt(s.func===B.LESS?B.LEQUAL:s.func,Yt.ReadOnly,s.range)),k.setStencilMode(li.disabled);const H=3*x.primitiveLength*2,ee=3*x.primitiveOffset*2*2;C&&C>1?B.drawElementsInstanced(B.LINES,H,B.UNSIGNED_SHORT,ee,C):B.drawElements(B.LINES,H,B.UNSIGNED_SHORT,ee),_.bind(),k.program.set(this.program),k.setDepthMode(s),k.setStencilMode(h),k.setColorMode(p)}draw(r,s,h,p,_,x,T,S,I,C,L,k,B,j,U,$,N){const H=r.context,ee=H.gl;if(this.failedToCreate)return;H.program.set(this.program),H.setDepthMode(h),H.setStencilMode(p),H.setColorMode(_),H.setCullFace(x);for(const re of Object.keys(this.fixedUniforms))this.fixedUniforms[re].set(this.program,re,T[re]);j&&j.setUniforms(this.program,H,this.binderUniforms,k,{zoom:B});const X={[ee.POINTS]:1,[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[s],te=N&&N.length>0;if(te){for(const re of N)ee.bindBufferBase(ee.TRANSFORM_FEEDBACK_BUFFER,re.targetIndex,re.buffer.buffer);ee.beginTransformFeedback(s)}const q=$&&$>0?1:void 0;for(const re of L.get()){const ae=re.vaos||(re.vaos={});(ae[S]||(ae[S]=new Qh)).bind(H,this,I,j?j.getPaintVertexBuffers():[],C,re.vertexOffset,U||[],q),$&&$>1?ee.drawElementsInstanced(s,re.primitiveLength*X,ee.UNSIGNED_SHORT,re.primitiveOffset*X*2,$):C?ee.drawElements(s,re.primitiveLength*X,ee.UNSIGNED_SHORT,re.primitiveOffset*X*2):ee.drawArrays(s,re.vertexOffset,re.vertexLength),s===ee.TRIANGLES&&C&&this._drawDebugWireframe(r,h,p,_,C,re,k,B,j,$)}te&&ee.endTransformFeedback()}}function ld(u,r){const s=Math.pow(2,r.tileID.overscaledZ),h=r.tileSize*Math.pow(2,u.transform.tileZoom)/s,p=h*(r.tileID.canonical.x+r.tileID.wrap*s),_=h*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.a3(r,1,u.transform.tileZoom),u_pixel_coord_upper:[p>>16,_>>16],u_pixel_coord_lower:[65535&p,65535&_]}}const pp=o.a6.create(),cd=(u,r,s,h,p,_,x,T,S,I,C,L,k,B,j,U)=>{const $=r.style.light,N=$.properties.get("position"),H=[N.x,N.y,N.z],ee=o.co.create();$.properties.get("anchor")==="viewport"&&(o.co.fromRotation(ee,-r.transform.angle),o.N.transformMat3(H,H,ee));const X=$.properties.get("color"),te=r.transform,q={u_matrix:u,u_lightpos:H,u_lightintensity:$.properties.get("intensity"),u_lightcolor:[X.r,X.g,X.b],u_vertical_gradient:+s,u_opacity:h,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:pp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:p,u_edge_radius:_,u_flood_light_color:L,u_vertical_scale:k,u_flood_light_intensity:B,u_ground_shadow_factor:j,u_emissive_strength:U};return te.projection.name==="globe"&&(q.u_tile_id=[x.canonical.x,x.canonical.y,1<<x.canonical.z],q.u_zoom_transition=S,q.u_inv_rot_matrix=C,q.u_merc_center=I,q.u_up_dir=te.projection.upVector(new o.bs(0,0,0),I[0]*o.V,I[1]*o.V),q.u_height_lift=T),q},ud=(u,r,s)=>({u_matrix:u,u_edge_radius:r,u_vertical_scale:s}),aa=(u,r,s,h,p,_,x,T,S,I,C,L,k,B)=>{const j=cd(u,r,s,h,p,_,x,S,I,C,L,k,B,1,[0,0,0],0),U={u_height_factor:-Math.pow(2,x.overscaledZ)/T.tileSize/8};return o.e(j,ld(r,T),U)},qa=(u,r)=>({u_matrix:u,u_emissive_strength:r}),hd=(u,r,s,h)=>o.e(qa(u,r),ld(s,h)),la=(u,r,s)=>({u_matrix:u,u_world:s,u_emissive_strength:r}),mp=(u,r,s,h,p)=>o.e(hd(u,r,s,h),{u_world:p}),_u=(u,r,s,h)=>{const p=o.V/s.tileSize;return{u_matrix:u,u_camera_to_center_distance:r.getCameraToCenterDistance(h),u_extrude_scale:[r.pixelsToGLUnits[0]/p,r.pixelsToGLUnits[1]/p]}},dd=(u,r,s=1)=>({u_matrix:u,u_color:r,u_overlay:0,u_overlay_scale:s}),_p=o.a6.create(),fd=(u,r,s,h,p,_,x)=>{const T=u.transform,S=T.projection.name==="globe",I=S?o.cp(T.zoom,r.canonical)*T._pixelsPerMercatorPixel:o.a3(s,1,_),C={u_matrix:r.projMatrix,u_extrude_scale:I,u_intensity:x,u_inv_rot_matrix:_p,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){C.u_inv_rot_matrix=h,C.u_merc_center=p,C.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],C.u_zoom_transition=o.S(T.zoom);const L=p[0]*o.V,k=p[1]*o.V;C.u_up_dir=T.projection.upVector(new o.bs(0,0,0),L,k)}return C};function gu(u,[r,s,h,p],[_,x]){if(_===x)return[0,0,0,0];const T=255*(u-1)/(u*(x-_));return[r*T,s*T,h*T,p*T]}function gp(u,r,[s,h]){return s===h?0:.5/u+(r-s)*(u-1)/(u*(h-s))}const pd=(u,r,s,h,p,_,x,T,S,I,C,L,k,B,j,U,$,N,H,ee,X)=>{return{u_matrix:u,u_normalize_matrix:r,u_globe_matrix:s,u_merc_matrix:h,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:I,u_fade_t:C.mix,u_opacity:C.opacity*L.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:L.paint.get("raster-brightness-min"),u_brightness_high:L.paint.get("raster-brightness-max"),u_saturation_factor:(q=L.paint.get("raster-saturation"),q>0?1-1/(1.001-q):-q),u_contrast_factor:(te=L.paint.get("raster-contrast"),te>0?1/(1-te):1+te),u_spin_weights:Kl(L.paint.get("raster-hue-rotate")),u_perspective_transform:k,u_raster_elevation:B,u_zoom_transition:x,u_merc_center:T,u_cutoff_params:S,u_colorization_mix:gu(o.cq,U,N),u_colorization_offset:gp(o.cq,$,N),u_color_ramp:j,u_texture_offset:[ee/(H+2*ee),H/(H+2*ee)],u_texture_res:[H+2*ee,H+2*ee],u_emissive_strength:X};var te,q};function Kl(u){u*=Math.PI/180;const r=Math.sin(u),s=Math.cos(u);return[(2*s+1)/3,(-Math.sqrt(3)*r-s+1)/3,(Math.sqrt(3)*r-s+1)/3]}const J_=(u,r,s,h,p,_,x,T,S,I,C,L)=>({u_matrix:u,u_normalize_matrix:r,u_globe_matrix:s,u_merc_matrix:h,u_grid_matrix:p,u_tl_parent:_,u_scale_parent:I,u_fade_t:C.mix,u_opacity:C.opacity,u_image0:0,u_image1:1,u_raster_elevation:L,u_zoom_transition:x,u_merc_center:T,u_cutoff_params:S}),Q_=(u,r,s,h,p,_,x,T)=>({u_tile_offset:u,u_velocity:r,u_color_ramp:h,u_velocity_res:s,u_max_speed:p,u_texture_offset:_,u_data_scale:x,u_data_offset:T}),yp=(u,r,s,h,p,_,x,T)=>({u_velocity:u,u_velocity_res:r,u_max_speed:s,u_speed_factor:h,u_lifetime_delta:p,u_rand_seed:Math.random(),u_texture_offset:_,u_data_scale:x,u_data_offset:T}),vp=o.a6.create(),yu=(u,r,s,h,p,_,x,T,S,I,C,L,k,B,j,U,$,N)=>{const H=p.transform,ee={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:H.getCameraToCenterDistance(U),u_rotate_symbol:+s,u_aspect_ratio:H.width/H.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:x,u_coord_matrix:T,u_is_text:+S,u_pitch_with_map:+h,u_texsize:I,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:vp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:vp,u_up_vector:[0,-1,0],u_icon_transition:N||0,u_icon_saturation:$};return U.name==="globe"&&(ee.u_tile_id=[C.canonical.x,C.canonical.y,1<<C.canonical.z],ee.u_zoom_transition=L,ee.u_inv_rot_matrix=B,ee.u_merc_center=k,ee.u_camera_forward=H._camera.forward(),ee.u_ecef_origin=o.cr(H.globeMatrix,C.toUnwrapped()),ee.u_tile_matrix=Float32Array.from(H.globeMatrix),ee.u_up_vector=j),ee},Yl=(u,r,s,h,p,_,x,T,S,I,C,L,k,B,j,U,$)=>o.e(yu(u,r,s,h,p,_,x,T,S,I,L,k,B,j,U,$,1),{u_gamma_scale:h?p.transform.getCameraToCenterDistance($)*Math.cos(p.terrain?0:p.transform._pitch):1,u_device_pixel_ratio:o.f.devicePixelRatio,u_is_halo:+C,undefined:void 0}),vu=(u,r,s,h,p,_,x,T,S,I,C,L,k,B,j,U)=>o.e(Yl(u,r,s,h,p,_,x,T,!0,S,!0,C,L,k,B,j,U),{u_texsize_icon:I,u_texture_icon:1}),md=(u,r,s,h)=>({u_matrix:u,u_emissive_strength:r,u_opacity:s,u_color:h}),Jl=(u,r,s,h,p,_,x)=>o.e(function(T,S,I,C){const L=I.imageManager.getPattern(T.toString(),S),{width:k,height:B}=I.imageManager.getPixelSize(S),j=Math.pow(2,C.tileID.overscaledZ),U=C.tileSize*Math.pow(2,I.transform.tileZoom)/j,$=U*(C.tileID.canonical.x+C.tileID.wrap*j),N=U*C.tileID.canonical.y;return{u_image:0,u_pattern_tl:L.tl,u_pattern_br:L.br,u_texsize:[k,B],u_pattern_size:L.displaySize,u_tile_units_to_pixels:1/o.a3(C,1,I.transform.tileZoom),u_pixel_coord_upper:[$>>16,N>>16],u_pixel_coord_lower:[65535&$,65535&N]}}(p,_,h,x),{u_matrix:u,u_emissive_strength:r,u_opacity:s}),xu=(u,r,s,h,p,_,x,T,S,I,C,L,k=[0,0,0],B)=>{const j=h.style.light,U=j.properties.get("position"),$=[-U.x,-U.y,U.z],N=o.co.create();j.properties.get("anchor")==="viewport"&&(o.co.fromRotation(N,-h.transform.angle),o.N.transformMat3($,$,N));const H=I.alphaMode==="MASK",ee=j.properties.get("color"),X=L.paint.get("model-ambient-occlusion-intensity"),te=L.paint.get("model-color").constantOr(o.ax.white),q=L.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:u,u_lighting_matrix:r,u_normal_matrix:s,u_lightpos:$,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[ee.r,ee.g,ee.b],u_camera_pos:k,u_opacity:p,u_baseTextureIsAlpha:0,u_alphaMask:+H,u_alphaCutoff:I.alphaCutoff,u_baseColorFactor:[_.r,_.g,_.b,_.a],u_emissiveFactor:[x[0],x[1],x[2],1],u_metallicFactor:T,u_roughnessFactor:S,u_baseColorTexture:Mn.BaseColor,u_metallicRoughnessTexture:Mn.MetallicRoughness,u_normalTexture:Mn.Normal,u_occlusionTexture:Mn.Occlusion,u_emissionTexture:Mn.Emission,u_color_mix:[te.r,te.g,te.b,q],u_aoIntensity:X,u_emissive_strength:C,u_occlusionTextureTransform:B||[0,0,0,0]}},Ql=new Float32Array(16),ec=(u,r=Ql,s=Ql)=>({u_matrix:u,u_instance:r,u_node_matrix:s}),eg={fillExtrusion:u=>({u_matrix:new o.bK(u),u_lightpos:new o.bM(u),u_lightintensity:new o.bN(u),u_lightcolor:new o.bM(u),u_vertical_gradient:new o.bN(u),u_opacity:new o.bN(u),u_edge_radius:new o.bN(u),u_ao:new o.bL(u),u_tile_id:new o.bM(u),u_zoom_transition:new o.bN(u),u_inv_rot_matrix:new o.bK(u),u_merc_center:new o.bL(u),u_up_dir:new o.bM(u),u_height_lift:new o.bN(u),u_flood_light_color:new o.bM(u),u_vertical_scale:new o.bN(u),u_flood_light_intensity:new o.bN(u),u_ground_shadow_factor:new o.bM(u),u_emissive_strength:new o.bN(u)}),fillExtrusionDepth:u=>({u_matrix:new o.bK(u),u_edge_radius:new o.bN(u),u_vertical_scale:new o.bN(u)}),fillExtrusionPattern:u=>({u_matrix:new o.bK(u),u_lightpos:new o.bM(u),u_lightintensity:new o.bN(u),u_lightcolor:new o.bM(u),u_vertical_gradient:new o.bN(u),u_height_factor:new o.bN(u),u_edge_radius:new o.bN(u),u_ao:new o.bL(u),u_tile_id:new o.bM(u),u_zoom_transition:new o.bN(u),u_inv_rot_matrix:new o.bK(u),u_merc_center:new o.bL(u),u_up_dir:new o.bM(u),u_height_lift:new o.bN(u),u_image:new o.bO(u),u_texsize:new o.bL(u),u_pixel_coord_upper:new o.bL(u),u_pixel_coord_lower:new o.bL(u),u_tile_units_to_pixels:new o.bN(u),u_opacity:new o.bN(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new o.bK(u),u_opacity:new o.bN(u),u_ao_pass:new o.bN(u),u_meter_to_tile:new o.bN(u),u_ao:new o.bL(u),u_flood_light_intensity:new o.bN(u),u_flood_light_color:new o.bM(u),u_attenuation:new o.bN(u),u_edge_radius:new o.bN(u),u_fb:new o.bO(u),u_fb_size:new o.bN(u)}),fill:u=>({u_matrix:new o.bK(u),u_emissive_strength:new o.bN(u)}),fillPattern:u=>({u_matrix:new o.bK(u),u_emissive_strength:new o.bN(u),u_image:new o.bO(u),u_texsize:new o.bL(u),u_pixel_coord_upper:new o.bL(u),u_pixel_coord_lower:new o.bL(u),u_tile_units_to_pixels:new o.bN(u)}),fillOutline:u=>({u_matrix:new o.bK(u),u_emissive_strength:new o.bN(u),u_world:new o.bL(u)}),fillOutlinePattern:u=>({u_matrix:new o.bK(u),u_emissive_strength:new o.bN(u),u_world:new o.bL(u),u_image:new o.bO(u),u_texsize:new o.bL(u),u_pixel_coord_upper:new o.bL(u),u_pixel_coord_lower:new o.bL(u),u_tile_units_to_pixels:new o.bN(u)}),circle:o.cs,collisionBox:u=>({u_matrix:new o.bK(u),u_camera_to_center_distance:new o.bN(u),u_extrude_scale:new o.bL(u)}),collisionCircle:u=>({u_matrix:new o.bK(u),u_inv_matrix:new o.bK(u),u_camera_to_center_distance:new o.bN(u),u_viewport_size:new o.bL(u)}),debug:u=>({u_color:new o.ca(u),u_matrix:new o.bK(u),u_overlay:new o.bO(u),u_overlay_scale:new o.bN(u)}),clippingMask:u=>({u_matrix:new o.bK(u)}),heatmap:u=>({u_extrude_scale:new o.bN(u),u_intensity:new o.bN(u),u_matrix:new o.bK(u),u_inv_rot_matrix:new o.bK(u),u_merc_center:new o.bL(u),u_tile_id:new o.bM(u),u_zoom_transition:new o.bN(u),u_up_dir:new o.bM(u)}),heatmapTexture:u=>({u_image:new o.bO(u),u_color_ramp:new o.bO(u),u_opacity:new o.bN(u)}),hillshade:u=>({u_matrix:new o.bK(u),u_image:new o.bO(u),u_latrange:new o.bL(u),u_light:new o.bL(u),u_shadow:new o.ca(u),u_highlight:new o.ca(u),u_emissive_strength:new o.bN(u),u_accent:new o.ca(u)}),hillshadePrepare:u=>({u_matrix:new o.bK(u),u_image:new o.bO(u),u_dimension:new o.bL(u),u_zoom:new o.bN(u)}),line:o.ct,linePattern:o.cu,raster:u=>({u_matrix:new o.bK(u),u_normalize_matrix:new o.bK(u),u_globe_matrix:new o.bK(u),u_merc_matrix:new o.bK(u),u_grid_matrix:new o.cb(u),u_tl_parent:new o.bL(u),u_scale_parent:new o.bN(u),u_fade_t:new o.bN(u),u_opacity:new o.bN(u),u_image0:new o.bO(u),u_image1:new o.bO(u),u_brightness_low:new o.bN(u),u_brightness_high:new o.bN(u),u_saturation_factor:new o.bN(u),u_contrast_factor:new o.bN(u),u_spin_weights:new o.bM(u),u_perspective_transform:new o.bL(u),u_raster_elevation:new o.bN(u),u_zoom_transition:new o.bN(u),u_merc_center:new o.bL(u),u_cutoff_params:new o.bP(u),u_colorization_mix:new o.bP(u),u_colorization_offset:new o.bN(u),u_color_ramp:new o.bO(u),u_texture_offset:new o.bL(u),u_texture_res:new o.bL(u),u_emissive_strength:new o.bN(u)}),rasterParticle:u=>({u_matrix:new o.bK(u),u_normalize_matrix:new o.bK(u),u_globe_matrix:new o.bK(u),u_merc_matrix:new o.bK(u),u_grid_matrix:new o.cb(u),u_tl_parent:new o.bL(u),u_scale_parent:new o.bN(u),u_fade_t:new o.bN(u),u_opacity:new o.bN(u),u_image0:new o.bO(u),u_image1:new o.bO(u),u_raster_elevation:new o.bN(u),u_zoom_transition:new o.bN(u),u_merc_center:new o.bL(u),u_cutoff_params:new o.bP(u)}),rasterParticleTexture:u=>({u_texture:new o.bO(u),u_opacity:new o.bN(u)}),rasterParticleDraw:u=>({u_tile_offset:new o.bL(u),u_velocity:new o.bO(u),u_color_ramp:new o.bO(u),u_velocity_res:new o.bL(u),u_max_speed:new o.bN(u),u_texture_offset:new o.bL(u),u_data_scale:new o.bP(u),u_data_offset:new o.bN(u)}),rasterParticleUpdate:u=>({u_velocity:new o.bO(u),u_velocity_res:new o.bL(u),u_max_speed:new o.bN(u),u_speed_factor:new o.bN(u),u_lifetime_delta:new o.bN(u),u_rand_seed:new o.bN(u),u_texture_offset:new o.bL(u),u_data_scale:new o.bP(u),u_data_offset:new o.bN(u)}),symbolIcon:u=>({u_is_size_zoom_constant:new o.bO(u),u_is_size_feature_constant:new o.bO(u),u_size_t:new o.bN(u),u_size:new o.bN(u),u_camera_to_center_distance:new o.bN(u),u_rotate_symbol:new o.bO(u),u_aspect_ratio:new o.bN(u),u_fade_change:new o.bN(u),u_matrix:new o.bK(u),u_label_plane_matrix:new o.bK(u),u_coord_matrix:new o.bK(u),u_is_text:new o.bO(u),u_pitch_with_map:new o.bO(u),u_texsize:new o.bL(u),u_tile_id:new o.bM(u),u_zoom_transition:new o.bN(u),u_inv_rot_matrix:new o.bK(u),u_merc_center:new o.bL(u),u_camera_forward:new o.bM(u),u_tile_matrix:new o.bK(u),u_up_vector:new o.bM(u),u_ecef_origin:new o.bM(u),u_texture:new o.bO(u),u_icon_transition:new o.bN(u),u_icon_saturation:new o.bN(u)}),symbolSDF:u=>({u_is_size_zoom_constant:new o.bO(u),u_is_size_feature_constant:new o.bO(u),u_size_t:new o.bN(u),u_size:new o.bN(u),u_camera_to_center_distance:new o.bN(u),u_rotate_symbol:new o.bO(u),u_aspect_ratio:new o.bN(u),u_fade_change:new o.bN(u),u_matrix:new o.bK(u),u_label_plane_matrix:new o.bK(u),u_coord_matrix:new o.bK(u),u_is_text:new o.bO(u),u_pitch_with_map:new o.bO(u),u_texsize:new o.bL(u),u_texture:new o.bO(u),u_gamma_scale:new o.bN(u),u_device_pixel_ratio:new o.bN(u),u_tile_id:new o.bM(u),u_zoom_transition:new o.bN(u),u_inv_rot_matrix:new o.bK(u),u_merc_center:new o.bL(u),u_camera_forward:new o.bM(u),u_tile_matrix:new o.bK(u),u_up_vector:new o.bM(u),u_ecef_origin:new o.bM(u),u_is_halo:new o.bO(u)}),symbolTextAndIcon:u=>({u_is_size_zoom_constant:new o.bO(u),u_is_size_feature_constant:new o.bO(u),u_size_t:new o.bN(u),u_size:new o.bN(u),u_camera_to_center_distance:new o.bN(u),u_rotate_symbol:new o.bO(u),u_aspect_ratio:new o.bN(u),u_fade_change:new o.bN(u),u_matrix:new o.bK(u),u_label_plane_matrix:new o.bK(u),u_coord_matrix:new o.bK(u),u_is_text:new o.bO(u),u_pitch_with_map:new o.bO(u),u_texsize:new o.bL(u),u_texsize_icon:new o.bL(u),u_texture:new o.bO(u),u_texture_icon:new o.bO(u),u_gamma_scale:new o.bN(u),u_device_pixel_ratio:new o.bN(u),u_is_halo:new o.bO(u)}),background:u=>({u_matrix:new o.bK(u),u_emissive_strength:new o.bN(u),u_opacity:new o.bN(u),u_color:new o.ca(u)}),backgroundPattern:u=>({u_matrix:new o.bK(u),u_emissive_strength:new o.bN(u),u_opacity:new o.bN(u),u_image:new o.bO(u),u_pattern_tl:new o.bL(u),u_pattern_br:new o.bL(u),u_texsize:new o.bL(u),u_pattern_size:new o.bL(u),u_pixel_coord_upper:new o.bL(u),u_pixel_coord_lower:new o.bL(u),u_tile_units_to_pixels:new o.bN(u)}),terrainRaster:up,terrainDepth:up,skybox:u=>({u_matrix:new o.bK(u),u_sun_direction:new o.bM(u),u_cubemap:new o.bO(u),u_opacity:new o.bN(u),u_temporal_offset:new o.bN(u)}),skyboxGradient:u=>({u_matrix:new o.bK(u),u_color_ramp:new o.bO(u),u_center_direction:new o.bM(u),u_radius:new o.bN(u),u_opacity:new o.bN(u),u_temporal_offset:new o.bN(u)}),skyboxCapture:u=>({u_matrix_3f:new o.cb(u),u_sun_direction:new o.bM(u),u_sun_intensity:new o.bN(u),u_color_tint_r:new o.bP(u),u_color_tint_m:new o.bP(u),u_luminance:new o.bN(u)}),globeRaster:u=>({u_proj_matrix:new o.bK(u),u_globe_matrix:new o.bK(u),u_normalize_matrix:new o.bK(u),u_merc_matrix:new o.bK(u),u_zoom_transition:new o.bN(u),u_merc_center:new o.bL(u),u_image0:new o.bO(u),u_grid_matrix:new o.cb(u),u_skirt_height:new o.bN(u),u_far_z_cutoff:new o.bN(u),u_frustum_tl:new o.bM(u),u_frustum_tr:new o.bM(u),u_frustum_br:new o.bM(u),u_frustum_bl:new o.bM(u),u_globe_pos:new o.bM(u),u_globe_radius:new o.bN(u),u_viewport:new o.bL(u)}),globeAtmosphere:u=>({u_frustum_tl:new o.bM(u),u_frustum_tr:new o.bM(u),u_frustum_br:new o.bM(u),u_frustum_bl:new o.bM(u),u_horizon:new o.bN(u),u_transition:new o.bN(u),u_fadeout_range:new o.bN(u),u_color:new o.bP(u),u_high_color:new o.bP(u),u_space_color:new o.bP(u),u_temporal_offset:new o.bN(u),u_horizon_angle:new o.bN(u)}),model:u=>({u_matrix:new o.bK(u),u_lighting_matrix:new o.bK(u),u_normal_matrix:new o.bK(u),u_lightpos:new o.bM(u),u_lightintensity:new o.bN(u),u_lightcolor:new o.bM(u),u_camera_pos:new o.bM(u),u_opacity:new o.bN(u),u_baseColorFactor:new o.bP(u),u_emissiveFactor:new o.bP(u),u_metallicFactor:new o.bN(u),u_roughnessFactor:new o.bN(u),u_baseTextureIsAlpha:new o.bO(u),u_alphaMask:new o.bO(u),u_alphaCutoff:new o.bN(u),u_baseColorTexture:new o.bO(u),u_metallicRoughnessTexture:new o.bO(u),u_normalTexture:new o.bO(u),u_occlusionTexture:new o.bO(u),u_emissionTexture:new o.bO(u),u_color_mix:new o.bP(u),u_aoIntensity:new o.bN(u),u_emissive_strength:new o.bN(u),u_occlusionTextureTransform:new o.bP(u)}),modelDepth:u=>({u_matrix:new o.bK(u),u_instance:new o.bK(u),u_node_matrix:new o.bK(u)}),groundShadow:u=>({u_matrix:new o.bK(u),u_ground_shadow_factor:new o.bM(u)}),stars:u=>({u_matrix:new o.bK(u),u_up:new o.bM(u),u_right:new o.bM(u),u_intensity_multiplier:new o.bN(u)})};let Is;function Cs(u,r,s,h,p,_,x){const T=u.context,S=T.gl,I=u.transform,C=u.getOrCreateProgram("collisionBox"),L=[];let k=0,B=0;for(let X=0;X<h.length;X++){const te=h[X],q=r.getTile(te),re=q.getBucket(s);if(!re)continue;const ae=kh(te,re,I);let ue=ae;p[0]===0&&p[1]===0||(ue=u.translatePosMatrix(ae,q,p,_));const me=x?re.textCollisionBox:re.iconCollisionBox,Me=re.collisionCircleArray;if(Me.length>0){const ye=o.a6.create(),Oe=ue;o.a6.mul(ye,re.placementInvProjMatrix,I.glCoordMatrix),o.a6.mul(ye,ye,re.placementViewportMatrix),L.push({circleArray:Me,circleOffset:B,transform:Oe,invTransform:ye,projection:re.getProjection()}),k+=Me.length/4,B=k}me&&(u.terrain&&u.terrain.setupElevationDraw(q,C),C.draw(u,S.LINES,Yt.disabled,li.disabled,u.colorModeForRenderPass(),Jt.disabled,_u(ue,I,q,re.getProjection()),s.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,null,I.zoom,null,[me.collisionVertexBuffer,me.collisionVertexBufferExt]))}if(!x||!L.length)return;const j=u.getOrCreateProgram("collisionCircle"),U=new o.cv;U.resize(4*k),U._trim();let $=0;for(const X of L)for(let te=0;te<X.circleArray.length/4;te++){const q=4*te,re=X.circleArray[q+0],ae=X.circleArray[q+1],ue=X.circleArray[q+2],me=X.circleArray[q+3];U.emplace($++,re,ae,ue,me,0),U.emplace($++,re,ae,ue,me,1),U.emplace($++,re,ae,ue,me,2),U.emplace($++,re,ae,ue,me,3)}(!Is||Is.length<2*k)&&(Is=function(X){const te=2*X,q=new o.aw;q.resize(te),q._trim();for(let re=0;re<te;re++){const ae=6*re;q.uint16[ae+0]=4*re+0,q.uint16[ae+1]=4*re+1,q.uint16[ae+2]=4*re+2,q.uint16[ae+3]=4*re+2,q.uint16[ae+4]=4*re+3,q.uint16[ae+5]=4*re+0}return q}(k));const N=T.createIndexBuffer(Is,!0),H=T.createVertexBuffer(U,o.cw.members,!0);for(const X of L){const te={u_matrix:X.transform,u_inv_matrix:X.invTransform,u_camera_to_center_distance:(ee=I).getCameraToCenterDistance(X.projection),u_viewport_size:[ee.width,ee.height]};j.draw(u,S.TRIANGLES,Yt.disabled,li.disabled,u.colorModeForRenderPass(),Jt.disabled,te,s.id,H,N,o.aB.simpleSegment(0,2*X.circleOffset,X.circleArray.length,X.circleArray.length/2),null,I.zoom)}var ee;H.destroy(),N.destroy()}const to=o.a6.create();function tc(u){const r=u._camera.getWorldToCamera(u.worldSize,1),s=o.a6.multiply([],r,u.globeMatrix);o.a6.invert(s,s);const h=[0,0,0],p=[0,1,0,0];return o.a7.transformMat4(p,p,s),h[0]=p[0],h[1]=p[1],h[2]=p[2],o.N.normalize(h,h),h}function Ct({width:u,height:r,anchor:s,textOffset:h,textScale:p},_){const{horizontalAlign:x,verticalAlign:T}=o.bf(s),S=-(x-.5)*u,I=-(T-.5)*r,C=o.bd(s,h);return new o.P((S/p+C[0])*_,(I/p+C[1])*_)}function xp(u,r,s,h,p,_,x,T,S,I,C){const L=u.text.placedSymbolArray,k=u.text.dynamicLayoutVertexArray,B=u.icon.dynamicLayoutVertexArray,j={},U=u.getProjection(),$=Ul(T,U,_),N=_.elevation,H=U.upVectorScale(T.canonical,_.center.lat,_.worldSize).metersToTile;k.clear();for(let ee=0;ee<L.length;ee++){const X=L.get(ee),{tileAnchorX:te,tileAnchorY:q,numGlyphs:re}=X,ae=X.hidden||!X.crossTileID||u.allowVerticalPlacement&&!X.placedOrientation?null:h[X.crossTileID];if(ae){let ue=0,me=0,Me=0;if(N){const Ke=N?N.getAtTileOffset(T,te,q):0,[st,nt,_t]=U.upVector(T.canonical,te,q);ue=Ke*st*H,me=Ke*nt*H,Me=Ke*_t*H}let[ye,Oe,Le,We]=fs(X.projectedAnchorX+ue,X.projectedAnchorY+me,X.projectedAnchorZ+Me,s?$:x);const ve=Qf(_.getCameraToCenterDistance(U),We);let Ce=p.evaluateSizeForFeature(u.textSizeData,I,X)*ve/o.bc;s&&(Ce*=u.tilePixelRatio/S);const fe=Ct(ae,Ce);s?({x:ye,y:Oe,z:Le}=U.projectTilePoint(te+fe.x,q+fe.y,T.canonical),[ye,Oe,Le]=fs(ye+ue,Oe+me,Le+Me,x)):(r&&fe._rotate(-_.angle),ye+=fe.x,Oe+=fe.y,Le=0);const we=u.allowVerticalPlacement&&X.placedOrientation===o.b6.vertical?Math.PI/2:0;for(let Ke=0;Ke<re;Ke++)o.b9(k,ye,Oe,Le,we);C&&X.associatedIconIndex>=0&&(j[X.associatedIconIndex]={x:ye,y:Oe,z:Le,angle:we})}else Io(re,k)}if(C){B.clear();const ee=u.icon.placedSymbolArray;for(let X=0;X<ee.length;X++){const te=ee.get(X),{numGlyphs:q}=te,re=j[X];if(te.hidden||!re)Io(q,B);else{const{x:ae,y:ue,z:me,angle:Me}=re;for(let ye=0;ye<q;ye++)o.b9(B,ae,ue,me,Me)}}u.icon.dynamicLayoutVertexBuffer.updateData(B)}u.text.dynamicLayoutVertexBuffer.updateData(k)}function bu(u,r,s,h,p,_,x={}){const T=s.paint.get("icon-translate"),S=s.paint.get("text-translate"),I=s.paint.get("icon-translate-anchor"),C=s.paint.get("text-translate-anchor"),L=s.layout.get("icon-rotation-alignment"),k=s.layout.get("text-rotation-alignment"),B=s.layout.get("icon-pitch-alignment"),j=s.layout.get("text-pitch-alignment"),U=s.layout.get("icon-keep-upright"),$=s.layout.get("text-keep-upright"),N=s.paint.get("icon-color-saturation"),H=u.context,ee=H.gl,X=u.transform,te=L==="map",q=k==="map",re=B==="map",ae=j==="map",ue=s.layout.get("symbol-sort-key").constantOr(1)!==void 0;let me=!1;const Me=u.depthModeForSublayer(0,Yt.ReadOnly),ye=[o.a5(X.center.lng),o.ae(X.center.lat)],Oe=s.layout.get("text-variable-anchor"),Le=X.projection.name==="globe",We=[],ve=[0,-1,0];for(const Ce of h){const fe=r.getTile(Ce),we=fe.getBucket(s);if(!we||we.projection.name==="mercator"&&Le||we.fullyClipped)continue;const Ke=we.projection.name==="globe",st=Ke?o.S(X.zoom):0,nt=Ul(Ce,we.getProjection(),X),_t=X.calculatePixelsToTileUnitsMatrix(fe),Ot=Oe&&we.hasTextData(),Zt=we.hasIconTextFit()&&Ot&&we.hasIconData(),Bt=we.getProjection().createInversionMatrix(X,Ce.canonical),Ut=()=>{const kr=te&&s.layout.get("symbol-placement")!=="point",Ii=[],Gi=kr||Zt,Ci=s.paint.get("icon-image-cross-fade").constantOr(0);u.terrainRenderModeElevated()&&re&&Ii.push("PITCH_WITH_MAP_TERRAIN"),Ke&&(Ii.push("PROJECTION_GLOBE_VIEW"),Gi&&Ii.push("PROJECTED_POS_ON_VIEWPORT")),Ci>0&&Ii.push("ICON_TRANSITION"),we.icon.zOffsetVertexBuffer&&Ii.push("Z_OFFSET"),N<1&&Ii.push("SATURATION");const ji=we.icon.programConfigurations.get(s.id),vr=u.getOrCreateProgram(we.sdfIcons?"symbolSDF":"symbolIcon",{config:ji,defines:Ii});let Yi;const fn=fe.imageAtlasTexture?fe.imageAtlasTexture.size:[0,0],An=we.iconSizeData,Yn=o.b5(An,X.zoom),$s=re||X.pitch!==0,Jn=Nl(nt,fe.tileID.canonical,re,te,X,we.getProjection(),_t),pn=Ch(nt,fe.tileID.canonical,re,te,X,we.getProjection(),_t),an=u.translatePosMatrix(pn,fe,T,I,!0),kn=u.translatePosMatrix(nt,fe,T,I),Gn=Gi?to:Jn,Qn=te&&!re&&!kr;let qs=ve;!Le&&!X.mercatorFromTransition||te||(qs=tc(X));const Uo=Ke?qs:ve;Yi=we.sdfIcons&&!we.iconsInText?Yl(An.kind,Yn,Qn,re,u,kn,Gn,an,!1,fn,!0,Ce,st,ye,Bt,Uo,we.getProjection()):yu(An.kind,Yn,Qn,re,u,kn,Gn,an,!1,fn,Ce,st,ye,Bt,Uo,we.getProjection(),N,Ci);const fa=fe.imageAtlasTexture?fe.imageAtlasTexture:null,xc=s.layout.get("icon-size").constantOr(0)!==1||we.iconsNeedLinear,bc=we.sdfIcons||u.options.rotating||u.options.zooming||xc||$s?ee.LINEAR:ee.NEAREST,qd=we.sdfIcons&&s.paint.get("icon-halo-width").constantOr(1)!==0,wc=u.terrain&&re&&kr?o.a6.invert(o.a6.create(),Jn):to;if(kr&&we.icon){const Ka=X.elevation,Ru=Ka?Ka.getAtTileOffsetFunc(Ce,X.center.lat,X.worldSize,we.getProjection()):null,so=Ih(nt,fe.tileID.canonical,re,te,X,we.getProjection(),_t);Rh(we,nt,u,!1,so,pn,re,U,Ru,Ce)}return{program:vr,buffers:we.icon,uniformValues:Yi,atlasTexture:fa,atlasTextureIcon:null,atlasInterpolation:bc,atlasInterpolationIcon:null,isSDF:we.sdfIcons,hasHalo:qd,tile:fe,labelPlaneMatrixInv:wc}},gi=()=>{const kr=q&&s.layout.get("symbol-placement")!=="point",Ii=[],Gi=kr||Oe||Zt;u.terrainRenderModeElevated()&&ae&&Ii.push("PITCH_WITH_MAP_TERRAIN"),Ke&&(Ii.push("PROJECTION_GLOBE_VIEW"),Gi&&Ii.push("PROJECTED_POS_ON_VIEWPORT")),we.text.zOffsetVertexBuffer&&Ii.push("Z_OFFSET");const Ci=we.text.programConfigurations.get(s.id),ji=u.getOrCreateProgram(we.iconsInText?"symbolTextAndIcon":"symbolSDF",{config:Ci,defines:Ii});let vr,Yi=[0,0],fn=null;const An=we.textSizeData;we.iconsInText&&(Yi=fe.imageAtlasTexture?fe.imageAtlasTexture.size:[0,0],fn=fe.imageAtlasTexture?fe.imageAtlasTexture:null,vr=ae||X.pitch!==0||u.options.rotating||u.options.zooming||An.kind==="composite"||An.kind==="camera"?ee.LINEAR:ee.NEAREST);const Yn=fe.glyphAtlasTexture?fe.glyphAtlasTexture.size:[0,0],$s=o.b5(An,X.zoom),Jn=Nl(nt,fe.tileID.canonical,ae,q,X,we.getProjection(),_t),pn=Ch(nt,fe.tileID.canonical,ae,q,X,we.getProjection(),_t),an=u.translatePosMatrix(pn,fe,S,C,!0),kn=u.translatePosMatrix(nt,fe,S,C),Gn=Gi?to:Jn,Qn=q&&!ae&&!kr;let qs=ve;!Le&&!X.mercatorFromTransition||q||(qs=tc(X));const Uo=Ke?qs:ve;let fa;fa=we.iconsInText?vu(An.kind,$s,Qn,ae,u,kn,Gn,an,Yn,Yi,Ce,st,ye,Bt,Uo,we.getProjection()):Yl(An.kind,$s,Qn,ae,u,kn,Gn,an,!0,Yn,!0,Ce,st,ye,Bt,Uo,we.getProjection());const xc=fe.glyphAtlasTexture?fe.glyphAtlasTexture:null,bc=ee.LINEAR,qd=s.paint.get("text-halo-width").constantOr(1)!==0,wc=u.terrain&&ae&&kr?o.a6.invert(o.a6.create(),Jn):to;if(kr&&we.text){const Ka=X.elevation,Ru=Ka?Ka.getAtTileOffsetFunc(Ce,X.center.lat,X.worldSize,we.getProjection()):null,so=Ih(nt,fe.tileID.canonical,ae,q,X,we.getProjection(),_t);Rh(we,nt,u,!0,so,pn,ae,$,Ru,Ce)}return{program:ji,buffers:we.text,uniformValues:fa,atlasTexture:xc,atlasTextureIcon:fn,atlasInterpolation:bc,atlasInterpolationIcon:vr,isSDF:!0,hasHalo:qd,tile:fe,labelPlaneMatrixInv:wc}},si=we.icon.segments.get().length,di=we.text.segments.get().length,ui=si&&!x.onlyText?Ut():null,ki=di&&!x.onlyIcons?gi():null,pr=s.paint.get("icon-opacity").constantOr(1),Ai=s.paint.get("text-opacity").constantOr(1);if(ue&&we.canOverlap){me=!0;const kr=pr&&!x.onlyText?we.icon.segments.get():[],Ii=Ai&&!x.onlyIcons?we.text.segments.get():[];for(const Gi of kr)We.push({segments:new o.aB([Gi]),sortKey:Gi.sortKey,state:ui});for(const Gi of Ii)We.push({segments:new o.aB([Gi]),sortKey:Gi.sortKey,state:ki})}else x.onlyText||We.push({segments:pr?we.icon.segments:new o.aB([]),sortKey:0,state:ui}),x.onlyIcons||We.push({segments:Ai?we.text.segments:new o.aB([]),sortKey:0,state:ki})}me&&We.sort((Ce,fe)=>Ce.sortKey-fe.sortKey);for(const Ce of We){const fe=Ce.state;if(fe)if(u.terrain&&u.terrain.setupElevationDraw(fe.tile,fe.program,{useDepthForOcclusion:X.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:fe.labelPlaneMatrixInv}),H.activeTexture.set(ee.TEXTURE0),fe.atlasTexture&&fe.atlasTexture.bind(fe.atlasInterpolation,ee.CLAMP_TO_EDGE,!0),fe.atlasTextureIcon&&(H.activeTexture.set(ee.TEXTURE1),fe.atlasTextureIcon&&fe.atlasTextureIcon.bind(fe.atlasInterpolationIcon,ee.CLAMP_TO_EDGE,!0)),u.uploadCommonLightUniforms(u.context,fe.program),fe.hasHalo){const we=fe.uniformValues;we.u_is_halo=1,Do(fe.buffers,Ce.segments,s,u,fe.program,Me,p,_,we,2),we.u_is_halo=0}else{if(fe.isSDF){const we=fe.uniformValues;fe.hasHalo&&(we.u_is_halo=1,Do(fe.buffers,Ce.segments,s,u,fe.program,Me,p,_,we,1)),we.u_is_halo=0}Do(fe.buffers,Ce.segments,s,u,fe.program,Me,p,_,fe.uniformValues,1)}}}function Do(u,r,s,h,p,_,x,T,S,I){const C=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer];p.draw(h,h.context.gl.TRIANGLES,_,x,T,Jt.disabled,S,s.id,u.layoutVertexBuffer,u.indexBuffer,r,s.paint,h.transform.zoom,u.programConfigurations.get(s.id),C,I)}function ca(u,r,s,h,p,_,x){const T=u.context.gl,S=s.paint.get("fill-pattern"),I=S&&S.constantOr(1);let C,L,k,B,j;x?(L=I&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",C=T.LINES):(L=I?"fillPattern":"fill",C=T.TRIANGLES);for(const U of h){const $=r.getTile(U);if(I&&!$.patternsLoaded())continue;const N=$.getBucket(s);if(!N)continue;u.prepareDrawTile();const H=N.programConfigurations.get(s.id),ee=u.isTileAffectedByFog(U),X=u.getOrCreateProgram(L,{config:H,overrideFog:ee});I&&(u.context.activeTexture.set(T.TEXTURE0),$.imageAtlasTexture&&$.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),H.updatePaintBuffers());const te=S.constantOr(null);if(te&&$.imageAtlas){const ae=$.imageAtlas.patternPositions[te.toString()];ae&&H.setConstantPatternPositions(ae)}const q=u.translatePosMatrix(U.projMatrix,$,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor")),re=s.paint.get("fill-emissive-strength");if(x){B=N.indexBuffer2,j=N.segments2;const ae=u.terrain&&u.terrain.renderingToTexture?u.terrain.drapeBufferSize:[T.drawingBufferWidth,T.drawingBufferHeight];k=L==="fillOutlinePattern"&&I?mp(q,re,u,$,ae):la(q,re,ae)}else B=N.indexBuffer,j=N.segments,k=I?hd(q,re,u,$):qa(q,re);u.uploadCommonUniforms(u.context,X,U.toUnwrapped()),X.draw(u,C,p,u.stencilModeForClipping(U),_,Jt.disabled,k,s.id,N.layoutVertexBuffer,B,j,s.paint,u.transform.zoom,H,void 0)}}function zt(u,r,s,h,p,_,x,T){s.resetLayerRenderingStats(u);const S=u.context,I=S.gl,C=u.transform,L=s.paint.get("fill-extrusion-pattern"),k=L.constantOr(1),B=s.paint.get("fill-extrusion-opacity"),j=u.style.enable3dLights(),U=s.paint.get(j&&!k?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),$=[s.paint.get("fill-extrusion-ambient-occlusion-intensity"),U],N=s.layout.get("fill-extrusion-edge-radius"),H=N>0&&!s.paint.get("fill-extrusion-rounded-roof"),ee=H?0:N,X=C.projection.name==="globe"?o.cF():0,te=C.projection.name==="globe",q=te?o.S(C.zoom):0,re=[o.a5(C.center.lng),o.ae(C.center.lat)],ae=s.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),ue=s.paint.get("fill-extrusion-flood-light-intensity"),me=s.paint.get("fill-extrusion-vertical-scale"),Me=Po(u,s.paint.get("fill-extrusion-cutoff-fade-range")),ye=s.paint.get("fill-extrusion-emissive-strength"),Oe=[];let Le;te&&Oe.push("PROJECTION_GLOBE_VIEW"),$[0]>0&&Oe.push("FAUX_AO"),H&&Oe.push("ZERO_ROOF_RADIUS"),T&&Oe.push("HAS_CENTROID"),ue>0&&Oe.push("FLOOD_LIGHT"),Me.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF");const We=u.renderPass==="shadow",ve=u.shadowRenderer,Ce=We&&!!ve;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let fe=[0,0,0];if(ve){const st=u.style.directionalLight,nt=u.style.ambientLight;st&&nt&&(fe=Hl(st,nt)),Le=Oe.concat(["SHADOWS_SINGLE_CASCADE"])}const we=Ce?"fillExtrusionDepth":k?"fillExtrusionPattern":"fillExtrusion",Ke=s.getLayerRenderingStats();for(const st of h){const nt=r.getTile(st),_t=nt.getBucket(s);if(!_t||_t.projection.name!==C.projection.name)continue;let Ot=!1;ve&&(Ot=ve.getMaxCascadeForTile(st.toUnwrapped())===0);const Zt=u.isTileAffectedByFog(st),Bt=_t.programConfigurations.get(s.id),Ut=u.getOrCreateProgram(we,{config:Bt,defines:Ot?Le:Oe,overrideFog:Zt});if(u.terrain&&u.terrain.setupElevationDraw(nt,Ut,{useMeterToDem:!0}),!_t.centroidVertexBuffer){const pr=Ut.attributes.a_centroid_pos;pr!==void 0&&I.vertexAttrib2f(pr,0,0)}!We&&ve&&ve.setupShadows(nt.tileID.toUnwrapped(),Ut,"vector-tile",nt.tileID.overscaledZ),k&&(u.context.activeTexture.set(I.TEXTURE0),nt.imageAtlasTexture&&nt.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Bt.updatePaintBuffers());const gi=L.constantOr(null);if(gi&&nt.imageAtlas){const pr=nt.imageAtlas.patternPositions[gi.toString()];pr&&Bt.setConstantPatternPositions(pr)}const si=s.paint.get("fill-extrusion-vertical-gradient");let di;if(We&&ve){if(wp(nt.tileID,_t,u))continue;const pr=ve.calculateShadowPassMatrixFromTile(nt.tileID.toUnwrapped());di=ud(pr,ee,me)}else{const pr=u.translatePosMatrix(st.expandedProjMatrix,nt,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ai=C.projection.createInversionMatrix(C,st.canonical);di=k?aa(pr,u,si,B,$,ee,st,nt,X,q,re,Ai,ae,me):cd(pr,u,si,B,$,ee,st,X,q,re,Ai,ae,me,ue,fe,ye)}u.uploadCommonUniforms(S,Ut,st.toUnwrapped(),null,Me);let ui=_t.segments;if(C.projection.name==="mercator"&&!We&&(ui=_t.getVisibleSegments(nt.tileID,u.terrain,u.transform.getFrustum(0)),!ui.get().length))continue;if(Ke)if(We)for(const pr of ui.get())Ke.numRenderedVerticesInShadowPass+=pr.primitiveLength;else for(const pr of ui.get())Ke.numRenderedVerticesInTransparentPass+=pr.primitiveLength;const ki=[];(u.terrain||T)&&ki.push(_t.centroidVertexBuffer),te&&ki.push(_t.layoutVertexExtBuffer),Ut.draw(u,S.gl.TRIANGLES,p,_,x,Jt.backCCW,di,s.id,_t.layoutVertexBuffer,_t.indexBuffer,ui,s.paint,u.transform.zoom,Bt,ki)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}function Oo(u,r,s,h,p,_,x,T,S,I,C,L,k,B,j,U,$,N,H){const ee=u.context,X=ee.gl,te=u.transform,q=u.transform.zoom,re=[],ae=Po(u,s.paint.get("fill-extrusion-cutoff-fade-range"));I==="clear"?(re.push("CLEAR_SUBPASS"),H&&(re.push("CLEAR_FROM_TEXTURE"),ee.activeTexture.set(X.TEXTURE0),H.bind(X.LINEAR,X.CLAMP_TO_EDGE))):I==="sdf"&&re.push("SDF_SUBPASS"),$&&re.push("HAS_CENTROID"),ae.shouldRenderCutoff&&re.push("RENDER_CUTOFF");const ue=s.layout.get("fill-extrusion-edge-radius"),me=(Me,ye,Oe,Le,We)=>{const ve=ye.programConfigurations.get(s.id),Ce=u.isTileAffectedByFog(Me),fe=u.getOrCreateProgram("fillExtrusionGroundEffect",{config:ve,defines:re,overrideFog:Ce}),we=((st,nt,_t,Ot,Zt,Bt,Ut,gi,si,di,ui)=>({u_matrix:nt,u_opacity:_t,u_ao_pass:Ot?1:0,u_meter_to_tile:Zt,u_ao:Bt,u_flood_light_intensity:Ut,u_flood_light_color:gi,u_attenuation:si,u_edge_radius:di,u_fb:0,u_fb_size:ui}))(0,Le,C,S,We,[L,k*We],B,j,U,q>=17?0:ue*We,H?H.size[0]:0),Ke=[];$&&Ke.push(ye.hiddenByLandmarkVertexBuffer),u.uploadCommonUniforms(ee,fe,Me.toUnwrapped(),null,ae),fe.draw(u,ee.gl.TRIANGLES,p,_,x,T,we,s.id,ye.vertexBuffer,ye.indexBuffer,Oe,s.paint,q,ve,Ke)};for(const Me of h){const ye=r.getTile(Me),Oe=ye.getBucket(s);if(!Oe||Oe.projection.name!==te.projection.name||!Oe.groundEffect||Oe.groundEffect&&!Oe.groundEffect.hasData())continue;const Le=Oe.groundEffect,We=1/Oe.tileToMeter;{const ve=u.translatePosMatrix(Me.projMatrix,ye,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),Ce=Le.getDefaultSegment();me(Me,Le,Ce,ve,We)}if(N)for(let ve=0;ve<4;ve++){const Ce=o.cG[ve](Me),fe=r.getTile(Ce);if(!fe)continue;const we=fe.getBucket(s);if(!we||we.projection.name!==te.projection.name||!we.groundEffect||we.groundEffect&&!we.groundEffect.hasData())continue;const Ke=we.groundEffect;let st,nt;ve===0?(st=[-o.V,0,0],nt=1):ve===1?(st=[o.V,0,0],nt=0):ve===2?(st=[0,-o.V,0],nt=3):(st=[0,o.V,0],nt=2);const _t=Ke.regionSegments[nt];if(!_t)continue;const Ot=new Float32Array(16);o.a6.translate(Ot,Me.projMatrix,st),me(Me,Ke,_t,u.translatePosMatrix(Ot,ye,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),We)}}}function tg(u,r,s,h,p,_,x){h.centroidVertexArray.length===0&&h.createCentroidsBuffer();const T=_?_.findDEMTileFor(s):null;if(!(T&&T.dem||x))return;const S=N=>new o.P(Math.ceil((N+o.cJ)*o.cK),0),I=N=>{const H=r.getSource().minzoom,ee=te=>{const q=r.getTileByID(te);if(q&&q.hasData())return q.getBucket(p)},X=[0,-1,1];for(const te of X){if(N.overscaledZ+te<H)continue;const q=ee(N.calculateScaledKey(N.overscaledZ+te));if(q)return q}},C=[0,0,0],L=(N,H)=>(C[0]=Math.min(N.min.y,H.min.y),C[1]=Math.max(N.max.y,H.max.y),C[2]=o.V-H.min.x>N.max.x?H.min.x-o.V:N.max.x,C),k=(N,H)=>(C[0]=Math.min(N.min.x,H.min.x),C[1]=Math.max(N.max.x,H.max.x),C[2]=o.V-H.min.y>N.max.y?H.min.y-o.V:N.max.y,C),B=[(N,H)=>L(N,H),(N,H)=>L(H,N),(N,H)=>k(N,H),(N,H)=>k(H,N)],j=(N,H,ee,X,te,q,re)=>{if(!_)return 0;const ae=[[q?ee:N,q?N:ee,0],[q?ee:H,q?H:ee,0]],ue=re<0?o.V+re:re,me=[q?ue:(N+H)/2,q?(N+H)/2:ue,0];return ee===0&&re<0||ee!==0&&re>0?_.getForTilePoints(te,[me],!0,X):ae.push(me),_.getForTilePoints(s,ae,!0,T),Math.max(ae[0][2],ae[1][2],me[2])/_.exaggeration()};for(let N=0;N<4;N++){const H=h.borderFeatureIndices[N];if(H.length===0)continue;const ee=o.cG[N](s),X=I(ee);if(!(X&&X instanceof o.cH)||h.borderDoneWithNeighborZ[N]===X.canonical.z)continue;X.centroidVertexArray.length===0&&X.createCentroidsBuffer();const te=_?_.findDEMTileFor(ee):null;if(!(te&&te.dem||x))continue;const q=(N<2?1:5)-N,re=X.borderDoneWithNeighborZ[q]!==h.canonical.z,ae=X.borderFeatureIndices[q];let ue=0;if(h.canonical.z!==X.canonical.z){for(const me of H)h.showCentroid(h.featuresOnBorder[me]);if(re)for(const me of ae)X.showCentroid(X.featuresOnBorder[me]);h.borderDoneWithNeighborZ[N]=X.canonical.z,X.borderDoneWithNeighborZ[q]=h.canonical.z}for(const me of H){const Me=h.featuresOnBorder[me],ye=h.centroidData[Me.centroidDataIndex],Oe=Me.borders[N];let Le;for(;ue<ae.length;){Le=X.featuresOnBorder[ae[ue]];const We=Le.borders[q];if(We[1]>Oe[0]+3||We[0]>Oe[0]-3)break;X.showCentroid(Le),ue++}if(Le&&ue<ae.length){const We=ue;let ve=0;for(;!(Le.borders[q][0]>Oe[1]-3)&&(ve++,++ue!==ae.length);)Le=X.featuresOnBorder[ae[ue]];if(Le=X.featuresOnBorder[ae[We]],ve>1){const we=Le.borders[q];Math.abs(Oe[0]-we[0])<3&&Math.abs(Oe[1]-we[1])<3&&(ve=1,ue=We+1)}else if(ve===0){h.showCentroid(Me);continue}const Ce=X.centroidData[Le.centroidDataIndex];x&&ve===1&&(((U=ye).flags|($=Ce).flags)&o.cI?(U.flags|=o.cI,$.flags|=o.cI):(U.flags&=~o.cI,$.flags&=~o.cI));const fe=Me.intersectsCount()>1||Le.intersectsCount()>1;if(ve>1)ue=We,ye.centroidXY=Ce.centroidXY=new o.P(0,0);else if(te&&te.dem&&!fe){const we=B[N](ye,Ce),Ke=N%2?o.V-1:0,st=j(we[0],Math.min(o.V-1,we[1]),Ke,te,ee,N<2,we[2]);ye.centroidXY=Ce.centroidXY=S(st)}else fe?ye.centroidXY=Ce.centroidXY=new o.P(0,0):(ye.centroidXY=h.encodeBorderCentroid(Me),Ce.centroidXY=X.encodeBorderCentroid(Le));h.writeCentroidToBuffer(ye),X.writeCentroidToBuffer(Ce)}else h.showCentroid(Me)}h.borderDoneWithNeighborZ[N]=X.canonical.z,X.borderDoneWithNeighborZ[q]=h.canonical.z}var U,$;(h.needsCentroidUpdate||!h.centroidVertexBuffer&&h.centroidVertexArray.length!==0)&&h.uploadCentroid(u)}const ig=[1,0,0],_d=[0,1,0],bp=[0,0,1];function wp(u,r,s){const h=s.transform,p=s.shadowRenderer;if(!p)return!0;const _=u.toUnwrapped(),x=h.tileSize*p._cascades[s.currentShadowCascade].scale;let T=r.maxHeight;if(h.elevation){const U=h.elevation.getMinMaxForTile(u);U&&(T+=U.max)}const S=[...p.shadowDirection];S[2]=-S[2];const I=p.computeSimplifiedTileShadowVolume(_,T,x,S);if(!I)return!1;const C=[ig,_d,bp,S,[S[0],0,S[2]],[0,S[1],S[2]]],L=h.projection.name==="globe",k=h.scaleZoom(x),B=o.bq.fromInvProjectionMatrix(h.invProjMatrix,h.worldSize,k,!L),j=p.getCurrentCascadeFrustum();return B.intersectsPrecise(I.vertices,I.planes,C)===0||j.intersectsPrecise(I.vertices,I.planes,C)===0}function Tp(u){return[u[0]*o.cL,u[1]*o.cL,u[2]*o.cL,0]}function gd(u,r,s,h,p,_,x,T,S){const I=h.getSource(),C=s.globeSharedBuffers;if(!C)return;let L,k,B;if(r&&(L=h.getTile(r)),I instanceof o.ap?(k=I.texture,B=o.cj(0,0,s.transform)):L&&r&&(k=L.texture,B=o.cj(r.canonical.z,r.canonical.x,s.transform)),!k||!B)return;u||(B=o.a6.scale(o.a6.create(),B,[1,-1,1]));const j=s.context,U=j.gl,$=p.paint.get("raster-resampling")==="nearest"?U.NEAREST:U.LINEAR,N=s.colorModeForDrapableLayerRenderPass(_),H=x.defines;H.push("GLOBE_POLES");const ee=new Yt(U.LEQUAL,Yt.ReadWrite,s.depthRangeFor3D),X=Float32Array.from(s.transform.expandedFarZProjMatrix),te=Float32Array.from(o.aT(o.ci(new o.bs(0,0,0))));s.terrain&&s.terrain.prepareDrawTile(),j.activeTexture.set(U.TEXTURE0),k.bind($,U.CLAMP_TO_EDGE),j.activeTexture.set(U.TEXTURE1),k.bind($,U.CLAMP_TO_EDGE),k.useMipmap&&j.extTextureFilterAnisotropic&&s.transform.pitch>20&&U.texParameterf(U.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax);const[q,re,ae,ue]=r?C.getPoleBuffers(r.canonical.z,!1):C.getPoleBuffers(0,!0),me=p.paint.get("raster-elevation");let Me;u?(Me=q,s.renderDefaultNorthPole=me!==0):(Me=re,s.renderDefaultSouthPole=me!==0);const ye=Tp(x.mix),Oe=((We,ve,Ce,fe,we,Ke,st,nt,_t,Ot,Zt,Bt,Ut)=>pd(We,ve,Ce,new Float32Array(16),new Float32Array(9),[0,0],fe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ke,[0,0],nt,2,Ot,Zt,Bt,1,0,Ut))(X,te,B,o.S(s.transform.zoom),0,p,0,me,0,ye,x.offset,x.range,_),Le=s.getOrCreateProgram("raster",{defines:H});s.uploadCommonUniforms(j,Le,null),Le.draw(s,U.TRIANGLES,ee,S,N,T,Oe,p.id,Me,ae,ue)}function yd(u){const r=u._nearZ,s=u.projection.farthestPixelDistance(u),h=s-r,p=.2*u.height,_=r+p;return[r,s,(_-p-r)/h,(_-r)/h]}function vd(u,r,s,h){if(u)return r instanceof ct&&u instanceof ta?r.getTextureDescriptor(u,s,!0):{texture:u.texture,mix:Tp(h.mix),offset:h.offset,buffer:0,tileSize:1}}function xd(u,r,s){if(!u)return null;const h=r.getTextureDescriptor(u,s,!0);if(!h)return null;let{texture:p,mix:_,offset:x,tileSize:T,buffer:S,format:I}=h;if(!p||!I)return null;let C=!1;return I==="uint32"&&(C=!0,_[3]=0,_=gu(o.cM,_,[0,s.paint.get("raster-particle-max-speed")]),x=gp(o.cM,x,[0,s.paint.get("raster-particle-max-speed")])),{texture:p,textureOffset:[S/(T+2*S),T/(T+2*S)],tileSize:T,scalarData:C,scale:_,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[I]]}}function bd(u){const r=u._nearZ,s=u.projection.farthestPixelDistance(u),h=s-r,p=.2*u.height,_=r+p;return[r,s,(_-p-r)/h,(_-r)/h]}const Xn=new o.ax(1,0,0,1),zo=new o.ax(0,1,0,1),Ep=new o.ax(0,0,1,1),wd=new o.ax(1,0,1,1),Td=new o.ax(0,1,1,1);function ko(u,r,s,h,p,_,x){const T=u.context,S=u.transform,I=T.gl,C=S.projection.name==="globe",L=C?["PROJECTION_GLOBE_VIEW"]:[];let k=o.a6.clone(s.projMatrix);if(C&&o.S(S.zoom)>0){const ye=o.aS(s.canonical,S),Oe=o.cN(ye);k=o.a6.multiply(new Float32Array(16),S.globeMatrix,Oe),o.a6.multiply(k,S.projMatrix,k)}const B=o.a6.create();B[12]+=2*p/(o.f.devicePixelRatio*S.width),B[13]+=2*_/(o.f.devicePixelRatio*S.height),o.a6.multiply(k,B,k);const j=u.getOrCreateProgram("debug",{defines:L}),U=r.getTileByID(s.key);u.terrain&&u.terrain.setupElevationDraw(U,j);const $=Yt.disabled,N=li.disabled,H=u.colorModeForRenderPass(),ee="$debug";T.activeTexture.set(I.TEXTURE0),u.emptyTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),C?U._makeGlobeTileDebugBuffers(u.context,S):U._makeDebugTileBoundsBuffers(u.context,S.projection);const X=U._tileDebugBuffer||u.debugBuffer,te=U._tileDebugIndexBuffer||u.debugIndexBuffer,q=U._tileDebugSegments||u.debugSegments;if(j.draw(u,I.LINE_STRIP,$,N,H,Jt.disabled,dd(k,h),ee,X,te,q,null,null,null,[U._globeTileDebugBorderBuffer]),x){const ye=U.latestRawTileData,Oe=Math.floor((ye&&ye.byteLength||0)/1024);let Le=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Le+=` => ${s.overscaledZ}`),Le+=` ${U.state}`,Le+=` ${Oe}kb`,function(We,ve){We.initDebugOverlayCanvas();const Ce=We.debugOverlayCanvas,fe=We.context.gl,we=We.debugOverlayCanvas.getContext("2d");we.clearRect(0,0,Ce.width,Ce.height),we.shadowColor="white",we.shadowBlur=2,we.lineWidth=1.5,we.strokeStyle="white",we.textBaseline="top",we.font="bold 36px Open Sans, sans-serif",we.fillText(ve,5,5),we.strokeText(ve,5,5),We.debugOverlayTexture.update(Ce),We.debugOverlayTexture.bind(fe.LINEAR,fe.CLAMP_TO_EDGE)}(u,Le)}const re=r.getTile(s).tileSize,ae=512/Math.min(re,512)*(s.overscaledZ/S.zoom)*.5,ue=U._tileDebugTextBuffer||u.debugBuffer,me=U._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,Me=U._tileDebugTextSegments||u.debugSegments;j.draw(u,I.TRIANGLES,$,N,Si.alphaBlended,Jt.disabled,dd(k,o.ax.transparent,ae),ee,ue,me,Me,null,null,null,[U._globeTileDebugTextBuffer])}function Ed(u,r,s,h){Or(u,0,r+s/2,u.transform.width,s,h)}function as(u,r,s,h){Or(u,r-s/2,0,s,u.transform.height,h)}function Or(u,r,s,h,p,_){const x=u.context,T=x.gl;T.enable(T.SCISSOR_TEST),T.scissor(r*o.f.devicePixelRatio,s*o.f.devicePixelRatio,h*o.f.devicePixelRatio,p*o.f.devicePixelRatio),x.clear({color:_}),T.disable(T.SCISSOR_TEST)}const wu=o.ay([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Sd}=wu;function io(u,r,s,h){u.emplaceBack(r,s,h)}class Md{constructor(r){this.vertexArray=new o.az,this.indices=new o.aw,io(this.vertexArray,-1,-1,1),io(this.vertexArray,1,-1,1),io(this.vertexArray,-1,1,1),io(this.vertexArray,1,1,1),io(this.vertexArray,-1,-1,-1),io(this.vertexArray,1,-1,-1),io(this.vertexArray,-1,1,-1),io(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Sd),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.aB.simpleSegment(0,0,36,12)}}function ua(u,r,s,h,p,_){const x=u.context.gl,T=r.paint.get("sky-atmosphere-color"),S=r.paint.get("sky-atmosphere-halo-color"),I=r.paint.get("sky-atmosphere-sun-intensity"),C=((L,k,B,j,U)=>({u_matrix_3f:L,u_sun_direction:k,u_sun_intensity:B,u_color_tint_r:[j.r,j.g,j.b,j.a],u_color_tint_m:[U.r,U.g,U.b,U.a],u_luminance:5e-5}))(o.co.fromMat4(o.co.create(),h),p,I,T,S);x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+_,r.skyboxTexture,0),s.draw(u,x.TRIANGLES,Yt.disabled,li.disabled,Si.unblended,Jt.frontCW,C,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const rg=o.ay([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Za{constructor(r){const s=new o.cO;s.emplaceBack(-1,1,1,0,0),s.emplaceBack(1,1,1,1,0),s.emplaceBack(1,-1,1,1,1),s.emplaceBack(-1,-1,1,0,1);const h=new o.aw;h.emplaceBack(0,1,2),h.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(s,rg.members),this.indexBuffer=r.createIndexBuffer(h),this.segments=o.aB.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ic=o.ay([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class at{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Wt{constructor(r){this.colorModeAlphaBlendedWriteRGB=new Si([1,To,1,To],o.ax.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Si([1,0,1,0],o.ax.transparent,[!1,!1,!1,!0]),this.params=new at,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){const s=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Za(s);const h=this.params.sizeRange,p=this.params.intensityRange,_=function(C){const L=o.aA(30),k=[];for(let B=0;B<C;++B){const j=2*Math.PI*L(),U=Math.acos(1-2*L())-.5*Math.PI;k.push(o.N.fromValues(Math.cos(U)*Math.cos(j),Math.cos(U)*Math.sin(j),Math.sin(U)))}return k}(this.params.starsCount),x=o.aA(300),T=new o.cP,S=new o.aw;let I=0;for(let C=0;C<_.length;++C){const L=o.N.scale([],_[C],200),k=Math.max(0,1+.01*h*(1*x()-.5)),B=Math.max(0,1+.01*p*(1*x()-.5));T.emplaceBack(L[0],L[1],L[2],-1,-1,k,B),T.emplaceBack(L[0],L[1],L[2],1,-1,k,B),T.emplaceBack(L[0],L[1],L[2],1,1,k,B),T.emplaceBack(L[0],L[1],L[2],-1,1,k,B),S.emplaceBack(I+0,I+1,I+2),S.emplaceBack(I+0,I+2,I+3),I+=4}this.starsVx=s.createVertexBuffer(T,ic.members),this.starsIdx=s.createIndexBuffer(S),this.starsSegments=o.aB.simpleSegment(0,0,T.length,S.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,s){const h=r.context,p=h.gl,_=r.transform,x=new Yt(p.LEQUAL,Yt.ReadOnly,[0,1]),T=o.S(_.zoom),S=s.properties.get("color").toArray01(),I=s.properties.get("high-color").toArray01(),C=s.properties.get("space-color").toArray01PremultipliedAlpha(),L=5e-4,k=o.cQ(s.properties.get("horizon-blend"),0,1,L,.25),B=o.cd(r,h,_)&&k===L?_.worldSize/(2*Math.PI*1.025)-1:_.globeRadius,j=r.frameCounter/1e3%1,U=o.N.length(_.globeCenterInViewSpace),$=Math.sqrt(Math.pow(U,2)-Math.pow(B,2)),N=Math.acos($/U),H=ee=>{const X=_.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ee&&X.push("ALPHA_PASS");const te=r.getOrCreateProgram("globeAtmosphere",{defines:X}),q=((ae,ue,me,Me,ye,Oe,Le,We,ve,Ce,fe,we)=>({u_frustum_tl:ae,u_frustum_tr:ue,u_frustum_br:me,u_frustum_bl:Me,u_horizon:ye,u_transition:Oe,u_fadeout_range:Le,u_color:We,u_high_color:ve,u_space_color:Ce,u_temporal_offset:fe,u_horizon_angle:we}))(_.frustumCorners.TL,_.frustumCorners.TR,_.frustumCorners.BR,_.frustumCorners.BL,_.frustumCorners.horizon,T,k,S,I,C,j,N);r.uploadCommonUniforms(h,te);const re=this.atmosphereBuffer;re&&te.draw(r,p.TRIANGLES,x,li.disabled,ee?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Jt.backCW,q,ee?"atmosphere_glow_alpha":"atmosphere_glow",re.vertexBuffer,re.indexBuffer,re.segments)};H(!1),H(!0)}drawStars(r,s){const h=o.aa(s.properties.get("star-intensity"),0,1);if(h===0)return;const p=r.context,_=p.gl,x=r.transform,T=r.getOrCreateProgram("stars"),S=o.bi.identity([]);o.bi.rotateX(S,S,-x._pitch),o.bi.rotateZ(S,S,-x.angle),o.bi.rotateX(S,S,o.bj(x._center.lat)),o.bi.rotateY(S,S,-o.bj(x._center.lng));const I=o.a6.fromQuat(new Float32Array(16),S),C=o.a6.multiply([],x.starsProjMatrix,I),L=o.co.fromMat4([],I),k=o.co.invert([],L),B=[0,1,0];o.N.transformMat3(B,B,k),o.N.scale(B,B,this.params.sizeMultiplier);const j=[1,0,0];o.N.transformMat3(j,j,k),o.N.scale(j,j,this.params.sizeMultiplier);const U=($=B,N=j,H=h,{u_matrix:Float32Array.from(C),u_up:$,u_right:N,u_intensity_multiplier:H});var $,N,H;r.uploadCommonUniforms(p,T),this.starsVx&&this.starsIdx&&T.draw(r,_.TRIANGLES,Yt.disabled,li.disabled,this.colorModeAlphaBlendedWriteRGB,Jt.disabled,U,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function ha(u,r){const s=[...u],h=r.cameraWorldSizeForFog/r.worldSize,p=o.a6.identity([]);return o.a6.scale(p,p,[h,h,1]),o.a6.multiply(s,p,s),o.a6.multiply(s,r.worldToFogMatrix,s),s}function zr(u,r,s,h){const p=s.material,_=h.context,{baseColorTexture:x,metallicRoughnessTexture:T}=p.pbrMetallicRoughness,{normalTexture:S,occlusionTexture:I,emissionTexture:C}=p;function L(k,B,j){if(k&&(u.push(B),_.activeTexture.set(_.gl.TEXTURE0+j),k.gfxTexture)){const{minFilter:U,magFilter:$,wrapS:N,wrapT:H}=k.sampler;k.gfxTexture.bindExtraParam(U,$,N,H)}}L(x,"HAS_TEXTURE_u_baseColorTexture",Mn.BaseColor),L(T,"HAS_TEXTURE_u_metallicRoughnessTexture",Mn.MetallicRoughness),L(S,"HAS_TEXTURE_u_normalTexture",Mn.Normal),L(I,"HAS_TEXTURE_u_occlusionTexture",Mn.Occlusion),L(C,"HAS_TEXTURE_u_emissionTexture",Mn.Emission),s.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(s.texcoordBuffer)),s.colorBuffer&&(u.push(s.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(s.colorBuffer)),s.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(s.normalBuffer)),s.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(s.pbrBuffer)),p.alphaMode!=="OPAQUE"&&p.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),p.defined||u.push("DIFFUSE_SHADED"),u.push("USE_STANDARD_DERIVATIVES")}function rc(u,r,s,h,p,_){const x=s.paint.get("model-opacity"),T=r.context,S=new Yt(r.context.gl.LEQUAL,Yt.ReadWrite,r.depthRangeFor3D),I=r.transform,C=u.mesh,L=C.material,k=L.pbrMetallicRoughness,B=r.style.fog;let j;j=r.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:o.a6.multiply([],h.zScaleMatrix,u.nodeModelMatrix),o.a6.multiply(j,h.negCameraPosMatrix,j);const U=o.a6.invert([],j);o.a6.transpose(U,U);const $=s.paint.get("model-emissive-strength").constantOr(0),N=xu(new Float32Array(u.worldViewProjection),new Float32Array(j),new Float32Array(U),r,x,k.baseColorFactor,L.emissiveFactor,k.metallicFactor,k.roughnessFactor,L,$,s),H={defines:[]},ee=[];zr(H.defines,ee,C,r);const X=r.shadowRenderer;X&&(X.useNormalOffset=!1);let te=null;if(B){const ae=ha(u.nodeModelMatrix,r.transform);if(te=new Float32Array(ae),I.projection.name!=="globe"){const ue=C.aabb.min,me=C.aabb.max,[Me,ye]=B.getOpacityForBounds(ae,ue[0],ue[1],me[0],me[1]);H.overrideFog=Me>=rr||ye>=rr}}const q=Po(r,s.paint.get("model-cutoff-fade-range"));q.shouldRenderCutoff&&H.defines.push("RENDER_CUTOFF");const re=r.getOrCreateProgram("model",H);r.uploadCommonUniforms(T,re,null,te,q),r.renderPass!=="shadow"&&X&&X.setupShadowsFromMatrix(u.nodeModelMatrix,re),re.draw(r,T.gl.TRIANGLES,S,p,_,C.material.doubleSided?Jt.disabled:Jt.backCCW,N,s.id,C.vertexBuffer,C.indexBuffer,C.segments,s.paint,r.transform.zoom,void 0,ee)}function nc(u,r,s,h,p,_,x){let T;T=u.projection.name==="globe"?o.cS(s,u):[...s],o.a6.multiply(T,T,r.matrix);const S=o.a6.multiply([],h,T);if(r.meshes)for(const I of r.meshes){if(I.material.alphaMode!=="BLEND"){x.push({mesh:I,depth:0,modelIndex:p,worldViewProjection:S,nodeModelMatrix:T});continue}const C=o.N.transformMat4([],I.centroid,S);C[2]>0&&_.push({mesh:I,depth:C[2],modelIndex:p,worldViewProjection:S,nodeModelMatrix:T})}if(r.children)for(const I of r.children)nc(u,I,s,h,p,_,x)}function Te(u,r,s,h){const p=s.shadowRenderer;if(!p)return;const _=p.getShadowPassDepthMode(),x=p.getShadowPassColorMode(),T=p.calculateShadowPassMatrixFromMatrix(r),S=ec(T);s.getOrCreateProgram("modelDepth",{defines:s._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(s,s.context.gl.TRIANGLES,_,li.disabled,x,Jt.backCCW,S,h.id,u.vertexBuffer,u.indexBuffer,u.segments,h.paint,s.transform.zoom,void 0,void 0)}function Ad(u,r,s){const h=r.updateZoomBasedPaintProperties(),p=function(_,x,T){let S,I,C,L=_.terrain?_.terrain.exaggeration():0;if(_.terrain&&L>0){const k=_.terrain,B=k.findDEMTileFor(T);B&&B.dem?S=o.cU.create(k,T,B):L=0}if(L===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),L===x.validForExaggeration&&(L===0||S&&S._demTile&&S._demTile.tileID===x.validForDEMTile.id&&S._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(const k in x.instancesPerModel){const B=x.instancesPerModel[k];for(let j=0;j<B.instancedDataArray.length;++j){const U=(S?L*S.getElevationAt(0|B.instancedDataArray.float32[16*j],0|B.instancedDataArray.float32[16*j+1],!0,!0):0)+B.instancesEvaluatedElevation[j];B.instancedDataArray.float32[16*j+6]=U,I=I?Math.min(x.terrainElevationMin,U):U,C=C?Math.max(x.terrainElevationMax,U):U}}return x.terrainElevationMin=I||0,x.terrainElevationMax=C||0,x.validForExaggeration=L,x.validForDEMTile=S&&S._demTile?{id:S._demTile.tileID,timestamp:S._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,r,s);(h||p)&&(r.uploaded=!1,r.upload(u.context))}const ls={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.bS([0,0,0],[o.V,o.V,0])};function Sp(u,r){const s=1<<u.canonical.z,h=r.getFreeCameraOptions().position,p=r.elevation,_=u.canonical.x/s,x=(u.canonical.x+1)/s,T=u.canonical.y/s,S=(u.canonical.y+1)/s;let I=r._centerAltitude;if(p){const B=p.getMinMaxForTile(u);B&&B.max>I&&(I=B.max)}const C=o.aa(h.x,_,x)-h.x,L=o.aa(h.y,T,S)-h.y,k=o.bl(I,r.center.lat)-h.z;return r._zoomFromMercatorZ(Math.sqrt(C*C+L*L+k*k))}function Id(u,r,s,h,p,_,x){const T=u.context,S=u.renderPass==="shadow",I=u.shadowRenderer,C=S&&I?I.getShadowPassDepthMode():new Yt(T.gl.LEQUAL,Yt.ReadWrite,u.depthRangeFor3D),L=u.isTileAffectedByFog(_);if(s.meshes)for(const k of s.meshes){const B=["MODEL_POSITION_ON_GPU"],j=[];let U,$,N;h.instancedDataArray.length>20&&B.push("INSTANCED_ARRAYS");const H=Po(u,r.paint.get("model-cutoff-fade-range"));if(H.shouldRenderCutoff&&B.push("RENDER_CUTOFF"),S&&I)U=u.getOrCreateProgram("modelDepth",{defines:B}),$=ec(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(s.matrix)),N=I.getShadowPassColorMode();else{zr(B,j,k,u),U=u.getOrCreateProgram("model",{defines:B,overrideFog:L});const X=k.material,te=X.pbrMetallicRoughness,q=r.paint.get("model-opacity"),re=r.paint.get("model-emissive-strength").constantOr(0);$=xu(_.expandedProjMatrix,Float32Array.from(s.matrix),new Float32Array(16),u,q,te.baseColorFactor,X.emissiveFactor,te.metallicFactor,te.roughnessFactor,X,re,r,p),I&&(x.shadowUniformsInitialized?U.setShadowUniformValues(T,I.getShadowUniformValues()):(I.setupShadows(_.toUnwrapped(),U,"model-tile",_.overscaledZ),x.shadowUniformsInitialized=!0)),N=H.shouldRenderCutoff||q<1||X.alphaMode!=="OPAQUE"?Si.alphaBlended:Si.unblended}u.uploadCommonUniforms(T,U,_.toUnwrapped(),null,H);const ee=k.material.doubleSided?Jt.disabled:Jt.backCCW;if(h.instancedDataArray.length>20)j.push(h.instancedDataBuffer),U.draw(u,T.gl.TRIANGLES,C,li.disabled,N,ee,$,r.id,k.vertexBuffer,k.indexBuffer,k.segments,r.paint,u.transform.zoom,void 0,j,h.instancedDataArray.length);else{const X=S?"u_instance":"u_normal_matrix";for(let te=0;te<h.instancedDataArray.length;++te)$[X]=new Float32Array(h.instancedDataArray.arrayBuffer,64*te,16),U.draw(u,T.gl.TRIANGLES,C,li.disabled,N,ee,$,r.id,k.vertexBuffer,k.indexBuffer,k.segments,r.paint,u.transform.zoom,void 0,j)}}if(s.children)for(const k of s.children)Id(u,r,k,h,p,_,x)}const Ha=[1,-1,1];function ng(u,r,s,h){if(!s.modelManager)return!0;const p=s.modelManager;if(!s.shadowRenderer)return!0;const _=s.shadowRenderer,x=r.aabb;let T=!0,S=u.maxHeight;if(S===0){let C=0;for(const L in u.instancesPerModel){const k=p.getModel(L,h);k?C=Math.max(C,Math.max(Math.max(k.aabb.max[0],k.aabb.max[1]),k.aabb.max[2])):T=!1}S=u.maxScale*C*1.41+u.maxVerticalOffset,T&&(u.maxHeight=S)}x.max[2]=S,x.min[2]+=u.terrainElevationMin,x.max[2]+=u.terrainElevationMax,o.N.transformMat4(x.min,x.min,r.tileMatrix),o.N.transformMat4(x.max,x.max,r.tileMatrix);const I=x.intersects(_.getCurrentCascadeFrustum());return s.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=I===2),I===0}class sg{}class Mp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,s,h){{const L=this._storage.get(s.id);if(L)return L.lastUsedFrameIdx=r,L.buf}const p=h.gl,_=p.getBufferParameter(p.ELEMENT_ARRAY_BUFFER,p.BUFFER_SIZE),x=new ArrayBuffer(_),T=new Int16Array(x);p.getBufferSubData(p.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));const S=new o.cW;for(let L=0;L<_/2;L+=3){const k=T[L],B=T[L+1],j=T[L+2];S.emplaceBack(k,B),S.emplaceBack(B,j),S.emplaceBack(j,k)}const I=h.bindVertexArrayOES.current,C=new sg;return C.buf=new mr(h,S),C.lastUsedFrameIdx=r,this._storage.set(s.id,C),h.bindVertexArrayOES.set(I),C.buf}update(r){for(const[s,h]of this._storage)r-h.lastUsedFrameIdx>30&&(h.buf.destroy(),this._storage.delete(s))}destroy(){for(const[r,s]of this._storage)s.buf.destroy(),this._storage.delete(r)}}class sc{registerParameter(r,s,h,p,_){}registerButton(r,s,h){}}const oc={symbol:function(u,r,s,h,p){if(u.renderPass!=="translucent")return;const _=li.disabled,x=u.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(I,C,L,k,B,j,U){const $=C.transform,N=B==="map",H=j==="map";for(const ee of I){const X=k.getTile(ee),te=X.getBucket(L);if(!te||!te.text||!te.text.segments.get().length)continue;const q=o.b5(te.textSizeData,$.zoom),re=Ul(ee,te.getProjection(),$),ae=$.calculatePixelsToTileUnitsMatrix(X),ue=Nl(re,X.tileID.canonical,H,N,$,te.getProjection(),ae),me=te.hasIconTextFit()&&te.hasIconData();if(q){const Me=Math.pow(2,$.zoom-X.tileID.overscaledZ);xp(te,N,H,U,o.cx,$,ue,ee,Me,q,me)}}}(h,u,s,r,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),p);const T=s.paint.get("icon-opacity").constantOr(1)!==0,S=s.paint.get("text-opacity").constantOr(1)!==0;s.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(T||S)?bu(u,r,s,h,_,x):(T&&bu(u,r,s,h,_,x,{onlyIcons:!0}),S&&bu(u,r,s,h,_,x,{onlyText:!0})),r.map.showCollisionBoxes&&(Cs(u,r,s,h,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Cs(u,r,s,h,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(u,r,s,h){if(u.renderPass!=="translucent")return;const p=s.paint.get("circle-opacity"),_=s.paint.get("circle-stroke-width"),x=s.paint.get("circle-stroke-opacity"),T=s.layout.get("circle-sort-key").constantOr(1)!==void 0,S=s.paint.get("circle-emissive-strength");if(p.constantOr(1)===0&&(_.constantOr(1)===0||x.constantOr(1)===0))return;const I=u.context,C=I.gl,L=u.transform,k=u.depthModeForSublayer(0,Yt.ReadOnly),B=li.disabled,j=u.colorModeForDrapableLayerRenderPass(S),U=L.projection.name==="globe",$=[o.a5(L.center.lng),o.ae(L.center.lat)],N=[];for(let ee=0;ee<h.length;ee++){const X=h[ee],te=r.getTile(X),q=te.getBucket(s);if(!q||q.projection.name!==L.projection.name)continue;const re=q.programConfigurations.get(s.id),ae=o.cy(s),ue=u.isTileAffectedByFog(X);U&&ae.push("PROJECTION_GLOBE_VIEW");const me=u.getOrCreateProgram("circle",{config:re,defines:ae,overrideFog:ue}),Me=q.layoutVertexBuffer,ye=q.globeExtVertexBuffer,Oe=q.indexBuffer,Le=L.projection.createInversionMatrix(L,X.canonical),We={programConfiguration:re,program:me,layoutVertexBuffer:Me,globeExtVertexBuffer:ye,indexBuffer:Oe,uniformValues:o.cz(u,X,te,Le,$,s),tile:te};if(T){const ve=q.segments.get();for(const Ce of ve)N.push({segments:new o.aB([Ce]),sortKey:Ce.sortKey,state:We})}else N.push({segments:q.segments,sortKey:0,state:We})}T&&N.sort((ee,X)=>ee.sortKey-X.sortKey);const H={useDepthForOcclusion:L.depthOcclusionForSymbolsAndCircles};for(const ee of N){const{programConfiguration:X,program:te,layoutVertexBuffer:q,globeExtVertexBuffer:re,indexBuffer:ae,uniformValues:ue,tile:me}=ee.state,Me=ee.segments;u.terrain&&u.terrain.setupElevationDraw(me,te,H),u.uploadCommonUniforms(I,te,me.tileID.toUnwrapped()),te.draw(u,C.TRIANGLES,k,B,j,Jt.disabled,ue,s.id,q,ae,Me,s.paint,L.zoom,X,[re])}},heatmap:function(u,r,s,h){if(s.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const p=u.context,_=p.gl,x=li.disabled,T=new Si([_.ONE,_.ONE,_.ONE,_.ONE],o.ax.transparent,[!0,!0,!0,!0]);(function(B,j,U,$){const N=B.gl,H=j.width*$,ee=j.height*$;B.activeTexture.set(N.TEXTURE1),B.viewport.set([0,0,H,ee]);let X=U.heatmapFbo;if(!X||X&&(X.width!==H||X.height!==ee)){X&&X.destroy();const te=N.createTexture();N.bindTexture(N.TEXTURE_2D,te),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_S,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_WRAP_T,N.CLAMP_TO_EDGE),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MIN_FILTER,N.LINEAR),N.texParameteri(N.TEXTURE_2D,N.TEXTURE_MAG_FILTER,N.LINEAR),X=U.heatmapFbo=B.createFramebuffer(H,ee,!0,null),function(q,re,ae,ue,me,Me){const ye=q.gl;ye.texImage2D(ye.TEXTURE_2D,0,q.extRenderToTextureHalfFloat?ye.RGBA16F:ye.RGBA,me,Me,0,ye.RGBA,q.extRenderToTextureHalfFloat?ye.HALF_FLOAT:ye.UNSIGNED_BYTE,null),ue.colorAttachment.set(ae)}(B,0,te,X,H,ee)}else N.bindTexture(N.TEXTURE_2D,X.colorAttachment.get()),B.bindFramebuffer.set(X.framebuffer)})(p,u,s,u.transform.projection.name==="globe"?.5:.25),p.clear({color:o.ax.transparent});const S=u.transform,I=S.projection.name==="globe",C=I?["PROJECTION_GLOBE_VIEW"]:[],L=I?Jt.frontCCW:Jt.disabled,k=[o.a5(S.center.lng),o.ae(S.center.lat)];for(let B=0;B<h.length;B++){const j=h[B];if(r.hasRenderableParent(j))continue;const U=r.getTile(j),$=U.getBucket(s);if(!$||$.projection.name!==S.projection.name)continue;const N=u.isTileAffectedByFog(j),H=$.programConfigurations.get(s.id),ee=u.getOrCreateProgram("heatmap",{config:H,defines:C,overrideFog:N}),{zoom:X}=u.transform;u.terrain&&u.terrain.setupElevationDraw(U,ee),u.uploadCommonUniforms(p,ee,j.toUnwrapped());const te=S.projection.createInversionMatrix(S,j.canonical);ee.draw(u,_.TRIANGLES,Yt.disabled,x,T,L,fd(u,j,U,te,k,X,s.paint.get("heatmap-intensity")),s.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,s.paint,u.transform.zoom,H,I?[$.globeExtVertexBuffer]:null)}p.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(p,_){const x=p.context,T=x.gl,S=_.heatmapFbo;if(!S)return;x.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,S.colorAttachment.get()),x.activeTexture.set(T.TEXTURE1);let I=_.colorRampTexture;I||(I=_.colorRampTexture=new o.T(x,_.colorRamp,T.RGBA)),I.bind(T.LINEAR,T.CLAMP_TO_EDGE),p.getOrCreateProgram("heatmapTexture").draw(p,T.TRIANGLES,Yt.disabled,li.disabled,p.colorModeForRenderPass(),Jt.disabled,((C,L,k,B)=>({u_image:0,u_color_ramp:1,u_opacity:L.paint.get("heatmap-opacity")}))(0,_),_.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,_.paint,p.transform.zoom)}(u,s))},line:function(u,r,s,h){if(u.renderPass!=="translucent")return;const p=s.paint.get("line-opacity"),_=s.paint.get("line-width");if(p.constantOr(1)===0||_.constantOr(1)===0)return;const x=s.paint.get("line-emissive-strength"),T=u.depthModeForSublayer(0,Yt.ReadOnly),S=u.colorModeForDrapableLayerRenderPass(x),I=u.terrain&&u.terrain.renderingToTexture?1:o.f.devicePixelRatio,C=s.paint.get("line-dasharray"),L=C.constantOr(1),k=s.layout.get("line-cap"),B=s.paint.get("line-pattern"),j=B.constantOr(1),U=s.paint.get("line-pattern").constantOr(1),$=s.paint.get("line-opacity").constantOr(1)!==1;let N=!U&&$;const H=s.paint.get("line-gradient"),ee=j?"linePattern":"line",X=u.context,te=X.gl,q=o.cA(s);u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(N=!1);for(const re of h){const ae=r.getTile(re);if(j&&!ae.patternsLoaded())continue;const ue=ae.getBucket(s);if(!ue)continue;u.prepareDrawTile();const me=ue.programConfigurations.get(s.id),Me=u.isTileAffectedByFog(re),ye=u.getOrCreateProgram(ee,{config:me,defines:q,overrideFog:Me}),Oe=B.constantOr(null);if(Oe&&ae.imageAtlas){const st=ae.imageAtlas.patternPositions[Oe.toString()];st&&me.setConstantPatternPositions(st)}const Le=C.constantOr(null),We=k.constantOr(null);if(!j&&Le&&We&&ae.lineAtlas){const st=ae.lineAtlas.getDash(Le,We);st&&me.setConstantPatternPositions(st)}let[ve,Ce]=s.paint.get("line-trim-offset");(We==="round"||We==="square")&&ve!==Ce&&(ve===0&&(ve-=1),Ce===1&&(Ce+=1));const fe=u.terrain?re.projMatrix:null,we=j?o.cB(u,ae,s,fe,I,[ve,Ce]):o.cC(u,ae,s,fe,ue.lineClipsArray.length,I,[ve,Ce]);if(H){const st=ue.gradients[s.id];let nt=st.texture;if(s.gradientVersion!==st.version){let _t=256;if(s.stepInterpolant){const Ot=r.getSource().maxzoom,Zt=re.canonical.z===Ot?Math.ceil(1<<u.transform.maxZoom-re.canonical.z):1;_t=o.aa(o.cD(ue.maxLineLength/o.V*1024*Zt),256,X.maxTextureSize)}st.gradient=o.cE({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:_t,image:st.gradient||void 0,clips:ue.lineClipsArray}),st.texture?st.texture.update(st.gradient):st.texture=new o.T(X,st.gradient,te.RGBA),st.version=s.gradientVersion,nt=st.texture}X.activeTexture.set(te.TEXTURE1),nt.bind(s.stepInterpolant?te.NEAREST:te.LINEAR,te.CLAMP_TO_EDGE)}L&&(X.activeTexture.set(te.TEXTURE0),ae.lineAtlasTexture&&ae.lineAtlasTexture.bind(te.LINEAR,te.REPEAT),me.updatePaintBuffers()),j&&(X.activeTexture.set(te.TEXTURE0),ae.imageAtlasTexture&&ae.imageAtlasTexture.bind(te.LINEAR,te.CLAMP_TO_EDGE),me.updatePaintBuffers()),u.uploadCommonUniforms(X,ye,re.toUnwrapped());const Ke=st=>{ye.draw(u,te.TRIANGLES,T,st,S,Jt.disabled,we,s.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,s.paint,u.transform.zoom,me,[ue.layoutVertexBuffer2])};if(N){const st=u.stencilModeForClipping(re).ref;st===0&&u.terrain&&X.clear({stencil:0});const nt={func:te.EQUAL,mask:255};we.u_alpha_discard_threshold=.8,Ke(new li(nt,st,255,te.KEEP,te.KEEP,te.INVERT)),we.u_alpha_discard_threshold=0,Ke(new li(nt,st,255,te.KEEP,te.KEEP,te.KEEP))}else Ke(u.stencilModeForClipping(re))}N&&(u.resetStencilClippingMasks(),u.terrain&&X.clear({stencil:0}))},fill:function(u,r,s,h){const p=s.paint.get("fill-color"),_=s.paint.get("fill-opacity");if(_.constantOr(1)===0)return;const x=s.paint.get("fill-emissive-strength"),T=u.colorModeForDrapableLayerRenderPass(x),S=s.paint.get("fill-pattern"),I=u.opaquePassEnabledForLayer()&&!S.constantOr(1)&&p.constantOr(o.ax.transparent).a===1&&_.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===I){const C=u.depthModeForSublayer(1,u.renderPass==="opaque"?Yt.ReadWrite:Yt.ReadOnly);ca(u,r,s,h,C,T,!1)}if(u.renderPass==="translucent"&&s.paint.get("fill-antialias")){const C=u.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,Yt.ReadOnly);ca(u,r,s,h,C,T,!0)}},"fill-extrusion":function(u,r,s,h){const p=s.paint.get("fill-extrusion-opacity"),_=u.context,x=_.gl,T=u.terrain,S=T&&T.renderingToTexture;if(p===0)return;const I=u.conflationActive&&u.layerUsedInConflation(s,r.getSource());if(I&&function(C,L,k,B){for(const j of B){const U=L.getTile(j).getBucket(k);U&&(U.updateReplacement(j,C.replacementSource),U.uploadCentroid(C.context))}}(u,r,s,h),T||I)for(const C of h){const L=r.getTile(C).getBucket(s);L&&tg(u.context,r,C,L,s,T,I)}if(u.renderPass==="shadow"&&u.shadowRenderer){const C=u.shadowRenderer;if(T&&p<.65&&s._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.Z)return;const L=C.getShadowPassDepthMode(),k=C.getShadowPassColorMode();zt(u,r,s,h,L,li.disabled,k,I)}else if(u.renderPass==="translucent"){const C=!s.paint.get("fill-extrusion-pattern").constantOr(1),L=s.paint.get("fill-extrusion-color").constantOr(o.ax.white);if(!S&&L.a!==0){const k=new Yt(u.context.gl.LEQUAL,Yt.ReadWrite,u.depthRangeFor3D);p===1&&C?zt(u,r,s,h,k,li.disabled,Si.unblended,I):(zt(u,r,s,h,k,li.disabled,Si.disabled,I),zt(u,r,s,h,k,u.stencilModeFor3D(),u.colorModeForRenderPass(),I),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&C&&(!T&&u.transform.projection.name!=="globe"||S)){const k=s.paint.get("fill-extrusion-opacity"),B=s.paint.get("fill-extrusion-ambient-occlusion-intensity"),j=s.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),U=s.paint.get("fill-extrusion-flood-light-intensity"),$=s.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),N=B>0&&j>0,H=U>0,ee=(te,q,re)=>(1-re)*te+re*q,X=te=>{const q=u.depthModeForSublayer(1,Yt.ReadOnly,x.LEQUAL,!0),re=s.paint.get(te?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ae=ee(.1,3,re),ue=u._showOverdrawInspector;if(!ue){const me=new li({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Me=new Si([x.ONE,x.ONE,x.ONE,x.ONE],o.ax.transparent,[!1,!1,!1,!0],x.MIN);Oo(u,r,s,h,q,me,Me,Jt.disabled,te,"sdf",k,B,j,U,$,ae,I,!1)}{const me=ue?li.disabled:new li({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Me=ue?u.colorModeForRenderPass():new Si([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],o.ax.transparent,[!0,!0,!0,!0]);Oo(u,r,s,h,q,me,Me,Jt.disabled,te,"color",k,B,j,U,$,ae,I,!1)}};if(S){const te=(q,re,ae)=>{const ue=u.depthModeForSublayer(1,Yt.ReadOnly,x.LEQUAL,!1),me=s.paint.get(q?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Me=ee(.1,3,me);{const ye=new Si([x.ONE,x.ONE,x.ONE,x.ONE],o.ax.transparent,[!1,!1,!1,!0]);Oo(u,r,s,h,ue,li.disabled,ye,Jt.disabled,q,"clear",k,B,j,U,$,Me,I,re)}{const ye=new li({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Oe=new Si([x.ONE,x.ONE,x.ONE,x.ONE],o.ax.transparent,[!1,!1,!1,!0],x.MIN);Oo(u,r,s,h,ue,ye,Oe,Jt.disabled,q,"sdf",k,B,j,U,$,Me,I,re)}{const ye=q?x.ZERO:x.ONE_MINUS_DST_ALPHA,Oe=new li({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Le=new Si([ye,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],o.ax.transparent,[!0,!0,!0,!0]);Oo(u,r,s,h,ue,Oe,Le,Jt.disabled,q,"color",k,B,j,U,$,Me,I,re)}{const ye=new Si([x.ONE,x.ONE,x.ONE,q?x.ZERO:x.ONE],o.ax.transparent,[!1,!1,!1,!0],q?x.FUNC_ADD:x.MAX);Oo(u,r,s,h,ue,li.disabled,ye,Jt.disabled,q,"clear",k,B,j,U,$,Me,I,re,ae)}};if(N||H){let q;if(u.prepareDrawTile(),T){const re=T.drapeBufferSize[0],ae=T.drapeBufferSize[1];q=T.framebufferCopyTexture,q&&(!q||q.size[0]===re&&q.size[1]===ae)||(q&&q.destroy(),q=T.framebufferCopyTexture=new o.T(_,new o.h({width:re,height:ae}),x.RGBA)),q.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexImage2D(x.TEXTURE_2D,0,x.RGBA,0,0,re,ae,0)}N&&te(!0,!1,q),H&&te(!1,!0,q)}}else N&&X(!0),H&&X(!1)}}},hillshade:function(u,r,s,h){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;const p=u.context,_=u.terrain&&u.terrain.renderingToTexture,[x,T]=u.renderPass!=="translucent"||_?[{},h]:u.stencilConfigForOverlap(h);for(const S of T){const I=r.getTile(S);if(I.needsHillshadePrepare&&u.renderPass==="offscreen")ed(u,I,s);else if(u.renderPass==="translucent"){const C=u.depthModeForSublayer(0,Yt.ReadOnly),L=s.paint.get("hillshade-emissive-strength"),k=u.colorModeForDrapableLayerRenderPass(L),B=_&&u.terrain?u.terrain.stencilModeForRTTOverlap(S):x[S.overscaledZ];pu(u,S,I,s,C,B,k)}}p.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,r,s,h,p,_){if(u.renderPass!=="translucent"||s.paint.get("raster-opacity")===0)return;const x=u.transform.projection.name==="globe",T=s.paint.get("raster-elevation")!==0,S=T&&x;if(u.renderElevatedRasterBackface&&!S)return;const I=u.context,C=I.gl,L=r.getSource(),k=function(q,re,ae,ue){const me=re.paint.get("raster-color"),Me=q.type==="raster-array",ye=[],Oe=re.paint.get("raster-resampling"),Le=re.paint.get("raster-color-mix");let We=re.paint.get("raster-color-range");const ve=[Le[0],Le[1],Le[2],0],Ce=Le[3];let fe=Oe==="nearest"?ue.NEAREST:ue.LINEAR;if(Me&&(ye.push("RASTER_ARRAY"),me||ye.push("RASTER_COLOR"),Oe==="linear"&&ye.push("RASTER_ARRAY_LINEAR"),fe=ue.NEAREST,!We&&q.rasterLayers)){const we=q.rasterLayers.find(({id:Ke})=>Ke===re.sourceLayer);we&&we.fields&&we.fields.range&&(We=we.fields.range)}if(We=We||[0,1],me){ye.push("RASTER_COLOR"),ae.activeTexture.set(ue.TEXTURE2),re.updateColorRamp(We);let we=re.colorRampTexture;we||(we=re.colorRampTexture=new o.T(ae,re.colorRamp,ue.RGBA)),we.bind(ue.LINEAR,ue.CLAMP_TO_EDGE)}return{mix:ve,range:We,offset:Ce,defines:ye,resampling:fe}}(L,s,I,C);if(L instanceof o.ap&&!h.length&&!x)return;const B=s.paint.get("raster-emissive-strength"),j=u.colorModeForDrapableLayerRenderPass(B),U=u.terrain&&u.terrain.renderingToTexture,$=!u.options.moving,N=s.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;if(L instanceof o.ap&&!h.length&&(L.onNorthPole||L.onSouthPole)){const q=T?u.stencilModeFor3D():li.disabled;return void gd(!!L.onNorthPole,null,u,r,s,B,k,Jt.disabled,q)}if(!h.length)return;const[H,ee]=L instanceof o.ap||U?[{},h]:u.stencilConfigForOverlap(h),X=ee[ee.length-1].overscaledZ;S&&k.defines.push("PROJECTION_GLOBE_VIEW"),T&&k.defines.push("RENDER_CUTOFF");const te=(q,re,ae)=>{for(const ue of q){const me=ue.toUnwrapped(),Me=r.getTile(ue);if(U&&(!Me||!Me.hasData()))continue;I.activeTexture.set(C.TEXTURE0);const ye=vd(Me,L,s,k);if(!ye||!ye.texture)continue;const{texture:Oe,mix:Le,offset:We,tileSize:ve,buffer:Ce}=ye;let fe,we;U?(fe=Yt.disabled,we=ue.projMatrix):T?(fe=new Yt(C.LEQUAL,Yt.ReadWrite,u.depthRangeFor3D),we=x?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(me,$)):(fe=u.depthModeForSublayer(ue.overscaledZ-X,s.paint.get("raster-opacity")===1?Yt.ReadWrite:Yt.ReadOnly,C.LESS),we=u.transform.calculateProjMatrix(me,$));const Ke=u.terrain&&U?u.terrain.stencilModeForRTTOverlap(ue):H[ue.overscaledZ],st=_?0:s.paint.get("raster-fade-duration");Me.registerFadeDuration(st);const nt=r.findLoadedParent(ue,0),_t=nd(Me,nt,r,u.transform,st);let Ot,Zt;u.terrain&&u.terrain.prepareDrawTile(),I.activeTexture.set(C.TEXTURE0),Oe.bind(N,C.CLAMP_TO_EDGE),I.activeTexture.set(C.TEXTURE1),nt?(nt.texture&&nt.texture.bind(N,C.CLAMP_TO_EDGE),Ot=Math.pow(2,nt.tileID.overscaledZ-Me.tileID.overscaledZ),Zt=[Me.tileID.canonical.x*Ot%1,Me.tileID.canonical.y*Ot%1]):Oe.bind(N,C.CLAMP_TO_EDGE),Oe.useMipmap&&I.extTextureFilterAnisotropic&&u.transform.pitch>20&&C.texParameterf(C.TEXTURE_2D,I.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,I.extTextureFilterAnisotropicMax);const Bt=u.transform;let Ut;const gi=T?yd(Bt):[0,0,0,0];let si,di,ui,ki,pr,Ai=0;if(S&&L instanceof o.ap&&L.coordinates.length>3)si=Float32Array.from(o.aT(o.ci(new o.bs(0,0,0)))),di=Float32Array.from(Bt.globeMatrix),ui=Float32Array.from(o.ce(Bt)),ki=[o.a5(Bt.center.lng),o.ae(Bt.center.lat)],Ut=L.elevatedGlobePerspectiveTransform,pr=L.elevatedGlobeGridMatrix||new Float32Array(9);else if(S){const Ci=o.cf(ue.canonical);Ai=o.cg(Ci.getCenter().lat),si=Float32Array.from(o.aT(o.ci(ue.canonical))),di=Float32Array.from(Bt.globeMatrix),ui=Float32Array.from(o.ce(Bt)),ki=[o.a5(Bt.center.lng),o.ae(Bt.center.lat)],Ut=[0,0],pr=Float32Array.from(o.ch(ue.canonical,Ci,Ai,Bt.worldSize/Bt._pixelsPerMercatorPixel))}else Ut=L instanceof o.ap?L.perspectiveTransform:[0,0],si=new Float32Array(16),di=new Float32Array(9),ui=new Float32Array(16),ki=[0,0],pr=new Float32Array(9);const kr=pd(we,si,di,ui,pr,Zt||[0,0],o.S(u.transform.zoom),ki,gi,Ot||1,_t,s,Ut,T?s.paint.get("raster-elevation"):0,2,Le,We,k.range,ve,Ce,B),Ii=u.isTileAffectedByFog(ue),Gi=u.getOrCreateProgram("raster",{defines:k.defines,overrideFog:Ii});if(u.uploadCommonUniforms(I,Gi,me),L instanceof o.ap){const Ci=L.elevatedGlobeVertexBuffer,ji=L.elevatedGlobeIndexBuffer;if(U||!x)L.boundsBuffer&&L.boundsSegments&&Gi.draw(u,C.TRIANGLES,fe,li.disabled,j,Jt.disabled,kr,s.id,L.boundsBuffer,u.quadTriangleIndexBuffer,L.boundsSegments);else if(Ci&&ji){const vr=Bt.zoom<=o.bG?L.elevatedGlobeSegments:L.getSegmentsForLongitude(Bt.center.lng);vr&&Gi.draw(u,C.TRIANGLES,fe,li.disabled,j,re,kr,s.id,Ci,ji,vr)}}else if(S){fe=new Yt(C.LEQUAL,Yt.ReadOnly,u.depthRangeFor3D);const Ci=u.globeSharedBuffers;if(Ci){const[ji,vr,Yi]=Ci.getGridBuffers(Ai,!1);Gi.draw(u,C.TRIANGLES,fe,ae||Ke,u.colorModeForRenderPass(),re,kr,s.id,ji,vr,Yi)}}else{const{tileBoundsBuffer:Ci,tileBoundsIndexBuffer:ji,tileBoundsSegments:vr}=u.getTileBoundsBuffers(Me);Gi.draw(u,C.TRIANGLES,fe,Ke,j,Jt.disabled,kr,s.id,Ci,ji,vr)}}if(!(L instanceof o.ap)&&S)for(const ue of q){const me=ue.canonical.y===(1<<ue.canonical.z)-1;ue.canonical.y===0&&gd(!0,ue,u,r,s,B,k,re,ae||li.disabled),me&&gd(!1,ue,u,r,s,B,k,re===Jt.frontCW?Jt.backCW:Jt.frontCW,ae||li.disabled)}};S?te(ee,u.renderElevatedRasterBackface?Jt.backCW:Jt.frontCW,u.stencilModeFor3D()):te(ee,Jt.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,r,s,h,p,_){u.renderPass==="offscreen"&&function(x,T,S,I){if(!I.length)return;const C=x.context,L=C.gl,k=T.getSource();if(!(k instanceof ct))return;const B=[];for(const $ of I){const N=T.getTile($);if(!(N instanceof ta))continue;const H=xd(N,k,S);if(!H)continue;const ee=[H.tileSize,H.tileSize];let X=S.tileFramebuffer;X||(X=S.tileFramebuffer=C.createFramebuffer(ee[0],ee[1],!0,null));let te=N.rasterParticleState;const q=S.paint.get("raster-particle-count");te||(te=N.rasterParticleState=new sn(C,$,ee,q));const re=te.update(S.lastInvalidatedAt);te.numParticles!==q&&te.setNumParticles($,q);const ae=te.targetColorTexture;te.targetColorTexture=te.backgroundColorTexture,te.backgroundColorTexture=ae;const ue=te.particleVertices0;te.particleVertices0=te.particleVertices1,te.particleVertices1=ue,B.push([$,H,te,re])}if(B.length===0)return;const j=o.f.now(),U=S.previousDrawTimestamp?.001*(j-S.previousDrawTimestamp):.0167;if(S.previousDrawTimestamp=j,S.hasColorMap()){C.activeTexture.set(L.TEXTURE0+2);let $=S.colorRampTexture;$||($=S.colorRampTexture=new o.T(C,S.colorRamp,L.RGBA)),$.bind(L.LINEAR,L.CLAMP_TO_EDGE)}C.bindFramebuffer.set(S.tileFramebuffer.framebuffer),C.activeTexture.set(L.TEXTURE0),function($,N,H){const ee=$.context,X=ee.gl,te=N.tileFramebuffer;ee.activeTexture.set(X.TEXTURE0);const q={u_texture:0,u_opacity:1.05*(ae=N.paint.get("raster-particle-fade-opacity-factor"))/(ae+.05)},re=$.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ae;for(const ue of H){const[,,me,Me]=ue;te.colorAttachment.set(me.targetColorTexture.texture),ee.viewport.set([0,0,te.width,te.height]),ee.clear({color:o.ax.transparent}),Me&&(me.backgroundColorTexture.bind(X.NEAREST,X.CLAMP_TO_EDGE),re.draw($,X.TRIANGLES,Yt.disabled,li.disabled,Si.alphaBlended,Jt.disabled,q,N.id,$.viewportBuffer,$.quadTriangleIndexBuffer,$.viewportSegments))}}(x,S,B),function($,N,H,ee){const X=$.context.gl,te=H.tileFramebuffer,q=$.transform.projection.name==="globe",re=H.paint.get("raster-particle-max-speed");for(const ae of ee){const[ue,me,Me]=ae;me.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE),te.colorAttachment.set(Me.targetColorTexture.texture);const ye=$.getOrCreateProgram("rasterParticleDraw",{defines:me.defines,overrideFog:!1}),Oe=me.scalarData?[]:[0,1,2,3].map(ve=>o.cG[ve](ue));Oe.push(ue);const Le=ue.canonical.x,We=ue.canonical.y;for(const ve of Oe){const Ce=N.getTile(q?ve.wrapped():ve);if(!Ce)continue;const fe=Ce.rasterParticleState;if(!fe)continue;const we=Q_([ve.canonical.x+(1<<ve.canonical.z)*(ve.wrap-ue.wrap)-Le,ve.canonical.y-We],0,me.texture.size,2,re,me.textureOffset,me.scale,me.offset);ye.draw($,X.POINTS,Yt.disabled,li.disabled,Si.alphaBlended,Jt.disabled,we,H.id,fe.particleVertices0,void 0,fe.particleSegment)}}}(x,T,S,B),function($,N,H,ee){const X=$.context.gl;let te=N.transformFeedbackObject;te||(te=N.transformFeedbackObject=X.createTransformFeedback()),X.bindTransformFeedback(X.TRANSFORM_FEEDBACK,N.transformFeedbackObject);const q=N.paint.get("raster-particle-max-speed"),re=ee*N.paint.get("raster-particle-speed-factor")*.3,ae=(ue=N.paint.get("raster-particle-reset-rate-factor"),Math.pow(ue,6));var ue;for(const me of H){const[,Me,ye]=me;Me.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const Oe=yp(0,Me.texture.size,q,re,ae,Me.textureOffset,Me.scale,Me.offset);$.getOrCreateProgram("rasterParticleUpdate",{defines:Me.defines,transformFeedback:{bufferMode:X.SEPARATE_ATTRIBS,shaderVaryings:["v_new_particle"]}}).draw($,X.POINTS,Yt.disabled,li.disabled,Si.disabled,Jt.disabled,Oe,N.id,ye.particleVertices0,void 0,ye.particleSegment,{},void 0,void 0,void 0,void 0,[{buffer:ye.particleVertices1,targetIndex:0}])}X.bindTransformFeedback(X.TRANSFORM_FEEDBACK,null)}(x,S,B,U)}(u,r,s,h),u.renderPass==="translucent"&&(function(x,T,S,I,C){const L=x.context,k=L.gl,B=!x.options.moving,j=x.transform.projection.name==="globe";if(!I.length)return;const[U,$]=x.stencilConfigForOverlap(I),N=[];j&&N.push("PROJECTION_GLOBE_VIEW");for(const H of $){const ee=H.toUnwrapped(),X=T.getTile(H);if(!X.rasterParticleState)continue;const te=X.rasterParticleState,q=100;X.registerFadeDuration(q);const re=T.findLoadedParent(H,0),ae=nd(X,re,T,x.transform,q);let ue,me;x.terrain&&x.terrain.prepareDrawTile(),L.activeTexture.set(k.TEXTURE0),te.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),L.activeTexture.set(k.TEXTURE1),re&&re.rasterParticleState?(re.rasterParticleState.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),ue=Math.pow(2,re.tileID.overscaledZ-X.tileID.overscaledZ),me=[X.tileID.canonical.x*ue%1,X.tileID.canonical.y*ue%1]):te.targetColorTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const Me=j?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(ee,B),ye=x.transform,Oe=bd(ye),Le=o.cf(H.canonical),We=o.cg(Le.getCenter().lat);let ve,Ce,fe,we,Ke;j?(ve=Float32Array.from(o.aT(o.ci(H.canonical))),Ce=Float32Array.from(ye.globeMatrix),fe=Float32Array.from(o.ce(ye)),we=[o.a5(ye.center.lng),o.ae(ye.center.lat)],Ke=Float32Array.from(o.ch(H.canonical,Le,We,ye.worldSize/ye._pixelsPerMercatorPixel))):(ve=new Float32Array(16),Ce=new Float32Array(9),fe=new Float32Array(16),we=[0,0],Ke=new Float32Array(9));const st=J_(Me,ve,Ce,fe,Ke,me||[0,0],o.S(x.transform.zoom),we,Oe,ue||1,ae,250),nt=x.isTileAffectedByFog(H),_t=x.getOrCreateProgram("rasterParticle",{defines:N,overrideFog:nt});if(x.uploadCommonUniforms(L,_t,ee),j){const Ot=new Yt(k.LEQUAL,Yt.ReadWrite,x.depthRangeFor3D),Zt=0,Bt=x.globeSharedBuffers;if(Bt){const[Ut,gi,si]=Bt.getGridBuffers(We,Zt!==0);_t.draw(x,k.TRIANGLES,Ot,li.disabled,Si.alphaBlended,Jt.backCCW,st,S.id,Ut,gi,si)}}else{const Ot=x.depthModeForSublayer(0,Yt.ReadOnly),Zt=U[H.overscaledZ],{tileBoundsBuffer:Bt,tileBoundsIndexBuffer:Ut,tileBoundsSegments:gi}=x.getTileBoundsBuffers(X);_t.draw(x,k.TRIANGLES,Ot,Zt,Si.alphaBlended,Jt.disabled,st,S.id,Bt,Ut,gi)}}x.resetStencilClippingMasks()}(u,r,s,h),u.style.map.triggerRepaint())},background:function(u,r,s,h){const p=s.paint.get("background-color"),_=s.paint.get("background-opacity"),x=s.paint.get("background-emissive-strength");if(_===0)return;const T=u.context,S=T.gl,I=u.transform,C=I.tileSize,L=s.paint.get("background-pattern");if(u.isPatternMissing(L,s.scope))return;const k=!L&&p.a===1&&_===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==k)return;const B=li.disabled,j=u.depthModeForSublayer(0,k==="opaque"?Yt.ReadWrite:Yt.ReadOnly),U=u.colorModeForDrapableLayerRenderPass(x),$=L?"backgroundPattern":"background";let N,H=h;H||(N=u.getBackgroundTiles(),H=Object.values(N).map(ee=>ee.tileID)),L&&(T.activeTexture.set(S.TEXTURE0),u.imageManager.bind(u.context,s.scope));for(const ee of H){const X=u.isTileAffectedByFog(ee),te=u.getOrCreateProgram($,{overrideFog:X}),q=ee.toUnwrapped(),re=h?ee.projMatrix:u.transform.calculateProjMatrix(q);u.prepareDrawTile();const ae=r?r.getTile(ee):N?N[ee.key]:new Eo(ee,C,I.zoom,u),ue=L?Jl(re,x,_,u,L,s.scope,{tileID:ee,tileSize:C}):md(re,x,_,p);u.uploadCommonUniforms(T,te,q);const{tileBoundsBuffer:me,tileBoundsIndexBuffer:Me,tileBoundsSegments:ye}=u.getTileBoundsBuffers(ae);te.draw(u,S.TRIANGLES,j,B,U,Jt.disabled,ue,s.id,me,Me,ye)}},sky:function(u,r,s){const h=u._atmosphere?o.S(u.transform.zoom):1,p=s.paint.get("sky-opacity")*h;if(p===0)return;const _=u.context,x=s.paint.get("sky-type"),T=new Yt(_.gl.LEQUAL,Yt.ReadOnly,[0,1]),S=u.frameCounter/1e3%1;x==="atmosphere"?u.renderPass==="offscreen"?s.needsSkyboxCapture(u)&&(function(I,C,L,k){const B=I.context,j=B.gl;let U=C.skyboxFbo;if(!U){U=C.skyboxFbo=B.createFramebuffer(32,32,!0,null),C.skyboxGeometry=new Md(B),C.skyboxTexture=B.gl.createTexture(),j.bindTexture(j.TEXTURE_CUBE_MAP,C.skyboxTexture),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,j.LINEAR);for(let ee=0;ee<6;++ee)j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+ee,0,j.RGBA,32,32,0,j.RGBA,j.UNSIGNED_BYTE,null)}B.bindFramebuffer.set(U.framebuffer),B.viewport.set([0,0,32,32]);const $=C.getCenter(I,!0),N=I.getOrCreateProgram("skyboxCapture"),H=new Float64Array(16);o.a6.identity(H),o.a6.rotateY(H,H,.5*-Math.PI),ua(I,C,N,H,$,0),o.a6.identity(H),o.a6.rotateY(H,H,.5*Math.PI),ua(I,C,N,H,$,1),o.a6.identity(H),o.a6.rotateX(H,H,.5*-Math.PI),ua(I,C,N,H,$,2),o.a6.identity(H),o.a6.rotateX(H,H,.5*Math.PI),ua(I,C,N,H,$,3),o.a6.identity(H),ua(I,C,N,H,$,4),o.a6.identity(H),o.a6.rotateY(H,H,Math.PI),ua(I,C,N,H,$,5),B.viewport.set([0,0,I.width,I.height])}(u,s),s.markSkyboxValid(u)):u.renderPass==="sky"&&function(I,C,L,k,B){const j=I.context,U=j.gl,$=I.transform,N=I.getOrCreateProgram("skybox");j.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_CUBE_MAP,C.skyboxTexture);const H=((ee,X,te,q,re)=>({u_matrix:ee,u_sun_direction:X,u_cubemap:0,u_opacity:q,u_temporal_offset:re}))($.skyboxMatrix,C.getCenter(I,!1),0,k,B);I.uploadCommonUniforms(j,N),N.draw(I,U.TRIANGLES,L,li.disabled,I.colorModeForRenderPass(),Jt.backCW,H,"skybox",C.skyboxGeometry.vertexBuffer,C.skyboxGeometry.indexBuffer,C.skyboxGeometry.segment)}(u,s,T,p,S):x==="gradient"&&u.renderPass==="sky"&&function(I,C,L,k,B){const j=I.context,U=j.gl,$=I.transform,N=I.getOrCreateProgram("skyboxGradient");C.skyboxGeometry||(C.skyboxGeometry=new Md(j)),j.activeTexture.set(U.TEXTURE0);let H=C.colorRampTexture;H||(H=C.colorRampTexture=new o.T(j,C.colorRamp,U.RGBA)),H.bind(U.LINEAR,U.CLAMP_TO_EDGE);const ee=((X,te,q,re,ae)=>({u_matrix:X,u_color_ramp:0,u_center_direction:te,u_radius:o.bj(q),u_opacity:re,u_temporal_offset:ae}))($.skyboxMatrix,C.getCenter(I,!1),C.paint.get("sky-gradient-radius"),k,B);I.uploadCommonUniforms(j,N),N.draw(I,U.TRIANGLES,L,li.disabled,I.colorModeForRenderPass(),Jt.backCW,ee,"skyboxGradient",C.skyboxGeometry.vertexBuffer,C.skyboxGeometry.indexBuffer,C.skyboxGeometry.segment)}(u,s,T,p,S)},debug:function(u,r,s,h,p,_){for(let x=0;x<s.length;x++)if(p){const I=new o.ax(h.r*.8,h.g*.8,h.b*.8,1);ko(u,r,s[x],h,-1,-1,_),ko(u,r,s[x],h,-1,1,_),ko(u,r,s[x],h,1,1,_),ko(u,r,s[x],h,1,-1,_),ko(u,r,s[x],I,0,0,_)}else ko(u,r,s[x],h,0,0,_)},custom:function(u,r,s,h){const p=u.context,_=s.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&s.isLayerDraped(r)){if(u.renderPass==="offscreen"){const x=_.prerender;if(x){if(u.setCustomLayerDefaults(),p.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const T=u.transform.pointMerc;x.call(_,p.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),o.S(u.transform.zoom),[T.x,T.y],u.transform.pixelsPerMeterRatio)}else x.call(_,p.gl,u.transform.customLayerMatrix());p.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const T=_.renderToTile;if(T){const S=h[0].canonical,I=new o.L(S.x+h[0].wrap*(1<<S.z),S.y,S.z);p.setDepthMode(Yt.disabled),p.setStencilMode(li.disabled),p.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),T.call(_,p.gl,I),p.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),p.setColorMode(u.colorModeForRenderPass()),p.setStencilMode(li.disabled);const x=_.renderingMode==="3d"?new Yt(u.context.gl.LEQUAL,Yt.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,Yt.ReadOnly);if(p.setDepthMode(x),u.transform.projection.name==="globe"){const T=u.transform.pointMerc;_.render(p.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),o.S(u.transform.zoom),[T.x,T.y],u.transform.pixelsPerMeterRatio)}else _.render(p.gl,u.transform.customLayerMatrix());p.setDirty(),u.setBaseState(),p.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,r,s,h){if(u.renderPass==="opaque")return;const p=s.paint.get("model-opacity");if(p===0)return;const _=s.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!_||u.terrain&&p<.65&&s._transitionablePaint._values["model-opacity"].value.expression instanceof o.Z))return;const x=u.shadowRenderer,T=s.paint.get("model-receive-shadows");x&&(x.useNormalOffset=!0,T||(x.enabled=!1));const S=()=>{x&&(x.useNormalOffset=!0,T||(x.enabled=!0))},I=r.getSource();if(u.renderPass==="light-beam"&&I.type!=="batched-model")return;if(I.type==="vector"||I.type==="geojson")return function(N,H,ee,X){const te=N.transform;if(te.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${te.projection.name} projection is not yet implemented`);const q=te.getFreeCameraOptions().position;if(!N.modelManager)return;const re=N.modelManager;ee.modelManager=re;const ae=N.shadowRenderer;if(!ee._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ue=ee._unevaluatedLayout._values["model-id"],me={...ee.layout.get("model-id").parameters};for(const Me of X){const ye=H.getTile(Me).getBucket(ee);if(!ye||ye.projection.name!==te.projection.name)continue;const Oe=Sp(Me,te);me.zoom=Oe;const Le=ue.possiblyEvaluate(me);if(Ad(N,ye,Me),ls.shadowUniformsInitialized=!1,ls.useSingleShadowCascade=!!ae&&ae.getMaxCascadeForTile(Me.toUnwrapped())===0,N.renderPass==="shadow"&&ae){if(N.currentShadowCascade===1&&ye.isInsideFirstShadowMapFrustum)continue;const Ce=te.calculatePosMatrix(Me.toUnwrapped(),te.worldSize);if(ls.tileMatrix.set(Ce),ls.shadowTileMatrix=Float32Array.from(ae.calculateShadowPassMatrixFromMatrix(Ce)),ls.aabb.min.fill(0),ls.aabb.max[0]=ls.aabb.max[1]=o.V,ls.aabb.max[2]=0,ng(ye,ls,N,ee.scope))continue}const We=1<<Me.canonical.z,ve=[((q.x-Me.wrap)*We-Me.canonical.x)*o.V,(q.y*We-Me.canonical.y)*o.V,q.z*We*o.V];for(let Ce in ye.instancesPerModel){const fe=ye.instancesPerModel[Ce];fe.features.length>0&&(Ce=Le.evaluate(fe.features[0].feature,{}));const we=re.getModel(Ce,ee.scope);if(we&&we.uploaded)for(const Ke of we.nodes)Id(N,ee,Ke,fe,ve,Me,ls)}}}(u,r,s,h),void S();if(!I.loaded())return;if(I.type==="batched-model")return function(N,H,ee,X){ee.resetLayerRenderingStats(N);const te=N.context,q=N.transform,re=N.style.fog,ae=N.shadowRenderer;if(q.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${q.projection.name} projection is not yet implemented`);const ue=N.transform.getFreeCameraOptions().position,me=o.N.scale([],[ue.x,ue.y,ue.z],N.transform.worldSize);o.N.negate(me,me);const Me=o.a6.identity([]),ye=o.cR(q.center.lat,q.zoom),Oe=o.a6.fromScaling([],[1,1,1/ye]);o.a6.translate(Me,Me,me);const Le=ee.paint.get("model-opacity"),We=new Yt(te.gl.LEQUAL,Yt.ReadWrite,N.depthRangeFor3D),ve=new Yt(te.gl.LEQUAL,Yt.ReadOnly,N.depthRangeFor3D),Ce=new o.bS([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),fe=N.renderPass==="shadow",we=fe&&ae?ae.getCurrentCascadeFrustum():q.getFrustum(q.scaleZoom(q.worldSize)),Ke=ee.getLayerRenderingStats(),st=function(nt,_t){for(const Ot of X){const Zt=H.getTile(Ot).getBucket(ee);if(!Zt||!Zt.uploaded)continue;let Bt=!1;ae&&(Bt=ae.getMaxCascadeForTile(Ot.toUnwrapped())===0);const Ut=q.calculatePosMatrix(Ot.toUnwrapped(),q.worldSize),gi=Zt.modelTraits;for(const si of Zt.getNodesInfo()){if(si.hiddenByReplacement||!si.node.meshes)continue;const di=si.evaluatedScale,ui=si.node;let ki=0;if(N.terrain&&ui.elevation&&(ki=ui.elevation*N.terrain.exaggeration()),di[0]<=1&&di[1]<=1&&di[2]<=1&&(()=>{const vr=si.getLocalBounds();return Ce.min=[...vr.min],Ce.max=[...vr.max],Ce.min[2]+=ki,Ce.max[2]+=ki,o.N.transformMat4(Ce.min,Ce.min,Ut),o.N.transformMat4(Ce.max,Ce.max,Ut),Ce})().intersects(we)===0)continue;const pr=N.renderPass==="light-beam",Ai=[...Ut];o.a6.translate(Ai,Ai,[(ui.anchor?ui.anchor[0]:0)*(di[0]-1),(ui.anchor?ui.anchor[1]:0)*(di[1]-1),ki]),o.N.exactEquals(di,o.cT)||o.a6.scale(Ai,Ai,di),o.a6.multiply(Ai,Ai,ui.matrix);const kr=o.a6.multiply([],Oe,Ai);o.a6.multiply(kr,Me,kr);const Ii=o.a6.invert([],kr);o.a6.transpose(Ii,Ii),o.a6.scale(Ii,Ii,Ha);const Gi=o.a6.multiply([],q.expandedFarZProjMatrix,Ai),Ci=gi&o.cV.HasMapboxMeshFeatures,ji=Ci?0:si.evaluatedRMEA[0][2];for(let vr=0;vr<ui.meshes.length;++vr){const Yi=ui.meshes[vr],fn=vr===ui.lightMeshIndex;if(fn){if(!pr&&!N.terrain&&N.shadowRenderer){N.currentLayer<N.firstLightBeamLayer&&(N.firstLightBeamLayer=N.currentLayer);continue}}else if(pr)continue;const An={defines:[]},Yn=[];if(zr(An.defines,Yn,Yi,N),Ci||An.defines.push("DIFFUSE_SHADED"),Bt&&An.defines.push("SHADOWS_SINGLE_CASCADE"),Ke&&(fe?Ke.numRenderedVerticesInShadowPass+=Yi.vertexArray.length:Ke.numRenderedVerticesInTransparentPass+=Yi.vertexArray.length),fe){Te(Yi,Ai,N,ee);continue}let $s=null;if(re){const Qn=ha(Ai,N.transform);if($s=new Float32Array(Qn),q.projection.name!=="globe"){const qs=Yi.aabb.min,Uo=Yi.aabb.max,[fa,xc]=re.getOpacityForBounds(Qn,qs[0],qs[1],Uo[0],Uo[1]);An.overrideFog=fa>=rr||xc>=rr}}const Jn=Yi.material;let pn;Jn.occlusionTexture&&Jn.occlusionTexture.offsetScale&&(pn=Jn.occlusionTexture.offsetScale,An.defines.push("OCCLUSION_TEXTURE_TRANSFORM")),!fe&&ae&&(ae.useNormalOffset=!!Yi.normalBuffer);const an=N.getOrCreateProgram("model",An);!fe&&ae&&ae.setupShadowsFromMatrix(Ai,an,ae.useNormalOffset),N.uploadCommonUniforms(te,an,Ot.toUnwrapped(),$s);const kn=Jn.pbrMetallicRoughness;kn.metallicFactor=.9,kn.roughnessFactor=.5;const Gn=xu(new Float32Array(Gi),new Float32Array(kr),new Float32Array(Ii),N,Le,kn.baseColorFactor,Jn.emissiveFactor,kn.metallicFactor,kn.roughnessFactor,Jn,ji,ee,[0,0,0],pn);an.draw(N,te.gl.TRIANGLES,_t&&!fn?We:ve,li.disabled,nt?fn||Le<1||si.hasTranslucentParts?Si.alphaBlended:Si.unblended:Si.disabled,Jt.backCCW,Gn,ee.id,Yi.vertexBuffer,Yi.indexBuffer,Yi.segments,ee.paint,N.transform.zoom,void 0,Yn)}}}};(function(nt,_t,Ot,Zt){const Bt=nt.terrain?nt.terrain.exaggeration():0,Ut=nt.transform.zoom;for(const gi of Zt){const si=_t.getTile(gi).getBucket(Ot);si&&(nt.conflationActive&&si.updateReplacement(gi,nt.replacementSource),si.evaluateScale(nt,Ot),nt.terrain&&Bt>0&&si.elevationUpdate(nt.terrain,Bt,gi,Ot.source),si.needsReEvaluation(nt,Ut,Ot)&&si.evaluate(Ot))}})(N,H,ee,X),Le===1?st(!0,!0):(st(!1,!0),st(!0,!1))}(u,r,s,h),void S();const C=I.getModels(),L=[],k=u.transform.getFreeCameraOptions().position,B=o.N.scale([],[k.x,k.y,k.z],u.transform.worldSize);o.N.negate(B,B);const j=[],U=[];let $=0;for(const N of C){const H=s.paint.get("model-rotation").constantOr(null),ee=s.paint.get("model-scale").constantOr(null),X=s.paint.get("model-translation").constantOr(null);N.computeModelMatrix(u,H,ee,X,!0,!0,!1);const te=o.a6.identity([]),q=o.cR(N.position.lat,u.transform.zoom),re=o.a6.fromScaling([],[1,1,1/q]);o.a6.translate(te,te,B),L.push({zScaleMatrix:re,negCameraPosMatrix:te});for(const ae of N.nodes)nc(u.transform,ae,N.matrix,u.transform.expandedFarZProjMatrix,$,j,U);$++}if(j.sort((N,H)=>H.depth-N.depth),u.renderPass!=="shadow"){if(p===1)for(const N of U)rc(N,u,s,L[N.modelIndex],li.disabled,u.colorModeForRenderPass());else{for(const N of U)rc(N,u,s,L[N.modelIndex],li.disabled,Si.disabled);for(const N of U)rc(N,u,s,L[N.modelIndex],u.stencilModeFor3D(),u.colorModeForRenderPass());u.resetStencilClippingMasks()}for(const N of j)rc(N,u,s,L[N.modelIndex],li.disabled,u.colorModeForRenderPass());S()}else{for(const N of U)Te(N.mesh,N.nodeModelMatrix,u,s);for(const N of j)Te(N.mesh,N.nodeModelMatrix,u,s);S()}}},Cd={model:function(u,r,s){const h=u.scope,p=r.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(s.modelManager&&s.modelManager.upload(s,h));if(p.type==="batched-model")return;const _=p.getModels();for(const x of _)x.upload(s.context)},raster:function(u,r,s){const h=r.getSource();if(!(h instanceof ct&&h.loaded()))return;const p=u.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!p)return;const _=u.paint.get("raster-array-band")||h.getInitialBand(p);if(_==null)return;const x=r.getIds().map(T=>r.getTileByID(T));for(const T of x)T.updateNeeded(p,_)&&h.prepareTile(T,p,_)},"raster-particle":function(u,r,s){const h=r.getSource();if(!(h instanceof ct&&h.loaded()))return;const p=u.sourceLayer||h.rasterLayerIds&&h.rasterLayerIds[0];if(!p)return;const _=u.paint.get("raster-particle-array-band")||h.getInitialBand(p);if(_==null)return;const x=r.getIds().map(T=>r.getTileByID(T));for(const T of x)T.updateNeeded(p,_)&&h.prepareTile(T,p,_)}};class Ap{constructor(r,s,h,p){this.context=new Kf(r,s),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=p,this._debugParams={showTerrainProxyTiles:!1},p.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=Ss.maxUnderzooming+Ss.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.cX,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Zh(this),this._wireframeDebugCache=new Mp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(r,s){const h=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(h||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Y_(this,r));const p=this._terrain;this.transform.elevation=h?p:null,p.update(r,this.transform,s),this.transform.elevation&&!p.enabled&&(this.transform.elevation=null)}_updateFog(r){const s=r.fog;if(!s||this.transform.projection.name==="globe"||s.getOpacity(this.transform.pitch)<1||s.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[h,p]=s.getFovAdjustedRange(this.transform._fov);if(h>p)return void(this.transform.fogCullDistSq=null);const _=h+.78*(p-h);this.transform.fogCullDistSq=_*_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,s){if(this.width=r*o.f.devicePixelRatio,this.height=s*o.f.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const h of this.style.order)this.style._mergedLayers[h].resize()}setup(){const r=this.context,s=new o.aN;s.emplaceBack(0,0),s.emplaceBack(o.V,0),s.emplaceBack(0,o.V),s.emplaceBack(o.V,o.V),this.tileExtentBuffer=r.createVertexBuffer(s,o.aP.members),this.tileExtentSegments=o.aB.simpleSegment(0,0,4,2);const h=new o.aN;h.emplaceBack(0,0),h.emplaceBack(o.V,0),h.emplaceBack(0,o.V),h.emplaceBack(o.V,o.V),this.debugBuffer=r.createVertexBuffer(h,o.aP.members),this.debugSegments=o.aB.simpleSegment(0,0,4,5);const p=new o.aN;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(-1,1),p.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(p,o.aP.members),this.viewportSegments=o.aB.simpleSegment(0,0,4,2);const _=new o.av;_.emplaceBack(0,0,0,0),_.emplaceBack(o.V,0,o.V,0),_.emplaceBack(0,o.V,0,o.V),_.emplaceBack(o.V,o.V,o.V,o.V),this.mercatorBoundsBuffer=r.createVertexBuffer(_,o.aR.members),this.mercatorBoundsSegments=o.aB.simpleSegment(0,0,4,2);const x=new o.aw;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(x);const T=new o.aO;for(const I of[0,1,3,2,0])T.emplaceBack(I);this.debugIndexBuffer=r.createIndexBuffer(T),this.emptyTexture=new o.T(r,new o.h({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=o.a6.create();const S=this.context.gl;this.stencilClearMode=new li({func:S.ALWAYS,mask:0},0,255,S.ZERO,S.ZERO,S.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,Yt.disabled,this.stencilClearMode,Si.disabled,Jt.disabled,rd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,s,h){if(!s||this.currentStencilSource===s.id||!r.isTileClipped()||!h||h.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const S of h)if(this._tileClippingMaskIDs[S.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=s.id;const p=this.context,_=p.gl;this.nextStencilID+h.length>256&&this.clearStencil(),p.setColorMode(Si.disabled),p.setDepthMode(Yt.disabled);const x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of h){const S=s.getTile(T),I=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:C,tileBoundsIndexBuffer:L,tileBoundsSegments:k}=this.getTileBoundsBuffers(S);x.draw(this,_.TRIANGLES,Yt.disabled,new li({func:_.ALWAYS,mask:0},I,255,_.KEEP,_.KEEP,_.REPLACE),Si.disabled,Jt.disabled,rd(T.projMatrix),"$clipping",C,L,k)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,s=this.context.gl;return new li({func:s.NOTEQUAL,mask:255},r,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const s=this.context.gl;return new li({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(r){const s=this.context.gl,h=r.sort((x,T)=>T.overscaledZ-x.overscaledZ),p=h[h.length-1].overscaledZ,_=h[0].overscaledZ-p+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const x={};for(let T=0;T<_;T++)x[T+p]=new li({func:s.GEQUAL,mask:255},T+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=_,[x,h]}return[{[p]:li.disabled},h]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new Si([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new o.ax(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Si.unblended:Si.alphaBlended}colorModeForDrapableLayerRenderPass(r){const s=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Si([s.ONE,s.ONE_MINUS_SRC_ALPHA,s.CONSTANT_ALPHA,s.ONE_MINUS_SRC_ALPHA],new o.ax(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,s,h,p=!1){if(!this.opaquePassEnabledForLayer()&&!p)return Yt.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Yt(h||this.context.gl.LEQUAL,s,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,s){this._wireframeDebugCache.update(this.frameCounter),this.style=r,this.options=s;const h=this.style._mergedLayers,p=this.style.order,_=p.map(q=>h[q]),x=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.f.now()),this.imageManager.beginFrame();let T=0,S=!1;for(const q in x){const re=x[q];re.used&&(re.prepare(this.context),re.getSource().usedInConflation&&++T)}for(const q of _)q.isHidden(this.transform.zoom)||this.prepareLayer(q);const I={},C={},L={},k={},B={};for(const q in x){const re=x[q];I[q]=re.getVisibleCoordinates(),C[q]=I[q].slice().reverse(),L[q]=re.getVisibleCoordinates(!0).reverse(),k[q]=re.getShadowCasterCoordinates(),B[q]=re.sortCoordinatesByDistance(I[q])}const j=q=>{const re=this.style.getLayerSourceCache(q);return re&&re.used?re.getSource():null};if(T){const q=[];for(const re of _)this.layerUsedInConflation(re,j(re))&&q.push(re);if(q&&q.length>1){const re=[];for(const ae of q){const ue=this.style.getLayerSourceCache(ae);ue&&ue.used&&ue.getSource().usedInConflation&&re.push({layer:ae.fqid,cache:ue})}this.replacementSource.setSources(re),S=!0}}S||this.replacementSource.clear(),this.conflationActive=S,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const q of _){const re=q.cutoffRange();if(this.longestCutoffRange=Math.max(re,this.longestCutoffRange),re>0){const ae=j(q);ae&&(this.minCutoffZoom=Math.max(ae.minzoom,this.minCutoffZoom)),q.minzoom&&(this.minCutoffZoom=Math.max(q.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let q=0;q<_.length;q++)if(_[q].is3D()){this.opaquePassCutoff=q;break}const U=this.style&&this.style.fog;U?(this._fogVisible=U.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=U.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(L),this.opaquePassCutoff=0);const $=this._shadowRenderer;if($){$.updateShadowParameters(this.transform,this.style.directionalLight);for(const q in x)for(const re of I[q]){let ae={min:0,max:0};this.terrain&&(ae=this.terrain.getMinMaxForTile(re)||ae),$.addShadowReceiver(re.toUnwrapped(),ae.min,ae.max)}}if(this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.cY(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Wt(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!o.cZ(this.context.gl))return;this.renderPass="offscreen";for(const q of _){const re=r.getLayerSourceCache(q);if(!q.hasOffscreenPass()||q.isHidden(this.transform.zoom))continue;const ae=re?C[re.id]:void 0;(q.type==="custom"||q.type==="raster"||q.type==="raster-particle"||q.isSky()||ae&&ae.length)&&this.renderLayer(this,re,q,ae)}this.depthRangeFor3D=[0,1-(_.length+2)*this.numSublayers*this.depthEpsilon];const N=this.terrain;N&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&N.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,k)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const H=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ee=(()=>{if(s.showOverdrawInspector)return o.ax.black;if(this.style.fog&&this.transform.projection.supportsFog&&!H){const q=this.style.fog.properties.get("color").toArray01();return new o.ax(...q)}if(this.style.fog&&this.transform.projection.supportsFog&&H){const q=this.style.fog.properties.get("space-color").toArray01();return new o.ax(...q)}return o.ax.transparent})();if(this.context.clear({color:ee,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&H&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const q=_[this.currentLayer],re=r.getLayerSourceCache(q);if(q.isSky())continue;const ae=re?(q.is3D()?B:C)[re.id]:void 0;this._renderTileClippingMasks(q,re,ae),this.renderLayer(this,re,q,ae)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&H&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.S(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const q=_[this.currentLayer],re=r.getLayerSourceCache(q);q.isSky()&&this.renderLayer(this,re,q,re?C[re.id]:void 0)}function X(q,re){let ae;return re&&(ae=(q.type==="symbol"?L:q.is3D()?B:C)[re.id]),ae}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<p.length;){const q=_[this.currentLayer];if(q.type==="raster"){const re=r.getLayerSourceCache(q);this.renderLayer(this,re,q,X(q,re))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let te=0;for($&&(te=$.getShadowCastingLayerCount());this.currentLayer<p.length;){const q=_[this.currentLayer],re=r.getLayerSourceCache(q);if(q.isSky())++this.currentLayer;else if(N&&this.style.isLayerDraped(q)){if(q.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=N.renderBatch(this.currentLayer)}else{if(this._renderTileClippingMasks(q,re,re?I[re.id]:void 0),this.renderLayer(this,re,q,X(q,re)),!N&&$&&te>0&&q.hasShadowPass()&&--te==0&&($.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const ae=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ae;this.currentLayer++){const ue=_[this.currentLayer];if(!ue.hasLightBeamPass())continue;const me=r.getLayerSourceCache(ue);this.renderLayer(this,me,ue,me?C[me.id]:void 0)}this.currentLayer=ae,this.renderPass="translucent"}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let q=null;_.forEach(re=>{const ae=r.getLayerSourceCache(re);ae&&!re.isHidden(this.transform.zoom)&&ae.getVisibleCoordinates().length&&(!q||q.getSource().maxzoom<ae.getSource().maxzoom)&&(q=ae)}),q&&this.options.showTileBoundaries&&oc.debug(this,q,q.getVisibleCoordinates(),o.ax.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&oc.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ax(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(q){const re=q.transform.padding;Ed(q,q.transform.height-(re.top||0),3,Xn),Ed(q,re.bottom||0,3,zo),as(q,re.left||0,3,Ep),as(q,q.transform.width-(re.right||0),3,wd);const ae=q.transform.centerPoint;(function(ue,me,Me,ye){Or(ue,me-1,Me-10,2,20,ye),Or(ue,me-10,Me-1,20,2,ye)})(q,ae.x,q.transform.height-ae.y,Td)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),S||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:s}=this.transform.projection,h=!s||!s.includes(r.type);if(Cd[r.type]&&(h||this.terrain&&r.type==="custom")){const p=this.style.getLayerSourceCache(r);Cd[r.type](r,p,this)}this.gpuTimingEnd()}renderLayer(r,s,h,p){h.isHidden(this.transform.zoom)||(h.type==="background"||h.type==="sky"||h.type==="custom"||h.type==="model"||h.type==="raster"||h.type==="raster-particle"||p&&p.length)&&(this.id=h.id,this.gpuTimingStart(h),(!r.transform.projection.unsupportedLayers||!r.transform.projection.unsupportedLayers.includes(h.type)||r.terrain&&h.type==="custom")&&oc[h.type](r,s,h,p,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery,h=this.context.gl;let p=this.gpuTimers[r.id];p||(p=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:h.createQuery()}),p.calls++,h.beginQuery(s.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,s=this.context.gl,h=s.createQuery();this.deferredRenderGpuTimeQueries.push(h),s.beginQuery(r.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const s={};for(const h in r){const p=r[h],_=this.context.extTimerQuery,x=_.getQueryParameter(p.query,this.context.gl.QUERY_RESULT)/1e6;_.deleteQueryEXT(p.query),s[h]=x}return s}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const s=this.context.extTimerQuery,h=this.context.gl;let p=0;for(const _ of r)p+=s.getQueryParameter(_,h.QUERY_RESULT)/1e6,s.deleteQueryEXT(_);return p}translatePosMatrix(r,s,h,p,_){if(!h[0]&&!h[1])return r;const x=_?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(x){const I=Math.sin(x),C=Math.cos(x);h=[h[0]*C-h[1]*I,h[0]*I+h[1]*C]}const T=[_?h[0]:o.a3(s,h[0],this.transform.zoom),_?h[1]:o.a3(s,h[1],this.transform.zoom),0],S=new Float32Array(16);return o.a6.translate(S,r,T),S}saveTileTexture(r){const s=r.size[0],h=this._tileTextures[s];h?h.push(r):this._tileTextures[s]=[r]}getTileTexture(r){const s=this._tileTextures[r];return s&&s.length>0?s.pop():null}isPatternMissing(r,s){return r===null||r!==void 0&&!this.imageManager.getPattern(r.toString(),s)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,s,h){const p=h===void 0?this.terrain&&this.terrain.renderingToTexture:h,_=this.terrain&&this.terrain.exaggeration()===0,x=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(x.push("LIGHTING_3D_MODE"),x.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):p||x.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||x.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?x.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):x.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(x.push("TERRAIN"),this.linearFloatFilteringSupported()&&x.push("TERRAIN_DEM_FLOAT_FORMAT"),_&&x.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&x.push("GLOBE"),!this._fogVisible||p||s!==void 0&&!s||x.push("FOG","FOG_DITHERING"),p&&x.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&x.push("OVERDRAW_INSPECTOR"),x}getOrCreateProgram(r,s){this.cache=this.cache||{};const h=s&&s.defines||[],p=s&&s.config,_=s&&s.transformFeedback,x=this.currentGlobalDefines(r,s&&s.overrideFog,s&&s.overrideRtt).concat(h),T=ad.cacheKey(Jh[r],r,x,p);return this.cache[T]||(this.cache[T]=new ad(this.context,r,Jh[r],p,eg[r],x,_)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,s){if(this.style.enable3dLights()){const h=this.style.directionalLight,p=this.style.ambientLight;if(h&&p){const _=((x,T)=>{const S=x.properties.get("direction"),I=x.properties.get("color").toArray01(),C=x.properties.get("intensity"),L=T.properties.get("color").toArray01(),k=T.properties.get("intensity"),B=[S.x,S.y,S.z],j=o.cn(L,k),U=o.cn(I,C);return{u_lighting_ambient_color:j,u_lighting_directional_dir:B,u_lighting_directional_color:U,u_ground_radiance:sd(B,U,j)}})(h,p);s.setLightsUniformValues(r,_)}}}uploadCommonUniforms(r,s,h,p,_){if(this.uploadCommonLightUniforms(r,s),this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const T=x.getOpacity(this.transform.pitch),S=((I,C,L,k,B,j,U,$,N,H,ee,X)=>{const te=I.transform,q=C.properties.get("color").toArray01();q[3]=k;const re=I.frameCounter/1e3%1,[ae,ue]=C.properties.get("vertical-range");return{u_fog_matrix:L?te.calculateFogTileMatrix(L):X||I.identityMat,u_fog_range:C.getFovAdjustedRange(te._fov),u_fog_color:q,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ae,ue),ue],u_fog_temporal_offset:re,u_frustum_tl:B,u_frustum_tr:j,u_frustum_br:U,u_frustum_bl:$,u_globe_pos:N,u_globe_radius:H,u_viewport:ee,u_globe_transition:o.S(te.zoom),u_is_globe:+(te.projection.name==="globe")}})(this,x,h,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.f.devicePixelRatio,this.transform.height*o.f.devicePixelRatio],p);s.setFogUniformValues(r,S)}_&&s.setCutoffUniformValues(r,_.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,s=r.createTexture();return r.bindTexture(r.TEXTURE_2D,s),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),s}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,s=this._backgroundTiles={},h=this.transform.coveringTiles({tileSize:512});for(const p of h)s[p.key]=r[p.key]||new Eo(p,512,this.transform.tileZoom,this);return s}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(r,s){return!(!r.is3D()||r.minzoom&&r.minzoom>this.transform.zoom||r.sourceLayer!=="building"&&(!s||s.type!=="batched-model"))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let s=this._cachedTileFogOpacities[r.key];return s||(this._cachedTileFogOpacities[r.key]=s=this.style.fog.getOpacityForTile(r)),s[0]>=rr||s[1]>=rr}}function ac(u,r){let s=!1,h=null;const p=()=>{h=null,s&&(u(),h=setTimeout(p,r),s=!1)};return()=>(s=!0,h||p(),h)}class Tu{constructor(r){this._hashName=r&&encodeURIComponent(r),o.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ac(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const s=Pd(r);if(this._hashName){const h=this._hashName;let p=!1;const _=location.hash.slice(1).split("&").map(x=>{const T=x.split("=")[0];return T===h?(p=!0,`${T}=${s}`):x}).filter(x=>x);return p||_.push(`${h}=${s}`),`#${_.join("&")}`}return`#${s}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let s;return r.split("&").map(h=>h.split("=")).forEach(h=>{h[0]===this._hashName&&(s=h)}),(s&&s[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const s=this._getCurrentHash();if(s.length>=3&&!s.some(h=>isNaN(h))){const h=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(s[3]||0):r.getBearing();return r.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:h,pitch:+(s[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Pd(u,r){const s=u.getCenter(),h=Math.round(100*u.getZoom())/100,p=Math.ceil((h*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,p),x=Math.round(s.lng*_)/_,T=Math.round(s.lat*_)/_,S=u.getBearing(),I=u.getPitch();let C=r?`/${x}/${T}/${h}`:`${h}/${T}/${x}`;return(S||I)&&(C+="/"+Math.round(10*S)/10),I&&(C+=`/${Math.round(I)}`),C}const lc={linearity:.3,easing:o.c_(0,0,.3,1)},Kn=o.e({deceleration:2500,maxSpeed:1400},lc),og=o.e({deceleration:20,maxSpeed:1400},lc),Eu=o.e({deceleration:1e3,maxSpeed:360},lc),Ar=o.e({deceleration:1e3,maxSpeed:90},lc);class nr{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.f.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,s=o.f.now();for(;r.length>0&&s-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const s={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)s.zoom+=_.zoomDelta||0,s.bearing+=_.bearingDelta||0,s.pitch+=_.pitchDelta||0,_.panDelta&&s.pan._add(_.panDelta),_.around&&(s.around=_.around),_.pinchAround&&(s.pinchAround=_.pinchAround);const h=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(s.pan.mag()){const _=Ps(s.pan.mag(),h,o.e({},Kn,r||{}));p.offset=s.pan.mult(_.amount/s.pan.mag()),p.center=this._map.transform.center,cc(p,_)}if(s.zoom){const _=Ps(s.zoom,h,og);p.zoom=this._map.transform.zoom+_.amount,cc(p,_)}if(s.bearing){const _=Ps(s.bearing,h,Eu);p.bearing=this._map.transform.bearing+o.aa(_.amount,-179,179),cc(p,_)}if(s.pitch){const _=Ps(s.pitch,h,Ar);p.pitch=this._map.transform.pitch+_.amount,cc(p,_)}if(p.zoom||p.bearing){const _=s.pinchAround===void 0?s.around:s.pinchAround;p.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),p.noMoveStart=!0,p}}function cc(u,r){(!u.duration||u.duration<r.duration)&&(u.duration=r.duration,u.easing=r.easing)}function Ps(u,r,s){const{maxSpeed:h,linearity:p,deceleration:_}=s,x=o.aa(u*p/(r/1e3),-h,h),T=Math.abs(x)/(_*p);return{easing:s.easing,duration:1e3*T,amount:x*(T/2)}}class jn extends o.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,h,p={}){const _=At(s.getCanvasContainer(),h),x=s.unproject(_);super(r,o.e({point:_,lngLat:x,originalEvent:h},p)),this._defaultPrevented=!1,this.target=s}}class ro extends o.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,h){const p=r==="touchend"?h.changedTouches:h.touches,_=_i(s.getCanvasContainer(),p),x=_.map(S=>s.unproject(S)),T=_.reduce((S,I,C,L)=>S.add(I.div(L.length)),new o.P(0,0));super(r,{points:_,point:T,lngLats:x,lngLat:s.unproject(T),originalEvent:h}),this._defaultPrevented=!1}}class Rd extends o.b{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,s,h){super(r,{originalEvent:h}),this._defaultPrevented=!1}}class Ld{constructor(r,s){this._map=r,this._clickTolerance=s.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Rd(r.type,this._map,r))}mousedown(r,s){return this._mousedownPos=s,this._firePreventable(new jn(r.type,this._map,r))}mouseup(r){this._map.fire(new jn(r.type,this._map,r))}preclick(r){const s=o.e({},r);s.type="preclick",this._map.fire(new jn(s.type,this._map,s))}click(r,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||(this.preclick(r),this._map.fire(new jn(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new jn(r.type,this._map,r))}mouseover(r){this._map.fire(new jn(r.type,this._map,r))}mouseout(r){this._map.fire(new jn(r.type,this._map,r))}touchstart(r){return this._firePreventable(new ro(r.type,this._map,r))}touchmove(r){this._map.fire(new ro(r.type,this._map,r))}touchend(r){this._map.fire(new ro(r.type,this._map,r))}touchcancel(r){this._map.fire(new ro(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bo{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new jn(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new jn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new jn(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fo{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,s){this.isEnabled()&&r.shiftKey&&r.button===0&&(ht(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(r,s){if(!this._active)return;const h=s,p=this._startPos,_=this._lastPos;if(!p||!_||_.equals(h)||!this._box&&h.dist(p)<this._clickTolerance)return;this._lastPos=h,this._box||(this._box=ce("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const x=Math.min(p.x,h.x),T=Math.max(p.x,h.x),S=Math.min(p.y,h.y),I=Math.max(p.y,h.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${S}px)`,this._box.style.width=T-x+"px",this._box.style.height=I-S+"px")})}mouseupWindow(r,s){if(!this._active)return;const h=this._startPos,p=s;if(h&&r.button===0){if(this.reset(),kt(),h.x!==p.x||h.y!==p.y)return this._map.fire(new o.b("boxzoomend",{originalEvent:r})),{cameraAnimation:_=>_.fitScreenCoordinates(h,p,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Xe(),delete this._startPos,delete this._lastPos}_fireEvent(r,s){return this._map.fire(new o.b(r,{originalEvent:s}))}}function Wa(u,r){const s={};for(let h=0;h<u.length;h++)s[u[h].identifier]=r[h];return s}class Su{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,s,h){(this.centroid||h.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),h.length===this.numTouches&&(this.centroid=function(p){const _=new o.P(0,0);for(const x of p)_._add(x);return _.div(p.length)}(s),this.touches=Wa(h,s)))}touchmove(r,s,h){if(this.aborted||!this.centroid)return;const p=Wa(h,s);for(const _ in this.touches){const x=p[_];(!x||x.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(r,s,h){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),h.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class uc{constructor(r){this.singleTap=new Su(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,s,h){this.singleTap.touchstart(r,s,h)}touchmove(r,s,h){this.singleTap.touchmove(r,s,h)}touchend(r,s,h){const p=this.singleTap.touchend(r,s,h);if(p){const _=r.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(p)<30;if(_&&x||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class Dd{constructor(){this._zoomIn=new uc({numTouches:1,numTaps:2}),this._zoomOut=new uc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,s,h){this._zoomIn.touchstart(r,s,h),this._zoomOut.touchstart(r,s,h)}touchmove(r,s,h){this._zoomIn.touchmove(r,s,h),this._zoomOut.touchmove(r,s,h)}touchend(r,s,h){const p=this._zoomIn.touchend(r,s,h),_=this._zoomOut.touchend(r,s,h);return p?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(p)},{originalEvent:r})}):_?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(_)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Od={0:1,2:2};class Gs{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,s){return!1}_move(r,s){return{}}mousedown(r,s){if(this._lastPoint)return;const h=ai(r);this._correctButton(r,h)&&(this._lastPoint=s,this._eventButton=h)}mousemoveWindow(r,s){const h=this._lastPoint;if(h){if(r.preventDefault(),this._eventButton!=null&&function(p,_){const x=Od[_];return p.buttons===void 0||(p.buttons&x)!==x}(r,this._eventButton))this.reset();else if(this._moved||!(s.dist(h)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(h,s)}}mouseupWindow(r){this._lastPoint&&ai(r)===this._eventButton&&(this._moved&&kt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zd extends Gs{mousedown(r,s){super.mousedown(r,s),this._lastPoint&&(this._active=!0)}_correctButton(r,s){return s===0&&!r.ctrlKey}_move(r,s){return{around:s,panDelta:s.sub(r)}}}class hc extends Gs{_correctButton(r,s){return s===0&&r.ctrlKey||s===2}_move(r,s){const h=.8*(s.x-r.x);if(h)return this._active=!0,{bearingDelta:h}}contextmenu(r){r.preventDefault()}}class Mu extends Gs{_correctButton(r,s){return s===0&&r.ctrlKey||s===2}_move(r,s){const h=-.5*(s.y-r.y);if(h)return this._active=!0,{pitchDelta:h}}contextmenu(r){r.preventDefault()}}class kd{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=s.clickTolerance||1,this.reset(),o.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(r,s,h){return this._calculateTransform(r,s,h)}touchmove(r,s,h){if(this._active&&!(h.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(h.length===1&&!o.c$())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,s,h)}}touchend(r,s,h){this._calculateTransform(r,s,h),this._active&&h.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,s,h){h.length>0&&(this._active=!0);const p=Wa(h,s),_=new o.P(0,0),x=new o.P(0,0);let T=0;for(const I in p){const C=p[I],L=this._touches[I];L&&(_._add(C),x._add(C.sub(L)),T++,p[I]=C)}if(this._touches=p,T<this._minTouches||!x.mag())return;const S=x.div(T);return this._sum._add(S),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(T),panDelta:S}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ce("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class dn{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,s,h){return{}}touchstart(r,s,h){this._firstTwoTouches||h.length<2||(this._firstTwoTouches=[h[0].identifier,h[1].identifier],this._start([s[0],s[1]]))}touchmove(r,s,h){const p=this._firstTwoTouches;if(!p)return;r.preventDefault();const[_,x]=p,T=Xa(h,s,_),S=Xa(h,s,x);if(!T||!S)return;const I=this._aroundCenter?null:T.add(S).div(2);return this._move([T,S],I,r)}touchend(r,s,h){if(!this._firstTwoTouches)return;const[p,_]=this._firstTwoTouches,x=Xa(h,s,p),T=Xa(h,s,_);x&&T||(this._active&&kt(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Xa(u,r,s){for(let h=0;h<u.length;h++)if(u[h].identifier===s)return r[h]}function Au(u,r){return Math.log(u/r)/Math.LN2}class dc extends dn{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,s){const h=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Au(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Au(this._distance,h),pinchAround:s}}}function No(u,r){return 180*u.angleWith(r)/Math.PI}class Bd extends dn{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,s){const h=this._vector;if(this._vector=r[0].sub(r[1]),h&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:No(this._vector,h),pinchAround:s}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const s=25/(Math.PI*this._minDiameter)*360,h=this._startVector;if(!h)return!1;const p=No(r,h);return Math.abs(p)<s}}function fc(u){return Math.abs(u.y)>Math.abs(u.x)}class Fd extends dn{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,fc(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,s,h){const p=this._lastPoints;if(!p)return;const _=r[0].sub(p[0]),x=r[1].sub(p[1]);return this._map._cooperativeGestures&&!o.c$()&&h.touches.length<3||(this._valid=this.gestureBeginsVertically(_,x,h.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(_.y+x.y)/2*-.5})}gestureBeginsVertically(r,s,h){if(this._valid!==void 0)return this._valid;const p=r.mag()>=2,_=s.mag()>=2;if(!p&&!_)return;if(!p||!_)return this._firstMove==null&&(this._firstMove=h),h-this._firstMove<100&&void 0;const x=r.y>0==s.y>0;return fc(r)&&fc(s)&&x}}const da={panStep:100,bearingStep:15,pitchStep:10};class pc{constructor(){const r=da;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let s=0,h=0,p=0,_=0,x=0;switch(r.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:r.shiftKey?h=-1:(r.preventDefault(),_=-1);break;case 39:r.shiftKey?h=1:(r.preventDefault(),_=1);break;case 38:r.shiftKey?p=1:(r.preventDefault(),x=-1);break;case 40:r.shiftKey?p=-1:(r.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(h=0,p=0),{cameraAnimation:T=>{const S=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:Nd,zoom:s?Math.round(S)+s*(r.shiftKey?2:1):S,bearing:T.getBearing()+h*this._bearingStep,pitch:T.getPitch()+p*this._pitchStep,offset:[-_*this._panStep,-x*this._panStep],center:T.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Nd(u){return u*(2-u)}const mc=4.000244140625,Vd=1/450;class Ip{constructor(r,s){this._map=r,this._el=r.getCanvasContainer(),this._handler=s,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Vd,o.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.c$()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let s=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const h=o.f.now(),p=h-(this._lastWheelEventTime||0);this._lastWheelEventTime=h,s!==0&&s%mc==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(p*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),r.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=r,this._delta-=s,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=At(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:s,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const s=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>mc?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&C!==0&&(C=1/C);const L=s(),k=Math.pow(2,L),B=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):k;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(B*C))),this._type==="wheel"&&(this._startZoom=L,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:s(),p=this._startZoom,_=this._easing;let x,T=!1;if(this._type==="wheel"&&p&&_){const I=Math.min((o.f.now()-this._lastWheelEventTime)/200,1),C=_(I);x=o.U(p,h,C),I<1?this._frameId||(this._frameId=!0):T=!0}else x=h,T=!0;this._active=!0,T&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let S=x-s();return S*this._lastDelta<0&&(S=0),{noInertia:!0,needsRenderFrame:!T,zoomDelta:S,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let s=o.d0;if(this._prevEase){const h=this._prevEase,p=(o.f.now()-h.start)/h.duration,_=h.easing(p+.01)-h.easing(p),x=.27/Math.sqrt(_*_+1e-4)*.01,T=Math.sqrt(.0729-x*x);s=o.c_(x,T,.25,1)}return this._prevEase={start:o.f.now(),duration:r,easing:s},s}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ce("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Cp{constructor(r,s){this._clickZoom=r,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Pp{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,s){return r.preventDefault(),{cameraAnimation:h=>{h.easeTo({duration:300,zoom:h.getZoom()+(r.shiftKey?-1:1),around:h.unproject(s)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rp{constructor(){this._tap=new uc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,s,h){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?h.length>0&&(this._swipePoint=s[0],this._swipeTouch=h[0].identifier):this._tap.touchstart(r,s,h))}touchmove(r,s,h){if(this._tapTime){if(this._swipePoint){if(h[0].identifier!==this._swipeTouch)return;const p=s[0],_=p.y-this._swipePoint.y;return this._swipePoint=p,r.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(r,s,h)}touchend(r,s,h){this._tapTime?this._swipePoint&&h.length===0&&this.reset():this._tap.touchend(r,s,h)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lp{constructor(r,s,h){this._el=r,this._mousePan=s,this._touchPan=h}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Dp{constructor(r,s,h){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=s,this._mousePitch=h}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Op{constructor(r,s,h,p){this._el=r,this._touchZoom=s,this._touchRotate=h,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const _c=u=>u.zoom||u.drag||u.pitch||u.rotate;class zp extends o.b{}class kp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,s){const h=o.N.sub([],s,r);this.radius=o.N.length(h[2]<0?o.N.div([],h,this.constants):[h[0],h[1],0])}projectRay(r){o.N.div(r,r,this.constants),o.N.normalize(r,r),o.N.mul(r,r,this.constants);const s=o.N.scale([],r,this.radius);if(s[2]>0){const h=o.N.scale([],[0,0,1],o.N.dot(s,[0,0,1])),p=o.N.scale([],o.N.normalize([],[s[0],s[1],0]),this.radius),_=o.N.add([],s,o.N.scale([],o.N.sub([],o.N.add([],p,h),s),2));s[0]=_[0],s[1]=_[1]}return s}}function gc(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class ag{constructor(r,s){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new nr(r),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new kp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(s),o.aY(["handleEvent","handleWindowEvent"],this);const h=this._el;this._listeners=[[h,"touchstart",{passive:!0}],[h,"touchmove",{passive:!1}],[h,"touchend",void 0],[h,"touchcancel",void 0],[h,"mousedown",void 0],[h,"mousemove",void 0],[h,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[h,"mouseover",void 0],[h,"mouseout",void 0],[h,"dblclick",void 0],[h,"click",void 0],[h,"keydown",{capture:!1}],[h,"keyup",void 0],[h,"wheel",{passive:!1}],[h,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,_,x]of this._listeners){const T=p===document?this.handleWindowEvent:this.handleEvent;p.addEventListener(_,T,x)}}destroy(){for(const[r,s,h]of this._listeners){const p=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(s,p,h)}}_addDefaultHandlers(r){const s=this._map,h=s.getCanvasContainer();this._add("mapEvent",new Ld(s,r));const p=s.boxZoom=new Fo(s,r);this._add("boxZoom",p);const _=new Dd,x=new Pp;s.doubleClickZoom=new Cp(x,_),this._add("tapZoom",_),this._add("clickZoom",x);const T=new Rp;this._add("tapDragZoom",T);const S=s.touchPitch=new Fd(s);this._add("touchPitch",S);const I=new hc(r),C=new Mu(r);s.dragRotate=new Dp(r,I,C),this._add("mouseRotate",I,["mousePitch"]),this._add("mousePitch",C,["mouseRotate"]);const L=new zd(r),k=new kd(s,r);s.dragPan=new Lp(h,L,k),this._add("mousePan",L),this._add("touchPan",k,["touchZoom","touchRotate"]);const B=new Bd,j=new dc;s.touchZoomRotate=new Op(h,j,B,T),this._add("touchRotate",B,["touchPan","touchZoom"]),this._add("touchZoom",j,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Bo(s));const U=s.scrollZoom=new Ip(s,this);this._add("scrollZoom",U,["mousePan"]);const $=s.keyboard=new pc;this._add("keyboard",$);for(const N of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[N]&&s[N].enable(r[N])}_add(r,s,h){this._handlers.push({handlerName:r,handler:s,allowed:h}),this._handlersById[r]=s}stop(r){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_c(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,s,h){for(const p in r)if(p!==h&&(!s||s.indexOf(p)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const s=[];for(const h of r)this._el.contains(h.target)&&s.push(h);return s}handleEvent(r,s){this._updatingCamera=!0;const h=r.type==="renderFrame",p=h?void 0:r,_={needsRenderFrame:!1},x={},T={},S=r.touches?this._getMapTouches(r.touches):void 0,I=S?_i(this._el,S):h?void 0:At(this._el,r);for(const{handlerName:k,handler:B,allowed:j}of this._handlers){if(!B.isEnabled())continue;let U;this._blockedByActive(T,j,k)?B.reset():B[s||r.type]&&(U=B[s||r.type](r,I,S),this.mergeHandlerResult(_,x,U,k,p),U&&U.needsRenderFrame&&this._triggerRenderFrame()),(U||B.isActive())&&(T[k]=B)}const C={};for(const k in this._previousActiveHandlers)T[k]||(C[k]=p);this._previousActiveHandlers=T,(Object.keys(C).length||gc(_))&&(this._changes.push([_,x,C]),this._triggerRenderFrame()),(Object.keys(T).length||gc(_))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:L}=_;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))}mergeHandlerResult(r,s,h,p,_){if(!h)return;o.e(r,h);const x={handlerName:p,originalEvent:h.originalEvent||_};h.zoomDelta!==void 0&&(s.zoom=x),h.panDelta!==void 0&&(s.drag=x),h.pitchDelta!==void 0&&(s.pitch=x),h.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const r={},s={},h={};for(const[p,_,x]of this._changes)p.panDelta&&(r.panDelta=(r.panDelta||new o.P(0,0))._add(p.panDelta)),p.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(r.around=p.around),p.aroundCoord!==void 0&&(r.aroundCoord=p.aroundCoord),p.pinchAround!==void 0&&(r.pinchAround=p.pinchAround),p.noInertia&&(r.noInertia=p.noInertia),o.e(s,_),o.e(h,x);this._updateMapTransform(r,s,h),this._changes=[]}_updateMapTransform(r,s,h){const p=this._map,_=p.transform,x=H=>[H.x,H.y,H.z];if((H=>{const ee=this._eventsInProgress.drag;return ee&&!this._handlersById[ee.handlerName].isActive()})()&&!gc(r)){const H=_.zoom;_.cameraElevationReference="sea",this._originalZoom!=null&&_._orthographicProjectionAtLowPitch&&_.projection.name!=="globe"&&_.pitch===0?(_.cameraElevationReference="ground",_.zoom=this._originalZoom):(_.recenterOnTerrain(),_.cameraElevationReference="ground"),H!==_.zoom&&this._map._update(!0)}if(_._isCameraConstrained&&p._stop(!0),!gc(r))return void this._fireEvents(s,h,!0);let{panDelta:T,zoomDelta:S,bearingDelta:I,pitchDelta:C,around:L,aroundCoord:k,pinchAround:B}=r;_._isCameraConstrained&&(S>0&&(S=0),_._isCameraConstrained=!1),B!==void 0&&(L=B),(S||(H=>s[H]&&!this._eventsInProgress[H])("drag"))&&L&&(this._dragOrigin=x(_.pointCoordinate3D(L)),this._originalZoom=_.zoom,this._trackingEllipsoid.setup(_._camera.position,this._dragOrigin)),_.cameraElevationReference="sea",p._stop(!0),L=L||p.transform.centerPoint,I&&(_.bearing+=I),C&&(_.pitch+=C),_._updateCameraState();const j=[0,0,0];if(T)if(_.projection.name==="mercator"){const H=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(L).dir),ee=this._trackingEllipsoid.projectRay(_.screenPointToMercatorRay(L.sub(T)).dir);j[0]=ee[0]-H[0],j[1]=ee[1]-H[1]}else{const H=_.pointCoordinate(L);if(_.projection.name==="globe"){T=T.rotate(-_.angle);const ee=_._pixelsPerMercatorPixel/_.worldSize;j[0]=-T.x*o.d1(o.au(H.y))*ee,j[1]=-T.y*o.d1(_.center.lat)*ee}else{const ee=_.pointCoordinate(L.sub(T));H&&ee&&(j[0]=ee.x-H.x,j[1]=ee.y-H.y)}}const U=_.zoom,$=[0,0,0];if(S){const H=x(k||_.pointCoordinate3D(L)),ee={dir:o.N.normalize([],o.N.sub([],H,_._camera.position))};if(ee.dir[2]<0){const X=_.zoomDeltaToMovement(H,S);o.N.scale($,ee.dir,X)}}const N=o.N.add(j,j,$);_._translateCameraConstrained(N),S&&Math.abs(_.zoom-U)>1e-4&&_.recenterOnTerrain(),_.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(s,h,!0)}_fireEvents(r,s,h){const p=_c(this._eventsInProgress),_=_c(r),x={};for(const C in r){const{originalEvent:L}=r[C];this._eventsInProgress[C]||(x[`${C}start`]=L),this._eventsInProgress[C]=r[C]}!p&&_&&this._fireEvent("movestart",_.originalEvent);for(const C in x)this._fireEvent(C,x[C]);_&&this._fireEvent("move",_.originalEvent);for(const C in r){const{originalEvent:L}=r[C];this._fireEvent(C,L)}const T={};let S;for(const C in this._eventsInProgress){const{handlerName:L,originalEvent:k}=this._eventsInProgress[C];this._handlersById[L].isActive()||(delete this._eventsInProgress[C],S=s[L]||k,T[`${C}end`]=S)}for(const C in T)this._fireEvent(C,T[C]);const I=_c(this._eventsInProgress);if(h&&(p||_)&&!I){this._updatingCamera=!0;const C=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=k=>k!==0&&-this._bearingSnap<k&&k<this._bearingSnap;C?(L(C.bearing||this._map.getBearing())&&(C.bearing=0),this._map.easeTo(C,{originalEvent:S})):(this._map.fire(new o.b("moveend",{originalEvent:S})),L(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,s){this._map.fire(new o.b(r,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new zp("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Bp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class $r extends o.E{constructor(r,s){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=s.bearingSnap,this._respectPrefersReducedMotion=s.respectPrefersReducedMotion!==!1,o.aY(["_renderFrameCallback"],this)}getCenter(){return new o.bn(this.transform.center.lng,this.transform.center.lat)}setCenter(r,s){return this.jumpTo({center:r},s)}panBy(r,s,h){return r=o.P.convert(r).mult(-1),this.panTo(this.transform.center,o.e({offset:r},s),h)}panTo(r,s,h){return this.easeTo(o.e({center:r},s),h)}getZoom(){return this.transform.zoom}setZoom(r,s){return this.jumpTo({zoom:r},s),this}zoomTo(r,s,h){return this.easeTo(o.e({zoom:r},s),h)}zoomIn(r,s){return this.zoomTo(this.getZoom()+1,r,s),this}zoomOut(r,s){return this.zoomTo(this.getZoom()-1,r,s),this}getBearing(){return this.transform.bearing}setBearing(r,s){return this.jumpTo({bearing:r},s),this}getPadding(){return this.transform.padding}setPadding(r,s){return this.jumpTo({padding:r},s),this}rotateTo(r,s,h){return this.easeTo(o.e({bearing:r},s),h)}resetNorth(r,s){return this.rotateTo(0,o.e({duration:1e3},r),s),this}resetNorthPitch(r,s){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},r),s),this}snapToNorth(r,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,s):this}getPitch(){return this.transform.pitch}setPitch(r,s){return this.jumpTo({pitch:r},s),this}cameraForBounds(r,s){r=o.ad.convert(r);const h=s&&s.bearing||0,p=s&&s.pitch||0,_=r.getNorthWest(),x=r.getSouthEast();return this._cameraForBounds(this.transform,_,x,h,p,s)}_extendCameraOptions(r){const s={top:0,bottom:0,right:0,left:0};if(typeof(r=o.e({padding:s,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=="number"){const h=r.padding;r.padding={top:h,bottom:h,right:h,left:h}}return r.padding=o.e(s,r.padding),r}_minimumAABBFrustumDistance(r,s){const h=s.max[0]-s.min[0],p=s.max[1]-s.min[1];return h/p>r.aspect?h/(2*Math.tan(.5*r.fovX)*r.aspect):p/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,s,h,p,_,x){const T=r.clone(),S=this._extendCameraOptions(x);T.bearing=p,T.pitch=_;const I=o.bn.convert(s),C=o.bn.convert(h),L=.5*(I.lat+C.lat),k=.5*(I.lng+C.lng),B=o.d2(L,k),j=o.N.normalize([],B),U=o.N.normalize([],o.N.cross([],j,[0,1,0])),$=o.N.cross([],U,j),N=[U[0],U[1],U[2],0,$[0],$[1],$[2],0,j[0],j[1],j[2],0,0,0,0,1],H=[B,o.d2(I.lat,I.lng),o.d2(C.lat,I.lng),o.d2(C.lat,C.lng),o.d2(I.lat,C.lng),o.d2(L,I.lng),o.d2(L,C.lng),o.d2(I.lat,k),o.d2(C.lat,k)];let ee=o.bS.fromPoints(H.map(we=>[o.N.dot(U,we),o.N.dot($,we),o.N.dot(j,we)]));const X=o.N.transformMat4([],ee.center,N);o.N.squaredLength(X)===0&&o.N.set(X,0,0,1),o.N.normalize(X,X),o.N.scale(X,X,o.ab),T.center=o.d3(X);const te=T.getWorldToCameraMatrix(),q=o.a6.invert(new Float64Array(16),te);ee=o.bS.applyTransform(ee,o.a6.multiply([],te,N)),o.N.transformMat4(X,X,te);const re=.5*(ee.max[2]-ee.min[2]),ae=this._minimumAABBFrustumDistance(T,ee),ue=o.N.scale([],[0,0,1],re),me=o.N.add(ue,X,ue),Me=ae+(T.pitch===0?0:o.N.distance(X,me)),ye=T.globeCenterInViewSpace,Oe=o.N.sub([],X,[ye[0],ye[1],ye[2]]);o.N.normalize(Oe,Oe),o.N.scale(Oe,Oe,Me);const Le=o.N.add([],X,Oe);o.N.transformMat4(Le,Le,q);const We=o.d4/o.ab,ve=o.N.length(Le),Ce=o.bl(Math.max(ve*We-o.d4,Number.EPSILON),0),fe=Math.min(T.zoomFromMercatorZAdjusted(Ce),S.maxZoom);return fe>.5*(o.bG+o.bx)?(T.setProjection({name:"mercator"}),T.zoom=fe,this._cameraForBounds(T,s,h,p,_,x)):{center:T.center,zoom:fe,bearing:p,pitch:_}}queryTerrainElevation(r,s){const h=this.transform.elevation;return h?(s=o.e({},{exaggerated:!0},s),h.getAtPoint(o.L.fromLngLat(r),null,s.exaggerated)):null}_cameraForBounds(r,s,h,p,_,x){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,s,h,p,_,x);const T=r.clone(),S=this._extendCameraOptions(x),I=T.padding;T.bearing=p,T.pitch=_;const C=o.bn.convert(s),L=o.bn.convert(h),k=new o.bn(C.lng,L.lat),B=new o.bn(L.lng,C.lat),j=T.project(C),U=T.project(L),$=this.queryTerrainElevation(C),N=this.queryTerrainElevation(L),H=this.queryTerrainElevation(k),ee=this.queryTerrainElevation(B),X=[[j.x,j.y,Math.min($||0,N||0,H||0,ee||0)],[U.x,U.y,Math.max($||0,N||0,H||0,ee||0)]];let te=o.bS.fromPoints(X);const q=T.getWorldToCameraMatrix(),re=o.a6.invert(new Float64Array(16),q);te=o.bS.applyTransform(te,q);const ae=o.N.sub([],te.max,te.min),ue=I.left||0,me=I.right||0,Me=I.bottom||0,ye=I.top||0,{left:Oe,right:Le,top:We,bottom:ve}=S.padding,Ce=.5*(ue+me),fe=.5*(ye+Me),we=Math.min(T.scaleZoom(T.scale*Math.min((T.width-(ue+me+Oe+Le))/ae[0],(T.height-(Me+ye+ve+We))/ae[1])),S.maxZoom),Ke=T.scale/T.zoomScale(we);te=new o.bS([te.min[0]-(Oe+Ce)*Ke,te.min[1]-(ve+fe)*Ke,te.min[2]],[te.max[0]+(Le+Ce)*Ke,te.max[1]+(We+fe)*Ke,te.max[2]]);const st=.5*ae[2],nt=this._minimumAABBFrustumDistance(T,te),_t=[0,0,1,0];o.a7.transformMat4(_t,_t,q),o.a7.normalize(_t,_t);const Ot=o.N.scale([],_t,nt+st),Zt=o.N.add([],te.center,Ot),Bt=(typeof S.offset.x=="number"&&typeof S.offset.y=="number"?new o.P(S.offset.x,S.offset.y):o.P.convert(S.offset)).rotate(-o.bj(p));te.center[0]-=Bt.x*Ke,te.center[1]+=Bt.y*Ke,o.N.transformMat4(te.center,te.center,re),o.N.transformMat4(Zt,Zt,re);const Ut=[te.center[0],te.center[1],Zt[2]*T.pixelsPerMeter];o.N.scale(Ut,Ut,1/T.worldSize);const gi=o.at(Ut[0]),si=o.au(Ut[1]),di=Math.min(T._zoomFromMercatorZ(Ut[2]),S.maxZoom),ui=new o.bn(gi,si);return T.mercatorFromTransition&&di<.5*(o.bG+o.bx)?(T.setProjection({name:"globe"}),T.zoom=di,this._cameraForBounds(T,s,h,p,_,x)):{center:ui,zoom:di,bearing:p,pitch:_}}fitBounds(r,s,h){const p=this.cameraForBounds(r,s);return this._fitInternal(p,s,h)}fitScreenCoordinates(r,s,h,p,_){const x=o.P.convert(r),T=o.P.convert(s),S=new o.P(Math.min(x.x,T.x),Math.min(x.y,T.y)),I=new o.P(Math.max(x.x,T.x),Math.max(x.y,T.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,T))return this;const C=this.transform.pointLocation3D(S),L=this.transform.pointLocation3D(I),k=this.transform.pointLocation3D(new o.P(S.x,I.y)),B=this.transform.pointLocation3D(new o.P(I.x,S.y)),j=[Math.min(C.lng,L.lng,k.lng,B.lng),Math.min(C.lat,L.lat,k.lat,B.lat)],U=[Math.max(C.lng,L.lng,k.lng,B.lng),Math.max(C.lat,L.lat,k.lat,B.lat)],$=p&&p.pitch?p.pitch:this.getPitch(),N=this._cameraForBounds(this.transform,j,U,h,$,p);return this._fitInternal(N,p,_)}_fitInternal(r,s,h){return r?(delete(s=o.e(r,s)).padding,s.linear?this.easeTo(s,h):this.flyTo(s,h)):this}jumpTo(r,s){this.stop();const h=r.preloadOnly?this.transform.clone():this.transform;let p=!1,_=!1,x=!1;return"zoom"in r&&h.zoom!==+r.zoom&&(p=!0,h.zoom=+r.zoom),r.center!==void 0&&(h.center=o.bn.convert(r.center)),"bearing"in r&&h.bearing!==+r.bearing&&(_=!0,h.bearing=+r.bearing),"pitch"in r&&h.pitch!==+r.pitch&&(x=!0,h.pitch=+r.pitch),r.padding==null||h.isPaddingEqual(r.padding)||(h.padding=r.padding),r.preloadOnly?(this._preloadTiles(h),this):(this.fire(new o.b("movestart",s)).fire(new o.b("move",s)),p&&this.fire(new o.b("zoomstart",s)).fire(new o.b("zoom",s)).fire(new o.b("zoomend",s)),_&&this.fire(new o.b("rotatestart",s)).fire(new o.b("rotate",s)).fire(new o.b("rotateend",s)),x&&this.fire(new o.b("pitchstart",s)).fire(new o.b("pitch",s)).fire(new o.b("pitchend",s)),this.fire(new o.b("moveend",s)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Bp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,s){const h=this.transform;if(!h.projection.supportsFreeCamera)return o.w(Bp),this;this.stop();const p=h.zoom,_=h.pitch,x=h.bearing;h.setFreeCameraOptions(r);const T=p!==h.zoom,S=_!==h.pitch,I=x!==h.bearing;return this.fire(new o.b("movestart",s)).fire(new o.b("move",s)),T&&this.fire(new o.b("zoomstart",s)).fire(new o.b("zoom",s)).fire(new o.b("zoomend",s)),I&&this.fire(new o.b("rotatestart",s)).fire(new o.b("rotate",s)).fire(new o.b("rotateend",s)),S&&this.fire(new o.b("pitchstart",s)).fire(new o.b("pitch",s)).fire(new o.b("pitchend",s)),this.fire(new o.b("moveend",s)),this}easeTo(r,s){this._stop(!1,r.easeId),((r=o.e({offset:[0,0],duration:500,easing:o.d0},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const h=this.transform,p=this.getZoom(),_=this.getBearing(),x=this.getPitch(),T=this.getPadding(),S="zoom"in r?+r.zoom:p,I="bearing"in r?this._normalizeBearing(r.bearing,_):_,C="pitch"in r?+r.pitch:x,L="padding"in r?r.padding:h.padding,k=o.P.convert(r.offset);let B,j,U;if(h.projection.name==="globe"){const ue=o.L.fromLngLat(h.center),me=k.rotate(-h.angle);ue.x+=me.x/h.worldSize,ue.y+=me.y/h.worldSize;const Me=ue.toLngLat(),ye=o.bn.convert(r.center||Me);this._normalizeCenter(ye),B=h.centerPoint.add(me),j=new o.P(ue.x,ue.y).mult(h.worldSize),U=new o.P(o.a5(ye.lng),o.ae(ye.lat)).mult(h.worldSize).sub(j)}else{B=h.centerPoint.add(k);const ue=h.pointLocation(B),me=o.bn.convert(r.center||ue);this._normalizeCenter(me),j=h.project(ue),U=h.project(me).sub(j)}const $=h.zoomScale(S-p);let N,H;r.around&&(N=o.bn.convert(r.around),H=h.locationPoint(N));const ee=this._zooming||S!==p,X=this._rotating||_!==I,te=this._pitching||C!==x,q=!h.isPaddingEqual(L),re=ue=>me=>{if(ee&&(ue.zoom=o.U(p,S,me)),X&&(ue.bearing=o.U(_,I,me)),te&&(ue.pitch=o.U(x,C,me)),q&&(ue.interpolatePadding(T,L,me),B=ue.centerPoint.add(k)),N)ue.setLocationAtPoint(N,H);else{const Me=ue.zoomScale(ue.zoom-p),ye=S>p?Math.min(2,$):Math.max(.5,$),Oe=Math.pow(ye,1-me),Le=ue.unproject(j.add(U.mult(me*Oe)).mult(Me));ue.setLocationAtPoint(ue.renderWorldCopies?Le.wrap():Le,B)}return r.preloadOnly||this._fireMoveEvents(s),ue};if(r.preloadOnly){const ue=this._emulate(re,r.duration,h);return this._preloadTiles(ue),this}const ae={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ee,this._rotating=X,this._pitching=te,this._easeId=r.easeId,this._prepareEase(s,r.noMoveStart,ae),this._ease(re(h),ue=>{h.cameraElevationReference==="sea"&&h.recenterOnTerrain(),this._afterEase(s,ue)},r),this}_prepareEase(r,s,h={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),s||h.moving||this.fire(new o.b("movestart",r)),this._zooming&&!h.zooming&&this.fire(new o.b("zoomstart",r)),this._rotating&&!h.rotating&&this.fire(new o.b("rotatestart",r)),this._pitching&&!h.pitching&&this.fire(new o.b("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.b("move",r)),this._zooming&&this.fire(new o.b("zoom",r)),this._rotating&&this.fire(new o.b("rotate",r)),this._pitching&&this.fire(new o.b("pitch",r))}_afterEase(r,s){if(this._easeId&&s&&this._easeId===s)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const h=this._zooming,p=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,h&&this.fire(new o.b("zoomend",r)),p&&this.fire(new o.b("rotateend",r)),_&&this.fire(new o.b("pitchend",r)),this.fire(new o.b("moveend",r))}flyTo(r,s){if(this._prefersReducedMotion(r)){const ve=o.ac(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ve,s)}this.stop(),r=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.d0},r);const h=this.transform,p=this.getZoom(),_=this.getBearing(),x=this.getPitch(),T="zoom"in r?o.aa(+r.zoom,h.minZoom,h.maxZoom):p,S="bearing"in r?this._normalizeBearing(r.bearing,_):_,I="pitch"in r?+r.pitch:x,C=h.zoomScale(T-p),L=o.P.convert(r.offset),k=h.centerPoint.add(L),B=h.pointLocation(k);let j=r.center;if(j&&r.padding){const ve=this._cameraForBounds(this.transform,j,j,S,I,r);ve&&(j=ve.center)}j=o.bn.convert(j||B),this._normalizeCenter(j);const U=h.project(B),$=h.project(j).sub(U);let N=r.curve;const H=Math.max(h.width,h.height),ee=H/C,X=$.mag();if("minZoom"in r){const ve=o.aa(Math.min(r.minZoom,p,T),h.minZoom,h.maxZoom),Ce=H/h.zoomScale(ve-p);N=Math.sqrt(Ce/X*2)}const te=N*N;function q(ve){const Ce=(ee*ee-H*H+(ve?-1:1)*te*te*X*X)/(2*(ve?ee:H)*te*X);return Math.log(Math.sqrt(Ce*Ce+1)-Ce)}function re(ve){return(Math.exp(ve)-Math.exp(-ve))/2}function ae(ve){return(Math.exp(ve)+Math.exp(-ve))/2}const ue=q(0);let me=function(ve){return ae(ue)/ae(ue+N*ve)},Me=function(ve){return H*((ae(ue)*(re(Ce=ue+N*ve)/ae(Ce))-re(ue))/te)/X;var Ce},ye=(q(1)-ue)/N;if(Math.abs(X)<1e-6||!isFinite(ye)){if(Math.abs(H-ee)<1e-6)return this.easeTo(r,s);const ve=ee<H?-1:1;ye=Math.abs(Math.log(ee/H))/N,Me=function(){return 0},me=function(Ce){return Math.exp(ve*N*Ce)}}r.duration="duration"in r?+r.duration:1e3*ye/("screenSpeed"in r?+r.screenSpeed/N:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Oe=_!==S,Le=I!==x,We=ve=>Ce=>{const fe=Ce*ye,we=1/me(fe);ve.zoom=Ce===1?T:p+ve.scaleZoom(we),Oe&&(ve.bearing=o.U(_,S,Ce)),Le&&(ve.pitch=o.U(x,I,Ce));const Ke=Ce===1?j:ve.unproject(U.add($.mult(Me(fe))).mult(we));return ve.setLocationAtPoint(ve.renderWorldCopies?Ke.wrap():Ke,k),ve._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(s),ve};if(r.preloadOnly){const ve=this._emulate(We,r.duration,h);return this._preloadTiles(ve),this}return this._zooming=!0,this._rotating=Oe,this._pitching=Le,this._prepareEase(s,!1),this._ease(We(h),()=>this._afterEase(s),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const h=this._onEaseEnd;this._onEaseEnd=void 0,h.call(this,s)}if(!r){const h=this.handlers;h&&h.stop(!1)}return this}_ease(r,s,h){h.animate===!1||h.duration===0?(r(1),s()):(this._easeStart=o.f.now(),this._easeOptions=h,this._onEaseFrame=r,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.f.now()-this._easeStart)/this._easeOptions.duration,1),s=this._onEaseFrame;s&&s(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,s){r=o.bh(r,-180,180);const h=Math.abs(r-s);return Math.abs(r-360-s)<h&&(r-=360),Math.abs(r+360-s)<h&&(r+=360),r}_normalizeCenter(r){const s=this.transform;if(s.maxBounds||s.projection.name!=="globe"&&!s.renderWorldCopies)return;const h=r.lng-s.center.lng;r.lng+=h>180?-360:h<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&o.f.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,s,h){const p=Math.ceil(15*s/1e3),_=[],x=r(h.clone());for(let T=0;T<=p;T++){const S=x(T/p);_.push(S.clone())}return _}}class Ud{constructor(r={}){this.options=r,o.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const s=this.options&&this.options.compact;return this._map=r,this._container=ce("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ce("button","mapboxgl-ctrl-attrib-button",this._container),ce("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ce("div","mapboxgl-ctrl-attrib-inner",this._container),s&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),s===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,s){const h=this._map._getUIString(`AttributionControl.${s}`);r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",h)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const s=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.d5.ACCESS_TOKEN}];if(r){const h=s.reduce((p,_,x)=>(_.value&&(p+=`${_.key}=${_.value}${x<s.length-1?"&":""}`),p),"?");r.href=`${o.d5.FEEDBACK_URL}/${h}#${Pd(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const s=this._map.style._mergedSourceCaches;for(const p in s){const _=s[p];if(_.used){const x=_.getSource();x.attribution&&r.indexOf(x.attribution)<0&&r.push(x.attribution)}}r.sort((p,_)=>p.length-_.length),r=r.filter((p,_)=>{for(let x=_+1;x<r.length;x++)if(r[x].indexOf(p)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const h=r.join(" | ");h!==this._attribHTML&&(this._attribHTML=h,r.length?(this._innerContainer.innerHTML=h,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Fp{constructor(){o.aY(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=ce("div","mapboxgl-ctrl");const s=ce("a","mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://www.mapbox.com/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const s in r){const h=r[s].getSource();if(h.hasOwnProperty("mapbox_logo")&&!h.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const s=r[0];this._map.getCanvasContainer().offsetWidth<250?s.classList.add("mapboxgl-compact"):s.classList.remove("mapboxgl-compact")}}}class Np{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const s=++this._id;return this._queue.push({callback:r,id:s,cancelled:!1}),s}remove(r){const s=this._currentlyRunning,h=s?this._queue.concat(s):this._queue;for(const p of h)if(p.id===r)return void(p.cancelled=!0)}run(r=0){const s=this._currentlyRunning=this._queue;this._queue=[];for(const h of s)if(!h.cancelled&&(h.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function yc(u,r,s){if(u=new o.bn(u.lng,u.lat),r){const h=new o.bn(u.lng-360,u.lat),p=new o.bn(u.lng+360,u.lat),_=360*Math.ceil(Math.abs(u.lng-s.center.lng)/360),x=s.locationPoint(u).distSqr(r),T=r.x<0||r.y<0||r.x>s.width||r.y>s.height;s.locationPoint(h).distSqr(r)<x&&(T||Math.abs(h.lng-s.center.lng)<_)?u=h:s.locationPoint(p).distSqr(r)<x&&(T||Math.abs(p.lng-s.center.lng)<_)&&(u=p)}for(;Math.abs(u.lng-s.center.lng)>180;){const h=s.locationPoint(u);if(h.x>=0&&h.y>=0&&h.x<=s.width&&h.y<=s.height)break;u.lng>s.center.lng?u.lng-=360:u.lng+=360}return u}const Iu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class jd extends o.E{constructor(r,s){if(super(),(r instanceof HTMLElement||s)&&(r=o.e({element:r},s)),o.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=o.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=ce("div");const _=41,x=27,T=Ee("svg",{display:"block",height:_*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${_}`},this._element),S=Ee("radialGradient",{id:"shadowGradient"},Ee("defs",{},T));Ee("stop",{offset:"10%","stop-opacity":.4},S),Ee("stop",{offset:"100%","stop-opacity":.05},S),Ee("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),Ee("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),Ee("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),Ee("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=o.P.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const h=this._element.classList;for(const _ in Iu)h.remove(`mapboxgl-marker-anchor-${_}`);h.add(`mapboxgl-marker-anchor-${this._anchor}`);const p=r&&r.className?r.className.trim().split(/\s+/):[];h.add(...p),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.bn.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const s=r.code,h=r.charCode||r.keyCode;s!=="Space"&&s!=="Enter"&&h!==32&&h!==13||this.togglePopup()}_onMapClick(r){const s=r.originalEvent.target,h=this._element;this._popup&&(s===h||h.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,s=this._pos;if(!r||!s)return!1;const h=r.unproject(s),p=r.getFreeCameraOptions();if(!p.position)return!1;const _=p.position.toLngLat();return _.distanceTo(h)<.9*_.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const s=this._pos;if(!s||s.x<0||s.x>r.transform.width||s.y<0||s.y>r.transform.height)return void this._clearFadeTimer();const h=r.unproject(s);let p;r._showingGlobe()&&o.d6(r.transform,this._lngLat)?p=0:(p=1-r._queryFogOpacity(h),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(p*=this._occludedOpacity)),this._element.style.opacity=`${p}`,this._element.style.pointerEvents=p>0?"auto":"none",this._popup&&this._popup._setOpacity(p),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const s=this._offset.mult(this._scale);this._element.style.transform=`
-            translate(${r.x}px,${r.y}px)
-            ${Iu[this._anchor]}
-            ${this._calculateXYTransform()} ${this._calculateZTransform()}
-            translate(${s.x}px,${s.y}px)
-        `}_calculateXYTransform(){const r=this._pos,s=this._map,h=this.getPitchAlignment();if(!s||!r||h!=="map")return"";if(!s._showingGlobe()){const S=s.getPitch();return S?`rotateX(${S}deg)`:""}const p=o.bF(o.d7(s.transform,this._lngLat)),_=r.sub(o.d8(s.transform)),x=Math.abs(_.x)+Math.abs(_.y);if(x===0)return"";const T=p/x;return`rotateX(${-_.y*T}deg) rotateY(${_.x*T}deg)`}_calculateZTransform(){const r=this._pos,s=this._map;if(!s||!r)return"";let h=0;const p=this.getRotationAlignment();if(p==="map")if(s._showingGlobe()){const _=s.project(new o.bn(this._lngLat.lng,this._lngLat.lat+.001)),x=s.project(new o.bn(this._lngLat.lng,this._lngLat.lat-.001)).sub(_);h=o.bF(Math.atan2(x.y,x.x))-90}else h=-s.getBearing();else if(p==="horizon"){const _=o.O(4,6,s.getZoom()),x=o.d8(s.transform);x.y+=_*s.transform.height;const T=r.sub(x),S=o.bF(Math.atan2(T.y,T.x));h=(S>90?S-270:S+90)*(1-_)}return h+=this._rotation,h?`rotateZ(${h}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const s=this._map;s&&(s.transform.renderWorldCopies&&(this._lngLat=yc(this._lngLat,this._pos,s.transform)),this._pos=s.project(this._lngLat),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),s._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(s._showingGlobe()||s.getTerrain()||s.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const s=this._map;if(!s)return;const h=this._pointerdownPos,p=this._positionDelta;if(h&&p){if(!this._isDragging){const _=this._clickTolerance||s._clickTolerance;if(r.point.dist(h)<_)return;this._isDragging=!0}this._pos=r.point.sub(p),this._lngLat=s.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.b("dragstart"))),this.fire(new o.b("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.b("dragend")),this._state="inactive"}_addDragHandler(r){const s=this._map,h=this._pos;s&&h&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(h),this._pointerdownPos=r.point,this._state="pending",s.on("mousemove",this._onMove),s.on("touchmove",this._onMove),s.once("mouseup",this._onUp),s.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const s=this._map;return s&&(r?(s.on("mousedown",this._addDragHandler),s.on("touchstart",this._addDragHandler)):(s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Vp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Up=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function jp(u=new o.P(0,0),r="bottom"){if(typeof u=="number"){const s=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(r){case"top":return new o.P(0,u);case"top-left":return new o.P(s,s);case"top-right":return new o.P(-s,s);case"bottom":return new o.P(0,-u);case"bottom-left":return new o.P(s,-s);case"bottom-right":return new o.P(-s,-s);case"left":return new o.P(u,0);case"right":return new o.P(-u,0)}return new o.P(0,0)}return u instanceof o.P||Array.isArray(u)?o.P.convert(u):o.P.convert(u[r]||[0,0])}class Gd{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const s=o.cc((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-s)+this._end*s}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,s,h){this._start=this.getValue(s),this._end=r,this._startTime=s,this._endTime=s+h}}const vc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Gp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class $d{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.showParseStatus=!1,this.continuousRedraw=!1,this.showTileAABBs=!1,this.showPadding=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const Cu={showCompass:!0,showZoom:!0,visualizePitch:!1};class no{constructor(r,s,h=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new hc({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,h&&(this.mousePitch=new Mu({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),s.addEventListener("mousedown",this.mousedown),s.addEventListener("touchstart",this.touchstart,{passive:!1}),s.addEventListener("touchmove",this.touchmove),s.addEventListener("touchend",this.touchend),s.addEventListener("touchcancel",this.reset)}down(r,s){this.mouseRotate.mousedown(r,s),this.mousePitch&&this.mousePitch.mousedown(r,s),ht()}move(r,s){const h=this.map,p=this.mouseRotate.mousemoveWindow(r,s),_=p&&p.bearingDelta;if(_&&h.setBearing(h.getBearing()+_),this.mousePitch){const x=this.mousePitch.mousemoveWindow(r,s),T=x&&x.pitchDelta;T&&h.setPitch(h.getPitch()+T)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Xe(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(o.e({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),At(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,At(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=_i(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=_i(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Pu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},zn={maxWidth:100,unit:"metric"},Vo={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:o.dk,supported:ie,setRTLTextPlugin:o.dm,getRTLTextPluginStatus:o.dn,Map:class extends $r{constructor(u){const r=u;if((u=o.e({},Gp,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&o.d9(window)&&(u.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Zl(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies),u),this._repaint=!1,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new Np,this._domRenderTaskQueue=new Np,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.aC(),this._locale=o.e({},vc,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Gd(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new o.da(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?{...u.contextCreateOptions}:{},typeof u.container=="string"){const s=document.getElementById(u.container);if(!s)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=s}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),o.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new $d,this._tp=u.devtools?new sc(this):new sc,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showParseStatus",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,s=>{this.repaint=s}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileAABBs",void 0,s=>{this.showTileAABBs=s}),this._tp.registerParameter(this._debugParams,["Debug"],"showPadding",void 0,s=>{this.showPadding=s}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new ag(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||o.d5.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),u.hash&&(this._hash=new Tu(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});const s=u.bounds;s&&(this.resize(),this.fitBounds(s,o.e({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new Ud({customAttribution:u.customAttribution})),this._logoControl=new Fp,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new o.b(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new o.b(`${s.dataType}dataloading`,s))})}_getMapId(){return this._mapId}addControl(u,r){if(r===void 0&&(r=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new o.a(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=u.onAdd(this);this._controls.push(u);const h=this._controlPositions[r];return r.indexOf("bottom")!==-1?h.insertBefore(s,h.firstChild):h.appendChild(s),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new o.a(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(u);return r>-1&&this._controls.splice(r,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.b("movestart",u)).fire(new o.b("move",u)),this.fire(new o.b("resize",u)),r&&this.fire(new o.b("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(o.ad.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new o.b("zoomstart")).fire(new o.b("zoom")).fire(new o.b("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new o.b("zoomstart")).fire(new o.b("zoom")).fire(new o.b("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new o.b("pitchstart")).fire(new o.b("pitch")).fire(new o.b("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new o.b("pitchstart")).fire(new o.b("pitch")).fire(new o.b("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(r=>r==="auto"?navigator.language:r):u}setLanguage(u){const r=this._parseLanguage(u);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const s of this._controls)s._setLanguage&&s._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,r=u.projection.name;let s;r==="globe"&&u.zoom>=o.bx?(u.setMercatorFromTransition(),s=!0):r==="mercator"&&u.zoom<o.bx&&(u.setProjection({name:"globe"}),s=!0),s&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(u,r){return this._updateProjection(u||r||{name:"mercator"})}_updateProjection(u){let r;return r=u.name==="globe"&&this.transform.zoom>=o.bx?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u){return this.transform.locationPoint3D(o.bn.convert(u))}unproject(u){return this.transform.pointLocation3D(o.P.convert(u))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,r,s){if(u==="mouseenter"||u==="mouseover"){let h=!1;const p=x=>{const T=r.filter(I=>this.getLayer(I)),S=T.length?this.queryRenderedFeatures(x.point,{layers:T}):[];S.length?h||(h=!0,s.call(this,new jn(u,this,x.originalEvent,{features:S}))):h=!1},_=()=>{h=!1};return{layers:new Set(r),listener:s,delegates:{mousemove:p,mouseout:_}}}if(u==="mouseleave"||u==="mouseout"){let h=!1;const p=x=>{const T=r.filter(S=>this.getLayer(S));(T.length?this.queryRenderedFeatures(x.point,{layers:T}):[]).length?h=!0:h&&(h=!1,s.call(this,new jn(u,this,x.originalEvent)))},_=x=>{h&&(h=!1,s.call(this,new jn(u,this,x.originalEvent)))};return{layers:new Set(r),listener:s,delegates:{mousemove:p,mouseout:_}}}{const h=p=>{const _=r.filter(T=>this.getLayer(T)),x=_.length?this.queryRenderedFeatures(p.point,{layers:_}):[];x.length&&(p.features=x,s.call(this,p),delete p.features)};return{layers:new Set(r),listener:s,delegates:{[u]:h}}}}on(u,r,s){if(s===void 0)return super.on(u,r);if(Array.isArray(r)||(r=[r]),r){for(const p of r)if(!this._isValidId(p))return this}const h=this._createDelegatedListener(u,r,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(h);for(const p in h.delegates)this.on(p,h.delegates[p]);return this}once(u,r,s){if(s===void 0)return super.once(u,r);if(Array.isArray(r)||(r=[r]),r){for(const p of r)if(!this._isValidId(p))return this}const h=this._createDelegatedListener(u,r,s);for(const p in h.delegates)this.once(p,h.delegates[p]);return this}off(u,r,s){if(s===void 0)return super.off(u,r);r=new Set(Array.isArray(r)?r:[r]);for(const _ of r)if(!this._isValidId(_))return this;const h=(_,x)=>{if(_.size!==x.size)return!1;for(const T of _)if(!x.has(T))return!1;return!0},p=this._delegatedListeners?this._delegatedListeners[u]:void 0;return p&&(_=>{for(let x=0;x<_.length;x++){const T=_[x];if(T.listener===s&&h(T.layers,r)){for(const S in T.delegates)this.off(S,T.delegates[S]);return _.splice(x,1),this}}})(p),this}queryRenderedFeatures(u,r){if(!this.style)return[];if(r!==void 0||u===void 0||u instanceof o.P||Array.isArray(u)||(r=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],(r=r||{}).layers&&Array.isArray(r.layers)){for(const s of r.layers)if(!this._isValidId(s))return[]}return this.style.queryRenderedFeatures(u,r,this.transform)}querySourceFeatures(u,r){return this._isValidId(u)?this.style.querySourceFeatures(u,r):[]}isPointOnSurface(u){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&o.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(u))}setStyle(u,r){return(r=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&u?(this._diffStyle(u,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(u,r))}_getUIString(u){const r=this._locale[u];if(r==null)throw new Error(`Missing UI string '${u}'`);return r}_updateStyle(u,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u&&(this.style=new As(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof u=="string"?this.style.loadURL(u):this.style.loadJSON(u)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new As(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(u,r){if(typeof u=="string"){const s=this._requestManager.normalizeStyleURL(u),h=this._requestManager.transformRequest(s,o.R.Style);o.g(h,(p,_)=>{p?this.fire(new o.a(p)):_&&this._updateDiff(_,r)})}else typeof u=="object"&&this._updateDiff(u,r)}_updateDiff(u,r){try{this.style.setState(u)&&this._update(!0)}catch(s){o.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(u,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new o.a(new Error("IDs can't be empty."))),!1):!o.c4(u)||(this.fire(new o.a(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}addSource(u,r){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,r),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,r,s){this._lazyInitEmptyStyle(),this.style.addSourceType(u,r,s)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,r,{pixelRatio:s=1,sdf:h=!1,stretchX:p,stretchY:_,content:x}={}){if(this._lazyInitEmptyStyle(),r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:T,height:S,data:I}=o.f.getImageData(r);this.style.addImage(u,{data:new o.h({width:T,height:S},I),pixelRatio:s,stretchX:p,stretchY:_,content:x,sdf:h,version:0})}else if(r.width===void 0||r.height===void 0)this.fire(new o.a(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:T,height:S}=r,I=r;this.style.addImage(u,{data:new o.h({width:T,height:S},new Uint8Array(I.data)),pixelRatio:s,stretchX:p,stretchY:_,content:x,sdf:h,version:0,userImage:I}),I.onAdd&&I.onAdd(this,u)}}updateImage(u,r){this._lazyInitEmptyStyle();const s=this.style.getImage(u);if(!s)return void this.fire(new o.a(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const h=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?o.f.getImageData(r):r,{width:p,height:_}=h,x=h.data;if(p===void 0||_===void 0)return void this.fire(new o.a(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==s.data.width||_!==s.data.height)return void this.fire(new o.a(new Error(`The width and height of the updated image (${p}, ${_})
-                must be that same as the previous version of the image
-                (${s.data.width}, ${s.data.height})`)));const T=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);s.data.replace(x,T),this.style.updateImage(u,s)}hasImage(u){return u?!!this.style&&!!this.style.getImage(u):(this.fire(new o.a(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(u)}loadImage(u,r){o.d(this._requestManager.transformRequest(u,o.R.Image),(s,h)=>{r(s,h instanceof HTMLImageElement?o.f.getImageData(h):h)})}listImages(){return this.style.listImages()}addModel(u,r){this._lazyInitEmptyStyle(),this.style.addModel(u,r)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new o.a(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,r){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,r),this._update(!0)):this}getSlot(u){const r=this.getLayer(u);return r&&r.slot||null}setSlot(u,r){return this.style.setSlot(u,r),this.style.mergeLayers(),this._update(!0)}addImport(u,r){return this.style.addImport(u,r),this}updateImport(u,r){return typeof r!="string"&&r.id!==u?(this.removeImport(u),this.addImport(r)):(this.style.updateImport(u,r),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,r){return this.style.moveImport(u,r),this._update(!0)}moveLayer(u,r){return this._isValidId(u)?(this.style.moveLayer(u,r),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){return this._isValidId(u)?this.style.getOwnLayer(u):null}setLayerZoomRange(u,r,s){return this._isValidId(u)?(this.style.setLayerZoomRange(u,r,s),this._update(!0)):this}setFilter(u,r,s={}){return this._isValidId(u)?(this.style.setFilter(u,r,s),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,r,s,h={}){return this._isValidId(u)?(this.style.setPaintProperty(u,r,s,h),this._update(!0)):this}getPaintProperty(u,r){return this._isValidId(u)?this.style.getPaintProperty(u,r):null}setLayoutProperty(u,r,s,h={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,r,s,h),this._update(!0)):this}getLayoutProperty(u,r){return this._isValidId(u)?this.style.getLayoutProperty(u,r):null}getConfigProperty(u,r){return this.style.getConfigProperty(u,r)}setConfigProperty(u,r,s){return this.style.setConfigProperty(u,r,s),this._update(!0)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){const r=u[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.bn.convert(u),this.transform):0}setFeatureState(u,r){return this._isValidId(u.source)?(this.style.setFeatureState(u,r),this._update()):this}removeFeatureState(u,r){return this._isValidId(u.source)?(this.style.removeFeatureState(u,r),this._update()):this}getFeatureState(u){return this._isValidId(u.source)?this.style.getFeatureState(u):null}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let s,h,p,_=this._container;for(;_&&(!h||!p);){const x=window.getComputedStyle(_).transform;x&&x!=="none"&&(s=x.match(/matrix.*\((.+)\)/)[1].split(", "),s[0]&&s[0]!=="0"&&s[0]!=="1"&&(h=s[0]),s[3]&&s[3]!=="0"&&s[3]!=="1"&&(p=s[3])),_=_.parentElement}this._containerWidth=h?Math.abs(u/h):u,this._containerHeight=p?Math.abs(r/p):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=ce("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=ce("div","mapboxgl-canvas-container",u);this._canvas=ce("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const s=this._controlContainer=ce("div","mapboxgl-control-container",u),h=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(p=>{h[p]=ce("div",`mapboxgl-ctrl-${p}`,s)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,r){const s=o.f.devicePixelRatio||1;this._canvas.width=s*Math.ceil(u),this._canvas.height=s*Math.ceil(r),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${r}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const r=this._markers.indexOf(u);r!==-1&&this._markers.splice(r,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const r=this._popups.indexOf(u);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const u=o.e({},ie.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",u);r?(o.db(r,!0),this.painter=new Ap(r,this._contextCreateOptions,this.transform,this._tp),this.on("data",s=>{s.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.dc.testSupport(r)):this.fire(new o.a(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.b("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.resize(),this._update(),this.fire(new o.b("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let r;this.fire(new o.b("renderstart"));const s=this.painter.context.extTimerQuery,h=o.f.now(),p=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=p.createQuery(),p.beginQuery(s.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const _=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,I=this.transform.pitch,C=o.f.now(),L=new o.K(S,{now:C,fadeDuration:_,pitch:I,transition:this.style.transition});this.style.update(L)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(h),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(h),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,_,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,showParseStatus:this.showParseStatus||this._debugParams.showParseStatus,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs||this._debugParams.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:_,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding||this._debugParams.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.b("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new o.b("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const S=o.f.now()-h;p.endQuery(s.TIME_ELAPSED_EXT),setTimeout(()=>{const I=p.getQueryParameter(r,p.QUERY_RESULT)/1e6;p.deleteQuery(r),this.fire(new o.b("gpu-timing-frame",{cpuTime:S,gpuTime:I}))},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(S);this.fire(new o.b("gpu-timing-layer",{layerTimes:I}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const I=this.painter.queryGpuTimeDeferredRender(S);this.fire(new o.b("gpu-timing-deferred-render",{gpuTime:I}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(T||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(x=this._updateAverageElevation(h,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new o.b("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const I=this._calculateSpeedIndex();this.fire(new o.b("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,this._performanceMetricsCollection&&o.dd(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const r of this._markers)u&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!u||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(u,r=!1){const s=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&s(0);const h=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(h||(r||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(_)?_=0:this._averageElevationLastSampledAt=u;const x=Math.abs(p-_);if(x>1){if(this._isInitialLoad||h)return this._averageElevation.jumpTo(_),s(_);this._averageElevation.easeTo(_,u,300)}else if(x>1e-4)return this._averageElevation.jumpTo(_),s(_)}return!!this._averageElevation.isEasing(u)&&s(this._averageElevation.getValue(u))}_authenticate(){o.de(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===o.df||u.status===401)){const r=this.painter.context.gl;o.db(r,!1),this._logoControl instanceof Fp&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.a(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),o.dg(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const s=this.painter.context.gl,h=s.createFramebuffer();function p(_){s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,_,0);const x=new Uint8Array(s.drawingBufferWidth*s.drawingBufferHeight*4);return s.readPixels(0,0,s.drawingBufferWidth,s.drawingBufferHeight,s.RGBA,s.UNSIGNED_BYTE,x),x}return s.bindFramebuffer(s.FRAMEBUFFER,h),this._canvasPixelComparison(p(u),r.canvasCopies.map(p),r.timeStamps)}_canvasPixelComparison(u,r,s){let h=s[1]-s[0];const p=u.length/4;for(let _=0;_<r.length;_++){const x=r[_];let T=0;for(let S=0;S<x.length;S+=4)x[S]===u[S]&&x[S+1]===u[S+1]&&x[S+2]===u[S+2]&&x[S+3]===u[S+3]&&(T+=1);h+=(s[_+2]-s[_+1])*(1-T/p)}return h}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),o.dh(this.painter.context.gl),o.di.remove(),o.dj.remove(),this._removed=!0,this.fire(new o.b("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=o.f.frame(r=>{const s=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,s&&this._render(r)}))}_preloadTiles(u){const r=this.style?Object.values(this.style._sourceCaches):[];return o.b1(r,(s,h)=>s._preloadTiles(u,h),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,u&&this._update())}_setCacheLimits(u,r){o.dl(u,r)}get version(){return o.dk}},NavigationControl:class{constructor(u){this.options=o.e({},Cu,u),this._container=ce("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),ce("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),ce("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const s=this._map;s&&(this.options.visualizePitch?s.resetNorthPitch({},{originalEvent:r}):s.resetNorth({},{originalEvent:r}))}),this._compassIcon=ce("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const r=u.getZoom(),s=r===u.getMaxZoom(),h=r===u.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=h,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",h.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new no(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,r){const s=ce("button",u,this._container);return s.type="button",s.addEventListener("click",r),s}_setButtonTitle(u,r){if(!this._map)return;const s=this._map._getUIString(`NavigationControl.${r}`);u.setAttribute("aria-label",s),u.firstElementChild&&u.firstElementChild.setAttribute("title",s)}},GeolocateControl:class extends o.E{constructor(u){super();const r=navigator.geolocation;this.options=o.e({geolocation:r},Pu,u),o.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ac(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=ce("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const r=(s=!!this.options.geolocation)=>{this._supportsGeolocation=s,u(s)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(s=>r(s.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(u){const r=this._map.getMaxBounds(),s=u.coords;return!!r&&(s.longitude<r.getWest()||s.longitude>r.getEast()||s.latitude<r.getSouth()||s.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new o.b("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.b("geolocate",u)),this._finish()}}_updateCamera(u){const r=new o.bn(u.coords.longitude,u.coords.latitude),s=u.coords.accuracy,h=this._map.getBearing(),p=o.e({bearing:h},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(s),p,{geolocateSource:!0})}_updateMarker(u){if(u){const r=new o.bn(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,r=o.bl(1,u._center.lat)*u.worldSize,s=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${s}px`,this._circleElement.style.height=`${s}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.b("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=ce("button","mapboxgl-ctrl-geolocate",this._container),ce("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ce("div","mapboxgl-user-location"),this._dotElement.appendChild(ce("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ce("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new jd({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ce("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jd({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.b("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.b("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.b("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.b("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ud,ScaleControl:class{constructor(u){this.options=o.e({},zn,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,r=this._map,s=r._containerHeight/2,h=r._containerWidth/2-u/2,p=r.unproject([h,s]),_=r.unproject([h+u,s]),x=p.distanceTo(_);if(this.options.unit==="imperial"){const T=3.2808*x;T>5280?this._setScale(u,T/5280,"mile"):this._setScale(u,T,"foot")}else this.options.unit==="nautical"?this._setScale(u,x/1852,"nautical-mile"):x>=1e3?this._setScale(u,x/1e3,"kilometer"):this._setScale(u,x,"meter")}_setScale(u,r,s){this._map._requestDomTask(()=>{const h=function(_){const x=Math.pow(10,`${Math.floor(_)}`.length-1);let T=_/x;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(S){const I=Math.pow(10,Math.ceil(-Math.log(S)/Math.LN10));return Math.round(S*I)/I}(T),x*T}(r),p=h/r;this._container.innerHTML=this._isNumberFormatSupported&&s!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:s}).format(h):`${h}&nbsp;${Vo[s]}`,this._container.style.width=u*p+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=ce("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:o.w("Full screen control 'container' must be a DOM element.")),o.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=ce("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=ce("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ce("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends o.E{constructor(u){super(),this.options=o.e(Object.create(Vp),u),o.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new o.b("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new o.b("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=o.bn.convert(u),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const r=document.createDocumentFragment(),s=document.createElement("body");let h;for(s.innerHTML=u;h=s.firstChild,h;)r.appendChild(h);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=ce("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(u),this.options.closeButton){const s=this._closeButton=ce("button","mapboxgl-popup-close-button",r);s.type="button",s.setAttribute("aria-label","Close popup"),s.setAttribute("aria-hidden","true"),s.innerHTML="&#215;",s.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let r;return this._classList.delete(u)?r=!1:(this._classList.add(u),r=!0),this._updateClassList(),r}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const r=this._map,s=this._container,h=this._pos;if(!r||!s||!h)return"bottom";const p=s.offsetWidth,_=s.offsetHeight,x=h.x<p/2,T=h.x>r.transform.width-p/2;if(h.y+u<_)return x?"top-left":T?"top-right":"top";if(h.y>r.transform.height-_){if(x)return"bottom-left";if(T)return"bottom-right"}return x?"left":T?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),u.className=r.join(" ")}_update(u){const r=this._map,s=this._content;if(!r||!this._lngLat&&!this._trackPointer||!s)return;let h=this._container;if(h||(h=this._container=ce("div","mapboxgl-popup",r.getContainer()),this._tip=ce("div","mapboxgl-popup-tip",h),h.appendChild(s)),this.options.maxWidth&&h.style.maxWidth!==this.options.maxWidth&&(h.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=yc(this._lngLat,this._pos,r.transform)),!this._trackPointer||u){const p=this._pos=this._trackPointer&&u?u:r.project(this._lngLat),_=jp(this.options.offset),x=this._anchor=this._getAnchor(_.y),T=jp(this.options.offset,x),S=p.add(T).round();r._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${Iu[x]} translate(${S.x}px,${S.y}px)`)})}if(!this._marker&&r._showingGlobe()){const p=o.d6(r.transform,this._lngLat)?0:1;this._setOpacity(p)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(Up);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:jd,Style:As,LngLat:o.bn,LngLatBounds:o.ad,Point:o.P,MercatorCoordinate:o.L,FreeCameraOptions:$l,Evented:o.E,config:o.d5,prewarm:o.dp,clearPrewarmedResources:o.dq,get accessToken(){return o.d5.ACCESS_TOKEN},set accessToken(u){o.d5.ACCESS_TOKEN=u},get baseApiUrl(){return o.d5.API_URL},set baseApiUrl(u){o.d5.API_URL=u},get workerCount(){return o.dr.workerCount},set workerCount(u){o.dr.workerCount=u},get maxParallelImageRequests(){return o.d5.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){o.d5.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){o.ds(u)},get workerUrl(){return o.dt.workerUrl},set workerUrl(u){o.dt.workerUrl=u},get workerClass(){return o.dt.workerClass},set workerClass(u){o.dt.workerClass=u},get workerParams(){return o.dt.workerParams},set workerParams(u){o.dt.workerParams=u},get dracoUrl(){return o.du()},set dracoUrl(u){o.dv(u)},get meshoptUrl(){return o.dw()},set meshoptUrl(u){o.dx(u)},setNow:o.f.setNow,restoreNow:o.f.restoreNow}});var G=R;return G})})(TS);var GO=TS.exports;const Bn=U0(GO);var SS={exports:{}};(function(l,f){(function(){var v={};l.exports=v,v.simpleFilter=function(b,A){return A.filter(function(R){return v.test(b,R)})},v.test=function(b,A){return v.match(b,A)!==null},v.match=function(b,A,R){R=R||{};var z=0,G=[],o=A.length,Y=0,ie=0,K=R.pre||"",de=R.post||"",ce=R.caseSensitive&&A||A.toLowerCase(),Ee;b=R.caseSensitive&&b||b.toLowerCase();for(var Ue=0;Ue<o;Ue++)Ee=A[Ue],ce[Ue]===b[z]?(Ee=K+Ee+de,z+=1,ie+=1+ie):ie=0,Y+=ie,G[G.length]=Ee;return z===b.length?(Y=ce===b?1/0:Y,{rendered:G.join(""),score:Y}):null},v.filter=function(b,A,R){return!A||A.length===0?[]:typeof b!="string"?A:(R=R||{},A.reduce(function(z,G,o,Y){var ie=G;R.extract&&(ie=R.extract(G));var K=v.match(b,ie,R);return K!=null&&(z[z.length]={string:K.rendered,score:K.score,index:o,original:G}),z},[]).sort(function(z,G){var o=G.score-z.score;return o||z.index-G.index}))}})()})(SS);var $O=SS.exports,Ts=function(l){return this.component=l,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,l.el.parentNode.insertBefore(this.wrapper,l.el.nextSibling),this};Ts.prototype.show=function(){this.element.style.display="block"};Ts.prototype.hide=function(){this.element.style.display="none"};Ts.prototype.add=function(l){this.items.push(l)};Ts.prototype.clear=function(){this.items=[],this.active=0};Ts.prototype.isEmpty=function(){return!this.items.length};Ts.prototype.isVisible=function(){return this.element.style.display==="block"};Ts.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var l=0;l<this.items.length;l++)this.drawItem(this.items[l],this.active===l);this.show()};Ts.prototype.drawItem=function(l,f){var v=document.createElement("li"),b=document.createElement("a");f&&(v.className+=" active"),b.innerHTML=l.string,v.appendChild(b),this.element.appendChild(v),v.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),v.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,l)}).bind(this))};Ts.prototype.handleMouseUp=function(l){this.selectingListItem=!1,this.component.value(l.original),this.clear(),this.draw()};Ts.prototype.move=function(l){this.active=l,this.draw()};Ts.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Ts.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Ts.prototype.drawError=function(l){var f=document.createElement("li");f.innerHTML=l,this.element.appendChild(f),this.show()};var qO=Ts,ZO=Dl,HO=$O,WO=qO,rs=function(l,f,v){return v=v||{},this.options=ZO({minLength:2,limit:5,filter:!0,hideOnBlur:!0},v),this.el=l,this.data=f||[],this.list=new WO(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(b){this.handleKeyUp(b.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(b){this.handleKeyDown(b)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(b){this.handlePaste(b)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};rs.prototype.handleKeyUp=function(l){l===40||l===38||l===27||l===13||l===9||this.handleInputChange(this.el.value)};rs.prototype.handleKeyDown=function(l){switch(l.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&l.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};rs.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};rs.prototype.handlePaste=function(l){if(l.clipboardData)this.handleInputChange(l.clipboardData.getData("Text"));else{var f=this;setTimeout(function(){f.handleInputChange(l.target.value)},100)}};rs.prototype.handleInputChange=function(l){if(this.query=this.normalize(l),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(f){for(var v=0;v<f.length&&(this.list.add(f[v]),v!==this.options.limit-1);v++);this.list.draw()}).bind(this))};rs.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};rs.prototype.update=function(l){this.data=l,this.handleKeyUp()};rs.prototype.clear=function(){this.data=[],this.list.clear()};rs.prototype.normalize=function(l){return l=l.toLowerCase(),l};rs.prototype.match=function(l,f){return l.indexOf(f)>-1};rs.prototype.value=function(l){if(this.selected=l,this.el.value=this.getItemValue(l),document.createEvent){var f=document.createEvent("HTMLEvents");f.initEvent("change",!0,!1),this.el.dispatchEvent(f)}else this.el.fireEvent("onchange")};rs.prototype.getCandidates=function(l){var f={pre:"<strong>",post:"</strong>",extract:(function(b){return this.getItemValue(b)}).bind(this)},v;this.options.filter?(v=HO.filter(this.query,this.data,f),v=v.map((function(b){return{original:b.original,string:this.render(b.original,b.string)}}).bind(this))):v=this.data.map((function(b){var A=this.render(b);return{original:b,string:A}}).bind(this)),l(v)};rs.prototype.getItemValue=function(l){return l};rs.prototype.render=function(l,f){if(f)return f;for(var v=l.original?this.getItemValue(l.original):this.getItemValue(l),b=this.normalize(v),A=b.lastIndexOf(this.query);A>-1;){var R=A+this.query.length;v=v.slice(0,A)+"<strong>"+v.slice(A,R)+"</strong>"+v.slice(R),A=b.slice(0,A).lastIndexOf(this.query)}return v};rs.prototype.renderError=function(l){this.list.drawError(l)};var XO=rs,MS=XO,KO=MS;typeof window<"u"&&(window.Suggestions=MS);var YO="Expected a function",fT=NaN,JO="[object Symbol]",QO=/^\s+|\s+$/g,ez=/^[-+]0x[0-9a-f]+$/i,tz=/^0b[01]+$/i,iz=/^0o[0-7]+$/i,rz=parseInt,nz=typeof Vs=="object"&&Vs&&Vs.Object===Object&&Vs,sz=typeof self=="object"&&self&&self.Object===Object&&self,oz=nz||sz||Function("return this")(),az=Object.prototype,lz=az.toString,cz=Math.max,uz=Math.min,Zy=function(){return oz.Date.now()};function hz(l,f,v){var b,A,R,z,G,o,Y=0,ie=!1,K=!1,de=!0;if(typeof l!="function")throw new TypeError(YO);f=pT(f)||0,m0(v)&&(ie=!!v.leading,K="maxWait"in v,R=K?cz(pT(v.maxWait)||0,f):R,de="trailing"in v?!!v.trailing:de);function ce(At){var _i=b,ai=A;return b=A=void 0,Y=At,z=l.apply(ai,_i),z}function Ee(At){return Y=At,G=setTimeout(et,f),ie?ce(At):z}function Ue(At){var _i=At-o,ai=At-Y,Ie=f-_i;return K?uz(Ie,R-ai):Ie}function $e(At){var _i=At-o,ai=At-Y;return o===void 0||_i>=f||_i<0||K&&ai>=R}function et(){var At=Zy();if($e(At))return ht(At);G=setTimeout(et,Ue(At))}function ht(At){return G=void 0,de&&b?ce(At):(b=A=void 0,z)}function Xe(){G!==void 0&&clearTimeout(G),Y=0,b=o=A=G=void 0}function $t(){return G===void 0?z:ht(Zy())}function kt(){var At=Zy(),_i=$e(At);if(b=arguments,A=this,o=At,_i){if(G===void 0)return Ee(o);if(K)return G=setTimeout(et,f),ce(o)}return G===void 0&&(G=setTimeout(et,f)),z}return kt.cancel=Xe,kt.flush=$t,kt}function m0(l){var f=typeof l;return!!l&&(f=="object"||f=="function")}function dz(l){return!!l&&typeof l=="object"}function fz(l){return typeof l=="symbol"||dz(l)&&lz.call(l)==JO}function pT(l){if(typeof l=="number")return l;if(fz(l))return fT;if(m0(l)){var f=typeof l.valueOf=="function"?l.valueOf():l;l=m0(f)?f+"":f}if(typeof l!="string")return l===0?l:+l;l=l.replace(QO,"");var v=tz.test(l);return v||iz.test(l)?rz(l.slice(2),v?2:8):ez.test(l)?fT:+l}var pz=hz,Z0={exports:{}},lh=typeof Reflect=="object"?Reflect:null,mT=lh&&typeof lh.apply=="function"?lh.apply:function(f,v,b){return Function.prototype.apply.call(f,v,b)},t_;lh&&typeof lh.ownKeys=="function"?t_=lh.ownKeys:Object.getOwnPropertySymbols?t_=function(f){return Object.getOwnPropertyNames(f).concat(Object.getOwnPropertySymbols(f))}:t_=function(f){return Object.getOwnPropertyNames(f)};function mz(l){console&&console.warn&&console.warn(l)}var AS=Number.isNaN||function(f){return f!==f};function Zr(){Zr.init.call(this)}Z0.exports=Zr;Z0.exports.once=vz;Zr.EventEmitter=Zr;Zr.prototype._events=void 0;Zr.prototype._eventsCount=0;Zr.prototype._maxListeners=void 0;var _T=10;function O_(l){if(typeof l!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof l)}Object.defineProperty(Zr,"defaultMaxListeners",{enumerable:!0,get:function(){return _T},set:function(l){if(typeof l!="number"||l<0||AS(l))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+l+".");_T=l}});Zr.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Zr.prototype.setMaxListeners=function(f){if(typeof f!="number"||f<0||AS(f))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+f+".");return this._maxListeners=f,this};function IS(l){return l._maxListeners===void 0?Zr.defaultMaxListeners:l._maxListeners}Zr.prototype.getMaxListeners=function(){return IS(this)};Zr.prototype.emit=function(f){for(var v=[],b=1;b<arguments.length;b++)v.push(arguments[b]);var A=f==="error",R=this._events;if(R!==void 0)A=A&&R.error===void 0;else if(!A)return!1;if(A){var z;if(v.length>0&&(z=v[0]),z instanceof Error)throw z;var G=new Error("Unhandled error."+(z?" ("+z.message+")":""));throw G.context=z,G}var o=R[f];if(o===void 0)return!1;if(typeof o=="function")mT(o,this,v);else for(var Y=o.length,ie=DS(o,Y),b=0;b<Y;++b)mT(ie[b],this,v);return!0};function CS(l,f,v,b){var A,R,z;if(O_(v),R=l._events,R===void 0?(R=l._events=Object.create(null),l._eventsCount=0):(R.newListener!==void 0&&(l.emit("newListener",f,v.listener?v.listener:v),R=l._events),z=R[f]),z===void 0)z=R[f]=v,++l._eventsCount;else if(typeof z=="function"?z=R[f]=b?[v,z]:[z,v]:b?z.unshift(v):z.push(v),A=IS(l),A>0&&z.length>A&&!z.warned){z.warned=!0;var G=new Error("Possible EventEmitter memory leak detected. "+z.length+" "+String(f)+" listeners added. Use emitter.setMaxListeners() to increase limit");G.name="MaxListenersExceededWarning",G.emitter=l,G.type=f,G.count=z.length,mz(G)}return l}Zr.prototype.addListener=function(f,v){return CS(this,f,v,!1)};Zr.prototype.on=Zr.prototype.addListener;Zr.prototype.prependListener=function(f,v){return CS(this,f,v,!0)};function _z(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function PS(l,f,v){var b={fired:!1,wrapFn:void 0,target:l,type:f,listener:v},A=_z.bind(b);return A.listener=v,b.wrapFn=A,A}Zr.prototype.once=function(f,v){return O_(v),this.on(f,PS(this,f,v)),this};Zr.prototype.prependOnceListener=function(f,v){return O_(v),this.prependListener(f,PS(this,f,v)),this};Zr.prototype.removeListener=function(f,v){var b,A,R,z,G;if(O_(v),A=this._events,A===void 0)return this;if(b=A[f],b===void 0)return this;if(b===v||b.listener===v)--this._eventsCount===0?this._events=Object.create(null):(delete A[f],A.removeListener&&this.emit("removeListener",f,b.listener||v));else if(typeof b!="function"){for(R=-1,z=b.length-1;z>=0;z--)if(b[z]===v||b[z].listener===v){G=b[z].listener,R=z;break}if(R<0)return this;R===0?b.shift():gz(b,R),b.length===1&&(A[f]=b[0]),A.removeListener!==void 0&&this.emit("removeListener",f,G||v)}return this};Zr.prototype.off=Zr.prototype.removeListener;Zr.prototype.removeAllListeners=function(f){var v,b,A;if(b=this._events,b===void 0)return this;if(b.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):b[f]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete b[f]),this;if(arguments.length===0){var R=Object.keys(b),z;for(A=0;A<R.length;++A)z=R[A],z!=="removeListener"&&this.removeAllListeners(z);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(v=b[f],typeof v=="function")this.removeListener(f,v);else if(v!==void 0)for(A=v.length-1;A>=0;A--)this.removeListener(f,v[A]);return this};function RS(l,f,v){var b=l._events;if(b===void 0)return[];var A=b[f];return A===void 0?[]:typeof A=="function"?v?[A.listener||A]:[A]:v?yz(A):DS(A,A.length)}Zr.prototype.listeners=function(f){return RS(this,f,!0)};Zr.prototype.rawListeners=function(f){return RS(this,f,!1)};Zr.listenerCount=function(l,f){return typeof l.listenerCount=="function"?l.listenerCount(f):LS.call(l,f)};Zr.prototype.listenerCount=LS;function LS(l){var f=this._events;if(f!==void 0){var v=f[l];if(typeof v=="function")return 1;if(v!==void 0)return v.length}return 0}Zr.prototype.eventNames=function(){return this._eventsCount>0?t_(this._events):[]};function DS(l,f){for(var v=new Array(f),b=0;b<f;++b)v[b]=l[b];return v}function gz(l,f){for(;f+1<l.length;f++)l[f]=l[f+1];l.pop()}function yz(l){for(var f=new Array(l.length),v=0;v<f.length;++v)f[v]=l[v].listener||l[v];return f}function vz(l,f){return new Promise(function(v,b){function A(z){l.removeListener(f,R),b(z)}function R(){typeof l.removeListener=="function"&&l.removeListener("error",A),v([].slice.call(arguments))}OS(l,f,R,{once:!0}),f!=="error"&&xz(l,A,{once:!0})})}function xz(l,f,v){typeof l.on=="function"&&OS(l,"error",f,v)}function OS(l,f,v,b){if(typeof l.on=="function")b.once?l.once(f,v):l.on(f,v);else if(typeof l.addEventListener=="function")l.addEventListener(f,function A(R){b.once&&l.removeEventListener(f,A),v(R)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof l)}var bz=Z0.exports,wz={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function Tz(l){var f=l.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return f?{key:f[1],value:f[2]}:null}function Ez(l){var f=l.match(/<?([^>]*)>(.*)/);if(!f)return null;var v=f[1],b=f[2].split(";"),A=null,R=b.reduce(function(z,G){var o=Tz(G);return o?o.key==="rel"?(A||(A=o.value),z):(z[o.key]=o.value,z):z},{});return A?{url:v,rel:A,params:R}:null}function Sz(l){return l?l.split(/,\s*</).reduce(function(f,v){var b=Ez(v);if(!b)return f;var A=b.rel.split(/\s+/);return A.forEach(function(R){f[R]||(f[R]={url:b.url,params:b.params})}),f},{}):{}}var Mz=Sz,Az=Mz;function H0(l,f){this.request=l,this.headers=f.headers,this.rawBody=f.body,this.statusCode=f.statusCode;try{this.body=JSON.parse(f.body||"{}")}catch{this.body=f.body}this.links=Az(this.headers.link)}H0.prototype.hasNextPage=function(){return!!this.links.next};H0.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var Iz=H0,z_={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},gT=z_;function Cz(l){var f=l.type||gT.ERROR_HTTP,v;if(l.body)try{v=JSON.parse(l.body)}catch{v=l.body}else v=null;var b=l.message||null;b||(typeof v=="string"?b=v:v&&typeof v.message=="string"?b=v.message:f===gT.ERROR_REQUEST_ABORTED&&(b="Request aborted")),this.message=b,this.type=f,this.statusCode=l.statusCode||null,this.request=l.request,this.body=v}var Pz=Cz;function Rz(l){var f=l.indexOf(":"),v=l.substring(0,f).trim().toLowerCase(),b=l.substring(f+1).trim();return{name:v,value:b}}function Lz(l){var f={};return l&&l.trim().split(/[\r|\n]+/).forEach(function(v){var b=Rz(v);f[b.name]=b.value}),f}var Dz=Lz,Oz=Iz,yT=Pz,Hy=z_,zz=Dz,h_={};function kz(l){var f=h_[l.id];f&&(f.abort(),delete h_[l.id])}function Bz(l,f){return new Oz(l,{body:f.response,headers:zz(f.getAllResponseHeaders()),statusCode:f.status})}function vT(l){var f=l.total,v=l.loaded,b=100*v/f;return{total:f,transferred:v,percent:b}}function zS(l,f){return new Promise(function(v,b){f.onprogress=function(z){l.emitter.emit(Hy.EVENT_PROGRESS_DOWNLOAD,vT(z))};var A=l.file;A&&(f.upload.onprogress=function(z){l.emitter.emit(Hy.EVENT_PROGRESS_UPLOAD,vT(z))}),f.onerror=function(z){b(z)},f.onabort=function(){var z=new yT({request:l,type:Hy.ERROR_REQUEST_ABORTED});b(z)},f.onload=function(){if(delete h_[l.id],f.status<200||f.status>=400){var z=new yT({request:l,body:f.response,statusCode:f.status});b(z);return}v(f)};var R=l.body;typeof R=="string"?f.send(R):R?f.send(JSON.stringify(R)):A?f.send(A):f.send(),h_[l.id]=f}).then(function(v){return Bz(l,v)})}function kS(l,f){var v=l.url(f),b=new window.XMLHttpRequest;return b.open(l.method,v),Object.keys(l.headers).forEach(function(A){b.setRequestHeader(A,l.headers[A])}),b}function Fz(l){return Promise.resolve().then(function(){var f=kS(l,l.client.accessToken);return zS(l,f)})}var Nz={browserAbort:kz,sendRequestXhr:zS,browserSend:Fz,createRequestXhr:kS};function Vz(l){return l.map(encodeURIComponent).join(",")}function BS(l){return Array.isArray(l)?Vz(l):encodeURIComponent(String(l))}function FS(l,f,v){if(v===!1||v===null)return l;var b=/\?/.test(l)?"&":"?",A=encodeURIComponent(f);return v!==void 0&&v!==""&&v!==!0&&(A+="="+BS(v)),""+l+b+A}function Uz(l,f){if(!f)return l;var v=l;return Object.keys(f).forEach(function(b){var A=f[b];A!==void 0&&(Array.isArray(A)&&(A=A.filter(function(R){return R!=null}).join(",")),v=FS(v,b,A))}),v}function jz(l,f){if(!f||l.slice(0,4)==="http")return l;var v=l[0]==="/"?"":"/";return""+f.replace(/\/$/,"")+v+l}function Gz(l,f){return f?l.replace(/\/:([a-zA-Z0-9]+)/g,function(v,b){var A=f[b];if(A===void 0)throw new Error("Unspecified route parameter "+b);var R=BS(A);return"/"+R}):l}var $z={appendQueryObject:Uz,appendQueryParam:FS,prependOrigin:jz,interpolateRouteParams:Gz},qz=R_,W0=Dl,Zz=pS,Wm=$z,xT=z_,Hz=1;function Cl(l,f){if(!l)throw new Error("MapiRequest requires a client");if(!f||!f.path||!f.method)throw new Error("MapiRequest requires an options object with path and method properties");var v={};f.body&&(v["content-type"]="application/json");var b=W0(v,f.headers),A=Object.keys(b).reduce(function(R,z){return R[z.toLowerCase()]=b[z],R},{});this.id=Hz++,this._options=f,this.emitter=new Zz,this.client=l,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=f.path,this.method=f.method,this.origin=f.origin||l.origin,this.query=f.query||{},this.params=f.params||{},this.body=f.body||null,this.file=f.file||null,this.encoding=f.encoding||"utf8",this.sendFileAs=f.sendFileAs||null,this.headers=A}Cl.prototype.url=function(f){var v=Wm.prependOrigin(this.path,this.origin);v=Wm.appendQueryObject(v,this.query);var b=this.params,A=f??this.client.accessToken;if(A){v=Wm.appendQueryParam(v,"access_token",A);var R=qz(A).user;b=W0({ownerId:R},b)}return v=Wm.interpolateRouteParams(v,b),v};Cl.prototype.send=function(){var f=this;if(f.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return f.sent=!0,f.client.sendRequest(f).then(function(v){return f.response=v,f.emitter.emit(xT.EVENT_RESPONSE,v),v},function(v){throw f.error=v,f.emitter.emit(xT.EVENT_ERROR,v),v})};Cl.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Cl.prototype.eachPage=function(f){var v=this;function b(z){function G(){delete v._nextPageRequest;var o=z.nextPage();o&&(v._nextPageRequest=o,R(o))}f(null,z,G)}function A(z){f(z,null,function(){})}function R(z){z.send().then(b,A)}R(this)};Cl.prototype.clone=function(){return this._extend()};Cl.prototype._extend=function(f){var v=W0(this._options,f);return new Cl(this.client,v)};var Wz=Cl,Xz=R_,Kz=Wz,Yz=z_;function NS(l){if(!l||!l.accessToken)throw new Error("Cannot create a client without an access token");Xz(l.accessToken),this.accessToken=l.accessToken,this.origin=l.origin||Yz.API_ORIGIN}NS.prototype.createRequest=function(f){return new Kz(this,f)};var VS=NS,US=Nz,jS=VS;function _h(l){jS.call(this,l)}_h.prototype=Object.create(jS.prototype);_h.prototype.constructor=_h;_h.prototype.sendRequest=US.browserSend;_h.prototype.abortRequest=US.browserAbort;function Jz(l){return new _h(l)}var GS=Jz,Qz=GS,ek=Qz,tk=Dl,ch=dS;function ik(l){if(typeof window<"u")return l instanceof Vs.Blob||l instanceof Vs.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof l=="string"||l.pipe!==void 0))return"Filename or Readable stream"}function rk(l,f){return ch.assert(ch.strictShape(l),f)}function nk(l){var f="date";if(typeof l=="boolean")return f;try{var v=new Date(l);if(v.getTime&&isNaN(v.getTime()))return f}catch{return f}}function sk(l){return ch.tuple(ch.number,ch.number)(l)}var ok=tk(ch,{file:ik,date:nk,coordinates:sk,assertShape:rk});function ak(l,f){var v=function(b,A){return f.indexOf(b)!==-1&&A!==void 0};return typeof f=="function"&&(v=f),Object.keys(l).filter(function(b){return v(b,l[b])}).reduce(function(b,A){return b[A]=l[A],b},{})}var lk=ak;function ck(l,f){return Object.keys(l).reduce(function(v,b){return v[b]=f(b,l[b]),v},{})}var uk=ck,hk=uk;function dk(l){return hk(l,function(f,v){return typeof v=="boolean"?JSON.stringify(v):v})}var fk=dk,pk=VS,mk=GS;function _k(l){return function(f){var v;pk.prototype.isPrototypeOf(f)?v=f:v=mk(f);var b=Object.create(l);return b.client=v,b}}var gk=_k,$S=Dl,_r=ok,d_=lk,qS=fk,yk=gk,X0={},ZS=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];X0.forwardGeocode=function(l){_r.assertShape({query:_r.required(_r.string),mode:_r.oneOf("mapbox.places","mapbox.places-permanent"),countries:_r.arrayOf(_r.string),proximity:_r.oneOf(_r.coordinates,"ip"),types:_r.arrayOf(_r.oneOf(ZS)),autocomplete:_r.boolean,bbox:_r.arrayOf(_r.number),limit:_r.number,language:_r.arrayOf(_r.string),routing:_r.boolean,fuzzyMatch:_r.boolean,worldview:_r.string})(l),l.mode=l.mode||"mapbox.places";var f=qS($S({country:l.countries},d_(l,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:d_(l,["mode","query"]),query:f})};X0.reverseGeocode=function(l){_r.assertShape({query:_r.required(_r.coordinates),mode:_r.oneOf("mapbox.places","mapbox.places-permanent"),countries:_r.arrayOf(_r.string),types:_r.arrayOf(_r.oneOf(ZS)),bbox:_r.arrayOf(_r.number),limit:_r.number,language:_r.arrayOf(_r.string),reverseMode:_r.oneOf("distance","score"),routing:_r.boolean,worldview:_r.string})(l),l.mode=l.mode||"mapbox.places";var f=qS($S({country:l.countries},d_(l,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:d_(l,["mode","query"]),query:f})};var vk=yk(X0);let xk="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",HS=l=>crypto.getRandomValues(new Uint8Array(l)),WS=(l,f,v)=>{let b=(2<<Math.log(l.length-1)/Math.LN2)-1,A=-~(1.6*b*f/l.length);return(R=f)=>{let z="";for(;;){let G=v(A),o=A;for(;o--;)if(z+=l[G[o]&b]||"",z.length===R)return z}}},bk=(l,f=21)=>WS(l,f,HS),wk=(l=21)=>crypto.getRandomValues(new Uint8Array(l)).reduce((f,v)=>(v&=63,v<36?f+=v.toString(36):v<62?f+=(v-26).toString(36).toUpperCase():v>62?f+="-":f+="_",f),"");const Tk=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:bk,customRandom:WS,nanoid:wk,random:HS,urlAlphabet:xk},Symbol.toStringTag,{value:"Module"})),Ek=h3(Tk);var Sk=Ek.nanoid;function XS(l){this.origin=l.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=l.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=l,this.send=this.send.bind(this),this.countries=l.countries?l.countries.split(","):null,this.types=l.types?l.types.split(","):null,this.bbox=l.bbox?l.bbox:null,this.language=l.language?l.language.split(","):null,this.limit=l.limit?+l.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(l),this.eventQueue=new Array,this.flushInterval=l.flushInterval||1e3,this.maxQueueSize=l.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}XS.prototype={select:function(l,f){var v=this.getSelectedIndex(l,f),b=this.getEventPayload("search.select",f);if(b.resultIndex=v,b.resultPlaceName=l.place_name,b.resultId=l.id,!(v===this.lastSentIndex&&b.queryString===this.lastSentInput||v==-1)&&(this.lastSentIndex=v,this.lastSentInput=b.queryString,!!b.queryString))return this.push(b)},start:function(l){var f=this.getEventPayload("search.start",l);if(f.queryString)return this.push(f)},keyevent:function(l,f){if(l.key&&!(l.metaKey||[9,27,37,39,13,38,40].indexOf(l.keyCode)!==-1)){var v=this.getEventPayload("search.keystroke",f);if(v.lastAction=l.key,!!v.queryString)return this.push(v)}},send:function(l,f){if(!this.enableEventLogging)return f?f():void 0;var v=this.getRequestOptions(l);this.request(v,(function(b){if(b)return this.handleError(b,f);if(f)return f()}).bind(this))},getRequestOptions:function(l){Array.isArray(l)||(l=[l]);var f={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)};return f},getEventPayload:function(l,f){var v;f.options.proximity?typeof f.options.proximity=="object"?v=[f.options.proximity.longitude,f.options.proximity.latitude]:f.options.proximity==="ip"?v=[999,999]:v=f.options.proximity:v=null;var b=f._map?f._map.getZoom():void 0,A={event:l,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:f.options.autocomplete,fuzzyMatch:f.options.fuzzyMatch,proximity:v,limit:f.options.limit,routing:f.options.routing,worldview:f.options.worldview,mapZoom:b,keyboardLocale:this.locale};return l==="search.select"?A.queryString=f.inputString:l!="search.select"&&f._inputEl?A.queryString=f._inputEl.value:A.queryString=f.inputString,A},request:function(l,f){var v=new XMLHttpRequest;v.onreadystatechange=function(){if(this.readyState==4)return this.status==204?f(null):f(this.statusText)},v.open(l.method,l.host+"/"+l.path,!0);for(var b in l.headers){var A=l.headers[b];v.setRequestHeader(b,A)}v.send(l.body)},handleError:function(l,f){if(f)return f(l)},generateSessionID:function(){return Sk()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(l,f){if(f._typeahead){var v=f._typeahead.data,b=l.id,A=v.map(function(z){return z.id}),R=A.indexOf(b);return R}},shouldEnableLogging:function(l){return!(l.enableEventLogging===!1||l.origin&&l.origin!=="https://api.mapbox.com"||l.localGeocoder||l.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(l,f){this.eventQueue.push(l),(this.eventQueue.length>=this.maxQueueSize||f)&&this.flush()},remove:function(){this.flush()}};var Mk=XS,Ak={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},Ik={placeholder:Ak},KS={exports:{}};(function(l){(function(f,v,b){l.exports?l.exports=b():f[v]=b()})(Vs,"subtag",function(){var f="",v=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function b(o){return o.match(v)||[]}function A(o){return b(o).filter(function(Y,ie){return Y&&ie})}function R(o){return o=b(o),{language:o[1]||f,extlang:o[2]||f,script:o[3]||f,region:o[4]||f}}function z(o,Y,ie){Object.defineProperty(o,Y,{value:ie,enumerable:!0})}function G(o,Y,ie){function K(de){return b(de)[o]||f}z(K,"pattern",Y),z(R,ie,K)}return G(1,/^[a-zA-Z]{2,3}$/,"language"),G(2,/^[a-zA-Z]{3}$/,"extlang"),G(3,/^[a-zA-Z]{4}$/,"script"),G(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),z(R,"split",A),R})})(KS);var Ck=KS.exports;function YS(){}YS.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const l={enableHighAccuracy:!0};return new Promise(function(f,v){window.navigator.geolocation.getCurrentPosition(f,v,l)})}};var Pk=YS;function Rk(l,f){const v=JS(l),b=["address","street","place","country"];var A;if(typeof f=="function")return f(v);const R=b.indexOf(f);return R===-1?A=b:A=b.slice(R),A.reduce(function(z,G){return v[G]?(z!==""&&(z=z+", "),z+v[G]):z},"")}function JS(l){const f=l.address||"",v=l.text||"",b=l.place_name||"",R={address:b.split(",")[0],houseNumber:f,street:v,placeName:b};return l.context.forEach(function(z){const G=z.id.split(".")[0];R[G]=z.text}),R}const Lk=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var Dk={transformFeatureToGeolocationText:Rk,getAddressInfo:JS,REVERSE_GEOCODE_COORD_RGX:Lk},Ok=KO,zk=pz,Bc=Dl,kk=bz.EventEmitter,bT=wz,Wy=ek,Xy=vk,Bk=Mk,Fk=Ik,Nk=Ck,Vk=Pk,wT=Dk;const pl={FORWARD:0,LOCAL:1,REVERSE:2};function Uk(){var l=document.createElement("div");return l.className="mapboxgl-ctrl-geocoder--powered-by",l.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',l}function QS(l){this._eventEmitter=new kk,this.options=Bc({},this.options,l),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Vk}QS.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(l){return l.place_name},render:function(l){var f=l.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+f[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+f.splice(1,f.length).join(",")+"</div></div>"}},addTo:function(l){function f(v,b){if(!document.body.contains(b))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const A=v.onAdd();b.appendChild(A)}if(l._controlContainer)l.addControl(this);else if(l instanceof HTMLElement)f(this,l);else if(typeof l=="string"){const v=document.querySelectorAll(l);if(v.length===0)throw new Error("Element ",l,"not found.");if(v.length>1)throw new Error("Geocoder can only be added to a single html element");f(this,v[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(l){if(l&&typeof l!="string"&&(this._map=l),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=Xy(Wy({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new Bk(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var f=this.container=document.createElement("div");f.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var v=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",zk(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(Y){this.eventManager.keyevent(Y,this)}).bind(this));var b=document.createElement("div");b.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var A=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(A),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),b.appendChild(this._clearEl),b.appendChild(this._loadingEl),f.appendChild(v),f.appendChild(this._inputEl),f.appendChild(b),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var R=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(R),b.appendChild(this._geolocateEl),this._showGeolocateButton()}var z=this._typeahead=new Ok(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),z.getItemValue=this.options.getItemValue;var G=z.list.draw,o=this._footerNode=Uk();return z.list.draw=function(){G.call(this),o.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),o.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(o)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),f},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(l){this._hideLoadingIcon();const f={geometry:{type:"Point",coordinates:[l.coords.longitude,l.coords.latitude]}};this._handleMarker(f),this._fly(f),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(f),this._showClearButton(),this.fresh=!1;const v={limit:1,language:[this.options.language],query:f.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const b=f.geometry.coordinates[0]+","+f.geometry.coordinates[1];this._setInputValue(b),this._eventEmitter.emit("result",{result:f})}else this.geocoderService.reverseGeocode(v).send().then((function(b){const A=b.body.features[0];if(A){const R=wT.transformFeatureToGeolocationText(A,this.options.addressAccuracy);this._setInputValue(R),A.user_coordinates=f.geometry.coordinates,this._eventEmitter.emit("result",{result:A})}else this._eventEmitter.emit("result",{result:{user_coordinates:f.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(l){l.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(l,f){var v=document.createElementNS("http://www.w3.org/2000/svg","svg");return v.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+l),v.setAttribute("viewBox","0 0 18 18"),v.setAttribute("xml:space","preserve"),v.setAttribute("width",18),v.setAttribute("height",18),v.innerHTML=f,v},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(l){this._inputEl.value=l,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(l){var f=(l.clipboardData||window.clipboardData).getData("text");f.length>=this.options.minLength&&this._geocode(f)},_onKeyDown:function(l){var f=27,v=9;if(l.keyCode===f&&this.options.clearAndBlurOnEsc)return this._clear(l),this._inputEl.blur();var b=l.target&&l.target.shadowRoot?l.target.shadowRoot.activeElement:l.target,A=b?b.value:"";if(!A)return this.fresh=!0,l.keyCode!==v&&this.clear(l),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(l.metaKey||[v,f,37,39,13,38,40].indexOf(l.keyCode)!==-1)&&b.value.length>=this.options.minLength&&this._geocode(b.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(l){this.options.clearOnBlur&&this._clearOnBlur(l),this.options.collapsed&&this._collapse()},_onChange:function(){var l=this._typeahead.selected;l&&JSON.stringify(l)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(l),this.options.marker&&this._mapboxgl&&this._handleMarker(l),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(l),this._eventEmitter.emit("result",{result:l}),this.eventManager.select(l,this))},_fly:function(l){var f;if(l.properties&&bT[l.properties.short_code])f=Bc({},this.options.flyTo),this._map&&this._map.fitBounds(bT[l.properties.short_code].bbox,f);else if(l.bbox){var v=l.bbox;f=Bc({},this.options.flyTo),this._map&&this._map.fitBounds([[v[0],v[1]],[v[2],v[3]]],f)}else{var b={zoom:this.options.zoom};f=Bc({},b,this.options.flyTo),l.center?f.center=l.center:l.geometry&&l.geometry.type&&l.geometry.type==="Point"&&l.geometry.coordinates&&(f.center=l.geometry.coordinates),this._map&&this._map.flyTo(f)}},_requestType:function(l,f){var v;return l.localGeocoderOnly?v=pl.LOCAL:l.reverseGeocode&&wT.REVERSE_GEOCODE_COORD_RGX.test(f)?v=pl.REVERSE:v=pl.FORWARD,v},_setupConfig:function(l,f){const v=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],b=/[\s,]+/;var A=this,R=v.reduce(function(G,o){if(A.options[o]===void 0||A.options[o]===null)return G;["countries","types","language"].indexOf(o)>-1?G[o]=A.options[o].split(b):G[o]=A.options[o];const Y=typeof A.options[o].longitude=="number"&&typeof A.options[o].latitude=="number";if(o==="proximity"&&Y){const ie=A.options[o].longitude,K=A.options[o].latitude;G[o]=[ie,K]}return G},{});switch(l){case pl.REVERSE:{var z=f.split(b).map(function(G){return parseFloat(G,10)});A.options.flipCoordinates||z.reverse(),R.types&&R.types[0],R=Bc(R,{query:z,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(G){G in R&&delete R[G]})}break;case pl.FORWARD:{const G=f.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(G)&&(f=f.replace(/,/g," ")),R=Bc(R,{query:f})}break}return R},_geocode:function(l){this.inputString=l,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:l});const f=this._requestType(this.options,l),v=this._setupConfig(f,l);var b;switch(f){case pl.LOCAL:b=Promise.resolve();break;case pl.FORWARD:b=this.geocoderService.forwardGeocode(v).send();break;case pl.REVERSE:b=this.geocoderService.reverseGeocode(v).send();break}var A=this.options.localGeocoder?this.options.localGeocoder(l)||[]:[],R=[],z=null;return b.catch((function(G){z=G}).bind(this)).then((function(G){this._hideLoadingIcon();var o={};return G?G.statusCode=="200"&&(o=G.body,o.request=G.request,o.headers=G.headers):o={type:"FeatureCollection",features:[]},o.config=v,this.fresh&&(this.eventManager.start(this),this.fresh=!1),o.features=o.features?A.concat(o.features):A,this.options.externalGeocoder?(R=this.options.externalGeocoder(l,o.features)||Promise.resolve([]),R.then(function(Y){return o.features=o.features?Y.concat(o.features):Y,o},function(){return o})):o}).bind(this)).then((function(G){if(z)throw z;this.options.filter&&G.features.length&&(G.features=G.features.filter(this.options.filter)),G.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",G),this._typeahead.update(G.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",G))}).bind(this)).catch((function(G){this._hideLoadingIcon(),this._hideAttribution(),A.length&&this.options.localGeocoder||R.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(A)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:A}),this._eventEmitter.emit("error",{error:G})}).bind(this)),b},_clear:function(l){l&&l.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(l){this._clear(l),this._inputEl.focus()},_clearOnBlur:function(l){var f=this;l.relatedTarget&&f._clear(l)},_onQueryResult:function(l){var f=l.body;if(f.features.length){var v=f.features[0];this._typeahead.selected=v,this._inputEl.value=v.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var l=this._map.getCenter().wrap();this.setProximity({longitude:l.lng,latitude:l.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(l){return this._geocode(l).then(this._onQueryResult),this},_renderError:function(){var l="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(l)},_renderLocationError:function(){var l="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(l)},_renderNoResults:function(){var l="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(l)},_renderUserDeniedGeolocationError:function(){var l="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(l)},_renderMessage:function(l){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(l)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var l=this.options.language.split(",")[0],f=Nk.language(l),v=Fk.placeholder[f];if(v)return v}return"Search"},setInput:function(l,f){return f===void 0&&(f=!1),this._inputEl.value=l,this._typeahead.selected=null,this._typeahead.clear(),l.length>=this.options.minLength&&(f?this._geocode(l):this._onChange()),this},setProximity:function(l,f=!0){return this.options.proximity=l,f&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(l){return l&&typeof l=="function"&&(this._typeahead.render=l),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(l){var f=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=l||this.options.language||f,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(l){return this.options.zoom=l,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(l){return this.options.flyTo=l,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(l){return this.options.placeholder=l||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(l){return this.options.bbox=l,this},getCountries:function(){return this.options.countries},setCountries:function(l){return this.options.countries=l,this},getTypes:function(){return this.options.types},setTypes:function(l){return this.options.types=l,this},getMinLength:function(){return this.options.minLength},setMinLength:function(l){return this.options.minLength=l,this._typeahead&&(this._typeahead.options.minLength=l),this},getLimit:function(){return this.options.limit},setLimit:function(l){return this.options.limit=l,this._typeahead&&(this._typeahead.options.limit=l),this},getFilter:function(){return this.options.filter},setFilter:function(l){return this.options.filter=l,this},setOrigin:function(l){return this.options.origin=l,this.geocoderService=Xy(Wy({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(l){return this.options.accessToken=l,this.geocoderService=Xy(Wy({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(l){return this.options.autocomplete=l,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(l){return this.options.fuzzyMatch=l,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(l){return this.options.routing=l,this},getRouting:function(){return this.options.routing},setWorldview:function(l){return this.options.worldview=l,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(l){if(this._map){this._removeMarker();var f={color:"#4668F2"},v=Bc({},f,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(v),l.center?this.mapMarker.setLngLat(l.center).addTo(this._map):l.geometry&&l.geometry.type&&l.geometry.type==="Point"&&l.geometry.coordinates&&this.mapMarker.setLngLat(l.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(l,f){return this._eventEmitter.on(l,f),this},off:function(l,f){return this._eventEmitter.removeListener(l,f),this.eventManager.remove(),this}};var jk=QS;const Gk=U0(jk),$k=is({__name:"MapComponent",setup(l){const f=Ol(),v=D_(),b=Bi(null);Bn.accessToken="pk.eyJ1IjoibXItdGhvbWFzLXJvZ2VycyIsImEiOiJjbHV4MmJhZ2kwbW5lMmpxcmR4dmYyd3JpIn0.T4Knhl9eC-Nh-JNm2YQ3vw";const A=Bi(null);El(()=>f.showMoorings,()=>{A.value&&A.value.setLayoutProperty("marinas","visibility",f.showMoorings?"visible":"none")}),El(()=>f.showMarinas,()=>{A.value&&A.value.setLayoutProperty("actual-marinas","visibility",f.showMarinas?"visible":"none")}),El(()=>f.triggerLocationChange,async()=>{var ie;console.log(f.zoomToLocation),A.value&&f.zoomToLocation!==void 0&&f.zoomToLocation.coordinates&&f.zoomToLocation.coordinates!==((ie=f.currentLocation)==null?void 0:ie.coordinates)&&(await R(f.zoomToLocation.coordinates),G(),await o(f.zoomToLocation),v.toggleNav=!1)});function R(ie){return new Promise((K,de)=>{console.log("fly to coordinates",ie),console.log("map status in fly to: ",A.value?"true":"HELP, NO MAP"),A.value&&ie?(console.log(ie),A.value.flyTo({center:ie,zoom:15}),A.value.once("moveend",ce=>{K()})):de("No init map or no provided coordinates")})}function z(ie){if(ie!=null)return ie.replace(/'/g,"\\'")}function G(){b.value&&b.value.remove()}function o(ie){return new Promise((K,de)=>{if(A.value&&ie&&ie.coordinates)if(A.value){const ce=z(ie.title);b.value=new Bn.Popup({offset:[0,-15]}).setLngLat(ie.coordinates).setHTML(`<span class="${ie.layer}"><h3>${ie.title}</h3><a href="https://canalplan.uk/place/${ie.cp_id}" target="_blank">Canal Plan Page</a><br/><button class="save" onclick="saveLocation([${ie.coordinates}], '${ie.layer}', '${ce}', '${ie.cp_id}')">Save Location</button></span>`).addTo(A.value),K()}else de("No init map")})}Window.prototype.saveLocation=function(ie,K,de,ce,Ee){const Ue={coordinates:ie,layer:K,title:de,cp_id:ce,icon:Ee};console.log(Ue);const $e=window.globalStore;$e.state.value.mapStore.savedLocations.find(ht=>ht.cp_id===Ue.cp_id)!=null||$e.state.value.mapStore.savedLocations.push(Ue),console.log($e.state.value.mapStore.savedLocations)};function Y(ie){const K=A.value.queryRenderedFeatures(ie,{layers:["marinas","actual-marinas"]});if(K.length<1)return;console.log(K);const de=K[0];if(de&&de.properties)return de}return bo(()=>{f.getDataSets(),f.mapLoaded=!1,A.value&&(A.value=new Bn.Map({container:A.value,style:"mapbox://styles/mr-thomas-rogers/clx7qe3r701pv01qs1dtoethy",center:[-1.474008,52.155133],zoom:6}),A.value.on("load",()=>{f.mapLoaded=!0;const ie={coordinates:A.value.getCenter(),bearing:A.value.getBearing(),zoom:A.value.getZoom()};f.setCurrentLocation(ie),A.value.setLayoutProperty("marinas","visibility",f.showMoorings?"visible":"none"),A.value.setLayoutProperty("actual-marinas","visibility",f.showMarinas?"visible":"none")}),A.value.on("move",()=>{(A.value===null||A.value===void 0)&&console.warn("MAP IS NULL");const ie={coordinates:A.value.getCenter(),bearing:A.value.getBearing(),zoom:A.value.getZoom()};f.setCurrentLocation(ie)}),A.value.on("click",async ie=>{let K=Y(ie.point);if(console.log("original feature: ",K),!K||!K.properties||(await R(K.geometry.coordinates),console.log("updated feature: ",K),!K)||!K.properties)return;const de={coordinates:K.geometry.coordinates,cp_id:K.properties.cp_id,cp_route:K.properties.cp_route,icon:K.properties.icon,layer:K.properties.layer,title:K.properties.title};G(),await o(de)}),A.value.addControl(new Gk({accessToken:Bn.accessToken,mapboxgl:Bn})),A.value.addControl(new Bn.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!1})),A.value.addControl(new Bn.NavigationControl))}),Gf(()=>{A.value&&A.value.remove()}),(ie,K)=>(ri(),hi("div",{ref_key:"map",ref:A,class:"map-container w-1/1 h-full",id:"map-container"},null,512))}}),qk=["href"],Zk=is({__name:"SavedRoutes",props:{location:Object},setup(l){const f=Ol(),v=l,b=Bi(""),A=Bi("");function R(){var z;f.removeLocation((z=v.location)==null?void 0:z.cp_id)}return bo(()=>{var z,G;b.value=((z=v.location)==null?void 0:z.layer)==="facilities"?"Marina":"Mooring",A.value=`https://canalplan.uk/place/${(G=v.location)==null?void 0:G.cp_id}`}),(z,G)=>{var o,Y;return ri(),hi("div",{class:Xo([(o=l.location)==null?void 0:o.layer,"text-slate-100 rounded-lg p-2 hover:cursor-pointer mb-2 transition duration-75"])},[He("h3",{class:"text-lg font-bold",onClick:G[0]||(G[0]=ie=>z.$emit("zoomToLocation",l.location))},Nr((Y=l.location)==null?void 0:Y.title)+" - "+Nr(b.value),1),He("a",{href:A.value,target:"_blank"},"Canal Plan Page",8,qk),He("button",{onClick:R},"Delete")],2)}}}),Hk=qf(Zk,[["__scopeId","data-v-8a9631fb"]]),gh=l=>(SP("data-v-7af29514"),l=l(),MP(),l),Wk={class:"h-full px-3 py-4 overflow-y-auto bg-slate-100 flex flex-col justify-between"},Xk={class:"mb-4"},Kk={class:"cursor-pointer"},Yk=gh(()=>He("p",{class:"text-sm font-medium text-gray-900 mb-2"},"Display Moorings",-1)),Jk=["checked"],Qk=gh(()=>He("div",{class:"relative w-11 h-6 bg-green-800 rounded-full peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-green-600"},null,-1)),eB={class:"mb-4"},tB={class:"cursor-pointer"},iB=gh(()=>He("p",{class:"text-sm font-medium text-gray-900 mb-2"},"Display Marinas",-1)),rB=["checked"],nB=gh(()=>He("div",{class:"relative w-11 h-6 bg-[#431A63] rounded-full peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-[#613583]"},null,-1)),sB={key:0},oB=gh(()=>He("h1",null,"Saved Locations:",-1)),aB=gh(()=>He("div",{style:{"margin-bottom":"75px"}},[He("p",null,[Hc("Map data for this project was downloaded from "),He("a",{href:"https://canalplan.org.uk/wiki/downloads:introduction",target:"_blank"},"Canal Plan")])],-1)),lB=is({__name:"SideNav",setup(l){const f=Ol(),v=D_(),b=()=>{f.showMoorings=!f.showMoorings},A=()=>{f.showMarinas=!f.showMarinas},R=z=>{z&&f.setZoomLocation(z)};return(z,G)=>(ri(),hi("aside",{id:"default-sidebar",class:Xo(["absolute top-69 left-0 z-40 w-full sm:w-[25rem] h-screen shadow-lg border-solid transition-transform sm:translate-x-0",{"-translate-x-full":!wr(v).toggleNav,"-translate-x-0":wr(v).toggleNav}]),"aria-label":"Sidebar"},[He("div",Wk,[He("div",null,[He("div",Xk,[He("label",Kk,[Yk,He("input",{type:"checkbox",value:"",class:"sr-only peer",checked:wr(f).showMoorings,onClick:b},null,8,Jk),Qk])]),He("div",eB,[He("label",tB,[iB,He("input",{type:"checkbox",value:"",class:"sr-only peer",checked:wr(f).showMarinas,onClick:A},null,8,rB),nB])]),wr(f).savedLocations.length>0?(ri(),hi("div",sB,[oB,(ri(!0),hi(Gr,null,Ko(wr(f).savedLocations,o=>(ri(),$c(Hk,{key:o.id,location:o,onClick:c0(Y=>R(o),["self"]),onZoomToLocation:R},null,8,["location","onClick"]))),128))])):Xr("",!0)]),aB])],2))}}),cB=qf(lB,[["__scopeId","data-v-7af29514"]]),uB={class:"flex-1 min-h-0 h-[calc(100vh-69px)] w-full ml-0 sm:ml-[25rem] sm:w-[calc(100vw-25rem)]"},hB={key:0,class:"overlay"},dB=He("h1",null,"Loading...",-1),fB=He("div",{class:"loading"},[He("span"),He("span"),He("span")],-1),pB=[dB,fB],mB=is({__name:"Home",setup(l){const f=Ol(),v=()=>{({x:window.scrollX||document.documentElement.scrollLeft||document.body.scrollLeft,y:window.scrollY||document.documentElement.scrollTop||document.body.scrollTop}).y!==0&&(window.scrollY=0,document.documentElement.scrollTop=0,document.body.scrollTop)};return bo(()=>{window.addEventListener("scroll",v)}),Gf(()=>{window.removeEventListener("scroll",v)}),(b,A)=>(ri(),hi(Gr,null,[Cr(jO),Cr(cB),He("main",null,[He("div",uB,[wr(f).mapLoaded?Xr("",!0):(ri(),hi("div",hB,pB)),Cr($k)])])],64))}}),_B={key:0,class:"sortBox shadow-lg"},gB={class:"header"},yB=is({__name:"SortBox",props:{title:{},open:{type:Boolean}},emits:["close"],setup(l,{emit:f}){const v=l,b=f,A=()=>{b("close")};return(R,z)=>v.open?(ri(),hi("div",_B,[He("div",gB,[He("h1",null,Nr(v.title),1),He("span",{class:"close",onClick:A},"✗")]),Bs(R.$slots,"default")])):Xr("",!0)}}),vB={key:0,class:"filterBox shadow-lg"},xB=He("h1",null,"Filter By",-1),bB={style:{"margin-bottom":"200px"}},wB=He("legend",{class:""},"Marinas with these services:",-1),TB=["id","value","checked","onClick"],EB=["for"],SB={id:"showResults"},MB=is({__name:"FilterBox",props:{open:{type:Boolean}},emits:["close"],setup(l,{emit:f}){const v=new Hf,b=Xc(),A=l;Bi(!1);const R=Bi(),z=async ie=>{var Ee;const K=b.serviceFilterOptions.find(Ue=>Ue.serviceType.key===ie);K.active=!K.active;let de=(Ee=b.serviceFilterOptions)==null?void 0:Ee.filter(Ue=>Ue.active).map(Ue=>Ue.serviceType.key);console.log(de),b.serviceSearchValue,de.length==0&&(de=void 0);const ce={name:b.marinaSearchValue??void 0,searchCoordinates:b.searchLocationCoordinatesValue??void 0,searchDistance:b.searchRadiusValue,userCoordinates:b.userLocation??void 0,serviceTypes:de??void 0,limit:void 0,offset:0};console.warn(ce);try{const Ue=await v.dataMarinasSearchGet(ce);b.marinaSearchResults=Ue,console.log(b.marinaSearchResults),R.value=b.marinaSearchResults.length}catch(Ue){if(Ue.response&&Ue.response.status===404){b.marinaSearchResults=[],R.value=0;return}console.error("Search error: ",Ue),alert("search error");return}},G=async()=>{var de,ce;(de=b.serviceFilterOptions)==null||de.forEach(Ee=>Ee.active=!1);let ie=(ce=b.serviceFilterOptions)==null?void 0:ce.filter(Ee=>Ee.active).map(Ee=>Ee.serviceType.key);console.log(ie),b.serviceSearchValue,ie.length==0&&(ie=void 0);const K={name:b.marinaSearchValue??void 0,searchCoordinates:b.searchLocationCoordinatesValue??void 0,searchDistance:b.searchRadiusValue??4,userCoordinates:b.userLocation??void 0,serviceTypes:ie??void 0,limit:void 0,offset:0};console.warn(K.serviceTypes);try{const Ee=await v.dataMarinasSearchGet(K);b.marinaSearchResults=Ee,console.log(b.marinaSearchResults),R.value=b.marinaSearchResults.length}catch(Ee){if(Ee.response&&Ee.response.status===404){b.marinaSearchResults=[],R.value=0;return}console.error("Search error: ",Ee),alert("search error");return}},o=f,Y=()=>{o("close")};return bo(()=>{var ie;R.value=(ie=b.marinaSearchResults)==null?void 0:ie.length}),PE(()=>{var ie;R.value=(ie=b.marinaSearchResults)==null?void 0:ie.length}),(ie,K)=>A.open?Tl((ri(),hi("div",vB,[He("div",null,[He("div",{class:"header"},[He("span",{class:"close",onClick:Y},"✗"),xB,He("span",{class:"reset text-blue-700",onClick:G},"Clear filters")]),He("fieldset",bB,[wB,(ri(!0),hi(Gr,null,Ko(wr(b).serviceFilterOptions,de=>(ri(),hi("div",null,[He("input",{type:"checkbox",id:de.serviceType.key,name:"filter-services",value:de.serviceType.value,checked:de.active,onClick:ce=>z(de.serviceType.key)},null,8,TB),He("label",{for:de.serviceType.key},Nr(de.serviceType.value),9,EB)]))),256))])]),He("div",SB,[He("div",null,[He("span",null,Nr(R.value)+" matching results",1),He("button",{class:"bg-blue-700 text-white mt-2",onClick:Y},"Show Results")])])],512)),[[Nf,A.open]]):Xr("",!0)}}),AB={id:"searchContainer"},IB={id:"searchTerm"},CB={class:"mt-3"},PB=is({__name:"SearchBar",emits:["back"],setup(l,{emit:f}){const v=Xc(),b=Ol(),A=f,R=()=>{A("back")};return(z,G)=>(ri(),hi("div",AB,[He("div",{id:"searchTermContainer",class:Xo({"flex justify-between":!wr(b).mapLoaded})},[He("div",IB,[He("span",{class:"back",onClick:R}," ← "),He("span",CB,Nr(wr(v).searchLocationValue),1)]),Bs(z.$slots,"default",{},void 0,!0)],2)]))}}),eM=qf(PB,[["__scopeId","data-v-588799d4"]]),RB={key:0,id:"searchForm",class:"shadow-lg"},LB={class:"flex justify-between text-lg"},DB=He("h3",{class:"mb-2"},"Edit your search",-1),OB=He("span",null,null,-1),zB={class:"bg-blue-700",style:{padding:"15px","padding-top":"0px",height:"80px"}},kB={id:"searchOptions",class:"shadow-lg p-4"},BB={class:"mt-6 flex justify-between"},FB={key:0,id:"searchResults"},NB={class:"bg-white border border-gray-500 rounded-lg shadow-md mb-4 mt-2"},VB=He("a",{href:"#"},[He("img",{class:"rounded-t-lg",src:"",alt:""})],-1),UB={class:"p-5"},jB={href:"#"},GB={class:"mb-2 text-2xl font-bold tracking-tight text-gray-900"},$B={style:{"list-style":"inside","margin-bottom":"15px"}},qB={key:0},ZB=["href"],HB={key:1},WB={key:2},XB={key:3},KB={key:4},YB=He("svg",{class:"rtl:rotate-180 w-3.5 h-3.5 ms-2","aria-hidden":"true",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 14 10"},[He("path",{stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M1 5h12m0 0L9 1m4 4L9 9"})],-1),JB={key:1,id:"searchResults"},QB=He("legend",{class:"sr-only"},"Select an option to sort the results:",-1),eF=["id","value","checked","onClick"],tF=["for"],iF=He("h1",null,"test",-1),rF=is({__name:"Results",setup(l){const f=Zf(),v=Xc();Bi(!1);const b=Bi(!1),A=Bi(!1),R=Bi(!1),z=()=>{b.value=!0},G=()=>{A.value=!0,R.value=!1},o=()=>{A.value=!1},Y=()=>{R.value=!0,A.value=!1},ie=()=>{R.value=!1};function K(){f.push("/")}return bo(async()=>{var de;v.setSortOption(1),await v.resetServiceFilterOptions(),v.setServiceFilterOptionActive((de=v==null?void 0:v.serviceSearchValue)==null?void 0:de.key)}),fE(()=>{v.userLocation&&(v.sortOptions.find(de=>de.name==="Distance").enabled=!0)}),(de,ce)=>{var Ue,$e;const Ee=L0("router-link");return ri(),hi(Gr,null,[Cr(qc,{name:"down"},{default:go(()=>[b.value?(ri(),hi("div",RB,[He("div",LB,[He("span",{class:"hover:cursor-pointer",onClick:ce[0]||(ce[0]=et=>b.value=!1)},"✗"),DB,OB]),Cr(q0,{"search-has-error":!1,"search-error-msg":void 0,onSearched:ce[1]||(ce[1]=et=>b.value=!1)})])):Xr("",!0)]),_:1}),Tl(He("div",{id:"overlay",onClick:ce[2]||(ce[2]=et=>b.value=!1)},null,512),[[Nf,b.value]]),He("div",zB,[Cr(eM,{onBack:K,onClick:z})]),He("div",kB,[He("div",BB,[He("span",{onClick:G}," ↑ ↓ Sort "),He("span",{onClick:Y}," ⚲ Filter "),He("span",{onClick:ce[3]||(ce[3]=et=>wr(f).push("/results/map"))}," ≷ Map ")])]),((Ue=wr(v).marinaSearchResults)==null?void 0:Ue.length)>0?(ri(),hi("div",FB,[He("span",null,Nr(($e=wr(v).marinaSearchResults)==null?void 0:$e.length)+" results",1),(ri(!0),hi(Gr,null,Ko(wr(v).marinaSearchResults,et=>{var ht;return ri(),hi("div",NB,[VB,He("div",UB,[He("a",jB,[He("h5",GB,Nr(et.name),1)]),He("ul",$B,[et.website?(ri(),hi("li",qB,[He("a",{href:et.website,class:"text-blue-700",target:"_blank"},Nr(et.website),9,ZB)])):Xr("",!0),et.phoneNumber?(ri(),hi("li",HB,"Phone: "+Nr(et.phoneNumber),1)):Xr("",!0),et.canalName?(ri(),hi("li",WB,"Canal: "+Nr(et.canalName),1)):Xr("",!0),He("li",null,Nr((ht=et.services)==null?void 0:ht.length)+" service(s)",1),et.distanceFromUser>0?(ri(),hi("li",XB,"Distance from you: "+Nr(et.distanceFromUser.toFixed(2))+" miles",1)):Xr("",!0),et.distanceFromSearch>0?(ri(),hi("li",KB,"Distance from search: "+Nr(et.distanceFromSearch.toFixed(2))+" miles",1)):Xr("",!0)]),Cr(Ee,{to:{name:"Marina",params:{id:et.id}},class:"inline-flex items-center px-3 py-2 text-sm font-medium text-center text-white bg-blue-700 rounded-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300"},{default:go(()=>[Hc(" View more "),YB]),_:2},1032,["to"])])])}),256))])):(ri(),hi("div",JB," No results found, try adjusting your search ")),Cr(qc,{name:"slide"},{default:go(()=>[Cr(yB,{open:A.value,title:"Sort By",onClose:o},{default:go(()=>[He("fieldset",null,[QB,(ri(!0),hi(Gr,null,Ko(wr(v).sortOptions,et=>(ri(),hi(Gr,{key:et.id},[et.enabled===!0?(ri(),hi("div",{key:0,onClick:o},[He("input",{type:"radio",id:et.id.toString(),name:"filter",value:et.id,checked:et.active,onClick:ht=>wr(v).setSortOption(et.id)},null,8,eF),He("label",{for:et.id.toString()},Nr(et.name),9,tF)])):Xr("",!0)],64))),128))])]),_:1},8,["open"])]),_:1}),Cr(qc,{name:"slide"},{default:go(()=>[Cr(MB,{open:R.value,onClose:ie},{default:go(()=>[iF]),_:1},8,["open"])]),_:1})],64)}}}),nF={class:"flex-1 min-h-0 h-[calc(100vh)] w-full ml-0 sm:w-[calc(100vw)]",style:{overflow:"hidden"}},sF={key:0,id:"searchForm",class:"shadow-lg"},oF={class:"flex justify-between text-lg"},aF=He("h3",{class:"mb-2"},"Edit your search",-1),lF=He("span",null,null,-1),cF={key:0,class:"mt-2 mr-9",style:{}},uF=He("div",{class:"loading"},[He("span"),He("span"),He("span")],-1),hF=[uF],dF=is({__name:"ResultsMap",setup(l){const f=new oS,v=new Hf,b=Xc(),A=Zf(),R=Ol();D_(),Bi(null),Bn.accessToken="pk.eyJ1IjoibXItdGhvbWFzLXJvZ2VycyIsImEiOiJjbHV4MmJhZ2kwbW5lMmpxcmR4dmYyd3JpIn0.T4Knhl9eC-Nh-JNm2YQ3vw";const z=Bi(null),G=Bi(!1),o=()=>{G.value=!0};async function Y(K){const de={geoJsonId:K.geoJsonId};let ce;try{ce=await v.dataGeoJsonIdGet(de)}catch(Ee){console.error(Ee)}console.log("The marian:",ce),new Bn.Popup({offset:[0,-15]}).setLngLat(K.coordinates).setHTML(`<span><h3>${ce.name}</h3><a href="${ce.website}" target="_blank">Website</a><br/><a href="/marina/${ce.id}" class="save">View Location</button></span>`).addTo(z.value)}function ie(K){return new Promise((de,ce)=>{console.log("fly to coordinates",K),console.log("map status in fly to: ",z.value?"true":"HELP, NO MAP"),z.value&&K?(console.log(K),z.value.flyTo({center:K,zoom:15}),z.value.once("moveend",Ee=>{de()})):ce("No init map or no provided coordinates")})}return bo(async()=>{var K,de;if(document.getElementsByTagName("body")[0].style.overflow="hidden",R.getDataSets(),R.mapLoaded=!1,z.value){z.value=new Bn.Map({container:z.value,style:"mapbox://styles/mapbox/streets-v12",center:[-1.474008,52.155133],zoom:6});const Ee={ids:(K=b.marinaSearchResults)==null?void 0:K.map($e=>$e.geoJsonId)};console.log(Ee);const Ue=await f.geoJsonGeoJsonByIdsGet(Ee);console.log("geoData",Ue),z.value.on("load",()=>{var $e;z.value.addSource("marinas",{type:"geojson",data:Ue});for(const et of Ue.features){const ht=document.createElement("div");ht.id=`marker-${($e=et.properties)==null?void 0:$e.mooringPinId}`,ht.className="marker",new Bn.Marker(ht,{offset:[0,-23]}).setLngLat(et.geometry.coordinates).addTo(z.value),ht.addEventListener("click",Xe=>{var _i,ai,Ie;ie((_i=et.geometry)==null?void 0:_i.coordinates);const $t={coordinates:(ai=et.geometry)==null?void 0:ai.coordinates,geoJsonId:et.id};Y($t);const kt=document.getElementsByClassName("active");Xe.stopPropagation(),kt[0]&&kt[0].classList.remove("active");const At=document.getElementById(`listing-${(Ie=et.properties)==null?void 0:Ie.mooringPinId}`);At==null||At.classList.add("active")})}R.mapLoaded=!0}),z.value.on("move",()=>{(z.value===null||z.value===void 0)&&console.warn("MAP IS NULL")}),(de=b.marinaSearchResults)==null||de.forEach($e=>{}),z.value.addControl(new Bn.NavigationControl,"bottom-right"),z.value.addControl(new Bn.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!1}),"bottom-right")}}),Gf(()=>{document.getElementsByTagName("body")[0].style.overflow="scroll",z.value&&z.value.remove()}),(K,de)=>(ri(),hi("div",nF,[Cr(qc,{name:"down"},{default:go(()=>[G.value?(ri(),hi("div",sF,[He("div",oF,[He("span",{class:"hover:cursor-pointer",onClick:de[0]||(de[0]=ce=>G.value=!1)},"✗"),aF,lF]),Cr(q0,{"search-has-error":!1,"search-error-msg":void 0,onSearched:de[1]||(de[1]=ce=>G.value=!1)})])):Xr("",!0)]),_:1}),Tl(He("div",{id:"overlay",onClick:de[2]||(de[2]=ce=>G.value=!1)},null,512),[[Nf,G.value]]),Cr(eM,{style:{position:"absolute","z-index":"1",width:"100%",padding:"20px","padding-top":"0px"},onBack:de[3]||(de[3]=ce=>wr(A).push("/results")),onClick:o},{default:go(()=>[wr(R).mapLoaded?Xr("",!0):(ri(),hi("span",cF,hF))]),_:1}),He("div",{ref_key:"map",ref:z,class:"map-container w-1/1 h-full",id:"map-container"},null,512)]))}}),fF="modulepreload",pF=function(l){return"/"+l},TT={},br=function(f,v,b){let A=Promise.resolve();if(v&&v.length>0){const R=document.getElementsByTagName("link"),z=document.querySelector("meta[property=csp-nonce]"),G=(z==null?void 0:z.nonce)||(z==null?void 0:z.getAttribute("nonce"));A=Promise.all(v.map(o=>{if(o=pF(o),o in TT)return;TT[o]=!0;const Y=o.endsWith(".css"),ie=Y?'[rel="stylesheet"]':"";if(!!b)for(let ce=R.length-1;ce>=0;ce--){const Ee=R[ce];if(Ee.href===o&&(!Y||Ee.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${o}"]${ie}`))return;const de=document.createElement("link");if(de.rel=Y?"stylesheet":fF,Y||(de.as="script",de.crossOrigin=""),de.href=o,G&&de.setAttribute("nonce",G),document.head.appendChild(de),Y)return new Promise((ce,Ee)=>{de.addEventListener("load",ce),de.addEventListener("error",()=>Ee(new Error(`Unable to preload CSS for ${o}`)))})}))}return A.then(()=>f()).catch(R=>{const z=new Event("vite:preloadError",{cancelable:!0});if(z.payload=R,window.dispatchEvent(z),!z.defaultPrevented)throw R})},mF={class:"bg-blue-700",style:{padding:"25px",height:"80px"}},_F={class:"flex justify-between text-white"},gF={class:"text-xl w-full",style:{"text-align":"center"}},yF=He("span",{class:"w-20"},null,-1),vF={key:0,id:"serviceIcons",class:"shadow-lg border"},xF=["src","alt","title"],bF={id:"marina-details"},wF={class:"marina-heading flex justify-between"},TF={class:"font-bold text-lg mb-2"},EF=["href"],SF={key:1,href:"#",class:"text-gray-600 hover:cursor-not-allowed"},MF=He("hr",null,null,-1),AF={class:"marina-map-conatiner"},IF=He("hr",null,null,-1),CF={key:0,id:"marina-notes",class:"mb-2 p-4 border-4 rounded-lg"},PF=He("h4",{class:"mr-2 font-medium"},"Address:",-1),RF={key:0},LF={key:1,id:"marina-notes",class:"mb-2 p-4 border-4 rounded-lg"},DF=He("h4",{class:"mr-2 font-medium"},"Phone Number:",-1),OF={style:{display:"inline-block"},class:"text-base"},zF={key:2,id:"marina-notes",class:"mb-2 p-4 border-4 rounded-lg"},kF=He("h4",{class:"mr-2 font-medium"},"Services:",-1),BF={style:{"list-style":"inside","margin-bottom":"15px"}},FF=is({__name:"Marina",props:{id:{type:String,required:!0}},setup(l){const f=Xc();Bn.accessToken="pk.eyJ1IjoibXItdGhvbWFzLXJvZ2VycyIsImEiOiJjbHV4MmJhZ2kwbW5lMmpxcmR4dmYyd3JpIn0.T4Knhl9eC-Nh-JNm2YQ3vw";const v=Bi(null),b=Ol();console.log(Object.assign({"../assets/icons/cp-bar.svg":()=>br(()=>import("./cp-bar-BXdQxMvB.js"),[]),"../assets/icons/cp-blacking.svg":()=>br(()=>import("./cp-blacking-D2KPbFpr.js"),[]),"../assets/icons/cp-boatanddockyard.svg":()=>br(()=>import("./cp-boatanddockyard-15P5RN93.js"),[]),"../assets/icons/cp-boatconstruction.svg":()=>br(()=>import("./cp-boatconstruction-B7pBSd_9.js"),[]),"../assets/icons/cp-boathire.svg":()=>br(()=>import("./cp-boathire-CKwHeFAF.js"),[]),"../assets/icons/cp-boatmail.svg":()=>br(()=>import("./cp-boatmail-DrFcMviB.js"),[]),"../assets/icons/cp-boatmaintenance.svg":()=>br(()=>import("./cp-boatmaintenance-BzmZkgfl.js"),[]),"../assets/icons/cp-boatstorage.svg":()=>br(()=>import("./cp-boatstorage-B0awKXgY.js"),[]),"../assets/icons/cp-boatyard.svg":()=>br(()=>import("./cp-boatyard-CyThSHIA.js"),[]),"../assets/icons/cp-cafe.svg":()=>br(()=>import("./cp-cafe-CxAJ6dCO.js"),[]),"../assets/icons/cp-calorgas.svg":()=>br(()=>import("./cp-calorgas-31NNyauP.js"),[]),"../assets/icons/cp-chandlery.svg":()=>br(()=>import("./cp-chandlery-DJd-LEux.js"),[]),"../assets/icons/cp-cleaning.svg":()=>br(()=>import("./cp-cleaning-Ct75Lq7q.js"),[]),"../assets/icons/cp-clubsocial.svg":()=>br(()=>import("./cp-clubsocial-Dhx6NvBp.js"),[]),"../assets/icons/cp-coal.svg":()=>br(()=>import("./cp-coal-2YjSeqVO.js"),[]),"../assets/icons/cp-composting.svg":()=>br(()=>import("./cp-composting-C0zSYpYd.js"),[]),"../assets/icons/cp-diesel.svg":()=>br(()=>import("./cp-diesel-Cuo9GKAV.js"),[]),"../assets/icons/cp-elsan.svg":()=>br(()=>import("./cp-elsan-CTF8_1El.js"),[]),"../assets/icons/cp-evcharging.svg":()=>br(()=>import("./cp-evcharging-B6rk3Thi.js"),[]),"../assets/icons/cp-fuelutilities.svg":()=>br(()=>import("./cp-fuelutilities-CvSlPvK1.js"),[]),"../assets/icons/cp-hardstanding.svg":()=>br(()=>import("./cp-hardstanding-BNou5xmP.js"),[]),"../assets/icons/cp-laundry.svg":()=>br(()=>import("./cp-laundry-bwdrQt7Y.js"),[]),"../assets/icons/cp-liftingcraning.svg":()=>br(()=>import("./cp-liftingcraning-CUwALbyI.js"),[]),"../assets/icons/cp-mooring.svg":()=>br(()=>import("./cp-mooring-L6yDVnem.js"),[]),"../assets/icons/cp-parking.svg":()=>br(()=>import("./cp-parking-CPGXjO2W.js"),[]),"../assets/icons/cp-petrol.svg":()=>br(()=>import("./cp-petrol-Cb4eJ8lh.js"),[]),"../assets/icons/cp-pumpout.svg":()=>br(()=>import("./cp-pumpout-DbSwamPo.js"),[]),"../assets/icons/cp-rubbish.svg":()=>br(()=>import("./cp-rubbish-BPQmlXN5.js"),[]),"../assets/icons/cp-sanstation.svg":()=>br(()=>import("./cp-sanstation-DyNjm5ig.js"),[]),"../assets/icons/cp-showers.svg":()=>br(()=>import("./cp-showers-Dls3UPsn.js"),[]),"../assets/icons/cp-slipway.svg":()=>br(()=>import("./cp-slipway-CUM-ELCb.js"),[]),"../assets/icons/cp-toilets.svg":()=>br(()=>import("./cp-toilets-BjjxD0ve.js"),[]),"../assets/icons/cp-water.svg":()=>br(()=>import("./cp-water-B-CFA3v0.js"),[]),"../assets/icons/cp-wifi.svg":()=>br(()=>import("./cp-wifi-BIpky8B_.js"),[])}));const R=Bi(),z=Zf(),G=new Hf,o=new oS,Y=Bi(!0),ie=l,K=Bi(),de=()=>{if(f.searchLocationValue==null){z.push("/");return}z.push("/Results")};return bo(async()=>{var $e,et;const ce={id:ie.id};K.value=await G.dataMarinaIdGet(ce),R.value=(($e=K.value.services)==null?void 0:$e.map(ht=>{var Xe,$t,kt;return{name:((Xe=ht.serviceType)==null?void 0:Xe.value)??"",path:`/src/assets/icons/cp-${(kt=($t=ht.serviceType)==null?void 0:$t.iconKey)==null?void 0:kt.toLowerCase()}.svg`??""}}))||[],console.log(R.value);const Ee={id:K.value.geoJsonId};console.log(Ee),console.warn(K.value.geoJsonId);const Ue=await o.geoJsonGeoJsonByIdGet(Ee);if(console.log("location",Ue),b.getDataSets(),b.mapLoaded=!1,v.value){const ht=(et=Ue.features[0].geometry)==null?void 0:et.coordinates;v.value=new Bn.Map({container:v.value,style:"mapbox://styles/mapbox/streets-v12",center:ht,zoom:14.2}),new Bn.Marker({color:"#1d4ed8"}).setLngLat(ht).addTo(v.value),v.value.on("load",()=>{b.mapLoaded=!0}),v.value.on("move",()=>{(v.value===null||v.value===void 0)&&console.warn("MAP IS NULL")}),v.value.addControl(new Bn.NavigationControl,"bottom-right"),v.value.addControl(new Bn.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!1}))}Y.value=!1}),(ce,Ee)=>{var Ue,$e,et,ht,Xe,$t,kt,At,_i,ai,Ie,Ti,Wi,dt,Ei,Dr;return ri(),hi(Gr,null,[He("div",mF,[He("div",_F,[He("span",{class:"back w-20",onClick:de}," ← "),He("span",gF,Nr((($e=(Ue=K.value)==null?void 0:Ue.type)==null?void 0:$e.toLowerCase().charAt(0).toUpperCase())+((ht=(et=K.value)==null?void 0:et.type)==null?void 0:ht.toLowerCase().slice(1))),1),yF])]),((Xe=R.value)==null?void 0:Xe.length)>0?(ri(),hi("div",vF,[He("div",null,[(ri(!0),hi(Gr,null,Ko(R.value,tt=>(ri(),hi("span",null,[He("img",{src:tt.path,alt:tt.name,title:tt.name,class:""},null,8,xF)]))),256))])])):Xr("",!0),He("div",null,[He("main",bF,[He("section",wF,[He("h1",TF,Nr(($t=K.value)==null?void 0:$t.name),1),((kt=K.value)==null?void 0:kt.website)!=null?(ri(),hi("a",{key:0,href:(At=K.value)==null?void 0:At.website,target:"_blank",class:"text-blue-700"},"Website",8,EF)):(ri(),hi("a",SF,"Website"))]),MF,He("div",AF,[He("div",{ref_key:"map",ref:v,class:"map-container w-1/1 h-full",id:"map-container"},null,512)]),IF,He("section",null,[((_i=K.value)==null?void 0:_i.address)!=null?(ri(),hi("div",CF,[PF,((ai=K.value)==null?void 0:ai.address)!=null?(ri(),hi("p",RF,Nr((Ie=K.value)==null?void 0:Ie.address),1)):Xr("",!0)])):Xr("",!0),((Ti=K.value)==null?void 0:Ti.phoneNumber)!=null?(ri(),hi("div",LF,[DF,He("p",OF,Nr((Wi=K.value)==null?void 0:Wi.phoneNumber),1)])):Xr("",!0),((Ei=(dt=K.value)==null?void 0:dt.services)==null?void 0:Ei.length)>0?(ri(),hi("div",zF,[kF,He("ul",BF,[(ri(!0),hi(Gr,null,Ko((Dr=K.value)==null?void 0:Dr.services,tt=>{var Ri;return ri(),hi("li",{key:tt.id},Nr((Ri=tt.serviceType)==null?void 0:Ri.value),1)}),128))])])):Xr("",!0)])])])],64)}}}),NF=CD({history:rD(""),routes:[{path:"/old",name:"Default",component:mB},{path:"/",name:"Experimental",component:DO},{path:"/results",name:"Results",component:rF},{path:"/results/map",name:"ResultsMap",component:dF},{path:"/marina/:id",name:"Marina",component:FF,props:!0}]});var VF=Object.defineProperty,UF=Object.defineProperties,jF=Object.getOwnPropertyDescriptors,ET=Object.getOwnPropertySymbols,GF=Object.prototype.hasOwnProperty,$F=Object.prototype.propertyIsEnumerable,ST=(l,f,v)=>f in l?VF(l,f,{enumerable:!0,configurable:!0,writable:!0,value:v}):l[f]=v,th=(l,f)=>{for(var v in f||(f={}))GF.call(f,v)&&ST(l,v,f[v]);if(ET)for(var v of ET(f))$F.call(f,v)&&ST(l,v,f[v]);return l},MT=(l,f)=>UF(l,jF(f));const qF={props:{autoscroll:{type:Boolean,default:!0}},watch:{typeAheadPointer(){this.autoscroll&&this.maybeAdjustScroll()},open(l){this.autoscroll&&l&&this.$nextTick(()=>this.maybeAdjustScroll())}},methods:{maybeAdjustScroll(){var l;const f=((l=this.$refs.dropdownMenu)==null?void 0:l.children[this.typeAheadPointer])||!1;if(f){const v=this.getDropdownViewport(),{top:b,bottom:A,height:R}=f.getBoundingClientRect();if(b<v.top)return this.$refs.dropdownMenu.scrollTop=f.offsetTop;if(A>v.bottom)return this.$refs.dropdownMenu.scrollTop=f.offsetTop-(v.height-R)}},getDropdownViewport(){return this.$refs.dropdownMenu?this.$refs.dropdownMenu.getBoundingClientRect():{height:0,top:0,bottom:0}}}},ZF={data(){return{typeAheadPointer:-1}},watch:{filteredOptions(){for(let l=0;l<this.filteredOptions.length;l++)if(this.selectable(this.filteredOptions[l])){this.typeAheadPointer=l;break}},open(l){l&&this.typeAheadToLastSelected()},selectedValue(){this.open&&this.typeAheadToLastSelected()}},methods:{typeAheadUp(){for(let l=this.typeAheadPointer-1;l>=0;l--)if(this.selectable(this.filteredOptions[l])){this.typeAheadPointer=l;break}},typeAheadDown(){for(let l=this.typeAheadPointer+1;l<this.filteredOptions.length;l++)if(this.selectable(this.filteredOptions[l])){this.typeAheadPointer=l;break}},typeAheadSelect(){const l=this.filteredOptions[this.typeAheadPointer];l&&this.selectable(l)&&this.select(l)},typeAheadToLastSelected(){this.typeAheadPointer=this.selectedValue.length!==0?this.filteredOptions.indexOf(this.selectedValue[this.selectedValue.length-1]):-1}}},HF={props:{loading:{type:Boolean,default:!1}},data(){return{mutableLoading:!1}},watch:{search(){this.$emit("search",this.search,this.toggleLoading)},loading(l){this.mutableLoading=l}},methods:{toggleLoading(l=null){return l==null?this.mutableLoading=!this.mutableLoading:this.mutableLoading=l}}},K0=(l,f)=>{const v=l.__vccOpts||l;for(const[b,A]of f)v[b]=A;return v},WF={},XF={xmlns:"http://www.w3.org/2000/svg",width:"10",height:"10"},KF=He("path",{d:"M6.895455 5l2.842897-2.842898c.348864-.348863.348864-.914488 0-1.263636L9.106534.261648c-.348864-.348864-.914489-.348864-1.263636 0L5 3.104545 2.157102.261648c-.348863-.348864-.914488-.348864-1.263636 0L.261648.893466c-.348864.348864-.348864.914489 0 1.263636L3.104545 5 .261648 7.842898c-.348864.348863-.348864.914488 0 1.263636l.631818.631818c.348864.348864.914773.348864 1.263636 0L5 6.895455l2.842898 2.842897c.348863.348864.914772.348864 1.263636 0l.631818-.631818c.348864-.348864.348864-.914489 0-1.263636L6.895455 5z"},null,-1),YF=[KF];function JF(l,f){return ri(),hi("svg",XF,YF)}const QF=K0(WF,[["render",JF]]),e4={},t4={xmlns:"http://www.w3.org/2000/svg",width:"14",height:"10"},i4=He("path",{d:"M9.211364 7.59931l4.48338-4.867229c.407008-.441854.407008-1.158247 0-1.60046l-.73712-.80023c-.407008-.441854-1.066904-.441854-1.474243 0L7 5.198617 2.51662.33139c-.407008-.441853-1.066904-.441853-1.474243 0l-.737121.80023c-.407008.441854-.407008 1.158248 0 1.600461l4.48338 4.867228L7 10l2.211364-2.40069z"},null,-1),r4=[i4];function n4(l,f){return ri(),hi("svg",t4,r4)}const s4=K0(e4,[["render",n4]]),AT={Deselect:QF,OpenIndicator:s4},o4={mounted(l,{instance:f}){if(f.appendToBody){const{height:v,top:b,left:A,width:R}=f.$refs.toggle.getBoundingClientRect();let z=window.scrollX||window.pageXOffset,G=window.scrollY||window.pageYOffset;l.unbindPosition=f.calculatePosition(l,f,{width:R+"px",left:z+A+"px",top:G+b+v+"px"}),document.body.appendChild(l)}},unmounted(l,{instance:f}){f.appendToBody&&(l.unbindPosition&&typeof l.unbindPosition=="function"&&l.unbindPosition(),l.parentNode&&l.parentNode.removeChild(l))}};function a4(l){const f={};return Object.keys(l).sort().forEach(v=>{f[v]=l[v]}),JSON.stringify(f)}let l4=0;function c4(){return++l4}const u4={components:th({},AT),directives:{appendToBody:o4},mixins:[qF,ZF,HF],compatConfig:{MODE:3},emits:["open","close","update:modelValue","search","search:compositionstart","search:compositionend","search:keydown","search:blur","search:focus","search:input","option:created","option:selecting","option:selected","option:deselecting","option:deselected"],props:{modelValue:{},components:{type:Object,default:()=>({})},options:{type:Array,default(){return[]}},disabled:{type:Boolean,default:!1},clearable:{type:Boolean,default:!0},deselectFromDropdown:{type:Boolean,default:!1},searchable:{type:Boolean,default:!0},multiple:{type:Boolean,default:!1},placeholder:{type:String,default:""},transition:{type:String,default:"vs__fade"},clearSearchOnSelect:{type:Boolean,default:!0},closeOnSelect:{type:Boolean,default:!0},label:{type:String,default:"label"},autocomplete:{type:String,default:"off"},reduce:{type:Function,default:l=>l},selectable:{type:Function,default:l=>!0},getOptionLabel:{type:Function,default(l){return typeof l=="object"?l.hasOwnProperty(this.label)?l[this.label]:console.warn(`[vue-select warn]: Label key "option.${this.label}" does not exist in options object ${JSON.stringify(l)}.
-https://vue-select.org/api/props.html#getoptionlabel`):l}},getOptionKey:{type:Function,default(l){if(typeof l!="object")return l;try{return l.hasOwnProperty("id")?l.id:a4(l)}catch(f){return console.warn(`[vue-select warn]: Could not stringify this option to generate unique key. Please provide'getOptionKey' prop to return a unique key for each option.
-https://vue-select.org/api/props.html#getoptionkey`,l,f)}}},onTab:{type:Function,default:function(){this.selectOnTab&&!this.isComposing&&this.typeAheadSelect()}},taggable:{type:Boolean,default:!1},tabindex:{type:Number,default:null},pushTags:{type:Boolean,default:!1},filterable:{type:Boolean,default:!0},filterBy:{type:Function,default(l,f,v){return(f||"").toLocaleLowerCase().indexOf(v.toLocaleLowerCase())>-1}},filter:{type:Function,default(l,f){return l.filter(v=>{let b=this.getOptionLabel(v);return typeof b=="number"&&(b=b.toString()),this.filterBy(v,b,f)})}},createOption:{type:Function,default(l){return typeof this.optionList[0]=="object"?{[this.label]:l}:l}},resetOnOptionsChange:{default:!1,validator:l=>["function","boolean"].includes(typeof l)},clearSearchOnBlur:{type:Function,default:function({clearSearchOnSelect:l,multiple:f}){return l&&!f}},noDrop:{type:Boolean,default:!1},inputId:{type:String},dir:{type:String,default:"auto"},selectOnTab:{type:Boolean,default:!1},selectOnKeyCodes:{type:Array,default:()=>[13]},searchInputQuerySelector:{type:String,default:"[type=search]"},mapKeydown:{type:Function,default:(l,f)=>l},appendToBody:{type:Boolean,default:!1},calculatePosition:{type:Function,default(l,f,{width:v,top:b,left:A}){l.style.top=b,l.style.left=A,l.style.width=v}},dropdownShouldOpen:{type:Function,default({noDrop:l,open:f,mutableLoading:v}){return l?!1:f&&!v}},uid:{type:[String,Number],default:()=>c4()}},data(){return{search:"",open:!1,isComposing:!1,pushedTags:[],_value:[],deselectButtons:[]}},computed:{isReducingValues(){return this.$props.reduce!==this.$options.props.reduce.default},isTrackingValues(){return typeof this.modelValue>"u"||this.isReducingValues},selectedValue(){let l=this.modelValue;return this.isTrackingValues&&(l=this.$data._value),l!=null&&l!==""?[].concat(l):[]},optionList(){return this.options.concat(this.pushTags?this.pushedTags:[])},searchEl(){return this.$slots.search?this.$refs.selectedOptions.querySelector(this.searchInputQuerySelector):this.$refs.search},scope(){const l={search:this.search,loading:this.loading,searching:this.searching,filteredOptions:this.filteredOptions};return{search:{attributes:th({disabled:this.disabled,placeholder:this.searchPlaceholder,tabindex:this.tabindex,readonly:!this.searchable,id:this.inputId,"aria-autocomplete":"list","aria-labelledby":`vs${this.uid}__combobox`,"aria-controls":`vs${this.uid}__listbox`,ref:"search",type:"search",autocomplete:this.autocomplete,value:this.search},this.dropdownOpen&&this.filteredOptions[this.typeAheadPointer]?{"aria-activedescendant":`vs${this.uid}__option-${this.typeAheadPointer}`}:{}),events:{compositionstart:()=>this.isComposing=!0,compositionend:()=>this.isComposing=!1,keydown:this.onSearchKeyDown,blur:this.onSearchBlur,focus:this.onSearchFocus,input:f=>this.search=f.target.value}},spinner:{loading:this.mutableLoading},noOptions:{search:this.search,loading:this.mutableLoading,searching:this.searching},openIndicator:{attributes:{ref:"openIndicator",role:"presentation",class:"vs__open-indicator"}},listHeader:l,listFooter:l,header:MT(th({},l),{deselect:this.deselect}),footer:MT(th({},l),{deselect:this.deselect})}},childComponents(){return th(th({},AT),this.components)},stateClasses(){return{"vs--open":this.dropdownOpen,"vs--single":!this.multiple,"vs--multiple":this.multiple,"vs--searching":this.searching&&!this.noDrop,"vs--searchable":this.searchable&&!this.noDrop,"vs--unsearchable":!this.searchable,"vs--loading":this.mutableLoading,"vs--disabled":this.disabled}},searching(){return!!this.search},dropdownOpen(){return this.dropdownShouldOpen(this)},searchPlaceholder(){return this.isValueEmpty&&this.placeholder?this.placeholder:void 0},filteredOptions(){const l=[].concat(this.optionList);if(!this.filterable&&!this.taggable)return l;const f=this.search.length?this.filter(l,this.search,this):l;if(this.taggable&&this.search.length){const v=this.createOption(this.search);this.optionExists(v)||f.unshift(v)}return f},isValueEmpty(){return this.selectedValue.length===0},showClearButton(){return!this.multiple&&this.clearable&&!this.open&&!this.isValueEmpty}},watch:{options(l,f){const v=()=>typeof this.resetOnOptionsChange=="function"?this.resetOnOptionsChange(l,f,this.selectedValue):this.resetOnOptionsChange;!this.taggable&&v()&&this.clearSelection(),this.modelValue&&this.isTrackingValues&&this.setInternalValueFromOptions(this.modelValue)},modelValue:{immediate:!0,handler(l){this.isTrackingValues&&this.setInternalValueFromOptions(l)}},multiple(){this.clearSelection()},open(l){this.$emit(l?"open":"close")}},created(){this.mutableLoading=this.loading},methods:{setInternalValueFromOptions(l){Array.isArray(l)?this.$data._value=l.map(f=>this.findOptionFromReducedValue(f)):this.$data._value=this.findOptionFromReducedValue(l)},select(l){this.$emit("option:selecting",l),this.isOptionSelected(l)?this.deselectFromDropdown&&(this.clearable||this.multiple&&this.selectedValue.length>1)&&this.deselect(l):(this.taggable&&!this.optionExists(l)&&(this.$emit("option:created",l),this.pushTag(l)),this.multiple&&(l=this.selectedValue.concat(l)),this.updateValue(l),this.$emit("option:selected",l)),this.onAfterSelect(l)},deselect(l){this.$emit("option:deselecting",l),this.updateValue(this.selectedValue.filter(f=>!this.optionComparator(f,l))),this.$emit("option:deselected",l)},clearSelection(){this.updateValue(this.multiple?[]:null)},onAfterSelect(l){this.closeOnSelect&&(this.open=!this.open,this.searchEl.blur()),this.clearSearchOnSelect&&(this.search="")},updateValue(l){typeof this.modelValue>"u"&&(this.$data._value=l),l!==null&&(Array.isArray(l)?l=l.map(f=>this.reduce(f)):l=this.reduce(l)),this.$emit("update:modelValue",l)},toggleDropdown(l){const f=l.target!==this.searchEl;f&&l.preventDefault();const v=[...this.deselectButtons||[],this.$refs.clearButton];if(this.searchEl===void 0||v.filter(Boolean).some(b=>b.contains(l.target)||b===l.target)){l.preventDefault();return}this.open&&f?this.searchEl.blur():this.disabled||(this.open=!0,this.searchEl.focus())},isOptionSelected(l){return this.selectedValue.some(f=>this.optionComparator(f,l))},isOptionDeselectable(l){return this.isOptionSelected(l)&&this.deselectFromDropdown},optionComparator(l,f){return this.getOptionKey(l)===this.getOptionKey(f)},findOptionFromReducedValue(l){const f=b=>JSON.stringify(this.reduce(b))===JSON.stringify(l),v=[...this.options,...this.pushedTags].filter(f);return v.length===1?v[0]:v.find(b=>this.optionComparator(b,this.$data._value))||l},closeSearchOptions(){this.open=!1,this.$emit("search:blur")},maybeDeleteValue(){if(!this.searchEl.value.length&&this.selectedValue&&this.selectedValue.length&&this.clearable){let l=null;this.multiple&&(l=[...this.selectedValue.slice(0,this.selectedValue.length-1)]),this.updateValue(l)}},optionExists(l){return this.optionList.some(f=>this.optionComparator(f,l))},normalizeOptionForSlot(l){return typeof l=="object"?l:{[this.label]:l}},pushTag(l){this.pushedTags.push(l)},onEscape(){this.search.length?this.search="":this.searchEl.blur()},onSearchBlur(){if(this.mousedown&&!this.searching)this.mousedown=!1;else{const{clearSearchOnSelect:l,multiple:f}=this;this.clearSearchOnBlur({clearSearchOnSelect:l,multiple:f})&&(this.search=""),this.closeSearchOptions();return}if(this.search.length===0&&this.options.length===0){this.closeSearchOptions();return}},onSearchFocus(){this.open=!0,this.$emit("search:focus")},onMousedown(){this.mousedown=!0},onMouseUp(){this.mousedown=!1},onSearchKeyDown(l){const f=A=>(A.preventDefault(),!this.isComposing&&this.typeAheadSelect()),v={8:A=>this.maybeDeleteValue(),9:A=>this.onTab(),27:A=>this.onEscape(),38:A=>(A.preventDefault(),this.typeAheadUp()),40:A=>(A.preventDefault(),this.typeAheadDown())};this.selectOnKeyCodes.forEach(A=>v[A]=f);const b=this.mapKeydown(v,this);if(typeof b[l.keyCode]=="function")return b[l.keyCode](l)}}},h4=["dir"],d4=["id","aria-expanded","aria-owns"],f4={ref:"selectedOptions",class:"vs__selected-options"},p4=["disabled","title","aria-label","onClick"],m4={ref:"actions",class:"vs__actions"},_4=["disabled"],g4={class:"vs__spinner"},y4=["id"],v4=["id","aria-selected","onMouseover","onClick"],x4={key:0,class:"vs__no-options"},b4=Hc(" Sorry, no matching options. "),w4=["id"];function T4(l,f,v,b,A,R){const z=VP("append-to-body");return ri(),hi("div",{dir:v.dir,class:Xo(["v-select",R.stateClasses])},[Bs(l.$slots,"header",mo(_o(R.scope.header))),He("div",{id:`vs${v.uid}__combobox`,ref:"toggle",class:"vs__dropdown-toggle",role:"combobox","aria-expanded":R.dropdownOpen.toString(),"aria-owns":`vs${v.uid}__listbox`,"aria-label":"Search for option",onMousedown:f[1]||(f[1]=G=>R.toggleDropdown(G))},[He("div",f4,[(ri(!0),hi(Gr,null,Ko(R.selectedValue,(G,o)=>Bs(l.$slots,"selected-option-container",{option:R.normalizeOptionForSlot(G),deselect:R.deselect,multiple:v.multiple,disabled:v.disabled},()=>[(ri(),hi("span",{key:v.getOptionKey(G),class:"vs__selected"},[Bs(l.$slots,"selected-option",mo(_o(R.normalizeOptionForSlot(G))),()=>[Hc(Nr(v.getOptionLabel(G)),1)]),v.multiple?(ri(),hi("button",{key:0,ref_for:!0,ref:Y=>A.deselectButtons[o]=Y,disabled:v.disabled,type:"button",class:"vs__deselect",title:`Deselect ${v.getOptionLabel(G)}`,"aria-label":`Deselect ${v.getOptionLabel(G)}`,onClick:Y=>R.deselect(G)},[(ri(),$c(Py(R.childComponents.Deselect)))],8,p4)):Xr("",!0)]))])),256)),Bs(l.$slots,"search",mo(_o(R.scope.search)),()=>[He("input",a0({class:"vs__search"},R.scope.search.attributes,UP(R.scope.search.events)),null,16)])],512),He("div",m4,[Tl(He("button",{ref:"clearButton",disabled:v.disabled,type:"button",class:"vs__clear",title:"Clear Selected","aria-label":"Clear Selected",onClick:f[0]||(f[0]=(...G)=>R.clearSelection&&R.clearSelection(...G))},[(ri(),$c(Py(R.childComponents.Deselect)))],8,_4),[[Nf,R.showClearButton]]),Bs(l.$slots,"open-indicator",mo(_o(R.scope.openIndicator)),()=>[v.noDrop?Xr("",!0):(ri(),$c(Py(R.childComponents.OpenIndicator),mo(a0({key:0},R.scope.openIndicator.attributes)),null,16))]),Bs(l.$slots,"spinner",mo(_o(R.scope.spinner)),()=>[Tl(He("div",g4,"Loading...",512),[[Nf,l.mutableLoading]])])],512)],40,d4),Cr(qc,{name:v.transition},{default:go(()=>[R.dropdownOpen?Tl((ri(),hi("ul",{id:`vs${v.uid}__listbox`,ref:"dropdownMenu",key:`vs${v.uid}__listbox`,class:"vs__dropdown-menu",role:"listbox",tabindex:"-1",onMousedown:f[2]||(f[2]=c0((...G)=>R.onMousedown&&R.onMousedown(...G),["prevent"])),onMouseup:f[3]||(f[3]=(...G)=>R.onMouseUp&&R.onMouseUp(...G))},[Bs(l.$slots,"list-header",mo(_o(R.scope.listHeader))),(ri(!0),hi(Gr,null,Ko(R.filteredOptions,(G,o)=>(ri(),hi("li",{id:`vs${v.uid}__option-${o}`,key:v.getOptionKey(G),role:"option",class:Xo(["vs__dropdown-option",{"vs__dropdown-option--deselect":R.isOptionDeselectable(G)&&o===l.typeAheadPointer,"vs__dropdown-option--selected":R.isOptionSelected(G),"vs__dropdown-option--highlight":o===l.typeAheadPointer,"vs__dropdown-option--disabled":!v.selectable(G)}]),"aria-selected":o===l.typeAheadPointer?!0:null,onMouseover:Y=>v.selectable(G)?l.typeAheadPointer=o:null,onClick:c0(Y=>v.selectable(G)?R.select(G):null,["prevent","stop"])},[Bs(l.$slots,"option",mo(_o(R.normalizeOptionForSlot(G))),()=>[Hc(Nr(v.getOptionLabel(G)),1)])],42,v4))),128)),R.filteredOptions.length===0?(ri(),hi("li",x4,[Bs(l.$slots,"no-options",mo(_o(R.scope.noOptions)),()=>[b4])])):Xr("",!0),Bs(l.$slots,"list-footer",mo(_o(R.scope.listFooter)))],40,y4)),[[z]]):(ri(),hi("ul",{key:1,id:`vs${v.uid}__listbox`,role:"listbox",style:{display:"none",visibility:"hidden"}},null,8,w4))]),_:3},8,["name"]),Bs(l.$slots,"footer",mo(_o(R.scope.footer)))],10,h4)}const E4=K0(u4,[["render",T4]]),Y0=hL();Y0.use(TL);window.globalStore=Y0;const k_=aL(ML);k_.component("v-select",E4);k_.use(NF);k_.use(Y0);k_.mount("#app");
Index: dist/assets/index-BOYdbmYQ.css
===================================================================
diff --git a/dist/assets/index-BOYdbmYQ.css b/dist/assets/index-BOYdbmYQ.css
deleted file mode 100644
--- a/dist/assets/index-BOYdbmYQ.css	(revision 8f975f13449215f9523e04b8741069004d457444)
+++ /dev/null	(revision 8f975f13449215f9523e04b8741069004d457444)
@@ -1,1 +0,0 @@
-*,:before,:after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}:before,:after{--tw-content: ""}html,:host{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,sans-serif,"Apple Color Emoji","Segoe UI Emoji",Segoe UI Symbol,"Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal;-webkit-tap-highlight-color:transparent}body{margin:0;line-height:inherit}hr{height:0;color:inherit;border-top-width:1px}abbr:where([title]){-webkit-text-decoration:underline dotted;text-decoration:underline dotted}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}b,strong{font-weight:bolder}code,kbd,samp,pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,Liberation Mono,Courier New,monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}table{text-indent:0;border-color:inherit;border-collapse:collapse}button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;letter-spacing:inherit;color:inherit;margin:0;padding:0}button,select{text-transform:none}button,input:where([type=button]),input:where([type=reset]),input:where([type=submit]){-webkit-appearance:button;background-color:transparent;background-image:none}:-moz-focusring{outline:auto}:-moz-ui-invalid{box-shadow:none}progress{vertical-align:baseline}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}summary{display:list-item}blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}fieldset{margin:0;padding:0}legend{padding:0}ol,ul,menu{list-style:none;margin:0;padding:0}dialog{padding:0}textarea{resize:vertical}input::-moz-placeholder,textarea::-moz-placeholder{opacity:1;color:#9ca3af}input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}button,[role=button]{cursor:pointer}:disabled{cursor:default}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}[hidden]{display:none}*,:before,:after{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }::backdrop{--tw-border-spacing-x: 0;--tw-border-spacing-y: 0;--tw-translate-x: 0;--tw-translate-y: 0;--tw-rotate: 0;--tw-skew-x: 0;--tw-skew-y: 0;--tw-scale-x: 1;--tw-scale-y: 1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness: proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width: 0px;--tw-ring-offset-color: #fff;--tw-ring-color: rgb(59 130 246 / .5);--tw-ring-offset-shadow: 0 0 #0000;--tw-ring-shadow: 0 0 #0000;--tw-shadow: 0 0 #0000;--tw-shadow-colored: 0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: ;--tw-contain-size: ;--tw-contain-layout: ;--tw-contain-paint: ;--tw-contain-style: }.container{width:100%}@media (min-width: 640px){.container{max-width:640px}}@media (min-width: 768px){.container{max-width:768px}}@media (min-width: 1024px){.container{max-width:1024px}}@media (min-width: 1280px){.container{max-width:1280px}}@media (min-width: 1536px){.container{max-width:1536px}}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.pointer-events-none{pointer-events:none}.visible{visibility:visible}.static{position:static}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-y-0{top:0;bottom:0}.bottom-2{bottom:.5rem}.bottom-2\.5{bottom:.625rem}.end-2{inset-inline-end:.5rem}.end-2\.5{inset-inline-end:.625rem}.left-0{left:0}.start-0{inset-inline-start:0px}.top-0{top:0}.top-69{top:69px}.z-20{z-index:20}.z-40{z-index:40}.m-4{margin:1rem}.mx-auto{margin-left:auto;margin-right:auto}.my-6{margin-top:1.5rem;margin-bottom:1.5rem}.mb-2{margin-bottom:.5rem}.mb-3{margin-bottom:.75rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.me-4{margin-inline-end:1rem}.ml-0{margin-left:0}.mr-2{margin-right:.5rem}.mr-4{margin-right:1rem}.mr-5{margin-right:1.25rem}.mr-9{margin-right:2.25rem}.ms-2{margin-inline-start:.5rem}.mt-2{margin-top:.5rem}.mt-3{margin-top:.75rem}.mt-6{margin-top:1.5rem}.block{display:block}.flex{display:flex}.inline-flex{display:inline-flex}.hidden{display:none}.h-3{height:.75rem}.h-3\.5{height:.875rem}.h-4{height:1rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-69{height:69px}.h-8{height:2rem}.h-\[calc\(100vh\)\]{height:100vh}.h-\[calc\(100vh-69px\)\]{height:calc(100vh - 69px)}.h-full{height:100%}.h-screen{height:100vh}.min-h-0{min-height:0px}.w-11{width:2.75rem}.w-20{width:5rem}.w-3{width:.75rem}.w-3\.5{width:.875rem}.w-4{width:1rem}.w-5{width:1.25rem}.w-full{width:100%}.max-w-screen-xl{max-width:1280px}.max-w-sm{max-width:24rem}.flex-1{flex:1 1 0%}.flex-shrink{flex-shrink:1}.flex-grow{flex-grow:1}.-translate-x-0{--tw-translate-x: -0px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.-translate-x-full{--tw-translate-x: -100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.transform{transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.cursor-auto{cursor:auto}.cursor-pointer{cursor:pointer}.flex-col{flex-direction:column}.flex-wrap{flex-wrap:wrap}.items-center{align-items:center}.justify-between{justify-content:space-between}.space-x-3>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(.75rem * var(--tw-space-x-reverse));margin-left:calc(.75rem * calc(1 - var(--tw-space-x-reverse)))}.space-x-6>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 0;margin-right:calc(1.5rem * var(--tw-space-x-reverse));margin-left:calc(1.5rem * calc(1 - var(--tw-space-x-reverse)))}.self-center{align-self:center}.overflow-y-auto{overflow-y:auto}.whitespace-nowrap{white-space:nowrap}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-t-lg{border-top-left-radius:.5rem;border-top-right-radius:.5rem}.border{border-width:1px}.border-4{border-width:4px}.border-b{border-bottom-width:1px}.border-solid{border-style:solid}.border-gray-200{--tw-border-opacity: 1;border-color:rgb(229 231 235 / var(--tw-border-opacity))}.border-gray-300{--tw-border-opacity: 1;border-color:rgb(209 213 219 / var(--tw-border-opacity))}.border-gray-500{--tw-border-opacity: 1;border-color:rgb(107 114 128 / var(--tw-border-opacity))}.bg-\[\#431A63\]{--tw-bg-opacity: 1;background-color:rgb(67 26 99 / var(--tw-bg-opacity))}.bg-blue-700{--tw-bg-opacity: 1;background-color:rgb(29 78 216 / var(--tw-bg-opacity))}.bg-gray-50{--tw-bg-opacity: 1;background-color:rgb(249 250 251 / var(--tw-bg-opacity))}.bg-green-600{--tw-bg-opacity: 1;background-color:rgb(22 163 74 / var(--tw-bg-opacity))}.bg-green-800{--tw-bg-opacity: 1;background-color:rgb(22 101 52 / var(--tw-bg-opacity))}.bg-red-600{--tw-bg-opacity: 1;background-color:rgb(220 38 38 / var(--tw-bg-opacity))}.bg-slate-100{--tw-bg-opacity: 1;background-color:rgb(241 245 249 / var(--tw-bg-opacity))}.bg-white{--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity))}.p-2{padding:.5rem}.p-4{padding:1rem}.p-5{padding:1.25rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-4{padding-top:1rem;padding-bottom:1rem}.ps-10{padding-inline-start:2.5rem}.ps-3{padding-inline-start:.75rem}.text-center{text-align:center}.text-2xl{font-size:1.5rem;line-height:2rem}.text-base{font-size:1rem;line-height:1.5rem}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.font-bold{font-weight:700}.font-medium{font-weight:500}.font-normal{font-weight:400}.font-semibold{font-weight:600}.tracking-tight{letter-spacing:-.025em}.text-blue-700{--tw-text-opacity: 1;color:rgb(29 78 216 / var(--tw-text-opacity))}.text-gray-200{--tw-text-opacity: 1;color:rgb(229 231 235 / var(--tw-text-opacity))}.text-gray-600{--tw-text-opacity: 1;color:rgb(75 85 99 / var(--tw-text-opacity))}.text-gray-700{--tw-text-opacity: 1;color:rgb(55 65 81 / var(--tw-text-opacity))}.text-gray-900{--tw-text-opacity: 1;color:rgb(17 24 39 / var(--tw-text-opacity))}.text-slate-100{--tw-text-opacity: 1;color:rgb(241 245 249 / var(--tw-text-opacity))}.text-slate-500{--tw-text-opacity: 1;color:rgb(100 116 139 / var(--tw-text-opacity))}.text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity))}.underline{text-decoration-line:underline}.shadow{--tw-shadow: 0 1px 3px 0 rgb(0 0 0 / .1), 0 1px 2px -1px rgb(0 0 0 / .1);--tw-shadow-colored: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-lg{--tw-shadow: 0 10px 15px -3px rgb(0 0 0 / .1), 0 4px 6px -4px rgb(0 0 0 / .1);--tw-shadow-colored: 0 10px 15px -3px var(--tw-shadow-color), 0 4px 6px -4px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-md{--tw-shadow: 0 4px 6px -1px rgb(0 0 0 / .1), 0 2px 4px -2px rgb(0 0 0 / .1);--tw-shadow-colored: 0 4px 6px -1px var(--tw-shadow-color), 0 2px 4px -2px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.shadow-xl{--tw-shadow: 0 20px 25px -5px rgb(0 0 0 / .1), 0 8px 10px -6px rgb(0 0 0 / .1);--tw-shadow-colored: 0 20px 25px -5px var(--tw-shadow-color), 0 8px 10px -6px var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.outline{outline-style:solid}.filter{filter:var(--tw-blur) var(--tw-brightness) var(--tw-contrast) var(--tw-grayscale) var(--tw-hue-rotate) var(--tw-invert) var(--tw-saturate) var(--tw-sepia) var(--tw-drop-shadow)}.transition{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,-webkit-backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter;transition-property:color,background-color,border-color,text-decoration-color,fill,stroke,opacity,box-shadow,transform,filter,backdrop-filter,-webkit-backdrop-filter;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-transform{transition-property:transform;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-75{transition-duration:75ms}html,body,main{overflow-x:hidden}body,html{margin:0;padding:0;height:100%;display:flex;flex-direction:column}#overlay{position:fixed;width:100%;height:100%;top:0;left:0;right:0;bottom:0;background-color:#00000080;z-index:2;cursor:pointer}div.vs__dropdown-toggle{padding:20px;padding-left:10px!important;border:none}input.vs__search{color:#8f8f8f}ul#vs1__listbox{border:1px solid rgb(186,186,186);background-color:#f5f5f5;border-radius:6px}ul#vs2__listbox>li:hover{background-color:#1d4ed8!important}input[type=radio],input[type=checkbox]{margin-right:10px;margin-top:10px;width:15px;height:15px}fieldset>div{padding:3px 3px 3px 0;font-size:17px}fieldset{border-bottom:1px solid rgb(186,186,186);padding-bottom:20px;margin-bottom:20px}fieldset>div>input[type=number]{padding:10px;border-radius:8px}.after\:absolute:after{content:var(--tw-content);position:absolute}.after\:start-\[2px\]:after{content:var(--tw-content);inset-inline-start:2px}.after\:top-0:after{content:var(--tw-content);top:0}.after\:top-0\.5:after{content:var(--tw-content);top:.125rem}.after\:h-5:after{content:var(--tw-content);height:1.25rem}.after\:w-5:after{content:var(--tw-content);width:1.25rem}.after\:rounded-full:after{content:var(--tw-content);border-radius:9999px}.after\:border:after{content:var(--tw-content);border-width:1px}.after\:border-gray-300:after{content:var(--tw-content);--tw-border-opacity: 1;border-color:rgb(209 213 219 / var(--tw-border-opacity))}.after\:bg-white:after{content:var(--tw-content);--tw-bg-opacity: 1;background-color:rgb(255 255 255 / var(--tw-bg-opacity))}.after\:transition-all:after{content:var(--tw-content);transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.after\:content-\[\'\'\]:after{--tw-content: "";content:var(--tw-content)}.hover\:cursor-not-allowed:hover{cursor:not-allowed}.hover\:cursor-pointer:hover{cursor:pointer}.hover\:bg-blue-800:hover{--tw-bg-opacity: 1;background-color:rgb(30 64 175 / var(--tw-bg-opacity))}.hover\:bg-green-800:hover{--tw-bg-opacity: 1;background-color:rgb(22 101 52 / var(--tw-bg-opacity))}.hover\:underline:hover{text-decoration-line:underline}.focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}.focus\:ring-4:focus{--tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color);--tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(4px + var(--tw-ring-offset-width)) var(--tw-ring-color);box-shadow:var(--tw-ring-offset-shadow),var(--tw-ring-shadow),var(--tw-shadow, 0 0 #0000)}.focus\:ring-blue-300:focus{--tw-ring-opacity: 1;--tw-ring-color: rgb(147 197 253 / var(--tw-ring-opacity))}.peer:checked~.peer-checked\:bg-\[\#613583\]{--tw-bg-opacity: 1;background-color:rgb(97 53 131 / var(--tw-bg-opacity))}.peer:checked~.peer-checked\:bg-green-600{--tw-bg-opacity: 1;background-color:rgb(22 163 74 / var(--tw-bg-opacity))}.peer:checked~.peer-checked\:after\:translate-x-full:after{content:var(--tw-content);--tw-translate-x: 100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.peer:checked~.peer-checked\:after\:border-white:after{content:var(--tw-content);--tw-border-opacity: 1;border-color:rgb(255 255 255 / var(--tw-border-opacity))}@media (min-width: 640px){.sm\:mx-auto{margin-left:auto;margin-right:auto}.sm\:mb-0{margin-bottom:0}.sm\:ml-\[25rem\]{margin-left:25rem}.sm\:flex{display:flex}.sm\:w-\[25rem\]{width:25rem}.sm\:w-\[calc\(100vw\)\]{width:100vw}.sm\:w-\[calc\(100vw-25rem\)\]{width:calc(100vw - 25rem)}.sm\:translate-x-0{--tw-translate-x: 0px;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.sm\:items-center{align-items:center}.sm\:justify-between{justify-content:space-between}.sm\:text-center{text-align:center}}@media (min-width: 768px){.md\:me-6{margin-inline-end:1.5rem}.md\:hidden{display:none}.md\:py-8{padding-top:2rem;padding-bottom:2rem}}@media (min-width: 1024px){.lg\:my-8{margin-top:2rem;margin-bottom:2rem}}.rtl\:rotate-180:where([dir=rtl],[dir=rtl] *){--tw-rotate: 180deg;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}.rtl\:space-x-reverse:where([dir=rtl],[dir=rtl] *)>:not([hidden])~:not([hidden]){--tw-space-x-reverse: 1}.peer:checked~.rtl\:peer-checked\:after\:-translate-x-full:where([dir=rtl],[dir=rtl] *):after{content:var(--tw-content);--tw-translate-x: -100%;transform:translate(var(--tw-translate-x),var(--tw-translate-y)) rotate(var(--tw-rotate)) skew(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y))}@media (prefers-color-scheme: dark){.dark\:border-gray-400{--tw-border-opacity: 1;border-color:rgb(156 163 175 / var(--tw-border-opacity))}.dark\:border-gray-600{--tw-border-opacity: 1;border-color:rgb(75 85 99 / var(--tw-border-opacity))}.dark\:text-gray-200{--tw-text-opacity: 1;color:rgb(229 231 235 / var(--tw-text-opacity))}.dark\:text-white{--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity))}.dark\:hover\:bg-green-700:hover{--tw-bg-opacity: 1;background-color:rgb(21 128 61 / var(--tw-bg-opacity))}}:root{--vs-colors--lightest: rgba(60, 60, 60, .26);--vs-colors--light: rgba(60, 60, 60, .5);--vs-colors--dark: #333;--vs-colors--darkest: rgba(0, 0, 0, .15);--vs-search-input-color: inherit;--vs-search-input-placeholder-color: inherit;--vs-font-size: 1rem;--vs-line-height: 1.4;--vs-state-disabled-bg: rgb(248, 248, 248);--vs-state-disabled-color: var(--vs-colors--light);--vs-state-disabled-controls-color: var(--vs-colors--light);--vs-state-disabled-cursor: not-allowed;--vs-border-color: var(--vs-colors--lightest);--vs-border-width: 1px;--vs-border-style: solid;--vs-border-radius: 4px;--vs-actions-padding: 4px 6px 0 3px;--vs-controls-color: var(--vs-colors--light);--vs-controls-size: 1;--vs-controls--deselect-text-shadow: 0 1px 0 #fff;--vs-selected-bg: #f0f0f0;--vs-selected-color: var(--vs-colors--dark);--vs-selected-border-color: var(--vs-border-color);--vs-selected-border-style: var(--vs-border-style);--vs-selected-border-width: var(--vs-border-width);--vs-dropdown-bg: #fff;--vs-dropdown-color: inherit;--vs-dropdown-z-index: 1000;--vs-dropdown-min-width: 160px;--vs-dropdown-max-height: 350px;--vs-dropdown-box-shadow: 0px 3px 6px 0px var(--vs-colors--darkest);--vs-dropdown-option-bg: #000;--vs-dropdown-option-color: var(--vs-dropdown-color);--vs-dropdown-option-padding: 3px 20px;--vs-dropdown-option--active-bg: #5897fb;--vs-dropdown-option--active-color: #fff;--vs-dropdown-option--deselect-bg: #fb5858;--vs-dropdown-option--deselect-color: #fff;--vs-transition-timing-function: cubic-bezier(1, -.115, .975, .855);--vs-transition-duration: .15s}.v-select{position:relative;font-family:inherit}.v-select,.v-select *{box-sizing:border-box}:root{--vs-transition-timing-function: cubic-bezier(1, .5, .8, 1);--vs-transition-duration: .15s}@keyframes vSelectSpinner{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.vs__fade-enter-active,.vs__fade-leave-active{pointer-events:none;transition:opacity var(--vs-transition-duration) var(--vs-transition-timing-function)}.vs__fade-enter,.vs__fade-leave-to{opacity:0}:root{--vs-disabled-bg: var(--vs-state-disabled-bg);--vs-disabled-color: var(--vs-state-disabled-color);--vs-disabled-cursor: var(--vs-state-disabled-cursor)}.vs--disabled .vs__dropdown-toggle,.vs--disabled .vs__clear,.vs--disabled .vs__search,.vs--disabled .vs__selected,.vs--disabled .vs__open-indicator{cursor:var(--vs-disabled-cursor);background-color:var(--vs-disabled-bg)}.v-select[dir=rtl] .vs__actions{padding:0 3px 0 6px}.v-select[dir=rtl] .vs__clear{margin-left:6px;margin-right:0}.v-select[dir=rtl] .vs__deselect{margin-left:0;margin-right:2px}.v-select[dir=rtl] .vs__dropdown-menu{text-align:right}.vs__dropdown-toggle{-webkit-appearance:none;-moz-appearance:none;appearance:none;display:flex;padding:0 0 4px;background:none;border:var(--vs-border-width) var(--vs-border-style) var(--vs-border-color);border-radius:var(--vs-border-radius);white-space:normal}.vs__selected-options{display:flex;flex-basis:100%;flex-grow:1;flex-wrap:wrap;padding:0 2px;position:relative}.vs__actions{display:flex;align-items:center;padding:var(--vs-actions-padding)}.vs--searchable .vs__dropdown-toggle{cursor:text}.vs--unsearchable .vs__dropdown-toggle{cursor:pointer}.vs--open .vs__dropdown-toggle{border-bottom-color:transparent;border-bottom-left-radius:0;border-bottom-right-radius:0}.vs__open-indicator{fill:var(--vs-controls-color);transform:scale(var(--vs-controls-size));transition:transform var(--vs-transition-duration) var(--vs-transition-timing-function);transition-timing-function:var(--vs-transition-timing-function)}.vs--open .vs__open-indicator{transform:rotate(180deg) scale(var(--vs-controls-size))}.vs--loading .vs__open-indicator{opacity:0}.vs__clear{fill:var(--vs-controls-color);padding:0;border:0;background-color:transparent;cursor:pointer;margin-right:8px}.vs__dropdown-menu{display:block;box-sizing:border-box;position:absolute;top:calc(100% - var(--vs-border-width));left:0;z-index:var(--vs-dropdown-z-index);padding:5px 0;margin:0;width:100%;max-height:var(--vs-dropdown-max-height);min-width:var(--vs-dropdown-min-width);overflow-y:auto;box-shadow:var(--vs-dropdown-box-shadow);border:var(--vs-border-width) var(--vs-border-style) var(--vs-border-color);border-top-style:none;border-radius:0 0 var(--vs-border-radius) var(--vs-border-radius);text-align:left;list-style:none;background:var(--vs-dropdown-bg);color:var(--vs-dropdown-color)}.vs__no-options{text-align:center}.vs__dropdown-option{line-height:1.42857143;display:block;padding:var(--vs-dropdown-option-padding);clear:both;color:var(--vs-dropdown-option-color);white-space:nowrap;cursor:pointer}.vs__dropdown-option--highlight{background:var(--vs-dropdown-option--active-bg);color:var(--vs-dropdown-option--active-color)}.vs__dropdown-option--deselect{background:var(--vs-dropdown-option--deselect-bg);color:var(--vs-dropdown-option--deselect-color)}.vs__dropdown-option--disabled{background:var(--vs-state-disabled-bg);color:var(--vs-state-disabled-color);cursor:var(--vs-state-disabled-cursor)}.vs__selected{display:flex;align-items:center;background-color:var(--vs-selected-bg);border:var(--vs-selected-border-width) var(--vs-selected-border-style) var(--vs-selected-border-color);border-radius:var(--vs-border-radius);color:var(--vs-selected-color);line-height:var(--vs-line-height);margin:4px 2px 0;padding:0 .25em;z-index:0}.vs__deselect{display:inline-flex;-webkit-appearance:none;-moz-appearance:none;appearance:none;margin-left:4px;padding:0;border:0;cursor:pointer;background:none;fill:var(--vs-controls-color);text-shadow:var(--vs-controls--deselect-text-shadow)}.vs--single .vs__selected{background-color:transparent;border-color:transparent}.vs--single.vs--open .vs__selected,.vs--single.vs--loading .vs__selected{position:absolute;opacity:.4}.vs--single.vs--searching .vs__selected{display:none}.vs__search::-webkit-search-cancel-button{display:none}.vs__search::-webkit-search-decoration,.vs__search::-webkit-search-results-button,.vs__search::-webkit-search-results-decoration,.vs__search::-ms-clear{display:none}.vs__search,.vs__search:focus{color:var(--vs-search-input-color);-webkit-appearance:none;-moz-appearance:none;appearance:none;line-height:var(--vs-line-height);font-size:var(--vs-font-size);border:1px solid transparent;border-left:none;outline:none;margin:4px 0 0;padding:0 7px;background:none;box-shadow:none;width:0;max-width:100%;flex-grow:1;z-index:1}.vs__search::-moz-placeholder{color:var(--vs-search-input-placeholder-color)}.vs__search::placeholder{color:var(--vs-search-input-placeholder-color)}.vs--unsearchable .vs__search{opacity:1}.vs--unsearchable:not(.vs--disabled) .vs__search{cursor:pointer}.vs--single.vs--searching:not(.vs--open):not(.vs--loading) .vs__search{opacity:.2}.vs__spinner{align-self:center;opacity:0;font-size:5px;text-indent:-9999em;overflow:hidden;border-top:.9em solid rgba(100,100,100,.1);border-right:.9em solid rgba(100,100,100,.1);border-bottom:.9em solid rgba(100,100,100,.1);border-left:.9em solid rgba(60,60,60,.45);transform:translateZ(0) scale(var(--vs-controls--spinner-size, var(--vs-controls-size)));animation:vSelectSpinner 1.1s infinite linear;transition:opacity .1s}.vs__spinner,.vs__spinner:after{border-radius:50%;width:5em;height:5em;transform:scale(var(--vs-controls--spinner-size, var(--vs-controls-size)))}.vs--loading .vs__spinner{opacity:1}div.max-w-sm[data-v-3ce56771]{max-width:33%;min-width:33%}nav,section{padding:20px}h1.logo{color:#fff;font-size:25px;text-align:center;font-weight:700}h2{font-size:20px}div.search-types{display:flex;justify-content:space-between;text-align:center;margin-top:15px}div.search-type{text-align:center;padding:10px;border:2px solid transparent;width:100%;margin:10px;color:#fff;border-radius:100px;font-weight:500}div.search-type:hover{cursor:pointer;background-color:#2563eb}div.search-type.active{background-color:#1e3a8a;border:2px solid white}.search-container{border:5px solid #facc15;border-radius:8px}.search-container>form{padding:5px;background-color:#f5f5f5}.search-container>form>input,select{width:100%;padding:20px;background-color:#f5f5f5}.search-container>form>input:not(:last-child),.search-container>form>select:not(:last-child){border-bottom:1px solid rgb(186,186,186)}.search-container>form>input::-moz-placeholder{color:#8f8f8f}.search-container>form>input::placeholder{color:#8f8f8f}select{color:#bababa}.search-container>.container-footer>button{width:100%;color:#fff;padding:15px;font-weight:500;border-bottom-left-radius:4px;border-bottom-right-radius:4px}.close-items{width:800px;display:flex;justify-content:flex-start}section#close-by{overflow-x:scroll;margin-right:20px}section#close-by::-webkit-scrollbar{display:none}div#ad-space{position:sticky;bottom:0;width:100%;background-color:#f5f5f5;outline:2px solid rgb(88,88,88);padding:20px}.container-header>div.search-error{width:100%;color:#fff;padding:15px;font-weight:500;border-top-left-radius:4px;border-top-right-radius:4px;text-align:center}.mapboxgl-ctrl-geocoder,.mapboxgl-ctrl-geocoder *,.mapboxgl-ctrl-geocoder *:after,.mapboxgl-ctrl-geocoder *:before{box-sizing:border-box}.mapboxgl-ctrl-geocoder{font-size:18px;line-height:24px;font-family:Open Sans,-apple-system,BlinkMacSystemFont,Helvetica Neue,Arial,Helvetica,sans-serif;position:relative;background-color:#fff;width:100%;min-width:240px;z-index:1;border-radius:4px;transition:width .25s,min-width .25s}.mapboxgl-ctrl-geocoder--input{font:inherit;width:100%;border:0;background-color:transparent;margin:0;height:50px;color:#404040;color:#000000bf;padding:6px 45px;text-overflow:ellipsis;white-space:nowrap;overflow:hidden}.mapboxgl-ctrl-geocoder--input::-ms-clear{display:none}.mapboxgl-ctrl-geocoder--input:focus{color:#404040;color:#000000bf;outline:0;box-shadow:none;outline:thin dotted}.mapboxgl-ctrl-geocoder .mapboxgl-ctrl-geocoder--pin-right>*{z-index:2;position:absolute;right:8px;top:7px;display:none}.mapboxgl-ctrl-geocoder,.mapboxgl-ctrl-geocoder .suggestions{box-shadow:0 0 10px 2px #0000001a}.mapboxgl-ctrl-geocoder.mapboxgl-ctrl-geocoder--collapsed{width:50px;min-width:50px;transition:width .25s,min-width .25s}.mapboxgl-ctrl-geocoder .suggestions{background-color:#fff;border-radius:4px;left:0;list-style:none;margin:0;padding:0;position:absolute;width:100%;top:110%;top:calc(100% + 6px);z-index:1000;overflow:hidden;font-size:15px}.mapboxgl-ctrl-bottom-left .suggestions,.mapboxgl-ctrl-bottom-right .suggestions{top:auto;bottom:100%}.mapboxgl-ctrl-geocoder .suggestions>li>a{cursor:default;display:block;padding:6px 12px;color:#404040}.mapboxgl-ctrl-geocoder .suggestions>.active>a,.mapboxgl-ctrl-geocoder .suggestions>li>a:hover{color:#404040;background-color:#f3f3f3;text-decoration:none;cursor:pointer}.mapboxgl-ctrl-geocoder--suggestion-title{font-weight:700}.mapboxgl-ctrl-geocoder--suggestion-title,.mapboxgl-ctrl-geocoder--suggestion-address{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mapboxgl-ctrl-geocoder--icon{display:inline-block;vertical-align:middle;speak:none;fill:#757575;top:15px}.mapboxgl-ctrl-geocoder--icon-search{position:absolute;top:13px;left:12px;width:23px;height:23px}.mapboxgl-ctrl-geocoder--button{padding:0;margin:0;border:none;cursor:pointer;background:#fff;line-height:1}.mapboxgl-ctrl-geocoder--icon-close{width:20px;height:20px;margin-top:8px;margin-right:3px}.mapboxgl-ctrl-geocoder--button:hover .mapboxgl-ctrl-geocoder--icon-close{fill:#909090}.mapboxgl-ctrl-geocoder--icon-geolocate{width:22px;height:22px;margin-top:6px;margin-right:3px}.mapboxgl-ctrl-geocoder--icon-loading{width:26px;height:26px;margin-top:5px;margin-right:0;animation:rotate .8s infinite cubic-bezier(.45,.05,.55,.95)}.mapboxgl-ctrl-geocoder--powered-by{display:block;float:left;padding:6px 12px 9px;font-size:13px}.mapboxgl-ctrl-geocoder--powered-by a{color:#909090}.mapboxgl-ctrl-geocoder--powered-by a:not(:hover){text-decoration:none}@keyframes rotate{0%{transform:rotate(0)}to{transform:rotate(360deg)}}@media screen and (min-width: 640px){.mapboxgl-ctrl-geocoder.mapboxgl-ctrl-geocoder--collapsed{width:36px;min-width:36px}.mapboxgl-ctrl-geocoder{width:33.3333%;font-size:15px;line-height:20px;max-width:360px}.mapboxgl-ctrl-geocoder .suggestions{font-size:13px}.mapboxgl-ctrl-geocoder--icon{top:8px}.mapboxgl-ctrl-geocoder--icon-close{width:16px;height:16px;margin-top:3px;margin-right:0}.mapboxgl-ctrl-geocoder--icon-geolocate{width:18px;height:18px;margin-top:2px;margin-right:0}.mapboxgl-ctrl-geocoder--icon-search{left:7px;width:20px;height:20px}.mapboxgl-ctrl-geocoder--input{height:36px;padding:6px 35px}.mapboxgl-ctrl-geocoder--icon-loading{width:26px;height:26px;margin-top:-2px;margin-right:-5px}.mapbox-gl-geocoder--error{color:#909090;padding:6px 12px;font-size:16px;text-align:center}.mapboxgl-ctrl-geocoder--powered-by{font-size:11px!important}}.mapboxgl-popup-content h3{background:#16a34a;color:#fff;margin:-15px 0 0;padding:10px;border-radius:.5rem .5rem 0 0;font-weight:700}.mapboxgl-popup-content a{display:inline-block;padding-left:10px!important;text-decoration:underline;margin-top:0;padding:10px;font-weight:400;color:#16a34a}.mapboxgl-popup-content span.mooring button.save{background:#16a34a}.mapboxgl-popup-anchor-top>.mapboxgl-popup-tip{border-bottom-color:#91c949}div.facilities[data-v-8a9631fb]{background-color:#613583}div.mooring[data-v-8a9631fb]{background-color:#16a34a}a[data-v-8a9631fb],button[data-v-8a9631fb]{margin-right:10px;text-decoration:underline}a[data-v-7af29514]{color:#16a34a;text-decoration:underline}.overlay{width:100%;height:100%;background-color:#eaeaea;display:flex;flex-direction:column;justify-content:center;align-items:center;position:relative;overflow:none}.loading{position:relative;width:10px;display:flex;align-items:center;margin-top:20px}.loading span{display:inline-block;width:10px;height:10px;background-color:#1d4ed8;border-radius:10px;position:absolute}.loading span:first-child{animation:loading-span1 1.3s infinite;left:0}.loading span:nth-child(2){animation:loading-span2 1.3s infinite;left:15px}.loading span:nth-child(3){animation:loading-span3 1.3s infinite;left:30px}@keyframes loading-span1{0%{height:10px}25%{height:20px}50%{height:10px}to{height:10px}}@keyframes loading-span2{0%{height:10px}25%{height:10px}50%{height:20px}75%{height:10px}to{height:10px}}@keyframes loading-span3{0%{height:10px}25%{height:10px}50%{height:10px}75%{height:20px}to{height:10px}}div.sortBox{padding:30px;border-top:2px solid rgb(186,186,186);border-top-right-radius:20px;border-top-left-radius:20px;position:fixed;bottom:0;left:0;right:0;background-color:#f0f0f0;min-height:30vh;max-height:50vh;overflow:scroll}div.sortBox>div.header{font-size:25px;display:flex;justify-content:space-between}div.sortBox>div.header>span.close:hover{cursor:pointer}div.filterBox,div.filterBox>div{padding:30px;position:fixed;bottom:0;left:0;right:0;background-color:#f0f0f0;min-height:100vh;max-height:100vh;overflow:scroll;transition:transform .3s ease-out,opacity .3s ease-out}div.filterBox>div>div.header{font-size:17px;display:flex;justify-content:space-between;border-bottom:1px solid rgb(186,186,186);padding-bottom:20px;margin-bottom:20px}div.filterBox>div>div.header>span.close:hover{cursor:pointer}div.filterBox>div>div.header>span.reset:hover{cursor:pointer}div#showResults{position:fixed;width:100%;max-height:200px;min-height:150px;overflow:hidden;bottom:0;background:#fff;border:1px solid rgb(186,186,186)}div#showResults>div>button{display:block;width:100%;padding:20px;border-radius:8px}div#searchContainer[data-v-588799d4]:hover{cursor:pointer}div#searchForm{background-color:#f5f5f5;z-index:9;position:fixed;padding:20px;width:100%}.down-enter-from{opacity:0;transform:translateY(-100%)}.down-enter-to{opacity:1;transform:translateY(0)}.down-enter-active{transition:transform .3s ease-in-out,opacity .3s ease-out}.down-leave-from{opacity:1;transform:translateY(0)}.down-leave-to{opacity:0;transform:translateY(-100%)}.down-leave-active{transition:transform .3s ease-in-out,opacity .5s ease-out}.slide-enter-from{opacity:0;transform:translateY(100%)}.slide-enter-to{opacity:1;transform:translateY(0)}.slide-enter-active{transition:transform .3s ease-in-out,opacity .3s ease-out}.slide-leave-from{opacity:1;transform:translateY(0)}.slide-leave-to{opacity:0;transform:translateY(100%)}.slide-leave-active{transition:transform .3s ease-in-out,opacity .5s ease-out}div#searchTermContainer{background-color:#f5f5f5;padding:15px;border:5px solid #facc15;border-radius:8px}div#searchContainer{position:relative;top:20px}div#searchOptions{background-color:#f5f5f5;width:100%;height:80px}div#searchOptions>div>span{width:100%;text-align:center}div#searchOptions>div>*:hover{cursor:pointer}div#searchTerm>span{display:inline-block}div#searchTerm>span.back{font-size:40px;margin-top:-15px;margin-right:15px}div#searchTerm>span.back:hover{cursor:pointer}div#searchResults{padding:20px}div.resultsCard{border:2px solid rgb(186,186,186);border-radius:8px;padding:10px}div.search-info-box>span.back:hover{cursor:pointer}.mapboxgl-popup-close-button{display:none}.mapboxgl-popup-content{font:400 15px/22px Source Sans Pro,Helvetica Neue,sans-serif;padding:0;min-width:12rem;min-height:7rem;border-radius:.5rem}.mapboxgl-popup-content span.facilities h3{background:#613583;color:#fff;margin:-15px 0 0;padding:10px;border-radius:.5rem .5rem 0 0;font-weight:700}.mapboxgl-popup-content h3{background:#1d4ed8;color:#fff;margin:-15px 0 0;padding:10px;border-radius:.5rem .5rem 0 0;font-weight:700}.mapboxgl-popup-content h4{margin:0;padding:10px;font-weight:400}.mapboxgl-popup-content a{display:inline-block;padding-left:10px!important;text-decoration:underline;margin-top:0;padding:10px;font-weight:400;color:#1d4ed8}.mapboxgl-popup-content button.save{margin-left:10px;margin-bottom:10px;display:block;width:90%;padding:5px;border:1px solid grey;font-weight:400;color:#e6e6e6;border-radius:.5rem;background-color:#613583}.mapboxgl-popup-content span.mooring button.save{background:#1d4ed8}.mapboxgl-popup-content span.facilities a{padding:10px;font-weight:400;color:#613583}.mapboxgl-popup-content div{padding:10px}.mapboxgl-popup-anchor-top>.mapboxgl-popup-content{margin-top:15px}.mapboxgl-popup-anchor-top>.mapboxgl-popup-tip{border-bottom-color:#1d4ed8}a{outline:none!important}.marker{border:none;cursor:pointer;height:56px;width:56px;background-image:url(/assets/pin_7695812-DsAVf1Ok.png);background-size:contain;background-repeat:no-repeat;background-position:center}span.back{font-size:40px;margin-top:-20px;margin-right:-15px}span.save{font-size:30px;margin-top:-5px;margin-right:-25px}span.back:hover,span.save:hover{cursor:pointer}div#serviceIcons{background-color:#f5f5f5;height:80px;padding:20px}div#serviceIcons>div{display:flex;justify-content:center;flex-wrap:nowrap;height:100%;overflow-x:scroll}div#serviceIcons>div::-webkit-scrollbar{display:none}div#serviceIcons>div>span{min-width:20%;max-width:20%}div#serviceIcons>div>span>img{width:auto;max-height:100%;margin:0 auto;border:3px solid #facc15;border-radius:8px}div#marinaHeading{padding:10px}div.marina-map-conatiner{height:25vh}
